<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Curso de Dibujo y Representación del Cuerpo Humano - Universidad Alberto Hurtado">
    <meta name="author" content="Joselyn Vizcarra">
    <title>Curso de Dibujo Anatómico - LMS UAH</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        :root {
            --primary-dark: #2c5f66;
            --primary-light: #e8a2b8;
            --dark: #1a1a1a;
            --gray-light: #f5f5f5;
            --gray-medium: #666;
            --success: #4CAF50;
            --danger: #f44336;
            --warning: #FFC107;
            --info: #2196F3;
            --whatsapp-green: #25D366;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }

        /* ===== HEADER ===== */
        .header-uah {
            background: linear-gradient(135deg, var(--primary-dark), var(--dark));
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            position: sticky;
            top: 0;
            z-index: 1030;
            backdrop-filter: blur(10px);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-section h1 {
            font-size: clamp(1rem, 3vw, 1.3rem);
            font-weight: 700;
            margin: 0;
            background: linear-gradient(135deg, white, var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .user-badge {
            background: rgba(255,255,255,0.15);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .user-badge:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary-light), #ff9cc5);
            color: var(--dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .user-badge span {
            font-size: 0.9rem;
        }

        .btn-logout {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid rgba(244, 67, 54, 0.4);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .btn-logout:hover {
            background: var(--danger);
            border-color: var(--danger);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
        }

        /* ===== DASHBOARD DEL ESTUDIANTE - RESPONSIVE ===== */
        .dashboard-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .dashboard-welcome {
            background: linear-gradient(135deg, var(--primary-dark), #1a3a3f);
            color: white;
            padding: 2rem 1.5rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }

        .dashboard-welcome::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(232,162,184,0.2) 0%, transparent 70%);
            border-radius: 50%;
        }

        .dashboard-welcome::after {
            content: '';
            position: absolute;
            bottom: -30%;
            left: -5%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(232,162,184,0.15) 0%, transparent 70%);
            border-radius: 50%;
        }

        .welcome-content {
            position: relative;
            z-index: 1;
        }

        .welcome-greeting {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .welcome-subtitle {
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            opacity: 0.9;
            margin-bottom: 0;
        }

        /* ===== STATS CARDS - RESPONSIVE ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary-dark);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .stat-value {
            font-size: clamp(2rem, 5vw, 2.5rem);
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .stat-label {
            color: var(--gray-medium);
            font-size: clamp(0.85rem, 2vw, 0.95rem);
            margin-bottom: 0.75rem;
        }

        .stat-progress {
            height: 6px;
            background: var(--gray-light);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .stat-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-dark), var(--primary-light));
            border-radius: 3px;
            transition: width 1s ease;
        }

        /* ===== COURSE INFO - RESPONSIVE ===== */
        .course-info-section {
            background: white;
            border-radius: 20px;
            padding: 2rem 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }

        .course-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .course-header h2 {
            font-size: clamp(1.5rem, 3vw, 2rem);
            color: var(--primary-dark);
            margin: 0;
        }

        .course-toggle-btn {
            background: linear-gradient(135deg, var(--primary-dark), #1a3a3f);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .course-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(44, 95, 102, 0.3);
        }

        .course-toggle-btn i {
            transition: transform 0.3s ease;
        }

        .course-toggle-btn[aria-expanded="true"] i {
            transform: rotate(180deg);
        }

        .course-content {
            padding-top: 1rem;
        }

        .course-description {
            font-size: clamp(0.95rem, 2vw, 1.1rem);
            line-height: 1.8;
            color: var(--gray-medium);
            margin-bottom: 2rem;
        }

        .course-highlights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .highlight-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .highlight-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .highlight-text h4 {
            font-size: clamp(0.95rem, 2vw, 1.1rem);
            margin-bottom: 0.25rem;
            color: var(--dark);
        }

        .highlight-text p {
            font-size: clamp(0.85rem, 1.5vw, 0.9rem);
            color: var(--gray-medium);
            margin: 0;
        }

        /* ===== MODULES GRID - RESPONSIVE ===== */
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .module-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border-top: 4px solid var(--primary-dark);
        }

        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .module-header {
            background: linear-gradient(135deg, var(--primary-dark), #1a3a3f);
            color: white;
            padding: 1.5rem;
        }

        .module-number {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .module-title {
            font-size: clamp(1.2rem, 2.5vw, 1.5rem);
            font-weight: 700;
            margin: 0;
        }

        .module-body {
            padding: 1.5rem;
        }

        .module-description {
            font-size: clamp(0.9rem, 1.5vw, 1rem);
            color: var(--gray-medium);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .module-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--gray-light);
            border-radius: 12px;
        }

        .module-stat {
            text-align: center;
        }

        .module-stat-value {
            font-size: clamp(1.3rem, 3vw, 1.5rem);
            font-weight: 700;
            color: var(--primary-dark);
        }

        .module-stat-label {
            font-size: clamp(0.75rem, 1.5vw, 0.85rem);
            color: var(--gray-medium);
        }

        .module-progress {
            margin-bottom: 1rem;
        }

        .module-progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            color: var(--gray-medium);
        }

        .module-progress-bar {
            height: 8px;
            background: var(--gray-light);
            border-radius: 4px;
            overflow: hidden;
        }

        .module-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), #66BB6A);
            border-radius: 4px;
            transition: width 1s ease;
        }

        .module-footer {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .btn-module {
            flex: 1;
            min-width: 120px;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .btn-primary-module {
            background: linear-gradient(135deg, var(--primary-dark), #1a3a3f);
            color: white;
        }

        .btn-primary-module:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(44, 95, 102, 0.3);
        }

        .btn-secondary-module {
            background: white;
            color: var(--primary-dark);
            border: 2px solid var(--primary-dark);
        }

        .btn-secondary-module:hover {
            background: var(--primary-dark);
            color: white;
        }

        /* ===== QUICK ACCESS - RESPONSIVE ===== */
        .quick-access-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .quick-access-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .quick-access-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
            border-left-color: var(--primary-dark);
        }

        .quick-access-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .quick-access-title {
            font-size: clamp(1rem, 2vw, 1.2rem);
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .quick-access-description {
            font-size: clamp(0.85rem, 1.5vw, 0.9rem);
            color: var(--gray-medium);
            margin: 0;
        }

        /* ===== MENTOR BUTTON - RESPONSIVE ===== */
        .mentor-float-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            border-radius: 50%;
            box-shadow: 0 4px 20px rgba(44, 95, 102, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1020;
            border: none;
        }

        .mentor-float-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(44, 95, 102, 0.5);
        }

        .mentor-float-btn i {
            font-size: 1.8rem;
            color: white;
        }

        /* ===== MENTOR MODAL - RESPONSIVE ===== */
        .mentor-modal-content {
            border-radius: 20px;
            border: none;
            box-shadow: 0 10px 50px rgba(0,0,0,0.2);
        }

        .mentor-modal-header {
            background: linear-gradient(135deg, var(--primary-dark), #1a3a3f);
            color: white;
            border-radius: 20px 20px 0 0;
            padding: 1.5rem;
        }

        .mentor-modal-body {
            padding: 1.5rem;
            max-height: 60vh;
            overflow-y: auto;
        }

        .mentor-messages {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            display: flex;
            gap: 0.75rem;
            animation: slideIn 0.3s ease;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 80%;
            padding: 1rem 1.25rem;
            border-radius: 18px;
            font-size: clamp(0.9rem, 1.5vw, 1rem);
            line-height: 1.5;
        }

        .message.mentor .message-bubble {
            background: var(--gray-light);
            color: var(--dark);
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, var(--primary-dark), #1a3a3f);
            color: white;
        }

        .mentor-input-area {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gray-light);
        }

        .mentor-input-group {
            display: flex;
            gap: 0.75rem;
        }

        .mentor-input {
            flex: 1;
            border: 2px solid var(--gray-light);
            border-radius: 25px;
            padding: 0.75rem 1.25rem;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .mentor-input:focus {
            outline: none;
            border-color: var(--primary-dark);
            box-shadow: 0 0 0 3px rgba(44, 95, 102, 0.1);
        }

        .btn-send-mentor {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary-dark), #1a3a3f);
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-send-mentor:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(44, 95, 102, 0.3);
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 1.25rem;
            background: var(--gray-light);
            border-radius: 18px;
            max-width: fit-content;
        }

        .typing-indicator.show {
            display: flex;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--gray-medium);
            border-radius: 50%;
            animation: typingDot 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingDot {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.6; }
            30% { transform: translateY(-10px); opacity: 1; }
        }

        /* ===== ANIMATIONS ===== */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* ===== RESPONSIVE ADJUSTMENTS ===== */
        @media (max-width: 992px) {
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            
            .modules-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 0 0.75rem;
            }
            
            .dashboard-welcome {
                padding: 1.5rem 1rem;
            }
            
            .course-info-section {
                padding: 1.5rem 1rem;
            }
            
            .mentor-float-btn {
                bottom: 1.5rem;
                right: 1.5rem;
                width: 55px;
                height: 55px;
            }
            
            .message-bubble {
                max-width: 90%;
            }
        }

        @media (max-width: 576px) {
            .header-content {
                padding: 0 1rem;
            }
            
            .user-section {
                width: 100%;
                justify-content: space-between;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .course-highlights {
                grid-template-columns: 1fr;
            }
            
            .quick-access-grid {
                grid-template-columns: 1fr;
            }
            
            .module-footer {
                flex-direction: column;
            }
            
            .btn-module {
                width: 100%;
            }
            
            .mentor-float-btn {
                width: 50px;
                height: 50px;
                bottom: 1rem;
                right: 1rem;
            }
        }

        /* ===== TOAST NOTIFICATIONS ===== */
        .toast-container {
            position: fixed;
            top: 5rem;
            right: 2rem;
            z-index: 1050;
        }

        @media (max-width: 576px) {
            .toast-container {
                right: 1rem;
                left: 1rem;
            }
        }

        .toast {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 1rem 1.25rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.95rem;
        }

        .toast-message {
            font-size: 0.85rem;
            color: var(--gray-medium);
            margin: 0;
        }

        .toast.success .toast-icon {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success);
        }

        .toast.error .toast-icon {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger);
        }

        .toast.warning .toast-icon {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning);
        }

        .toast.info .toast-icon {
            background: rgba(33, 150, 243, 0.1);
            color: var(--info);
        }
    </style>
</head>
<body>
    <!-- ===== HEADER ===== -->
    <header class="header-uah">
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <i class="bi bi-palette-fill" style="font-size: 2rem; color: var(--primary-light);"></i>
                    <h1>LMS Dibujo Anatómico</h1>
                </div>
                
                <div class="user-section">
                    <div class="user-badge">
                        <div class="user-avatar" id="userAvatar">E</div>
                        <span id="userName">Estudiante</span>
                    </div>
                    <button class="btn btn-logout" onclick="logout()">
                        <i class="bi bi-box-arrow-right"></i>
                        <span class="d-none d-sm-inline">Salir</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ===== DASHBOARD ===== -->
    <div class="container dashboard-container">
        <!-- Welcome Section -->
        <div class="dashboard-welcome">
            <div class="welcome-content">
                <h2 class="welcome-greeting" id="welcomeGreeting">¡Bienvenido/a de vuelta!</h2>
                <p class="welcome-subtitle">Continúa tu viaje en el arte del dibujo anatómico</p>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(76, 175, 80, 0.1); color: var(--success);">
                    <i class="bi bi-check-circle-fill"></i>
                </div>
                <div class="stat-value" id="lessonsCompleted">0</div>
                <div class="stat-label">Lecciones Completadas</div>
                <div class="stat-progress">
                    <div class="stat-progress-bar" id="lessonsProgressBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(255, 193, 7, 0.1); color: var(--warning);">
                    <i class="bi bi-lightning-charge-fill"></i>
                </div>
                <div class="stat-value" id="currentStreak">0</div>
                <div class="stat-label">Días Consecutivos</div>
                <div class="stat-progress">
                    <div class="stat-progress-bar" id="streakProgressBar" style="width: 0%; background: linear-gradient(90deg, var(--warning), #FFD54F);"></div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(33, 150, 243, 0.1); color: var(--info);">
                    <i class="bi bi-trophy-fill"></i>
                </div>
                <div class="stat-value" id="totalXP">0</div>
                <div class="stat-label">Puntos de Experiencia</div>
                <div class="stat-progress">
                    <div class="stat-progress-bar" id="xpProgressBar" style="width: 0%; background: linear-gradient(90deg, var(--info), #64B5F6);"></div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(232, 162, 184, 0.2); color: var(--primary-light);">
                    <i class="bi bi-clock-history"></i>
                </div>
                <div class="stat-value" id="studyTime">0h</div>
                <div class="stat-label">Tiempo de Estudio</div>
                <div class="stat-progress">
                    <div class="stat-progress-bar" id="timeProgressBar" style="width: 0%; background: linear-gradient(90deg, var(--primary-light), #ff9cc5);"></div>
                </div>
            </div>
        </div>

        <!-- Course Info Section - ACCORDION -->
        <div class="course-info-section">
            <div class="course-header">
                <h2>
                    <i class="bi bi-book-fill me-2" style="color: var(--primary-light);"></i>
                    Información del Curso
                </h2>
                <button class="course-toggle-btn" type="button" data-bs-toggle="collapse" data-bs-target="#courseInfoCollapse" aria-expanded="false" aria-controls="courseInfoCollapse">
                    Ver más información del curso
                    <i class="bi bi-chevron-down"></i>
                </button>
            </div>

            <div class="collapse" id="courseInfoCollapse">
                <div class="course-content">
                    <p class="course-description">
                        Este curso está diseñado para desarrollar tus habilidades en el dibujo anatómico mediante un enfoque progresivo basado en la observación contemplativa inspirada en Leonardo da Vinci. A través de tres módulos interconectados, aprenderás desde los fundamentos del gesto y la proporción hasta la representación completa de la figura humana con profundidad anatómica.
                    </p>

                    <div class="course-highlights">
                        <div class="highlight-item">
                            <div class="highlight-icon" style="background: rgba(76, 175, 80, 0.1); color: var(--success);">
                                <i class="bi bi-eye-fill"></i>
                            </div>
                            <div class="highlight-text">
                                <h4>Observación Activa</h4>
                                <p>Desarrolla tu capacidad de ver y entender la forma humana</p>
                            </div>
                        </div>

                        <div class="highlight-item">
                            <div class="highlight-icon" style="background: rgba(33, 150, 243, 0.1); color: var(--info);">
                                <i class="bi bi-people-fill"></i>
                            </div>
                            <div class="highlight-text">
                                <h4>Anatomía Funcional</h4>
                                <p>Comprende la estructura que da vida al movimiento</p>
                            </div>
                        </div>

                        <div class="highlight-item">
                            <div class="highlight-icon" style="background: rgba(255, 193, 7, 0.1); color: var(--warning);">
                                <i class="bi bi-pencil-fill"></i>
                            </div>
                            <div class="highlight-text">
                                <h4>Práctica Progresiva</h4>
                                <p>Ejercicios estructurados del gesto a la figura completa</p>
                            </div>
                        </div>

                        <div class="highlight-item">
                            <div class="highlight-icon" style="background: rgba(232, 162, 184, 0.2); color: var(--primary-light);">
                                <i class="bi bi-chat-heart-fill"></i>
                            </div>
                            <div class="highlight-text">
                                <h4>Mentor IA</h4>
                                <p>Apoyo personalizado disponible cuando lo necesites</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modules Grid -->
        <div class="mb-4">
            <h2 class="mb-4" style="color: var(--primary-dark); font-weight: 700;">
                <i class="bi bi-grid-3x3-gap-fill me-2" style="color: var(--primary-light);"></i>
                Módulos del Curso
            </h2>

            <div class="modules-grid">
                <!-- Module 1 -->
                <div class="module-card">
                    <div class="module-header">
                        <div class="module-number">MÓDULO 1</div>
                        <h3 class="module-title">Observación y Gesto</h3>
                    </div>
                    <div class="module-body">
                        <p class="module-description">
                            Aprende a capturar la esencia del movimiento humano a través de líneas gestuales y proporciones básicas.
                        </p>
                        
                        <div class="module-stats">
                            <div class="module-stat">
                                <div class="module-stat-value">4</div>
                                <div class="module-stat-label">Lecciones</div>
                            </div>
                            <div class="module-stat">
                                <div class="module-stat-value">8</div>
                                <div class="module-stat-label">Ejercicios</div>
                            </div>
                        </div>

                        <div class="module-progress">
                            <div class="module-progress-label">
                                <span>Progreso</span>
                                <span id="module1Progress">0%</span>
                            </div>
                            <div class="module-progress-bar">
                                <div class="module-progress-fill" id="module1ProgressBar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="module-footer">
                            <button class="btn-module btn-primary-module" onclick="goToModule(1)">
                                <i class="bi bi-play-fill me-2"></i>
                                Continuar
                            </button>
                            <button class="btn-module btn-secondary-module" onclick="viewModuleDetails(1)">
                                <i class="bi bi-info-circle me-2"></i>
                                Detalles
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Module 2 -->
                <div class="module-card">
                    <div class="module-header">
                        <div class="module-number">MÓDULO 2</div>
                        <h3 class="module-title">Anatomía Funcional</h3>
                    </div>
                    <div class="module-body">
                        <p class="module-description">
                            Comprende la estructura ósea y muscular que sustenta el movimiento y la forma humana.
                        </p>
                        
                        <div class="module-stats">
                            <div class="module-stat">
                                <div class="module-stat-value">3</div>
                                <div class="module-stat-label">Lecciones</div>
                            </div>
                            <div class="module-stat">
                                <div class="module-stat-value">8</div>
                                <div class="module-stat-label">Ejercicios</div>
                            </div>
                        </div>

                        <div class="module-progress">
                            <div class="module-progress-label">
                                <span>Progreso</span>
                                <span id="module2Progress">0%</span>
                            </div>
                            <div class="module-progress-bar">
                                <div class="module-progress-fill" id="module2ProgressBar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="module-footer">
                            <button class="btn-module btn-primary-module" onclick="goToModule(2)">
                                <i class="bi bi-play-fill me-2"></i>
                                Continuar
                            </button>
                            <button class="btn-module btn-secondary-module" onclick="viewModuleDetails(2)">
                                <i class="bi bi-info-circle me-2"></i>
                                Detalles
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Module 3 -->
                <div class="module-card">
                    <div class="module-header">
                        <div class="module-number">MÓDULO 3</div>
                        <h3 class="module-title">Figura Completa</h3>
                    </div>
                    <div class="module-body">
                        <p class="module-description">
                            Integra observación y anatomía para representar la figura humana con profundidad y expresión.
                        </p>
                        
                        <div class="module-stats">
                            <div class="module-stat">
                                <div class="module-stat-value">3</div>
                                <div class="module-stat-label">Lecciones</div>
                            </div>
                            <div class="module-stat">
                                <div class="module-stat-value">7</div>
                                <div class="module-stat-label">Ejercicios</div>
                            </div>
                        </div>

                        <div class="module-progress">
                            <div class="module-progress-label">
                                <span>Progreso</span>
                                <span id="module3Progress">0%</span>
                            </div>
                            <div class="module-progress-bar">
                                <div class="module-progress-fill" id="module3ProgressBar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="module-footer">
                            <button class="btn-module btn-primary-module" onclick="goToModule(3)">
                                <i class="bi bi-play-fill me-2"></i>
                                Continuar
                            </button>
                            <button class="btn-module btn-secondary-module" onclick="viewModuleDetails(3)">
                                <i class="bi bi-info-circle me-2"></i>
                                Detalles
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Access -->
        <div class="mb-5">
            <h2 class="mb-4" style="color: var(--primary-dark); font-weight: 700;">
                <i class="bi bi-lightning-fill me-2" style="color: var(--primary-light);"></i>
                Acceso Rápido
            </h2>

            <div class="quick-access-grid">
                <div class="quick-access-card" onclick="window.location.href='portfolio.html'">
                    <div class="quick-access-icon" style="background: rgba(33, 150, 243, 0.1); color: var(--info);">
                        <i class="bi bi-folder-fill"></i>
                    </div>
                    <h3 class="quick-access-title">Mi Portafolio</h3>
                    <p class="quick-access-description">Revisa todos tus trabajos y observa tu evolución</p>
                </div>

                <div class="quick-access-card" onclick="window.location.href='resources.html'">
                    <div class="quick-access-icon" style="background: rgba(255, 193, 7, 0.1); color: var(--warning);">
                        <i class="bi bi-book-half"></i>
                    </div>
                    <h3 class="quick-access-title">Recursos</h3>
                    <p class="quick-access-description">Accede a referencias y materiales complementarios</p>
                </div>

                <div class="quick-access-card" onclick="window.location.href='progress.html'">
                    <div class="quick-access-icon" style="background: rgba(76, 175, 80, 0.1); color: var(--success);">
                        <i class="bi bi-graph-up"></i>
                    </div>
                    <h3 class="quick-access-title">Mi Progreso</h3>
                    <p class="quick-access-description">Visualiza tus estadísticas y logros detallados</p>
                </div>

                <div class="quick-access-card" onclick="openMentorChat()">
                    <div class="quick-access-icon" style="background: rgba(232, 162, 184, 0.2); color: var(--primary-light);">
                        <i class="bi bi-chat-dots-fill"></i>
                    </div>
                    <h3 class="quick-access-title">Mentor Anatómico</h3>
                    <p class="quick-access-description">Consulta con tu asistente de aprendizaje IA</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== MENTOR FLOAT BUTTON ===== -->
    <button class="mentor-float-btn" id="mentorFloatBtn" onclick="openMentorChat()">
        <i class="bi bi-chat-heart-fill"></i>
    </button>

    <!-- ===== MENTOR MODAL ===== -->
    <div class="modal fade" id="mentorModal" tabindex="-1" aria-labelledby="mentorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content mentor-modal-content">
                <div class="mentor-modal-header">
                    <h5 class="modal-title" id="mentorModalLabel">
                        <i class="bi bi-robot me-2"></i>
                        Mentor Anatómico
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="mentor-modal-body">
                    <div class="mentor-messages" id="mentorMessages">
                        <!-- Messages will be added here dynamically -->
                    </div>
                    <div class="typing-indicator" id="typingIndicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
                <div class="mentor-input-area">
                    <div class="mentor-input-group">
                        <input type="text" class="mentor-input" id="mentorInput" placeholder="Escribe tu consulta aquí..." onkeypress="handleMentorKeyPress(event)">
                        <button class="btn-send-mentor" onclick="sendMentorMessage()">
                            <i class="bi bi-send-fill"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== ONBOARDING MODAL ===== -->
    <div class="modal fade" id="onboardingModal" tabindex="-1" aria-labelledby="onboardingModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content" style="border-radius: 20px; border: none;">
                <div class="modal-header" style="background: linear-gradient(135deg, var(--primary-dark), #1a3a3f); color: white; border-radius: 20px 20px 0 0;">
                    <h5 class="modal-title" id="onboardingModalLabel">
                        <i class="bi bi-rocket-takeoff-fill me-2"></i>
                        Bienvenido/a al Curso
                    </h5>
                    <button type="button" class="btn-close btn-close-white" onclick="skipOnboarding()" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="padding: 2rem;">
                    <!-- Step 1 -->
                    <div class="onboarding-step" id="onboarding-step-1">
                        <div class="text-center mb-4">
                            <i class="bi bi-palette-fill" style="font-size: 4rem; color: var(--primary-dark);"></i>
                        </div>
                        <h3 class="text-center mb-3" style="color: var(--primary-dark);">¡Bienvenido/a!</h3>
                        <p class="text-center" style="font-size: 1.1rem; color: var(--gray-medium);">
                            Estás a punto de comenzar un viaje fascinante en el arte del dibujo anatómico. 
                            Este curso te guiará desde los fundamentos hasta la maestría en la representación del cuerpo humano.
                        </p>
                        <div class="d-flex justify-content-center gap-3 mt-4">
                            <button class="btn btn-secondary" onclick="skipOnboarding()">Omitir</button>
                            <button class="btn btn-primary" onclick="nextOnboardingStep(2)" style="background: var(--primary-dark); border: none;">
                                Siguiente <i class="bi bi-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 2 -->
                    <div class="onboarding-step" id="onboarding-step-2" style="display: none;">
                        <div class="text-center mb-4">
                            <i class="bi bi-book-fill" style="font-size: 4rem; color: var(--info);"></i>
                        </div>
                        <h3 class="text-center mb-3" style="color: var(--primary-dark);">Estructura del Curso</h3>
                        <div class="row g-3">
                            <div class="col-12">
                                <div class="p-3" style="background: var(--gray-light); border-radius: 12px;">
                                    <h5 style="color: var(--primary-dark);">
                                        <i class="bi bi-1-circle-fill me-2"></i>
                                        Módulo 1: Observación y Gesto
                                    </h5>
                                    <p class="mb-0" style="color: var(--gray-medium);">Aprende a capturar el movimiento y las proporciones básicas</p>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="p-3" style="background: var(--gray-light); border-radius: 12px;">
                                    <h5 style="color: var(--primary-dark);">
                                        <i class="bi bi-2-circle-fill me-2"></i>
                                        Módulo 2: Anatomía Funcional
                                    </h5>
                                    <p class="mb-0" style="color: var(--gray-medium);">Comprende la estructura ósea y muscular del cuerpo</p>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="p-3" style="background: var(--gray-light); border-radius: 12px;">
                                    <h5 style="color: var(--primary-dark);">
                                        <i class="bi bi-3-circle-fill me-2"></i>
                                        Módulo 3: Figura Completa
                                    </h5>
                                    <p class="mb-0" style="color: var(--gray-medium);">Integra todo para representar la figura humana completa</p>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-center gap-3 mt-4">
                            <button class="btn btn-secondary" onclick="nextOnboardingStep(1)">
                                <i class="bi bi-arrow-left me-2"></i> Anterior
                            </button>
                            <button class="btn btn-primary" onclick="nextOnboardingStep(3)" style="background: var(--primary-dark); border: none;">
                                Siguiente <i class="bi bi-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 3 -->
                    <div class="onboarding-step" id="onboarding-step-3" style="display: none;">
                        <div class="text-center mb-4">
                            <i class="bi bi-chat-heart-fill" style="font-size: 4rem; color: var(--primary-light);"></i>
                        </div>
                        <h3 class="text-center mb-3" style="color: var(--primary-dark);">Tu Mentor Anatómico</h3>
                        <p class="text-center" style="font-size: 1.1rem; color: var(--gray-medium);">
                            Tienes acceso a un asistente de aprendizaje IA disponible 24/7. Puede ayudarte con:
                        </p>
                        <div class="row g-3 mt-3">
                            <div class="col-md-6">
                                <div class="d-flex align-items-start gap-2">
                                    <i class="bi bi-check-circle-fill" style="color: var(--success); font-size: 1.5rem;"></i>
                                    <div>
                                        <strong>Dudas técnicas</strong>
                                        <p class="mb-0 small" style="color: var(--gray-medium);">Anatomía, proporciones y técnicas</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-start gap-2">
                                    <i class="bi bi-check-circle-fill" style="color: var(--success); font-size: 1.5rem;"></i>
                                    <div>
                                        <strong>Apoyo emocional</strong>
                                        <p class="mb-0 small" style="color: var(--gray-medium);">Motivación y manejo de frustración</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-start gap-2">
                                    <i class="bi bi-check-circle-fill" style="color: var(--success); font-size: 1.5rem;"></i>
                                    <div>
                                        <strong>Recursos adicionales</strong>
                                        <p class="mb-0 small" style="color: var(--gray-medium);">Referencias y materiales complementarios</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-start gap-2">
                                    <i class="bi bi-check-circle-fill" style="color: var(--success); font-size: 1.5rem;"></i>
                                    <div>
                                        <strong>Planificación</strong>
                                        <p class="mb-0 small" style="color: var(--gray-medium);">Organización y gestión del tiempo</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-center gap-3 mt-4">
                            <button class="btn btn-secondary" onclick="nextOnboardingStep(2)">
                                <i class="bi bi-arrow-left me-2"></i> Anterior
                            </button>
                            <button class="btn btn-primary" onclick="finishOnboarding()" style="background: var(--success); border: none;">
                                <i class="bi bi-check-circle-fill me-2"></i> ¡Entendido!
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== SESSION COMPLETED MODAL ===== -->
    <div class="modal fade" id="sessionCompletedModal" tabindex="-1" aria-labelledby="sessionCompletedModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content" style="border-radius: 20px; border: none;">
                <div class="modal-header" style="background: linear-gradient(135deg, var(--success), #66BB6A); color: white; border-radius: 20px 20px 0 0;">
                    <h5 class="modal-title" id="sessionCompletedModalLabel">
                        <i class="bi bi-trophy-fill me-2"></i>
                        ¡Sesión Completada!
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="padding: 2rem;">
                    <div class="text-center mb-4">
                        <i class="bi bi-award-fill" style="font-size: 5rem; color: var(--success);"></i>
                    </div>
                    
                    <h3 class="text-center mb-4" style="color: var(--primary-dark);">Resumen de tu Sesión</h3>
                    
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <div class="text-center p-3" style="background: var(--gray-light); border-radius: 12px;">
                                <div style="font-size: 2rem; font-weight: 700; color: var(--primary-dark);" id="sessionLessonsCount">0</div>
                                <div style="color: var(--gray-medium);">Lecciones</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3" style="background: var(--gray-light); border-radius: 12px;">
                                <div style="font-size: 2rem; font-weight: 700; color: var(--primary-dark);" id="sessionTimeSpent">0</div>
                                <div style="color: var(--gray-medium);">Minutos</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3" style="background: var(--gray-light); border-radius: 12px;">
                                <div style="font-size: 2rem; font-weight: 700; color: var(--primary-dark);" id="sessionConceptsCount">0</div>
                                <div style="color: var(--gray-medium);">Conceptos</div>
                            </div>
                        </div>
                    </div>

                    <div id="sessionConceptsList" class="mb-4">
                        <!-- Concepts list will be inserted here -->
                    </div>

                    <div class="alert" style="background: rgba(76, 175, 80, 0.1); border: 1px solid var(--success); border-radius: 12px;" role="alert">
                        <h6 style="color: var(--success); margin-bottom: 0.5rem;">
                            <i class="bi bi-lightbulb-fill me-2"></i>
                            Mensaje motivacional
                        </h6>
                        <p style="margin: 0; color: var(--gray-medium);" id="motivationalMessage"></p>
                    </div>

                    <div class="mt-4 p-3" style="background: var(--gray-light); border-radius: 12px;">
                        <h6 style="color: var(--primary-dark); margin-bottom: 0.75rem;">
                            <i class="bi bi-compass-fill me-2"></i>
                            Próximo paso:
                        </h6>
                        <p style="margin: 0; color: var(--gray-medium);" id="nextStepDescription"></p>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid var(--gray-light); padding: 1.5rem;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Volver al Dashboard</button>
                    <button type="button" class="btn btn-primary" id="continueToNextLessonBtn" style="background: var(--primary-dark); border: none;">
                        <i class="bi bi-play-fill me-2"></i>
                        Continuar Aprendiendo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Configuration Script -->
    <script>
        // ============================================
        // CONFIGURACIÓN GLOBAL
        // ============================================
        
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzTw0-_0C8s-c2DjbsVyVlJ7m3W5OlKt3SbQZK6nRwWbQ5-JuLJMt9TrmPG-v8CChQa/exec';
        
        let currentUser = null;
        let userProgress = null;
    </script>

    <!-- Authentication & Initialization Script -->
    <script>
        // ============================================
        // AUTENTICACIÓN Y CARGA INICIAL
        // ============================================
        
        window.addEventListener('DOMContentLoaded', async function() {
            console.log('🚀 Iniciando carga del dashboard...');
            
            // Verificar autenticación
            const authData = localStorage.getItem('authData');
            if (!authData) {
                console.log('❌ No hay sesión activa, redirigiendo al login...');
                window.location.href = 'login.html';
                return;
            }
            
            try {
                currentUser = JSON.parse(authData);
                console.log('✅ Usuario autenticado:', currentUser.nombre);
                
                // Actualizar interfaz con datos del usuario
                updateUserInterface();
                
                // Cargar progreso desde Google Sheets
                await loadUserProgress();
                
                // Animar estadísticas
                animateStats();
                
            } catch (error) {
                console.error('❌ Error al inicializar:', error);
                showToast('Error al cargar los datos', 'error');
            }
        });

        function updateUserInterface() {
            const userNameElement = document.getElementById('userName');
            const userAvatarElement = document.getElementById('userAvatar');
            const welcomeGreetingElement = document.getElementById('welcomeGreeting');
            
            if (userNameElement && currentUser) {
                userNameElement.textContent = currentUser.nombre;
            }
            
            if (userAvatarElement && currentUser) {
                const inicial = currentUser.nombre.charAt(0).toUpperCase();
                userAvatarElement.textContent = inicial;
            }
            
            if (welcomeGreetingElement && currentUser) {
                const hora = new Date().getHours();
                let saludo = '¡Buenos días';
                if (hora >= 12 && hora < 20) saludo = '¡Buenas tardes';
                if (hora >= 20) saludo = '¡Buenas noches';
                
                welcomeGreetingElement.textContent = `${saludo}, ${currentUser.nombre}!`;
            }
        }

        async function loadUserProgress() {
            try {
                console.log('📊 Cargando progreso del usuario...');
                
                const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=getProgress&studentId=${currentUser.id}`);
                const data = await response.json();
                
                if (data.success) {
                    userProgress = data.progress;
                    console.log('✅ Progreso cargado:', userProgress);
                    updateDashboardStats();
                } else {
                    console.log('⚠️ No se encontró progreso previo, inicializando...');
                    userProgress = initializeEmptyProgress();
                    updateDashboardStats();
                }
            } catch (error) {
                console.error('❌ Error al cargar progreso:', error);
                userProgress = initializeEmptyProgress();
                updateDashboardStats();
            }
        }

        function initializeEmptyProgress() {
            return {
                lessonsCompleted: 0,
                totalLessons: 10,
                streak: 0,
                xp: 0,
                studyTime: 0,
                module1Progress: 0,
                module2Progress: 0,
                module3Progress: 0
            };
        }

        function updateDashboardStats() {
            if (!userProgress) return;
            
            // Lecciones completadas
            document.getElementById('lessonsCompleted').textContent = userProgress.lessonsCompleted || 0;
            const lessonsPercent = ((userProgress.lessonsCompleted || 0) / (userProgress.totalLessons || 10)) * 100;
            document.getElementById('lessonsProgressBar').style.width = lessonsPercent + '%';
            
            // Racha
            document.getElementById('currentStreak').textContent = userProgress.streak || 0;
            const streakPercent = Math.min(((userProgress.streak || 0) / 30) * 100, 100);
            document.getElementById('streakProgressBar').style.width = streakPercent + '%';
            
            // XP
            document.getElementById('totalXP').textContent = userProgress.xp || 0;
            const xpPercent = Math.min(((userProgress.xp || 0) / 1000) * 100, 100);
            document.getElementById('xpProgressBar').style.width = xpPercent + '%';
            
            // Tiempo de estudio
            const hours = Math.floor((userProgress.studyTime || 0) / 60);
            const minutes = (userProgress.studyTime || 0) % 60;
            document.getElementById('studyTime').textContent = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
            const timePercent = Math.min(((userProgress.studyTime || 0) / 300) * 100, 100);
            document.getElementById('timeProgressBar').style.width = timePercent + '%';
            
            // Progreso por módulo
            updateModuleProgress(1, userProgress.module1Progress || 0);
            updateModuleProgress(2, userProgress.module2Progress || 0);
            updateModuleProgress(3, userProgress.module3Progress || 0);
        }

        function updateModuleProgress(moduleNumber, progress) {
            const progressElement = document.getElementById(`module${moduleNumber}Progress`);
            const progressBarElement = document.getElementById(`module${moduleNumber}ProgressBar`);
            
            if (progressElement) {
                progressElement.textContent = Math.round(progress) + '%';
            }
            
            if (progressBarElement) {
                progressBarElement.style.width = progress + '%';
            }
        }

        function animateStats() {
            setTimeout(() => {
                const progressBars = document.querySelectorAll('.stat-progress-bar, .module-progress-fill');
                progressBars.forEach(bar => {
                    bar.style.transition = 'width 1.5s cubic-bezier(0.4, 0, 0.2, 1)';
                });
            }, 300);
        }

        function logout() {
            if (confirm('¿Estás seguro/a de que deseas cerrar sesión?')) {
                localStorage.removeItem('authData');
                window.location.href = 'login.html';
            }
        }

        function goToModule(moduleNumber) {
            window.location.href = `module${moduleNumber}.html`;
        }

        function viewModuleDetails(moduleNumber) {
            showToast(`Ver detalles del Módulo ${moduleNumber}`, 'info');
            // Aquí se puede agregar lógica para mostrar un modal con detalles
        }

        function goToNextLessonDirect() {
            // Determinar la siguiente lección basada en el progreso
            if (userProgress.module1Progress < 100) {
                window.location.href = 'module1.html';
            } else if (userProgress.module2Progress < 100) {
                window.location.href = 'module2.html';
            } else if (userProgress.module3Progress < 100) {
                window.location.href = 'module3.html';
            } else {
                showToast('¡Felicidades! Has completado todo el curso', 'success');
            }
        }
    </script>

    <!-- Toast Notifications Script -->
    <script>
        // ============================================
        // SISTEMA DE NOTIFICACIONES TOAST
        // ============================================
        
        function showToast(message, type = 'info') {
            const container = document.createElement('div');
            container.className = 'toast-container';
            container.style.cssText = 'position: fixed; top: 5rem; right: 2rem; z-index: 1050;';
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'check-circle-fill',
                error: 'x-circle-fill',
                warning: 'exclamation-triangle-fill',
                info: 'info-circle-fill'
            };
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="bi bi-${icons[type]}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-message">${message}</div>
                </div>
            `;
            
            container.appendChild(toast);
            document.body.appendChild(container);
            
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(container);
                }, 300);
            }, 3000);
        }
    </script>

    <!-- Mentor System Script -->
    <script>
        // ============================================
        // SISTEMA DE MENTOR IA
        // ============================================
        
        // Base de conocimiento del mentor
        window.mentorKnowledge = {
            // Respuestas por categoría
            responses: {
                greeting: [
                    "¡Hola! Soy tu Mentor Anatómico. Estoy aquí para ayudarte en tu aprendizaje del dibujo anatómico. ¿En qué puedo ayudarte hoy?",
                    "¡Bienvenido/a! ¿Tienes alguna duda sobre anatomía, técnicas de dibujo o necesitas apoyo con tus ejercicios?"
                ],
                anatomy: [
                    "La anatomía humana puede parecer compleja al inicio, pero con práctica y observación sistemática se vuelve más clara. ¿Sobre qué parte del cuerpo tienes dudas?",
                    "Entender la anatomía funcional es clave. Recuerda que no se trata de memorizar cada músculo, sino de comprender cómo funcionan en conjunto para producir movimiento."
                ],
                emotion_frustrated: [
                    "Es completamente normal sentir frustración al aprender a dibujar. Cada trazo que haces, incluso los que no te satisfacen, está construyendo tu habilidad visual y motora. ¿Quieres que revisemos juntos qué aspecto específico te está costando?",
                    "La frustración es señal de que estás desafiándote, y eso es positivo. Recuerda que Leonardo da Vinci llenó miles de páginas con estudios y 'errores' antes de dominar la figura humana. Tómate un descanso breve si lo necesitas."
                ],
                technique: [
                    "Las técnicas de dibujo son herramientas, no reglas absolutas. Experimenta con diferentes aproximaciones y encuentra lo que funciona mejor para tu estilo de observación.",
                    "Una buena técnica es aquella que te permite capturar lo que observas de forma clara y expresiva. ¿Qué aspecto técnico te gustaría mejorar?"
                ],
                motivation: [
                    "¡Vas muy bien! Cada sesión de práctica, sin importar cuán corta sea, suma a tu desarrollo artístico. La consistencia es más importante que la perfección.",
                    "Recuerda por qué empezaste este viaje. El dibujo anatómico no solo es una habilidad técnica, es una forma de ver y comprender el mundo de manera más profunda."
                ]
            },
            
            // Memoria de conversación
            memory: [],
            
            // Generar respuesta contextual
            generateResponse: function(userMessage) {
                const message = userMessage.toLowerCase();
                let category = 'greeting';
                let emotion = 'neutral';
                let intensity = 1;
                
                // Detectar categoría y emoción
                if (message.includes('hola') || message.includes('buenas') || message.includes('hey')) {
                    category = 'greeting';
                } else if (message.includes('frustrad') || message.includes('no puedo') || message.includes('difícil')) {
                    category = 'emotion_frustrated';
                    emotion = 'frustrated';
                    intensity = 2;
                } else if (message.includes('músculo') || message.includes('hueso') || message.includes('anatomía')) {
                    category = 'anatomy';
                } else if (message.includes('técnica') || message.includes('cómo dibujar') || message.includes('método')) {
                    category = 'technique';
                } else if (message.includes('motivación') || message.includes('ánimo') || message.includes('ayuda')) {
                    category = 'motivation';
                }
                
                // Seleccionar respuesta aleatoria de la categoría
                const responses = this.responses[category];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                
                return {
                    text: randomResponse,
                    emotion: emotion,
                    intensity: intensity
                };
            }
        };

        // Sistema de memoria conversacional
        const conversationMemory = {
            messages: [],
            maxMessages: 10,
            
            add: function(userMessage, mentorResponse, emotion, intensity) {
                this.messages.push({
                    timestamp: Date.now(),
                    user: userMessage,
                    mentor: mentorResponse,
                    emotion: emotion,
                    intensity: intensity
                });
                
                // Mantener solo los últimos maxMessages
                if (this.messages.length > this.maxMessages) {
                    this.messages.shift();
                }
            },
            
            getContext: function() {
                return this.messages.slice(-3); // Últimos 3 intercambios
            }
        };

        // Funciones de interacción con el mentor
        function openMentorChat() {
            const modal = new bootstrap.Modal(document.getElementById('mentorModal'));
            modal.show();
            
            // Mensaje de bienvenida si es la primera vez
            const mentorMessages = document.getElementById('mentorMessages');
            if (mentorMessages.children.length === 0) {
                addMentorMessage('¡Hola! Soy tu Mentor Anatómico. Estoy aquí para ayudarte con cualquier duda sobre dibujo anatómico, técnicas o incluso si necesitas motivación. ¿En qué puedo ayudarte hoy?');
            }
        }

        function handleMentorKeyPress(event) {
            if (event.key === 'Enter') {
                sendMentorMessage();
            }
        }

        function sendMentorMessage() {
            const input = document.getElementById('mentorInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Agregar mensaje del usuario
            addUserMessage(message);
            input.value = '';
            
            // Mostrar indicador de escritura
            showTypingIndicator();
            
            // Simular tiempo de "pensamiento"
            setTimeout(() => {
                hideTypingIndicator();
                
                // Generar respuesta
                const response = window.mentorKnowledge.generateResponse(message);
                
                // Guardar en memoria
                conversationMemory.add(message, response.text, response.emotion, response.intensity);
                
                // Agregar respuesta del mentor
                addMentorMessage(response.text);
            }, 800 + Math.random() * 1200);
        }

        function addUserMessage(text) {
            const mentorMessages = document.getElementById('mentorMessages');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.textContent = text;
            
            messageDiv.appendChild(bubble);
            mentorMessages.appendChild(messageDiv);
            scrollToBottom();
        }

        function addMentorMessage(text, actions = []) {
            const mentorMessages = document.getElementById('mentorMessages');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message mentor';
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.innerHTML = text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            messageDiv.appendChild(bubble);
            
            // Agregar botones de acción si existen
            if (actions && actions.length > 0) {
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'message-actions';
                
                actions.forEach(actionText => {
                    const btn = document.createElement('button');
                    btn.className = 'action-button';
                    btn.textContent = actionText;
                    btn.onclick = () => {
                        // Agregar mensaje del usuario visualmente
                        addUserMessage(actionText);
                        
                        // Deshabilitar el botón para evitar doble clic
                        btn.disabled = true;
                        btn.style.opacity = '0.5';
                        
                        // Mostrar indicador de escritura
                        showTypingIndicator();
                        
                        // Generar respuesta contextual
                        setTimeout(() => {
                            hideTypingIndicator();
                            const response = window.mentorKnowledge.generateResponse(actionText);
                            conversationMemory.add(actionText, response.text, response.emotion, response.intensity);
                            addMentorMessage(response.text, response.actions || []);
                        }, 800 + Math.random() * 700);
                    };
                    actionsDiv.appendChild(btn);
                });
                
                bubble.appendChild(actionsDiv);
            }
            
            mentorMessages.appendChild(messageDiv);
            scrollToBottom();
        }

        function showTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.classList.add('show');
            scrollToBottom();
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.classList.remove('show');
        }

        function scrollToBottom() {
            const mentorMessages = document.getElementById('mentorMessages');
            setTimeout(() => {
                mentorMessages.scrollTop = mentorMessages.scrollHeight;
            }, 100);
        }
    </script>

    <!-- Onboarding & Session Completed Script -->
    <script>
        // ============================================
        // FUNCIONES DE ONBOARDING
        // ============================================
        
        // Detectar si es primera visita absoluta
        if (!localStorage.getItem('onboardingCompleted')) {
            setTimeout(() => {
                const onboardingModal = new bootstrap.Modal(document.getElementById('onboardingModal'));
                onboardingModal.show();
            }, 1000);
        }
        
        function nextOnboardingStep(stepNumber) {
            // Ocultar paso actual
            document.querySelectorAll('.onboarding-step').forEach(step => {
                step.style.display = 'none';
            });
            
            // Mostrar nuevo paso con animación
            const nextStep = document.getElementById(`onboarding-step-${stepNumber}`);
            if (nextStep) {
                nextStep.style.display = 'block';
                nextStep.style.animation = 'fadeIn 0.4s ease-in';
            }
        }
        
        function skipOnboarding() {
            const modal = bootstrap.Modal.getInstance(document.getElementById('onboardingModal'));
            if (modal) {
                modal.hide();
            }
            localStorage.setItem('onboardingCompleted', 'true');
            showToast('Puedes revisar la información del curso en las secciones más abajo', 'info');
        }
        
        function startFirstLesson() {
            localStorage.setItem('onboardingCompleted', 'true');
            window.location.href = 'module1.html';
        }
        
        function finishOnboarding() {
            const modal = bootstrap.Modal.getInstance(document.getElementById('onboardingModal'));
            if (modal) {
                modal.hide();
            }
            localStorage.setItem('onboardingCompleted', 'true');
            
            // Destacar el botón del mentor con animación
            setTimeout(() => {
                const mentorBtn = document.getElementById('mentorFloatBtn');
                if (mentorBtn) {
                    mentorBtn.style.animation = 'pulse 1s ease-in-out 3';
                    showToast('💬 El Mentor está aquí cuando lo necesites', 'info');
                }
            }, 500);
        }

        // ============================================
        // SISTEMA DE SESIÓN COMPLETADA
        // ============================================
        
        // Detectar si viene de completar una sesión
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('showSummary') === 'true') {
                const summary = JSON.parse(localStorage.getItem('lastSessionSummary') || '{}');
                
                if (Object.keys(summary).length > 0) {
                    setTimeout(() => {
                        showSessionCompletedModal(summary);
                        localStorage.removeItem('lastSessionSummary');
                        
                        // Limpiar URL sin recargar
                        window.history.replaceState({}, document.title, window.location.pathname);
                    }, 800);
                }
            }
        });
        
        function showSessionCompletedModal(summary) {
            // Llenar estadísticas
            document.getElementById('sessionLessonsCount').textContent = summary.lessonsCompleted || 0;
            document.getElementById('sessionTimeSpent').textContent = summary.timeSpent || 0;
            document.getElementById('sessionConceptsCount').textContent = (summary.newConcepts || []).length;
            
            // Mostrar conceptos aprendidos
            const conceptsList = document.getElementById('sessionConceptsList');
            if (summary.newConcepts && summary.newConcepts.length > 0) {
                conceptsList.innerHTML = `
                    <h6 style="color: var(--success); margin-bottom: 1rem;">
                        <i class="bi bi-lightbulb-fill me-2"></i>
                        Conceptos que aprendiste hoy:
                    </h6>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        ${summary.newConcepts.map(concept => `
                            <li style="padding: 0.5rem 0; display: flex; align-items: center; gap: 0.75rem;">
                                <i class="bi bi-check-circle-fill" style="color: var(--success); font-size: 1.2rem;"></i>
                                <span style="font-size: 1rem;">${concept}</span>
                            </li>
                        `).join('')}
                    </ul>
                `;
            } else {
                conceptsList.style.display = 'none';
            }
            
            // Mensaje motivacional aleatorio
            const motivationalMessages = [
                "¡Excelente progreso! Cada trazo te acerca a tu objetivo.",
                "Tu constancia está dando frutos. ¡Sigue así!",
                "Estás construyendo una base sólida. ¡Muy bien!",
                "El aprendizaje es un viaje, y vas por buen camino.",
                "Cada lección completada es un paso hacia la maestría.",
                "Tu dedicación es admirable. ¡Continúa con esa energía!",
                "Estás desarrollando habilidades que durarán toda la vida."
            ];
            const randomMessage = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
            document.getElementById('motivationalMessage').textContent = randomMessage;
            
            // Próximo paso
            const nextStep = document.getElementById('nextStepDescription');
            if (summary.nextLesson) {
                nextStep.textContent = summary.nextLesson;
                
                // Configurar botón de continuar
                const continueBtn = document.getElementById('continueToNextLessonBtn');
                continueBtn.onclick = function() {
                    goToNextLessonDirect();
                };
            } else {
                nextStep.textContent = '¡Has completado todo el módulo! Revisa tu progreso general.';
                document.getElementById('continueToNextLessonBtn').style.display = 'none';
            }
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('sessionCompletedModal'));
            modal.show();
        }
    </script>

</body>
</html>
