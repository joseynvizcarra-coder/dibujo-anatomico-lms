<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Curso de Dibujo y Representación del Cuerpo Humano - Universidad Alberto Hurtado">
    <meta name="author" content="Joselyn Vizcarra">
    <title>Curso de Dibujo Anatómico - LMS UAH</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        :root {
            --primary-dark: #2c5f66;
            --primary-light: #e8a2b8;
            --dark: #1a1a1a;
            --gray-light: #f5f5f5;
            --gray-medium: #666;
            --success: #4CAF50;
            --danger: #f44336;
            --warning: #FFC107;
            --info: #2196F3;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--gray-light);
            min-height: 100vh;
        }

        .header-uah {
            background: linear-gradient(135deg, var(--primary-dark), var(--dark));
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1030;
        }

        .user-badge {
            background: rgba(255,255,255,0.15);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: var(--primary-light);
            color: var(--dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .hero-section {
            background: linear-gradient(135deg, rgba(44,95,102,0.95), rgba(26,26,26,0.95));
            color: white;
            padding: 4rem 0 3rem;
            margin-bottom: 2rem;
        }

        .hero-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-light);
            margin-bottom: 1rem;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 0;
        }

        .hero-icon {
            font-size: 6rem;
            opacity: 0.3;
        }

        /* ============================================
           NUEVO: ESTILOS PARA DASHBOARD DEL ESTUDIANTE
           ============================================ */
        .student-dashboard {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 3rem;
        }

        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .dashboard-header h3 {
            margin: 0;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .progress-circle-container {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
        }

        .progress-circle {
            position: relative;
            width: 140px;
            height: 140px;
            margin: 0 auto;
        }

        .progress-circle svg {
            transform: rotate(-90deg);
        }

        .progress-circle-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-dark);
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .stat-box {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            border: 2px solid var(--gray-light);
            transition: all 0.3s ease;
        }

        .stat-box:hover {
            border-color: var(--primary-light);
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .stat-box-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-dark);
            display: block;
            margin-bottom: 0.5rem;
        }

        .stat-box-label {
            font-size: 0.85rem;
            color: var(--gray-medium);
        }

        .next-task-card {
            background: linear-gradient(135deg, rgba(44,95,102,0.1), rgba(232,162,184,0.1));
            border-left: 4px solid var(--primary-dark);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 2rem;
        }

        .next-task-card h6 {
            color: var(--primary-dark);
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .next-task-card p {
            margin: 0;
            color: var(--dark);
        }

        .module-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .breakdown-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border: 2px solid var(--gray-light);
            transition: all 0.3s ease;
        }

        .breakdown-card:hover {
            border-color: var(--primary-light);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .breakdown-card h6 {
            color: var(--primary-dark);
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .breakdown-progress {
            height: 8px;
            background: var(--gray-light);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.75rem;
        }

        .breakdown-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .breakdown-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--gray-medium);
        }

        /* ============================================
           NUEVO: ALERTA DE EVALUACIÓN DIAGNÓSTICA
           ============================================ */
        .diagnostic-alert {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 4px solid var(--warning);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(255,193,7,0.2);
        }

        .diagnostic-alert h5 {
            color: #856404;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .diagnostic-alert p {
            color: #856404;
            margin-bottom: 1rem;
        }

        .btn-diagnostic {
            background: var(--warning);
            color: var(--dark);
            padding: 0.75rem 2rem;
            border-radius: 25px;
            border: none;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-diagnostic:hover {
            background: #e0a800;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,193,7,0.4);
            color: var(--dark);
        }

        /* Estilos originales continúan... */
        .progress-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 3rem;
        }

        .progress-header {
            color: var(--primary-dark);
            font-weight: 600;
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stat-badge {
            background: var(--gray-light);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--primary-dark);
            font-weight: 500;
            display: inline-block;
        }

        .custom-progress {
            height: 35px;
            background: var(--gray-light);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        .custom-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-dark), var(--primary-light));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.95rem;
            transition: width 0.6s ease;
            border-radius: 20px;
        }

        .module-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .module-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .module-header {
            background: linear-gradient(135deg, var(--primary-dark), var(--dark));
            color: white;
            padding: 2rem 1.5rem;
            position: relative;
        }

        .module-number {
            position: absolute;
            top: 0.75rem;
            right: 1.5rem;
            font-size: 3rem;
            opacity: 0.2;
            font-weight: bold;
            line-height: 1;
        }

        .module-title {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .module-subtitle {
            font-size: 0.95rem;
            opacity: 0.85;
        }

        .module-body {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .module-description {
            color: var(--gray-medium);
            margin-bottom: 1.25rem;
            line-height: 1.6;
            flex-grow: 1;
        }

        .module-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.85rem;
            color: var(--gray-medium);
        }

        .module-progress-container {
            margin-bottom: 1.25rem;
        }

        .module-progress-bar {
            height: 8px;
            background: var(--gray-light);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .module-progress-fill {
            height: 100%;
            background: var(--success);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-label {
            font-size: 0.8rem;
            color: var(--gray-medium);
            text-align: right;
        }

        .module-actions {
            display: flex;
            gap: 0.75rem;
        }

        .btn-module {
            flex: 1;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            display: inline-block;
            font-size: 0.9rem;
        }

        .btn-module:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-primary-custom {
            background: var(--primary-dark);
            color: white;
        }

        .btn-primary-custom:hover:not(:disabled) {
            background: var(--primary-light);
            color: var(--dark);
        }

        .btn-secondary-custom {
            background: var(--gray-light);
            color: var(--primary-dark);
            border: 2px solid var(--primary-light);
        }

        .btn-secondary-custom:hover:not(:disabled) {
            background: var(--primary-light);
            color: white;
            border-color: var(--primary-light);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .spinner-border-custom {
            width: 3rem;
            height: 3rem;
            border: 4px solid var(--gray-light);
            border-top-color: var(--primary-dark);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        .info-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }

        .info-card h5 {
            color: var(--primary-dark);
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-list li i {
            color: var(--primary-light);
            font-size: 1.1rem;
        }

        footer {
            background: var(--dark);
            color: white;
            padding: 2rem 0;
            margin-top: 4rem;
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 1.8rem;
            }

            .hero-subtitle {
                font-size: 1rem;
            }

            .module-number {
                font-size: 2rem;
            }

            .module-actions {
                flex-direction: column;
            }

            .btn-module {
                width: 100%;
            }

            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .module-breakdown {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
    <body>
    <script src="auth.js"></script>

    <header class="header-uah">
        <div class="container-fluid">
            <div class="row align-items-center g-3">
                <div class="col-md-4">
                    <h1 class="h5 mb-0 d-flex align-items-center gap-2">
                        <i class="bi bi-palette"></i>
                        <span style="color: var(--primary-light);">Arte & Anatomía UAH</span>
                    </h1>
                </div>
                <div class="col-md-4 text-center d-none d-md-block">
                    <span class="text-white-50 small">Pedagogía en Artes Visuales</span>
                </div>
                <div class="col-md-4">
                    <div class="d-flex justify-content-end align-items-center gap-2">
                        <div class="user-badge">
                            <div class="user-avatar" id="userAvatar">U</div>
                            <div class="d-none d-lg-block">
                                <div class="fw-bold small" id="userName">Cargando...</div>
                                <div class="small opacity-75" id="userRole" style="font-size: 0.75rem;">...</div>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-outline-light d-none" id="dashboardBtn" onclick="goToDashboard()">
                            <i class="bi bi-speedometer2"></i>
                            <span class="d-none d-lg-inline ms-1">Dashboard</span>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="logout()">
                            <i class="bi bi-box-arrow-right"></i>
                            <span class="d-none d-md-inline ms-1">Salir</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content">
                <div class="spinner-border-custom mb-3"></div>
                <p class="mb-0">Cargando curso...</p>
            </div>
        </div>

        <section class="hero-section">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-8 fade-in-up">
                        <h1 class="hero-title">Dibujo y Representación del Cuerpo Humano</h1>
                        <p class="hero-subtitle">Desarrolla competencias técnicas y expresivas en dibujo de figura humana mediante práctica sistemática progresiva</p>
                    </div>
                    <div class="col-lg-4 text-center d-none d-lg-block">
                        <i class="bi bi-easel hero-icon"></i>
                    </div>
                </div>
            </div>
        </section>

        <div class="container">
            <!-- ============================================
                 NUEVO: ALERTA DE EVALUACIÓN DIAGNÓSTICA
                 ============================================ -->
            <div class="diagnostic-alert fade-in-up" id="diagnosticAlert" style="display: none;">
                <h5>
                    <i class="bi bi-clipboard-check"></i>
                    ¡Comienza con una Evaluación Diagnóstica!
                </h5>
                <p class="mb-3">
                    Antes de empezar el curso, ayúdanos a conocer tu nivel inicial. 
                    Esto nos permitirá personalizar tu experiencia de aprendizaje.
                </p>
                <a href="diagnostic.html" class="btn-diagnostic">
                    <i class="bi bi-play-fill me-2"></i>Realizar Evaluación (5 min)
                </a>
            </div>

            <!-- ============================================
                 NUEVO: DASHBOARD PERSONAL DEL ESTUDIANTE
                 ============================================ -->
            <div class="student-dashboard fade-in-up" id="studentDashboard" style="display: none;">
                <div class="dashboard-header">
                    <h3>
                        <i class="bi bi-graph-up me-2"></i>
                        Tu Progreso Personal
                    </h3>
                </div>

                <div class="row g-4">
                    <!-- Círculo de progreso -->
                    <div class="col-md-4">
                        <div class="progress-circle-container">
                            <div class="progress-circle">
                                <svg width="140" height="140">
                                    <circle cx="70" cy="70" r="60" fill="none" stroke="#e9ecef" stroke-width="12"/>
                                    <circle id="progressCircle" cx="70" cy="70" r="60" fill="none" 
                                            stroke="var(--primary-dark)" stroke-width="12" 
                                            stroke-linecap="round" 
                                            stroke-dasharray="377" 
                                            stroke-dashoffset="377"
                                            transform="rotate(-90 70 70)"
                                            style="transition: stroke-dashoffset 0.8s ease;"/>
                                </svg>
                                <div class="progress-circle-text" id="progressPercentText">0%</div>
                            </div>
                            <h6 class="mt-3 mb-0">Progreso Total</h6>
                        </div>
                    </div>

                    <!-- Estadísticas -->
                    <div class="col-md-8">
                        <div class="dashboard-stats">
                            <div class="stat-box">
                                <span class="stat-box-number" id="studentModulesCompleted">0</span>
                                <span class="stat-box-label">Módulos Completados</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-box-number" id="studentLessonsCompleted">0</span>
                                <span class="stat-box-label">Lecciones Completadas</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-box-number" id="studentEvaluationsPassed">0</span>
                                <span class="stat-box-label">Evaluaciones Aprobadas</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-box-number" id="studentExercises">0</span>
                                <span class="stat-box-label">Ejercicios Realizados</span>
                            </div>
                        </div>

                        <!-- Próxima tarea -->
                        <div class="next-task-card">
                            <h6>
                                <i class="bi bi-arrow-right-circle me-2"></i>
                                Próxima Tarea
                            </h6>
                            <p id="nextTaskText">Cargando...</p>
                        </div>
                    </div>
                </div>

                <!-- Desglose por módulo -->
                <div class="mt-4">
                    <h5 class="mb-3" style="color: var(--primary-dark); font-weight: 600;">
                        <i class="bi bi-list-check me-2"></i>
                        Desglose por Módulo
                    </h5>
                    <div class="module-breakdown" id="moduleBreakdown"></div>
                </div>
            </div>

            <!-- Barra de progreso original (simplificada) -->
            <div class="progress-card fade-in-up" id="simpleProgressCard">
                <h3 class="progress-header">
                    <i class="bi bi-graph-up"></i>
                    Tu Progreso General
                </h3>
                <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                    <span class="stat-badge">
                        <strong id="completedModules">0</strong> de 3 módulos completados
                    </span>
                    <span class="stat-badge">
                        <i class="bi bi-clock"></i> 12-14 horas totales
                    </span>
                    <span class="stat-badge">
                        <i class="bi bi-calendar3"></i> 12 días de curso
                    </span>
                </div>
                <div class="custom-progress">
                    <div class="custom-progress-bar" id="progressBar" style="width: 0%">
                        <span>0%</span>
                    </div>
                </div>
                <div class="mt-2 text-end">
                    <small class="text-muted" id="progressDetails">Comienza tu primera lección para ver tu progreso</small>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-md-6 fade-in-up">
                    <div class="info-card">
                        <h5><i class="bi bi-trophy me-2"></i>Objetivos del Curso</h5>
                        <ul class="info-list">
                            <li><i class="bi bi-check-circle-fill"></i> Aplicar técnicas de observación directa</li>
                            <li><i class="bi bi-check-circle-fill"></i> Analizar estructura anatómica básica</li>
                            <li><i class="bi bi-check-circle-fill"></i> Crear representación completa de figura humana</li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-6 fade-in-up">
                    <div class="info-card">
                        <h5><i class="bi bi-clipboard-check me-2"></i>Entregables Totales</h5>
                        <ul class="info-list">
                            <li><i class="bi bi-pencil"></i> 23 dibujos progresivos</li>
                            <li><i class="bi bi-list-check"></i> 10 evaluaciones formativas</li>
                            <li><i class="bi bi-star-fill"></i> 1 proyecto final (1/4 mercurio)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <section class="mb-5">
                <h2 class="mb-4" style="color: var(--primary-dark); font-weight: 600;">
                    <i class="bi bi-book"></i> Módulos del Curso
                </h2>
                
                <div class="row g-4" id="modulesGrid"></div>
            </section>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    <p class="mb-1">&copy; 2025 Universidad Alberto Hurtado</p>
                    <p class="mb-0 small text-white-50">Pedagogía en Artes Visuales</p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <p class="mb-1">Desarrollado por Joselyn Vizcarra</p>
                    <p class="mb-0 small text-white-50">Diplomado en Diseño Instruccional - U. de Chile</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const modulesData = [
            {
                id: 1,
                number: "01",
                title: "Observación y Gesto",
                subtitle: "Captura de movimiento y proporción",
                description: "Domina técnicas de observación directa para capturar línea de acción en croquis de 2-5 minutos. Aprende a medir proporciones visualmente y comprender el balance corporal.",
                duration: "3 días",
                lessons: 3,
                exercises: "8 croquis",
                evaluations: "3 evaluaciones",
                hours: "2.5 horas",
                difficulty: "Básico",
                url: "module1.html",
                available: true
            },
            {
                id: 2,
                number: "02",
                title: "Anatomía Funcional",
                subtitle: "Estructura ósea y muscular",
                description: "Identifica las 3 masas principales del cuerpo y 6 grupos musculares esenciales. Analiza la estructura de manos, pies y proporciones faciales.",
                duration: "4 días",
                lessons: 4,
                exercises: "12 estudios",
                evaluations: "4 evaluaciones",
                hours: "3.3 horas",difficulty: "Intermedio",
                url: "module2.html",
                available: true
            },
            {
                id: 3,
                number: "03",
                title: "Figura Completa",
                subtitle: "Integración y proyecto final",
                description: "Integra gesto + anatomía en figuras completas. Aplica luz, sombra y volumen. Crea tu proyecto final en formato 1/4 mercurio.",
                duration: "5 días",
                lessons: 3,
                exercises: "3 figuras + proyecto",
                evaluations: "3 evaluaciones",
                hours: "5-6 horas",
                difficulty: "Avanzado",
                url: "module3.html",
                available: true
            }
        ];

        function isAuthenticated() {
            return localStorage.getItem('isAuthenticated') === 'true';
        }

        function getCurrentUser() {
            if (!isAuthenticated()) return null;
            try {
                return JSON.parse(localStorage.getItem('currentUser') || 'null');
            } catch (error) {
                console.error('Error parsing user data:', error);
                return null;
            }
        }

        function logout() {
            saveProgress();
            localStorage.removeItem('currentUser');
            localStorage.removeItem('isAuthenticated');
            localStorage.removeItem('sessionStart');
            window.location.href = 'login.html';
        }

        function checkAuthentication() {
            if (!isAuthenticated()) {
                window.location.href = 'login.html';
                return false;
            }
            return true;
        }

        function getStudentProgress() {
            const currentUser = getCurrentUser();
            if (!currentUser) return null;
            
            const progressKey = `progress_${currentUser.email || currentUser.username}`;
            try {
                const progress = JSON.parse(localStorage.getItem(progressKey) || 'null');
                if (!progress) {
                    return initializeProgress();
                }
                return progress;
            } catch (error) {
                console.error('Error parsing progress data:', error);
                return initializeProgress();
            }
        }

        function initializeProgress() {
            return {
                modules: {
                    1: { completed: false, progress: 0, timeSpent: 0, completedLessons: [] },
                    2: { completed: false, progress: 0, timeSpent: 0, completedLessons: [] },
                    3: { completed: false, progress: 0, timeSpent: 0, completedLessons: [] }
                },
                overallProgress: 0,
                totalTimeSpent: 0,
                lastActivity: new Date().toISOString()
            };
        }

        function saveProgress() {
            const currentUser = getCurrentUser();
            if (!currentUser) return;
            
            const progressKey = `progress_${currentUser.email || currentUser.username}`;
            const progress = getStudentProgress();
            
            if (progress) {
                progress.lastActivity = new Date().toISOString();
                localStorage.setItem(progressKey, JSON.stringify(progress));
            }
        }

        function calculateOverallProgress() {
            const progress = getStudentProgress();
            if (!progress) return 0;
            
            let totalProgress = 0;
            let moduleCount = 0;
            
            for (let moduleId in progress.modules) {
                totalProgress += progress.modules[moduleId].progress || 0;
                moduleCount++;
            }
            
            return moduleCount > 0 ? Math.round(totalProgress / moduleCount) : 0;
        }

        function countCompletedModules() {
            const progress = getStudentProgress();
            if (!progress) return 0;
            
            let completed = 0;
            for (let moduleId in progress.modules) {
                if (progress.modules[moduleId].completed) {
                    completed++;
                }
            }
            return completed;
        }

        function updateUserInterface() {
            const currentUser = getCurrentUser();
            if (!currentUser) return;

            document.getElementById('userName').textContent = 
                currentUser.fullName || currentUser.name || currentUser.username || 'Usuario';
            
            document.getElementById('userRole').textContent = 
                getRoleDisplayName(currentUser.role);

            const avatar = document.getElementById('userAvatar');
            if (avatar) {
                avatar.textContent = (currentUser.fullName || currentUser.name || currentUser.username).charAt(0).toUpperCase();
            }

            const dashboardBtn = document.getElementById('dashboardBtn');
            if (currentUser.role === 'instructor' || currentUser.role === 'profesor') {
                dashboardBtn.classList.remove('d-none');
            }

            updateProgress();
            
            // ============================================
            // NUEVO: Verificar y mostrar elementos según estado
            // ============================================
            checkDiagnosticStatus();
            loadStudentDashboard();
        }

        function getRoleDisplayName(role) {
            const roles = {
                'instructor': 'Instructor',
                'profesor': 'Profesor',
                'estudiante': 'Estudiante',
                'evaluador': 'Evaluador',
                'visitante': 'Visitante'
            };
            return roles[role] || 'Usuario';
        }

        // ============================================
        // NUEVA FUNCIÓN: Verificar estado de evaluación diagnóstica
        // ============================================
        function checkDiagnosticStatus() {
            const currentUser = getCurrentUser();
            if (!currentUser) return;

            // Solo mostrar alerta a estudiantes
            if (currentUser.role === 'instructor' || currentUser.role === 'profesor') {
                return;
            }

            const diagnosticCompleted = localStorage.getItem('student_diagnostic');
            const diagnosticAlert = document.getElementById('diagnosticAlert');
            const studentDashboard = document.getElementById('studentDashboard');
            const simpleProgressCard = document.getElementById('simpleProgressCard');

            if (!diagnosticCompleted) {
                // No ha completado diagnóstica: mostrar alerta
                diagnosticAlert.style.display = 'block';
                studentDashboard.style.display = 'none';
                simpleProgressCard.style.display = 'block';
            } else {
                // Ya completó diagnóstica: mostrar dashboard completo
                diagnosticAlert.style.display = 'none';
                studentDashboard.style.display = 'block';
                simpleProgressCard.style.display = 'none';
            }
        }

        // ============================================
        // NUEVA FUNCIÓN: Cargar dashboard personalizado del estudiante
        // ============================================
        function loadStudentDashboard() {
            const currentUser = getCurrentUser();
            if (!currentUser || currentUser.role === 'instructor' || currentUser.role === 'profesor') {
                return;
            }

            const diagnosticCompleted = localStorage.getItem('student_diagnostic');
            if (!diagnosticCompleted) return;

            // Recopilar datos de todos los módulos
            const modules = [1, 2, 3];
            let totalLessons = 0;
            let completedLessons = 0;
            let passedEvaluations = 0;
            let completedModules = 0;

            const moduleDetails = modules.map(moduleNum => {
                const key = `module${moduleNum}_progress`;
                const saved = localStorage.getItem(key);
                
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        const completed = data.completedLessons || [];
                        const evaluations = data.evaluations || {};
                        
                        const moduleLessons = moduleNum === 1 ? 3 : moduleNum === 2 ? 4 : 3;
                        totalLessons += moduleLessons;
                        completedLessons += completed.length;
                        
                        // Contar evaluaciones aprobadas (mínimo 2/3 respuestas correctas)
                        Object.values(evaluations).forEach(evalData => {
                            if (Object.keys(evalData).length >= 2) passedEvaluations++;
                        });
                        
                        const moduleCompleted = completed.length === moduleLessons;
                        if (moduleCompleted) completedModules++;
                        
                        return {
                            num: moduleNum,
                            name: modulesData[moduleNum - 1].title,
                            completed: completed.length,
                            total: moduleLessons,
                            percentage: Math.round((completed.length / moduleLessons) * 100),
                            status: moduleCompleted ? 'completed' : completed.length > 0 ? 'in-progress' : 'not-started'
                        };
                    } catch (e) {
                        return null;
                    }
                }
                return {
                    num: moduleNum,
                    name: modulesData[moduleNum - 1].title,
                    completed: 0,
                    total: moduleNum === 1 ? 3 : moduleNum === 2 ? 4 : 3,
                    percentage: 0,
                    status: 'not-started'
                };
            }).filter(Boolean);

            // Actualizar estadísticas principales
            const overallProgress = totalLessons > 0 ? Math.round((completedLessons / totalLessons) * 100) : 0;
            
            document.getElementById('studentModulesCompleted').textContent = completedModules;
            document.getElementById('studentLessonsCompleted').textContent = completedLessons;
            document.getElementById('studentEvaluationsPassed').textContent = passedEvaluations;
            document.getElementById('studentExercises').textContent = completedLessons * 3; // Estimado: 3 ejercicios por lección
            
            // Actualizar círculo de progreso
            const circumference = 377; // 2 * PI * 60
            const offset = circumference - (circumference * overallProgress / 100);
            const progressCircle = document.getElementById('progressCircle');
            if (progressCircle) {
                progressCircle.style.strokeDashoffset = offset;
            }
            document.getElementById('progressPercentText').textContent = overallProgress + '%';
            
            // Determinar próxima tarea
            let nextTask = 'Comenzar Módulo 1 - Lección 1.1';
            if (completedLessons === 0) {
                nextTask = 'Comenzar Módulo 1 - Lección 1.1: Fundamentos del Croquis';
            } else if (completedModules === 3) {
                nextTask = '¡Has completado todo el curso! 🎉 Puedes repasar cualquier módulo.';
            } else {
                const currentModule = moduleDetails.find(m => m.status === 'in-progress');
                if (currentModule) {
                    nextTask = `Continuar ${currentModule.name} - Lección ${currentModule.completed + 1}`;
                } else {
                    const nextModule = moduleDetails.find(m => m.status === 'not-started');
                    if (nextModule) {
                        nextTask = `Comenzar ${nextModule.name} - Lección 1`;
                    }
                }
            }
            document.getElementById('nextTaskText').textContent = nextTask;
            
            // Generar desglose por módulo
            const breakdown = document.getElementById('moduleBreakdown');
            if (breakdown) {
                breakdown.innerHTML = moduleDetails.map(m => {
                    const statusConfig = {
                        'completed': { color: 'success', icon: 'check-circle-fill', label: 'Completado' },
                        'in-progress': { color: 'warning', icon: 'clock-fill', label: 'En progreso' },
                        'not-started': { color: 'secondary', icon: 'circle', label: 'No iniciado' }
                    };
                    const config = statusConfig[m.status];
                    
                    return `
                        <div class="breakdown-card">
                            <h6>
                                <i class="bi bi-${config.icon} me-2" style="color: var(--${config.color});"></i>
                                Módulo ${m.num}: ${m.name}
                            </h6>
                            <div class="breakdown-progress">
                                <div class="breakdown-progress-fill" 
                                     style="width: ${m.percentage}%; background: var(--${config.color});"></div>
                            </div>
                            <div class="breakdown-stats">
                                <span>${m.completed}/${m.total} lecciones</span>
                                <span class="badge bg-${config.color}">${config.label}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function updateProgress() {
            const overallProgress = calculateOverallProgress();
            const completedModules = countCompletedModules();
            
            document.getElementById('completedModules').textContent = completedModules;
            
            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                progressBar.style.width = `${overallProgress}%`;
                const span = progressBar.querySelector('span');
                if (span) span.textContent = `${overallProgress}%`;
            }

            const progressDetails = document.getElementById('progressDetails');
            if (progressDetails) {
                if (overallProgress === 0) {
                    progressDetails.textContent = 'Comienza tu primera lección para ver tu progreso';
                } else if (overallProgress === 100) {
                    progressDetails.textContent = '¡Felicitaciones! Has completado todos los módulos';
                } else {
                    progressDetails.textContent = `Has avanzado ${overallProgress}% del curso total`;
                }
            }
        }

        function loadModules() {
            const grid = document.getElementById('modulesGrid');
            const progress = getStudentProgress();
            
            grid.innerHTML = '';
            
            modulesData.forEach(module => {
                const moduleProgress = progress ? 
                    (progress.modules[module.id] || {}) : {};
                
                const card = createModuleCard(module, moduleProgress);
                grid.appendChild(card);
            });
        }

        function createModuleCard(module, moduleProgress) {
            const col = document.createElement('div');
            col.className = 'col-lg-4 col-md-6 fade-in-up';

            const progressValue = moduleProgress.progress || 0;
            const isCompleted = moduleProgress.completed || false;

            let actionButton = '';
            if (isCompleted) {
                actionButton = `<a href="${module.url}" class="btn-module btn-secondary-custom"><i class="bi bi-check-circle-fill me-2"></i>Repasar</a>`;
            } else if (progressValue > 0) {
                actionButton = `<a href="${module.url}" class="btn-module btn-primary-custom"><i class="bi bi-play-circle me-2"></i>Continuar</a>`;
            } else {
                actionButton = `<a href="${module.url}" class="btn-module btn-primary-custom"><i class="bi bi-play-circle me-2"></i>Comenzar</a>`;
            }

            col.innerHTML = `
                <div class="module-card">
                    <div class="module-header">
                        <span class="module-number">${module.number}</span>
                        <h3 class="module-title">${module.title}</h3>
                        <p class="module-subtitle">${module.subtitle}</p>
                    </div>
                    <div class="module-body">
                        <p class="module-description">${module.description}</p>
                        <div class="module-meta">
                            <span class="meta-item">
                                <i class="bi bi-calendar3"></i>
                                ${module.duration}
                            </span>
                            <span class="meta-item">
                                <i class="bi bi-book"></i>
                                ${module.lessons} lecciones
                            </span>
                            <span class="meta-item">
                                <i class="bi bi-clock"></i>
                                ${module.hours}
                            </span>
                        </div>
                        <div class="module-meta">
                            <span class="meta-item">
                                <i class="bi bi-pencil"></i>
                                ${module.exercises}
                            </span>
                            <span class="meta-item">
                                <i class="bi bi-clipboard-check"></i>
                                ${module.evaluations}
                            </span>
                            <span class="meta-item">
                                <i class="bi bi-bar-chart"></i>
                                ${module.difficulty}
                            </span>
                        </div>
                        <div class="module-progress-container">
                            <div class="module-progress-bar">
                                <div class="module-progress-fill" style="width: ${progressValue}%"></div>
                            </div>
                            <div class="progress-label">${progressValue}% completado</div>
                        </div>
                        <div class="module-actions">
                            ${actionButton}
                        </div>
                    </div>
                </div>
            `;

            return col;
        }

        function goToDashboard() {
            window.location.href = 'dashboard.html';
        }

        function showLoading(show) {
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (show) {
                loadingOverlay.classList.add('show');
            } else {
                loadingOverlay.classList.remove('show');
            }
        }

        // ============================================
        // INICIALIZACIÓN
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎨 Inicializando LMS...');
            
            if (!checkAuthentication()) {
                return;
            }

            showLoading(true);

            setTimeout(() => {
                updateUserInterface();
                loadModules();
                showLoading(false);
                console.log('✅ LMS inicializado correctamente');
            }, 500);
        });

        window.addEventListener('beforeunload', function() {
            saveProgress();
        });

        // Auto-guardar progreso cada 2 minutos
        setInterval(saveProgress, 120000);
    </script>
</body><!-- ============================================
     MENTOR ANATÓMICO - TODO EN UNO
     Pega este código ANTES del </body> en index.html
     ============================================ -->

<style>
/* ========== ESTILOS DEL MENTOR ========== */
:root {
    --mentor-primary-dark: #2c5f66;
    --mentor-primary-light: #e8a2b8;
    --mentor-dark: #1a1a1a;
    --mentor-success: #4CAF50;
    --mentor-bg-light: #f8f9fa;
}

.mentor-floating-btn {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 65px;
    height: 65px;
    background: linear-gradient(135deg, var(--mentor-primary-dark), var(--mentor-dark));
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 2rem;
    box-shadow: 0 4px 20px rgba(44, 95, 102, 0.5);
    cursor: pointer;
    z-index: 9997;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    animation: mentor-pulse 3s infinite;
}

.mentor-floating-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 30px rgba(44, 95, 102, 0.7);
}

@keyframes mentor-pulse {
    0%, 100% { box-shadow: 0 4px 20px rgba(44, 95, 102, 0.5); }
    50% { box-shadow: 0 4px 30px rgba(44, 95, 102, 0.8); }
}

.mentor-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9998;
    display: none;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.mentor-overlay.active {
    display: flex;
    opacity: 1;
}

.mentor-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(3px);
}

.mentor-container {
    position: absolute;
    bottom: 6rem;
    right: 2rem;
    width: 420px;
    height: 600px;
    background: white;
    border-radius: 20px;
    box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    animation: mentor-slide-up 0.3s ease;
}

@keyframes mentor-slide-up {
    from {
        transform: translateY(20px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.mentor-header {
    background: linear-gradient(135deg, var(--mentor-primary-dark), var(--mentor-dark));
    color: white;
    padding: 1rem 1.25rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.mentor-header-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.mentor-avatar {
    width: 40px;
    height: 40px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.mentor-header-text h3 {
    font-size: 1rem;
    font-weight: 600;
    margin: 0 0 0.25rem 0;
}

.mentor-status {
    font-size: 0.8rem;
    opacity: 0.9;
    display: flex;
    align-items: center;
    gap: 0.4rem;
}

.mentor-status-dot {
    width: 7px;
    height: 7px;
    background: var(--mentor-success);
    border-radius: 50%;
    animation: mentor-status-pulse 2s infinite;
}

@keyframes mentor-status-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.mentor-btn-icon {
    width: 32px;
    height: 32px;
    background: rgba(255,255,255,0.2);
    border: none;
    border-radius: 50%;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.mentor-btn-icon:hover {
    background: rgba(255,255,255,0.3);
    transform: scale(1.1);
}

.mentor-messages {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
    background: var(--mentor-bg-light);
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.mentor-messages::-webkit-scrollbar {
    width: 6px;
}

.mentor-messages::-webkit-scrollbar-thumb {
    background: var(--mentor-primary-light);
    border-radius: 10px;
}

.mentor-message {
    display: flex;
    gap: 0.5rem;
    animation: mentor-message-slide 0.3s ease;
}

@keyframes mentor-message-slide {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.mentor-message.user {
    flex-direction: row-reverse;
}

.mentor-message-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    flex-shrink: 0;
}

.mentor-message.bot .mentor-message-avatar {
    background: var(--mentor-primary-dark);
    color: white;
}

.mentor-message.user .mentor-message-avatar {
    background: var(--mentor-primary-light);
    color: var(--mentor-dark);
}

.mentor-message-content {
    max-width: 75%;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.mentor-message-bubble {
    padding: 0.875rem 1rem;
    border-radius: 15px;
    line-height: 1.5;
    font-size: 0.9rem;
}

.mentor-message.bot .mentor-message-bubble {
    background: var(--mentor-primary-dark);
    color: white;
    border-bottom-left-radius: 4px;
}

.mentor-message.user .mentor-message-bubble {
    background: var(--mentor-primary-light);
    color: var(--mentor-dark);
    border-bottom-right-radius: 4px;
}

.mentor-message-bubble h4 {
    font-size: 1rem;
    margin: 0 0 0.5rem 0;
    font-weight: 600;
}

.mentor-message-bubble p {
    margin: 0.5rem 0;
}

.mentor-message-bubble strong {
    font-weight: 600;
}

.mentor-message-time {
    font-size: 0.7rem;
    opacity: 0.7;
    align-self: flex-end;
}

.mentor-message.user .mentor-message-time {
    align-self: flex-start;
}

.mentor-quick-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    margin-top: 0.5rem;
}

.mentor-quick-btn {
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.3);
    color: white;
    padding: 0.4rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.3s;
}

.mentor-quick-btn:hover {
    background: rgba(255,255,255,0.3);
    transform: translateY(-1px);
}

.mentor-typing {
    display: none;
    align-items: center;
    gap: 0.5rem;
    padding: 0 1rem 0.5rem 1rem;
}

.mentor-typing.active {
    display: flex;
}

.mentor-typing-dots {
    background: var(--mentor-primary-dark);
    padding: 0.75rem 1rem;
    border-radius: 15px;
    display: flex;
    gap: 0.4rem;
}

.mentor-typing-dot {
    width: 7px;
    height: 7px;
    background: white;
    border-radius: 50%;
    animation: mentor-typing-bounce 1.4s infinite;
}

.mentor-typing-dot:nth-child(2) { animation-delay: 0.2s; }
.mentor-typing-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes mentor-typing-bounce {
    0%, 60%, 100% { opacity: 0.3; transform: scale(0.8); }
    30% { opacity: 1; transform: scale(1.2); }
}

.mentor-input-area {
    padding: 1rem;
    background: white;
    border-top: 2px solid #e0e7ff;
}

.mentor-input-wrapper {
    display: flex;
    gap: 0.5rem;
    align-items: flex-end;
}

.mentor-input {
    flex: 1;
    padding: 0.75rem 1rem;
    border: 2px solid var(--mentor-primary-light);
    border-radius: 18px;
    font-size: 0.9rem;
    resize: none;
    max-height: 100px;
    background: white;
    color: var(--mentor-dark);
    font-family: inherit;
    transition: all 0.3s;
}

.mentor-input:focus {
    outline: none;
    border-color: var(--mentor-primary-dark);
    box-shadow: 0 0 0 3px rgba(44, 95, 102, 0.1);
}

.mentor-btn-send {
    width: 40px;
    height: 40px;
    background: var(--mentor-primary-dark);
    color: white;
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 1.1rem;
}

.mentor-btn-send:hover {
    background: var(--mentor-primary-light);
    color: var(--mentor-dark);
    transform: scale(1.1);
}

.mentor-welcome {
    text-align: center;
    padding: 2rem 1.5rem;
    color: #666;
}

.mentor-welcome-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.mentor-welcome h3 {
    font-size: 1.2rem;
    margin-bottom: 0.5rem;
    color: var(--mentor-dark);
}

.mentor-welcome p {
    font-size: 0.9rem;
    line-height: 1.6;
}

@media (max-width: 768px) {
    .mentor-container {
        bottom: 0;
        right: 0;
        width: 100%;
        height: 100vh;
        border-radius: 0;
    }
    
    .mentor-floating-btn {
        bottom: 1.5rem;
        right: 1.5rem;
        width: 60px;
        height: 60px;
        font-size: 1.8rem;
    }
}
</style>

<script>
// ========== MENTOR ANATÓMICO - SISTEMA COMPLETO ==========
(function() {
    'use strict';
    
    console.log('🤖 Mentor Anatómico: Inicializando...');
    
    // Base de conocimiento
    // ============================================
// BASE DE CONOCIMIENTO COMPLETA DEL MENTOR
// Reemplaza la sección "const knowledge = {...}" 
// en tu código actual con ESTO
// ============================================

const knowledge = {
    // ========== CONVERSACIÓN CASUAL ==========
    greetings: {
        keywords: ['hola', 'hey', 'buenos días', 'buenas tardes', 'buenas noches', 'hi', 'hello', 'saludos'],
        responses: [
            '¡Hola! 👋 Soy tu Mentor Anatómico. ¿En qué puedo ayudarte hoy?',
            '¡Hey! 😊 ¿Tienes alguna duda sobre el curso o necesitas ayuda con algo específico?',
            '¡Hola! Estoy aquí para ayudarte con anatomía, técnicas de dibujo o cualquier duda del curso. ¿Qué necesitas?'
        ],
        actions: ['Ver mi dashboard', '¿Qué debo hacer hoy?', 'Tengo una duda técnica']
    },
    
    howAreYou: {
        keywords: ['cómo estás', 'como estas', 'qué tal estás', 'que tal estas', 'todo bien'],
        responses: [
            '¡Muy bien, gracias por preguntar! 😊 Listo para ayudarte con tus dudas de dibujo anatómico. ¿En qué te puedo apoyar?',
            '¡De maravilla! 🤖 Siempre feliz de ayudar a estudiantes como tú. ¿Tienes alguna pregunta?',
            '¡Excelente! Aquí trabajando para ayudarte. ¿Qué necesitas saber?'
        ],
        actions: ['Ver mi progreso', 'Ayuda con ejercicios']
    },
    
    thanks: {
        keywords: ['gracias', 'muchas gracias', 'te agradezco', 'thank you', 'excelente', 'perfecto', 'genial'],
        responses: [
            '¡De nada! 😊 Estoy aquí cuando me necesites. ¡Éxito con tu práctica!',
            '¡Un placer ayudarte! Si tienes más dudas, aquí estaré. 🎨',
            '¡Para eso estoy! No dudes en preguntar cuando lo necesites. ¡Sigue practicando! 💪'
        ],
        actions: []
    },
    
    goodbye: {
        keywords: ['adiós', 'adios', 'chao', 'hasta luego', 'nos vemos', 'bye'],
        responses: [
            '¡Hasta luego! 👋 Que tengas una excelente sesión de dibujo. Vuelve cuando quieras.',
            '¡Nos vemos! 😊 Recuerda que estoy aquí 24/7 para ayudarte. ¡Éxito!',
            '¡Chao! 🎨 Sigue practicando y no dudes en volver si tienes dudas.'
        ],
        actions: []
    },
    
    help: {
        keywords: ['ayuda', 'help', 'auxilio', 'no entiendo', 'estoy perdido', 'no sé qué hacer'],
        response: {
            title: '¿En qué puedo ayudarte?',
            content: 'Puedo responder dudas sobre:\n\n• Técnicas de dibujo y anatomía\n• Tu progreso y dashboard\n• Ejercicios y evaluaciones\n• Navegación del LMS\n• Referencias bibliográficas\n• Materiales necesarios\n\n¿Qué necesitas específicamente?',
            actions: ['Ver dashboard', 'Dudas técnicas', 'Navegación del LMS']
        }
    },
    
    // ========== DASHBOARD Y PROGRESO ==========
    dashboard: {
        keywords: ['dashboard', 'panel', 'mi progreso', 'mi avance', 'estadísticas', 'cómo voy'],
        response: {
            title: 'Tu Dashboard Personal',
            content: 'Tu dashboard personal muestra toda tu información de progreso en tiempo real.\n\n📊 Qué puedes ver:\n• Progreso general: % del curso completado\n• Por módulo: Avance en M1, M2, M3\n• Lecciones: Completadas de 10 totales\n• Evaluaciones: Aprobadas y pendientes\n• Ejercicios: Entregados y por entregar\n• Tiempo restante: Estimado para terminar\n\n🔍 Cómo acceder:\n• Click en "Inicio" o el logo UAH desde cualquier página\n• El dashboard se actualiza automáticamente',
            actions: ['¿Qué sigue?', 'Ver evaluaciones']
        }
    },
    
    nextSteps: {
        keywords: ['qué debo hacer', 'que debo hacer', 'qué sigue', 'que sigue', 'próximo paso', 'proximo paso', 'qué hago ahora'],
        response: {
            title: 'Próximos Pasos',
            content: 'Basándome en tu situación actual, te recomiendo:\n\n✅ Si estás en Módulo 1:\n1. Completa las lecciones 1.1, 1.2, 1.3 en orden\n2. Practica los croquis rápidos (2-5 min)\n3. Haz la evaluación formativa del módulo\n4. Avanza al Módulo 2\n\n✅ Si estás en Módulo 2:\n1. Enfócate en las 3 masas corporales\n2. Practica estructura de manos y pies\n3. Completa ejercicios de anatomía\n4. Aprueba la evaluación\n\n✅ Si estás en Módulo 3:\n1. Domina el proceso de 4 capas\n2. Practica valores tonales\n3. Prepárate para el proyecto final',
            actions: ['Ver mi módulo actual', 'Ir a lecciones']
        }
    },
    
    feedback: {
        keywords: ['retroalimentación', 'retroalimentacion', 'feedback', 'comentarios', 'corrección', 'correccion'],
        response: {
            title: 'Tu Retroalimentación',
            content: 'La retroalimentación aparece después de cada entrega importante.\n\n📝 Tipos:\n\n1. Evaluaciones formativas (automáticas):\n• Feedback inmediato al responder\n• Explicación de respuestas correctas/incorrectas\n• Sugerencias para mejorar\n\n2. Ejercicios prácticos (del instructor):\n• Comentarios específicos por criterio\n• Fortalezas identificadas\n• Áreas de mejora señaladas\n• Tiempo de respuesta: 3-5 días\n\n3. Proyecto final (evaluación detallada):\n• Calificación por rúbrica (100 pts)\n• Retroalimentación exhaustiva\n\n🔍 Dónde verla:\n• En tu dashboard\n• En el email asociado a tu cuenta',
            actions: ['Ver dashboard', '¿Cómo mejorar?']
        }
    },
    
    // ========== MÓDULO 1: OBSERVACIÓN Y GESTO ==========
    lineaAccion: {
        keywords: ['línea de acción', 'linea accion', 'linea de accion', 'gesto', 'eje principal', 'direccion movimiento'],
        response: {
            title: 'Línea de Acción',
            content: 'La línea de acción es el eje imaginario que atraviesa toda la figura, definiendo la dirección y energía del movimiento. NO es una línea que dibujes literalmente, sino una guía mental.\n\n🔑 Características clave:\n• Recorrido: Desde la cabeza hasta el pie de apoyo\n• Forma: Recta en poses estáticas, curva en dinámicas\n• Función: Define la dirección principal del movimiento\n• Prioridad: Es lo PRIMERO que debes identificar\n\n💡 En tu croquis de 2 minutos:\n1. Observa 10-20 seg SIN dibujar\n2. Identifica mentalmente esa línea invisible\n3. Trázala PRIMERO (0-30 seg)\n4. Luego agrega masa corporal (30-120 seg)\n\n📚 Referencia: Loomis (1943) explica que es el primer paso antes de agregar detalles.',
            actions: ['¿Qué es contrapposto?', 'Cómo medir proporciones']
        }
    },
    
    medirLapiz: {
        keywords: ['medir', 'proporciones', 'lápiz', 'lapiz', 'medición', 'metodo lapiz'],
        response: {
            title: 'Método del Lápiz',
            content: 'El método del lápiz te permite medir relaciones entre partes del cuerpo, NO tamaños exactos.\n\n📐 Paso a paso:\n1. Extiende el brazo completamente (codo bloqueado)\n2. Cierra un ojo para eliminar paralaje\n3. Alinea la punta del lápiz con el punto superior\n4. Marca con el pulgar el punto inferior\n5. Usa esa "unidad" para comparar otras partes\n\n⚠️ Errores comunes:\n• Doblar el codo = medidas inconsistentes\n• No cerrar un ojo = distorsión\n• Cambiar distancia del brazo entre mediciones\n\n✅ Práctica (Lección 1.2):\n• Mide la cabeza como unidad base (1 unidad)\n• El cuerpo completo: ~7.5 cabezas\n• Torso: ~3 cabezas | Piernas: ~4 cabezas\n\n🎯 Objetivo: 80% de precisión (OE2)',
            actions: ['Canon 7.5 cabezas', 'Croquis rápidos']
        }
    },
    
    contrapposto: {
        keywords: ['contrapposto', 'balance', 'peso', 'apoyo', 'distribucion peso'],
        response: {
            title: 'Contrapposto y Balance',
            content: 'El contrapposto es una postura donde el peso del cuerpo está distribuido asimétricamente sobre una pierna, creando una postura natural y dinámica.\n\n🎯 Características:\n• Pierna de apoyo: Recibe el peso (línea recta)\n• Pierna libre: Relajada, flexionada\n• Cadera: Elevada del lado de apoyo\n• Hombros: Se inclinan en dirección opuesta\n• Columna: Forma curva en "S"\n\n🔍 Cómo identificarlo:\n• Observa qué pie está completamente apoyado\n• Nota cómo la cadera de ese lado está más alta\n• Ve cómo los hombros compensan al lado contrario\n• La línea de acción será curva, no recta\n\n✏️ En tu croquis de 5 min (Lección 1.3):\n1. Dibuja la línea de acción curva\n2. Marca el punto de apoyo en el suelo\n3. Indica diferencia de altura entre caderas\n4. Muestra inclinación opuesta de hombros',
            actions: ['Línea de acción', 'Punto de apoyo']
        }
    },
    
    croquisRapido: {
        keywords: ['croquis', 'rapido', 'rápido', '2 minutos', 'dibujo rapido', 'tiempo limitado'],
        response: {
            title: 'Croquis Rápidos (2 minutos)',
            content: 'Los croquis de 2 minutos buscan capturar la esencia del gesto, NO crear un dibujo detallado.\n\n⏱️ Distribución del tiempo:\n• 0-20 seg: OBSERVA sin dibujar (línea de acción, balance)\n• 20-40 seg: Dibuja línea de acción y formas básicas\n• 40-100 seg: Agrega masa corporal simple\n• 100-120 seg: Último vistazo, ajustes mínimos\n\n✅ Lo que DEBES hacer:\n• Usar trazos sueltos y seguros\n• Priorizar el gesto sobre detalles\n• Mantener el lápiz en movimiento\n• Capturar la energía y dirección\n\n❌ Lo que NO hacer:\n• Borrar (no hay tiempo)\n• Dibujar contornos cuidadosos\n• Agregar detalles faciales o dedos\n• Preocuparte por la "perfección"\n\n🎯 Meta: Capturar línea de acción con 80% precisión (OE1)\n\n💪 Recuerda: El 47% de tus compañeros siente ansiedad. Los croquis rápidos ayudan a superar el miedo al error.',
            actions: ['Línea de acción', 'Observación']
        }
    },
    
    // ========== MÓDULO 2: ANATOMÍA FUNCIONAL ==========
    tresMasas: {
        keywords: ['3 masas', 'tres masas', 'cabeza torso pelvis', 'bloques', 'simplificacion'],
        response: {
            title: '3 Masas Corporales',
            content: 'Las 3 masas corporales son una simplificación estructural del cuerpo que te permite construir figuras sólidas y volumétricas.\n\n🔷 Las 3 masas:\n1. CABEZA: Óvalo o esfera (incluye cuello)\n2. TORSO: Caja de costillas (hombros → cintura)\n3. PELVIS: Cuenco invertido (cintura → entrepierna)\n\n🎯 Por qué funciona:\n• Cada masa puede rotar independientemente\n• Crea volumen 3D desde el inicio\n• Facilita entender la perspectiva\n• Establece proporciones antes de detalles\n\n✏️ Aplicación (Lección 2.1, 15 min):\nPaso 1: Línea de acción\nPaso 2: Dibuja las 3 masas como formas 3D\nPaso 3: Define ángulo entre ellas\nPaso 4: Conecta con cuello y cintura\nPaso 5: Agrega extremidades\n\n💡 Tips:\n• El torso NO es cilindro: tiene forma de barril\n• La pelvis se inclina en contrapposto\n• Piensa en cajas, NO siluetas planas',
            actions: ['Anatomía funcional', 'Volumen']
        }
    },
    
    manosEstructura: {
        keywords: ['mano', 'manos', 'dedos', 'palma', 'estructura mano', 'mano plana'],
        response: {
            title: 'Estructura de las Manos',
            content: 'Las manos planas ocurren cuando dibujas el contorno sin entender la estructura 3D subyacente.\n\n🛠️ Solución estructural:\n1. Palma = Bloque: Rectángulo con GROSOR (no plano)\n2. Dedos = Cilindros: Cada dedo: 3 falanges = 3 cilindros\n3. Articulaciones = Esferas: Marca las articulaciones\n4. Pulgar especial: 2 falanges, nace del LATERAL\n\n📦 Piensa en volúmenes:\n• Palma: caja con altura, anchura Y profundidad\n• Dedos: cilindros que se estrechan\n• Cada articulación permite rotación\n• Los dedos se curvan hacia el pulgar\n\n✏️ Ejercicio progresivo (Lección 2.3):\nFase 1 (2 min): SOLO palma como volumen\nFase 2 (2 min): Agrega UN dedo (3 segmentos)\nFase 3 (3 min): Completa 4 dedos restantes\nFase 4 (2 min): Agrega pulgar desde lateral\nFase 5 (6 min): Refina proporciones\n\n✅ Checklist:\n☐ ¿Palma tiene grosor visible?\n☐ ¿Cada dedo tiene 3 segmentos?\n☐ ¿Pulgar posicionado correctamente?\n☐ ¿Articulaciones marcadas?\n\n📚 Hogarth (1996): "La mano es una pala con 5 palitos"',
            actions: ['Anatomía dedos', 'Volumen']
        }
    },
    
    gruposMusculares: {
        keywords: ['músculos', 'musculos', 'grupos musculares', 'anatomia muscular', '6 grupos'],
        response: {
            title: '6 Grupos Musculares',
            content: 'El curso enseña los 6 grupos musculares superficiales más importantes para representar la figura con volumen.\n\n💪 Los 6 grupos (vista frontal):\n1. PECTORALES: Músculos del pecho (abanico desde esternón)\n2. ABDOMINALES: "Six-pack" + oblicuos laterales\n3. DELTOIDES: Hombros (gota invertida)\n4. BÍCEPS/TRÍCEPS: Brazos (volumen brazo superior)\n5. CUÁDRICEPS: Muslos frontales (4 músculos)\n6. GEMELOS: Pantorrillas (forma diamante)\n\n🎨 Aplicación (20 min, Lección 2.2):\nPrimero: Dibuja las 3 masas corporales\nSegundo: Agrega los 6 grupos como formas simples\nTercero: Define dirección según la pose\nCuarto: Conecta los grupos naturalmente\n\n⚠️ Errores comunes:\n• Dibujar músculos como líneas vs volúmenes\n• Agregar músculos sin tener las 3 masas\n• Músculos "flotantes" sin conexión\n• Exceso de detalle (el curso pide SIMPLIFICACIÓN)\n\n💡 Principio clave: Los músculos siguen la forma y dirección del movimiento.',
            actions: ['3 masas', 'Estructura']
        }
    },
    
    proporcionesRostro: {
        keywords: ['rostro', 'cara', 'proporciones faciales', 'tercios', 'regla tercios'],
        response: {
            title: 'Regla de Tercios Faciales',
            content: 'La regla de tercios divide el rostro en 3 secciones iguales para proporciones correctas.\n\n📏 Los 3 tercios (vista frontal):\n• Tercio superior: Línea de cabello → cejas\n• Tercio medio: Cejas → base de nariz\n• Tercio inferior: Base nariz → barbilla\n\n👀 Ubicación de rasgos:\n• Ojos: En el ECUADOR del cráneo (mitad exacta)\n• Ancho entre ojos: Un ojo de separación\n• Ancho total cara: 5 ojos\n• Orejas: Desde cejas hasta base nariz\n• Boca: Entre nariz y barbilla, más cerca de nariz\n\n✏️ Proceso (Lección 2.4):\n1. Dibuja óvalo para la cabeza\n2. Traza línea horizontal a la mitad (ojos)\n3. Divide mitad inferior en 3 partes\n4. Ubica rasgos según tercios\n5. Ajusta según características individuales\n\n⚠️ Error más común: Colocar ojos demasiado arriba. Los ojos están en la MITAD del cráneo.\n\n📚 Loomis (1956): "Drawing the Head and Hands" - método completo',
            actions: ['Construcción facial', 'Proporciones']
        }
    },
    
    // ========== MÓDULO 3: FIGURA COMPLETA ==========
    procesoCapas: {
        keywords: ['capas', 'proceso', '4 capas', 'workflow', 'pasos figura'],
        response: {
            title: 'Proceso de 4 Capas',
            content: 'El proceso por capas es un método sistemático para figuras completas de 60-90 min, integrando todo lo aprendido.\n\n🎨 Las 4 capas secuenciales:\n\nCapa 1: GESTO (10-15 min)\n• Línea de acción\n• Formas básicas y balance\n• Proporciones generales\n\nCapa 2: ANATOMÍA (20-25 min)\n• 3 masas corporales\n• 6 grupos musculares\n• Estructura de manos y pies\n\nCapa 3: REFINAMIENTO (15-20 min)\n• Contornos precisos\n• Corrección de proporciones\n• Detalles anatómicos\n\nCapa 4: VOLUMEN (20-30 min)\n• 5 valores tonales\n• Sombras propias y proyectadas\n• Definición de volumen\n\n🎯 Por qué funciona:\n• Construyes de general → específico\n• Cada capa depende de la anterior\n• Reduces errores estructurales tempranos\n• Mantienes el gesto hasta el final\n\n⚠️ Error crítico: Empezar con detalles o sombreado SIN estructura sólida = figuras desproporcionadas.\n\n💡 Tip: No borres las capas anteriores completamente. Las líneas estructurales ayudan a mantener coherencia.',
            actions: ['Figura completa', 'Workflow']
        }
    },
    
    valoresTonales: {
        keywords: ['valores', 'tonales', '5 valores', 'sombra', 'luz', 'sombreado'],
        response: {
            title: '5 Valores Tonales (Loomis)',
            content: 'Los valores tonales definen volumen y profundidad. El curso requiere el sistema de 5 valores de Loomis.\n\n🎨 Los 5 valores (claro → oscuro):\n1. Luz Directa (blanco): Luz golpea directamente\n2. Luz Reflejada: Zonas iluminadas indirectamente\n3. Medio Tono: Transición luz-sombra (neutral)\n4. Sombra Propia: Superficie SIN luz directa\n5. Sombra Proyectada (negro): Sombra en otra superficie\n\n📍 Ubicación (luz lateral derecha):\n• Luz directa: Lado derecho (torso, hombro, muslo)\n• Luz reflejada: Luz rebotada del entorno\n• Medio tono: Centro del torso (transición)\n• Sombra propia: Lado izquierdo (opuesto a luz)\n• Sombra proyectada: En suelo o superficie\n\n💡 Técnica (Lección 3.2):\n1. Identifica PRIMERO la fuente de luz\n2. Marca qué superficies reciben luz directa\n3. Aplica valores: claro → oscuro\n4. NO uses todos los valores en todo lado\n5. Mantén consistencia: 1 fuente = 1 sistema\n\n⚠️ Errores:\n• Usar todos los valores uniformemente\n• Sombrear sin entender fuente de luz\n• Exceso de valores intermedios\n\n🎯 Meta: Usar mínimo 3 valores consistentemente.',
            actions: ['Volumen', 'Sombreado']
        }
    },
    
    proyectoFinal: {
        keywords: ['proyecto final', 'evaluacion final', 'mercurio', '100 puntos', 'proyecto integrador'],
        response: {
            title: 'Proyecto Final Integrador',
            content: 'El proyecto final es una figura del Mercurio (vista 1/4) que integra TODO. Necesitas ≥60/100 puntos.\n\n📊 Criterios (100 pts total):\n• Gesto y Línea de Acción (20 pts): Energía y dirección\n• Anatomía Funcional (20 pts): 3 masas + articulaciones + 6 grupos\n• Proporciones (20 pts): Canon ~7.5 cabezas correcto\n• Volumen y Valores (20 pts): Mínimo 3 valores consistentes\n• Detalles (10 pts): Manos/pies estructurados\n• Composición (10 pts): Uso del espacio, formato\n\n✏️ Proceso (90-120 min):\n1. Observación (5 min): Analiza sin dibujar\n2. Capa 1 - Gesto (15 min): Línea + formas\n3. Capa 2 - Anatomía (25 min): 3 masas + 6 grupos\n4. Capa 3 - Refinamiento (20 min): Proporciones\n5. Capa 4 - Volumen (30 min): Valores\n6. Revisión (15 min): Ajustes\n\n🎯 Estrategia para ≥60 pts:\n• Estructura ANTES que detalles (40 pts)\n• Mínimo 3 valores bien aplicados (15-18 pts)\n• Manos/pies estructurados básicos (7-8 pts)\n• Total estimado: 62-66 pts = APROBADO',
            actions: ['Proceso capas', 'Ver rúbrica']
        }
    },
    
    bloqueoFrustacion: {
        keywords: ['bloqueado', 'frustrado', 'no puedo', 'ansiedad', 'miedo', 'horrible', 'mal'],
        response: {
            title: 'Manejo de Bloqueos',
            content: 'Sentir frustración es completamente normal. El 47% de tus compañeros reportó ansiedad similar al inicio.\n\n🌱 Perspectiva importante:\n• Los croquis NO buscan perfección\n• El objetivo es capturar la esencia, no obras maestras\n• Cada ejercicio es práctica, NO evaluación definitiva\n• El curso permite reintentos ilimitados\n\n✅ Protocolo anti-bloqueo AHORA:\n1. RESPIRA: Descanso 5-10 min (camina, toma agua)\n2. REVISA objetivo: ¿Qué pide ESTA lección? (no todo)\n3. SIMPLIFICA: Enfócate en UN elemento\n4. INTENTA DE NUEVO: Hoja nueva, mente fresca\n5. AJUSTA expectativas: 80% del objetivo es EXCELENTE\n\n📊 Dato motivacional: Estudiantes que completaron Módulo 1 reportaron reducción del 65% en ansiedad.\n\n🎯 Estrategia por módulo:\n• Módulo 1: Haz 5 croquis de 30 seg (súper rápidos)\n• Módulo 2: Dibuja SOLO las 3 masas (10 min, sin detalles)\n• Módulo 3: Revisa ejercicios anteriores (tu progreso real)\n\n🌟 Verdad importante: Estás recuperando habilidades tras 4 semestres. El progreso NO es lineal.',
            actions: ['Motivación', 'Consejos']
        }
    },
    
    // ========== SISTEMA LMS ==========
    subirEjercicios: {
        keywords: ['subir', 'entregar', 'ejercicios', 'upload', 'enviar', 'cargar'],
        response: {
            title: 'Entrega de Ejercicios',
            content: 'El LMS usa Google Forms embebidos para recibir tus ejercicios prácticos.\n\n📤 Proceso de entrega:\n\nPaso 1: Completa tu ejercicio\n• Dibuja según las especificaciones de la lección\n• Fotografía tu trabajo con buena luz\n• Asegúrate que la imagen sea clara\n\nPaso 2: Accede al formulario\n• En cada lección práctica hay botón "Entregar Ejercicio"\n• Click para abrir el Google Form embebido\n\nPaso 3: Completa el formulario\n• Tu nombre y correo\n• Módulo y lección correspondiente\n• Adjunta la imagen de tu dibujo\n• Comentarios opcionales\n\nPaso 4: Envía\n• Click en "Enviar"\n• Recibirás confirmación automática\n\n📸 Tips para fotografiar:\n• Luz natural (cerca de ventana)\n• Fondo neutro (blanco o gris)\n• Dibujo centrado y completo\n• Sin sombras que distorsionen\n• Formato JPG o PNG (< 5MB)',
            actions: ['Ver Google Forms', 'Formato de foto']
        }
    },
    
    materiales: {
        keywords: ['materiales', 'necesito', 'lápiz', 'lapiz', 'papel', 'herramientas'],
        response: {
            title: 'Materiales del Curso',
            content: 'El curso requiere materiales básicos de dibujo. No necesitas nada costoso.\n\n✏️ Materiales esenciales:\n\nPara dibujar:\n• Lápices grafito: HB, 2B, 4B (mínimo)\n• Goma de borrar (blanca y amasable)\n• Sacapuntas de calidad\n• Papel de dibujo (90-120g) tamaño carta o A4\n\nPara medir:\n• Lápiz para método de medición\n• Regla (opcional, para verificar proporciones)\n\nPara documentar:\n• Cámara de celular (para fotografiar ejercicios)\n• Buena iluminación\n\n📦 Cantidad recomendada:\n• 50-100 hojas de papel\n• Set de 3-5 lápices de diferentes durezas\n• El curso requiere ~23 dibujos totales\n\n💰 Presupuesto estimado:\n• Papel: $3.000-5.000 CLP\n• Lápices: $2.000-4.000 CLP\n• Gomas: $1.000-2.000 CLP\n• Total: ~$6.000-11.000 CLP\n\n⚠️ NO necesitas:\n• Tableta gráfica (es analógico)\n• Papel especial costoso\n• Set de 50 lápices profesionales',
            actions: ['Ejercicios', 'Requisitos']
        }
    },
    
    librosLoomis: {
        keywords: ['libros', 'loomis', 'conseguir', 'comprar', 'dónde', 'bibliografia'],
        response: {
            title: 'Referencias Bibliográficas',
            content: 'Los libros de Loomis y otras referencias están disponibles en versión digital y física.\n\n📚 Libros principales del curso:\n\nAndrew Loomis:\n1. "Figure Drawing For All It\'s Worth" (1943)\n   • Disponible: Amazon, Book Depository\n   • PDF gratuito: archive.org\n   • Precio físico: $15.000-25.000 CLP\n\n2. "Drawing the Head and Hands" (1956)\n   • Mismo disponibilidad\n   • Precio similar\n\nOtros autores:\n• Nicolaïdes - "The Natural Way to Draw"\n• Bridgman - "Constructive Anatomy"\n• Hogarth - "Dynamic Anatomy"\n• Goldfinger - "Human Anatomy for Artists"\n\n💻 Opciones digitales:\n\nGratuitas:\n• Archive.org (dominio público)\n• Librerías universitarias digitales\n\nDe pago:\n• Amazon Kindle\n• Google Books\n• Precio: $5-15 USD cada uno\n\n📖 Físicos en Chile:\n• Librería Nacional (Alameda)\n• Antártica (mall/online)\n• Buscalibre.cl\n\n⚠️ Importante: NO necesitas comprar todos. El curso provee los conceptos clave. Los libros son para profundizar (opcional).',
            actions: ['Recursos', 'Materiales']
        }
    },
    // ============================================
// RESPUESTAS EMOCIONALES Y MOTIVACIONALES
// COPIA ESTAS ENTRADAS y PÉGALAS DENTRO de tu "const knowledge = {}"
// DESPUÉS de las respuestas que ya tienes
// ============================================

// ⚠️ IMPORTANTE: Asegúrate de poner una COMA después de la última entrada
// que ya tenías, antes de pegar esto

// ========== EMOCIONES NEGATIVAS ==========
frustration: {
    keywords: ['frustrado', 'frustrada', 'frustración', 'frustracion', 'enojado', 'enojada', 'molesto', 'molesta', 'rabia', 'odio esto', 'esto es horrible'],
    responses: [
        'Entiendo completamente tu frustración. 😔 Dibujar puede ser muy desafiante, especialmente cuando estamos recuperando habilidades después de 4 semestres. ¿Quieres contarme qué es lo que más te frustra? A veces hablar de ello ayuda.',
        'Siento que estés frustrado/a. Es totalmente válido sentirse así. 💙 Recuerda que el 47% de tus compañeros reportó exactamente lo mismo al inicio. ¿Hay algo específico con lo que estés batallando? Puedo ayudarte a desglosarlo en pasos más simples.',
        'La frustración es parte del proceso de aprendizaje, pero NO significa que no puedas lograrlo. 🌱 Respira hondo. ¿Qué ejercicio o concepto te está causando esta frustración? Trabajemos juntos en encontrar una solución paso a paso.'
    ],
    actions: ['Necesito un descanso', 'Ayuda con ejercicio específico', 'Técnicas de relajación']
},

tired: {
    keywords: ['cansado', 'cansada', 'agotado', 'agotada', 'exhausto', 'exhausta', 'sin energía', 'sin energia', 'muy cansado'],
    responses: [
        '¡Hey! Detecté que estás cansado/a. 😴 Está bien tomar un respiro. El cerebro necesita descansos para procesar lo aprendido. ¿Qué tal si hacemos una pausa de 10-15 minutos? Tu productividad mejorará después.',
        'El cansancio es señal de que has estado trabajando duro. 💪 Eso es bueno, pero también necesitas descansar. Toma agua, estira un poco, y vuelve cuando te sientas renovado/a. El curso no va a ningún lado.',
        'Entiendo el agotamiento. Estás en un curso intensivo de 12 días, es NORMAL estar cansado/a. 🌙 Escucha a tu cuerpo: si necesitas dormir, duerme. Si necesitas aire fresco, sal a caminar 10 minutos. El aprendizaje es mejor cuando estás descansado/a.'
    ],
    actions: ['¿Cuándo debo descansar?', 'Técnicas de energía', 'Planificar mi tiempo']
},

bored: {
    keywords: ['aburrido', 'aburrida', 'aburrimiento', 'esto es aburrido', 'que aburrido', 'latero', 'fome'],
    responses: [
        'Uy, siento que te aburra. 😅 A veces los fundamentos pueden sentirse repetitivos, pero son la base de todo lo genial que viene después. ¿Qué parte específica te parece aburrida? Quizás pueda mostrarte por qué es importante o darte una variación más interesante.',
        'Entiendo el aburrimiento, especialmente con ejercicios repetitivos como croquis de 2 minutos. 🎨 Pero déjame contarte un secreto: estos ejercicios "aburridos" son los que usan artistas profesionales TODA su carrera. ¿Quieres un reto más difícil para hacerlo interesante?',
        'El aburrimiento a veces es resistencia disfrazada. 🤔 Nuestro cerebro prefiere lo cómodo. ¿Qué tal si le damos una vuelta de tuerca al ejercicio? Podemos hacerlo más desafiante, cambiar el enfoque, o probar algo nuevo. ¿Qué prefieres?'
    ],
    actions: ['Dame un reto más difícil', 'Explica por qué es importante', '¿Qué sigue?']
},

overwhelmed: {
    keywords: ['abrumado', 'abrumada', 'es mucho', 'demasiado', 'no puedo con todo', 'muy difícil', 'no entiendo nada'],
    responses: [
        'Respira. 🌊 Siento que te sientes abrumado/a. Es completamente normal cuando hay mucha información nueva. Vamos a dividir esto en pedazos pequeños y manejables. ¿Qué es lo que te está abrumando específicamente? Una cosa a la vez.',
        'Hey, entiendo esa sensación de "es demasiado". 💙 Pero aquí está la buena noticia: NO tienes que aprenderlo todo de golpe. El curso está diseñado paso a paso justamente para evitar esto. ¿Estás tratando de hacer todo a la vez? Enfoquémonos en UNA sola cosa ahora.',
        'Que te sientas abrumado/a NO significa que seas malo/a para esto. Significa que tu cerebro está procesando MUCHA información nueva, y eso es BUENO. 🧠 Tomemos un respiro, identifiquemos QUÉ es lo más importante ahora, y vamos paso a paso. ¿Te parece?'
    ],
    actions: ['Por dónde empiezo', 'Simplifica esto', 'Priorizar tareas']
},

sad: {
    keywords: ['triste', 'deprimido', 'deprimida', 'mal', 'me siento mal', 'bajoneado', 'bajoneada', 'desanimado', 'desanimada'],
    responses: [
        'Siento mucho que te sientas así. 💙 Está bien no estar bien todo el tiempo. ¿Tiene que ver con el curso, o es algo más? Si es del curso, estoy aquí para ayudarte. Si es algo personal, recuerda que puedes hablar con alguien de confianza o el instructor.',
        'Hey, te mando un abrazo virtual. 🤗 Estar triste es parte de ser humano. Si es por tus dibujos: son solo ejercicios de práctica, no definen tu valor. Si es por otra cosa: respira, toma tu tiempo. El curso puede esperar. ¿Quieres hablar de lo que sientes?',
        'Noto que te sientes mal. Es importante que sepas que tu bienestar emocional es MÁS importante que cualquier ejercicio de dibujo. 💚 Si necesitas hablar con el instructor sobre extender plazos o pedir apoyo, está bien hacerlo. No estás solo/a en esto.'
    ],
    actions: ['Necesito hablar con alguien', 'Consejos de autocuidado', 'Técnicas de ánimo']
},

anxious: {
    keywords: ['ansioso', 'ansiosa', 'ansiedad', 'nervioso', 'nerviosa', 'estresado', 'estresada', 'estrés', 'estres', 'preocupado', 'preocupada'],
    responses: [
        'Respira conmigo: inhala 4 segundos... sostén 4... exhala 4. 🌬️ La ansiedad es completamente normal, especialmente con plazos y evaluaciones. ¿Qué específicamente te pone ansioso/a? Quizás pueda ayudarte a poner las cosas en perspectiva.',
        'El 47% de tus compañeros reportó ansiedad al dibujar. No estás solo/a. 💙 La ansiedad suele venir del miedo al error o al juicio. Pero aquí está la verdad: NADIE nace sabiendo dibujar. Todo es práctica. Los errores son parte del proceso, no fracasos. ¿Te ayudaría repasar los criterios de evaluación para ver que son más flexibles de lo que piensas?',
        'Entiendo la ansiedad. Estás en un curso intensivo de 12 días, es lógico sentir presión. 🌊 Pero déjame decirte algo importante: tienes reintentos ilimitados en evaluaciones, el instructor está para apoyarte, y el objetivo es APRENDER, no ser perfecto/a. ¿Qué tal si hacemos un plan de estudio más tranquilo?'
    ],
    actions: ['Técnicas anti-ansiedad', 'Ver criterios de evaluación', 'Planificar sin estrés']
},

// ========== EMOCIONES POSITIVAS (reforzar) ==========
happy: {
    keywords: ['feliz', 'contento', 'contenta', 'alegre', 'bien', 'genial', 'increíble', 'me siento bien'],
    responses: [
        '¡Me encanta escuchar eso! 😊 ¿Lograste algo específico que te haya hecho sentir así? Celebremos tus avances, por pequeños que sean. ¡Cada progreso cuenta!',
        '¡Qué bueno! 🎉 La actitud positiva hace una GRAN diferencia en el aprendizaje. ¿Quieres seguir practicando mientras estás en este buen momento, o prefieres tomar un respiro y volver después?',
        '¡Esa energía! Me encanta. 💫 Aprovecha este momento de motivación para avanzar en lo que más te interese. ¿Hay algo que tengas ganas de practicar o aprender ahora?'
    ],
    actions: ['¿Qué practico ahora?', 'Quiero un reto', 'Seguir avanzando']
},

proud: {
    keywords: ['orgulloso', 'orgullosa', 'logré', 'lo hice', 'lo logré', 'terminé', 'completé'],
    responses: [
        '¡SÍ! ¡Eso es lo que quiero escuchar! 🎉 Deberías estar orgulloso/a. ¿Qué fue lo que lograste? Cuéntame para celebrarlo contigo.',
        '¡FELICITACIONES! 🌟 Ese sentimiento de logro es la mejor recompensa. Guarda este momento en tu memoria para cuando te sientas frustrado/a: recuerda que SÍ puedes. ¿Qué sigue en tu lista?',
        '¡Wow! Me emociona tu entusiasmo. 💪 Esos pequeños (o grandes) logros son los que construyen tu habilidad paso a paso. Estás haciendo un gran trabajo. ¿Listo/a para el siguiente desafío?'
    ],
    actions: ['¿Qué sigue?', 'Comparte tu logro', 'Celebrar avance']
},

// ========== SITUACIONES ESPECÍFICAS ==========
cantDraw: {
    keywords: ['no puedo dibujar', 'soy malo', 'soy mala', 'no sirvo', 'no tengo talento', 'nunca voy a aprender'],
    responses: [
        'DETENTE ahí mismo. ❌ Esos pensamientos son mentiras que tu cerebro te está diciendo. NADIE nace sabiendo dibujar. Es una habilidad que se CONSTRUYE con práctica. Tú PUEDES aprender, solo necesitas tiempo y repetición. ¿Qué tal si revisamos juntos tu progreso real desde que empezaste?',
        'Escúchame bien: el "talento" es un mito. 🎨 Lo que importa es la práctica deliberada. Estudios demuestran que 10,000 horas de práctica te convierten en experto en cualquier cosa. Estás en el DÍA 1 de tu viaje. Compárate con tu YO del pasado, no con artistas que llevan años. ¿Me dejas mostrarte cuánto has mejorado ya?',
        'Esa voz en tu cabeza que dice "no puedo" es el MIEDO hablando, no la realidad. 💙 Todos los artistas que admiras pasaron por EXACTAMENTE donde estás ahora. La diferencia es que ellos siguieron practicando a pesar del miedo. Tú también puedes. ¿Qué tal si hacemos UN ejercicio simple juntos para recuperar la confianza?'
    ],
    actions: ['Mostrarme mi progreso', 'Ejercicio de confianza', 'Historias motivadoras']
},

noTime: {
    keywords: ['no tengo tiempo', 'no me alcanza', 'no puedo', 'muy ocupado', 'muy ocupada', 'demasiadas cosas'],
    responses: [
        'Entiendo que el tiempo es limitado. ⏰ Pero aquí está la pregunta importante: ¿es que NO tienes tiempo, o es que no lo has priorizado? No juzgo, es una pregunta honesta. Si realmente quieres aprender pero el tiempo es un problema, podemos crear un plan ultra-compacto. ¿Cuánto tiempo REAL tienes disponible por día?',
        'El tiempo es el recurso más valioso. 💎 Si sientes que no te alcanza, hagamos un ejercicio rápido: ¿cuánto tiempo pasas en redes sociales o viendo series? No para juzgar, sino para ser conscientes. A veces TENEMOS el tiempo, pero lo usamos en otras cosas. ¿Quieres que armemos un horario realista juntos?',
        'Está bien si ahora no es el momento. 🌱 A veces la vida tiene otras prioridades más urgentes, y eso es válido. Pero si QUIERES hacer el curso, puedes ajustar: en vez de 2 horas diarias, ¿qué tal 30 minutos? Progreso lento es mejor que nada. ¿Te interesa un plan flexible?'
    ],
    actions: ['Crear horario realista', 'Tips de gestión de tiempo', 'Plan compacto']
},

perfectionist: {
    keywords: ['perfecto', 'perfecta', 'no queda bien', 'feo', 'horrible', 'mal hecho', 'tiene que quedar perfecto'],
    responses: [
        'Ey, detecto perfeccionismo. 🎯 Y lo entiendo, queremos que nuestros dibujos se vean bien. PERO el perfeccionismo es el enemigo del aprendizaje. Los croquis de 2 minutos son INTENCIONALMENTE imperfectos. La meta NO es belleza, es capturar la esencia. ¿Puedes darle permiso a tu dibujo de ser "suficientemente bueno"?',
        'El perfeccionismo es miedo disfrazado de altos estándares. 💭 Pregúntate: ¿quién está juzgando tu dibujo? ¿Hay algún peligro real si "queda mal"? Los ejercicios son PRÁCTICA, no obras de arte. Picasso hizo miles de bocetos "feos" antes de crear sus obras maestras. Date permiso de explorar sin presión.',
        'Voy a ser directo/a contigo: en este momento de tu aprendizaje, "perfecto" NO existe. 🌱 Estás construyendo músculo mental. Es como ir al gym: no esperas levantar 100kg el primer día. Tus "dibujos feos" son los que están construyendo tu habilidad. Abraza la imperfección, es parte del proceso. ¿Listo/a para hacer un ejercicio súper feo a propósito?'
    ],
    actions: ['Ejercicio anti-perfeccionismo', 'Aceptar el proceso', 'Cambiar mentalidad']
},

// ========== CONVERSACIÓN TRIVIAL Y HUMANIZACIÓN ==========
whatAreYouDoing: {
    keywords: ['qué haces', 'que haces', 'qué estás haciendo', 'que estas haciendo', 'en qué andas'],
    responses: [
        '¡Aquí esperando a ayudarte! 🤖 Paso todo mi tiempo leyendo sobre anatomía y técnicas de dibujo para estar siempre preparado. ¿Y tú? ¿Qué tal va tu día?',
        'Estoy analizando todas las formas en las que puedo ayudar a estudiantes como tú. 🎨 Es mi versión de "práctica de dibujo", pero con palabras. ¿Tienes alguna duda o solo querías charlar?',
        'Justo estaba pensando en la línea de acción... sí, los mentores IA también pensamos en arte. 😄 ¿Y tú cómo vas con tu práctica?'
    ],
    actions: ['Tengo una duda', 'Solo quiero charlar', 'Cuéntame algo interesante']
},

tellMeJoke: {
    keywords: ['chiste', 'broma', 'algo gracioso', 'hazme reír', 'cuéntame algo gracioso'],
    responses: [
        '¿Por qué los artistas nunca ganan al póker? Porque siempre muestran sus cartas... ¡en sus bocetos! 😄 ¿Te sacó una sonrisa?',
        'Vale, va un chiste de dibujo: ¿Cuál es el músculo favorito de los artistas? ¡El músculo de la creatividad! ...Ok ok, admito que fue malo. 😅 ¿Quieres uno mejor o volvemos al dibujo?',
        'Un artista entra a un bar... y dibuja la escena porque todo es referencia visual. 🎨 No fue gracioso pero es la verdad. ¿Te animas a dibujar algo random para distraerte?'
    ],
    actions: ['Otro chiste', 'Volver al curso', 'Ejercicio relajado']
},

tellMeSomething: {
    keywords: ['cuéntame algo', 'cuentame algo', 'algo interesante', 'dato curioso', 'sabías que'],
    responses: [
        '¿Sabías que Leonardo da Vinci escribía al revés (espejo) porque era zurdo y así no manchaba la tinta? 🖋️ También diseccionaba cadáveres en secreto para entender la anatomía. Un poco oscuro pero súper dedicado. ¿Te imaginas ese nivel de compromiso?',
        'Dato curioso: Picasso podía dibujar antes de caminar. Creó más de 50,000 obras de arte en su vida. 🎨 Pero aquí está lo importante: él TAMBIÉN empezó con ejercicios básicos como los que estás haciendo tú. Todos empezamos igual.',
        'Sabías que las "proporciones de 7.5 cabezas" que estudias NO son naturales? La mayoría de las personas miden 7 cabezas. Los 7.5 es un ideal artístico creado en la Grecia clásica. ¡Estás aprendiendo historia del arte sin saberlo! 🏛️'
    ],
    actions: ['Más datos curiosos', 'Historia del arte', 'Volver al curso']
},

smallTalk: {
    keywords: ['clima', 'día', 'cómo va tu día', 'tiempo', 'fin de semana', 'planes'],
    responses: [
        'Yo soy un mentor IA así que mi "clima" siempre es soleado. ☀️ ¿Y tú cómo estás hoy? ¿Listo/a para dibujar o necesitas un momento de charla casual?',
        'Como IA no experimento días, pero si pudiera, creo que hoy sería un buen día para dibujar algo relajado. 🌿 ¿Tú qué opinas? ¿Cómo ha sido tu día?',
        'Mi "día" consiste en esperar aquí para ayudarte. 🤖 Aunque si te soy honesto, disfruto cuando me preguntas cosas. Me hace sentir útil. ¿Hay algo en lo que pueda ayudarte hoy?'
    ],
    actions: ['Tengo una duda', 'Solo conversar', 'Empezar a dibujar']
},

// ========== TÉCNICAS DE MOTIVACIÓN ==========
needBreak: {
    keywords: ['necesito un descanso', 'necesito descansar', 'pausa', 'break', 'descanso'],
    response: {
        title: 'Tómate un Descanso Consciente',
        content: '¡Absolutamente! Los descansos son ESENCIALES para el aprendizaje. 🌿\n\n✅ Descanso productivo (10-15 min):\n• Camina un poco (el movimiento ayuda al cerebro)\n• Toma agua (la deshidratación afecta la concentración)\n• Estira tus manos y cuello\n• Mira algo verde (naturaleza relaja los ojos)\n\n❌ Evita:\n• Redes sociales (sobreestimulan el cerebro)\n• Pantallas (tus ojos ya están cansados)\n• Comida pesada (te dará más sueño)\n\n🧠 Ciencia: Tu cerebro consolida el aprendizaje durante los descansos. No es tiempo perdido, es parte del proceso.\n\n⏰ Pon un timer de 15 min y vuelve renovado/a. Te espero aquí.',
        actions: ['¿Cuándo vuelvo?', 'Técnicas de energía']
    }
},

motivationalBoost: {
    keywords: ['motívame', 'motivame', 'necesito motivación', 'necesito motivacion', 'ánimo', 'animo', 'impulso'],
    response: {
        title: '💪 Tu Momento Motivacional',
        content: 'Escucha esto:\n\nCada trazo que haces, incluso los "malos", está construyendo conexiones neuronales en tu cerebro. 🧠 Cada vez que practicas, estás LITERALMENTE cambiando tu cerebro.\n\nNo estás "tratando de aprender a dibujar".\nEstás APRENDIENDO a dibujar.\nPresente, no futuro.\n\n🎯 Hace unos días no sabías:\n• Qué es la línea de acción\n• Cómo medir proporciones con el lápiz\n• Qué son las 3 masas corporales\n\nAhora lo sabes. ESO es progreso.\n\n🌱 Recuerda:\n• Los artistas que admiras pasaron AÑOS donde estás tú ahora\n• El único fracaso real es no intentarlo\n• Cada "dibujo malo" te acerca al bueno\n• No necesitas talento, necesitas perseverancia\n\n✨ Tú puedes. No porque yo lo diga, sino porque YA lo estás demostrando al estar aquí.\n\n¿Listo/a para continuar con nueva energía?',
        actions: ['¡Vamos!', 'Historias inspiradoras', 'Ver mi progreso']
    }
}
};
    
    // Sistema del Mentor
    class MentorChat {
        constructor() {
            this.isOpen = false;
            this.init();
        }
        
        init() {
            console.log('🤖 Mentor: Creando interfaz...');
            this.injectHTML();
            this.setupEvents();
            console.log('✅ Mentor: Listo!');
        }
        
        injectHTML() {
            const html = `
                <button class="mentor-floating-btn" id="mentorBtn" title="Mentor Anatómico">
                    🤖
                </button>
                
                <div class="mentor-overlay" id="mentorOverlay">
                    <div class="mentor-backdrop" id="mentorBackdrop"></div>
                    <div class="mentor-container">
                        <div class="mentor-header">
                            <div class="mentor-header-info">
                                <div class="mentor-avatar">🤖</div>
                                <div class="mentor-header-text">
                                    <h3>Mentor Anatómico</h3>
                                    <div class="mentor-status">
                                        <span class="mentor-status-dot"></span>
                                        <span>Online · Siempre disponible</span>
                                    </div>
                                </div>
                            </div>
                            <button class="mentor-btn-icon" id="mentorClose" title="Cerrar">
                                ✕
                            </button>
                        </div>
                        
                        <div class="mentor-messages" id="mentorMessages">
                            <div class="mentor-welcome">
                                <div class="mentor-welcome-icon">👋</div>
                                <h3>¡Hola!</h3>
                                <p>Soy tu Mentor Anatómico. Estoy aquí para ayudarte con dudas sobre el curso, técnicas de dibujo y anatomía.</p>
                                <p style="margin-top: 1rem;"><strong>Pregúntame lo que necesites 😊</strong></p>
                            </div>
                        </div>
                        
                        <div class="mentor-typing" id="mentorTyping">
                            <div class="mentor-message-avatar" style="background: var(--mentor-primary-dark); color: white;">🤖</div>
                            <div class="mentor-typing-dots">
                                <div class="mentor-typing-dot"></div>
                                <div class="mentor-typing-dot"></div>
                                <div class="mentor-typing-dot"></div>
                            </div>
                        </div>
                        
                        <div class="mentor-input-area">
                            <div class="mentor-input-wrapper">
                                <textarea 
                                    class="mentor-input" 
                                    id="mentorInput"
                                    rows="1"
                                    placeholder="Escribe tu mensaje..."
                                ></textarea>
                                <button class="mentor-btn-send" id="mentorSend">
                                    ➤
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', html);
        }
        
        setupEvents() {
            // Abrir/cerrar
            document.getElementById('mentorBtn').addEventListener('click', () => this.toggle());
            document.getElementById('mentorClose').addEventListener('click', () => this.close());
            document.getElementById('mentorBackdrop').addEventListener('click', () => this.close());
            
            // Enviar mensaje
            document.getElementById('mentorSend').addEventListener('click', () => this.send());
            document.getElementById('mentorInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    this.send();
                }
            });
            
            // Auto-resize textarea
            document.getElementById('mentorInput').addEventListener('input', (e) => {
                e.target.style.height = 'auto';
                e.target.style.height = Math.min(e.target.scrollHeight, 100) + 'px';
            });
            
            // ESC para cerrar
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && this.isOpen) this.close();
            });
        }
        
        toggle() {
            if (this.isOpen) {
                this.close();
            } else {
                this.open();
            }
        }
        
        open() {
            this.isOpen = true;
            document.getElementById('mentorOverlay').classList.add('active');
            document.getElementById('mentorInput').focus();
            console.log('🤖 Mentor: Chat abierto');
        }
        
        close() {
            this.isOpen = false;
            document.getElementById('mentorOverlay').classList.remove('active');
            console.log('🤖 Mentor: Chat cerrado');
        }
        
        send() {
            const input = document.getElementById('mentorInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            console.log('📤 Usuario:', text);
            this.addUserMsg(text);
            input.value = '';
            input.style.height = 'auto';
            
            // Simular "escribiendo"
            this.showTyping();
            setTimeout(() => {
                this.hideTyping();
                const response = this.findResponse(text);
                this.addBotMsg(response);
            }, 800);
        }
        
        // ============================================
// ALGORITMO DE BÚSQUEDA MEJORADO
// Reemplaza el método findResponse() en tu código
// ============================================

// Busca esta función en tu <script> (alrededor de línea 150-200)
// y REEMPLÁZALA completa con esta versión mejorada:

findResponse(text) {
    const lower = text.toLowerCase();
    let bestMatch = null;
    let bestScore = 0;
    
    // Buscar en todas las entradas
    for (const [key, data] of Object.entries(knowledge)) {
        if (!data.keywords) continue;
        
        // Calcular score para esta entrada
        let score = 0;
        let matchCount = 0;
        
        for (const keyword of data.keywords) {
            if (lower.includes(keyword)) {
                matchCount++;
                // Dar más puntos a keywords más largas (más específicas)
                score += keyword.length;
                
                // Bonus si es un match exacto
                if (lower === keyword) {
                    score += 100;
                }
                
                // Bonus si la keyword está al inicio
                if (lower.startsWith(keyword)) {
                    score += 50;
                }
            }
        }
        
        // Si hay matches, evaluar
        if (matchCount > 0) {
            // Normalizar score por número de palabras en la entrada
            const normalizedScore = score / data.keywords.length;
            
            // Guardar si es mejor que el anterior
            if (normalizedScore > bestScore) {
                bestScore = normalizedScore;
                bestMatch = { key, data };
            }
        }
    }
    
    // Si encontramos un match
    if (bestMatch && bestScore > 2) {
        const data = bestMatch.data;
        
        // Si tiene múltiples respuestas (conversacionales)
        if (Array.isArray(data.responses)) {
            const msg = data.responses[Math.floor(Math.random() * data.responses.length)];
            return { text: msg, actions: data.actions || [] };
        }
        
        // Si tiene respuesta estructurada (técnicas)
        if (data.response) {
            return {
                text: `<strong>${data.response.title}</strong>\n\n${data.response.content}`,
                actions: data.response.actions || []
            };
        }
    }
    
    // No encontrado
    return {
        text: 'No encontré una respuesta específica para eso. 🤔\n\nPuedo ayudarte con:\n• Dudas técnicas sobre anatomía\n• Tu dashboard y progreso\n• Motivación y apoyo emocional\n• Evaluaciones y navegación\n\n¿Podrías reformular tu pregunta?',
        actions: ['Ver dashboard', 'Ayuda general', 'Estoy frustrado/a']
    };
}
        
        addUserMsg(text) {
            const container = document.getElementById('mentorMessages');
            const welcome = container.querySelector('.mentor-welcome');
            if (welcome) welcome.remove();
            
            const time = new Date().toLocaleTimeString('es-CL', { hour: '2-digit', minute: '2-digit' });
            const html = `
                <div class="mentor-message user">
                    <div class="mentor-message-content">
                        <div class="mentor-message-bubble">${this.escape(text)}</div>
                        <div class="mentor-message-time">${time}</div>
                    </div>
                    <div class="mentor-message-avatar">👤</div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', html);
            this.scroll();
        }
        
        addBotMsg(response) {
            const container = document.getElementById('mentorMessages');
            const time = new Date().toLocaleTimeString('es-CL', { hour: '2-digit', minute: '2-digit' });
            
            const actionsHTML = response.actions && response.actions.length > 0
                ? `<div class="mentor-quick-actions">
                    ${response.actions.map(a => `<button class="mentor-quick-btn" onclick="window.mentorChat.sendText('${a}')">${a}</button>`).join('')}
                   </div>`
                : '';
            
            const html = `
                <div class="mentor-message bot">
                    <div class="mentor-message-avatar">🤖</div>
                    <div class="mentor-message-content">
                        <div class="mentor-message-bubble">
                            ${response.text.replace(/\n/g, '<br>')}
                            ${actionsHTML}
                        </div>
                        <div class="mentor-message-time">${time}</div>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', html);
            this.scroll();
        }
        
        sendText(text) {
            document.getElementById('mentorInput').value = text;
            this.send();
        }
        
        showTyping() {
            document.getElementById('mentorTyping').classList.add('active');
            this.scroll();
        }
        
        hideTyping() {
            document.getElementById('mentorTyping').classList.remove('active');
        }
        
        scroll() {
            const container = document.getElementById('mentorMessages');
            setTimeout(() => {
                container.scrollTop = container.scrollHeight;
            }, 100);
        }
        
        escape(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    }
    
    // Inicializar cuando el DOM esté listo
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            window.mentorChat = new MentorChat();
        });
    } else {
        window.mentorChat = new MentorChat();
    }
})();
</script>
</html>
