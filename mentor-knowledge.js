// ============================================
// MENTOR ANAT√ìMICO v2.1 - BASE DE CONOCIMIENTO COMPLETA
// Compatible con la integraci√≥n del index.html
// ============================================

(function() {
    'use strict';

    // ============================================
    // 1. CONVERSACI√ìN B√ÅSICA (saludos, gracias, etc.)
    // ============================================
    const basicConversation = {
        saludos: {
            keywords: ['hola', 'hi', 'hey', 'buenos dias', 'buenas tardes', 'buenas noches', 'saludos', 'que tal', 'alo'],
            text: "¬°Hola! üëã Soy tu Mentor Anat√≥mico 2.0.\n\n**¬øEn qu√© puedo ayudarte hoy?**\n\nüíô **Emocional:** Me siento frustrado/a, estoy bloqueado/a\nüé® **T√©cnico:** L√≠nea de acci√≥n, proporciones, manos\nüìö **Sistema:** C√≥mo subir ejercicios, ver progreso\n\n**Escribe tu duda o pregunta** üí¨",
            actions: ['Duda t√©cnica', 'Apoyo emocional', 'Info del curso']
        },
        
        gracias: {
            keywords: ['gracias', 'thanks', 'thank you', 'te lo agradezco', 'muy util', 'me ayudo', 'muchas gracias'],
            text: "¬°De nada! üíô Me alegra haberte ayudado.\n\n**¬øNecesitas algo m√°s?**\n\nEstoy aqu√≠ para ti. Sigue practicando, vas por buen camino ‚ú®",
            actions: ['Tengo otra duda', 'Estoy bien, gracias']
        },
        
        despedida: {
            keywords: ['chao', 'adios', 'adi√≥s', 'nos vemos', 'hasta luego', 'bye', 'me voy', 'cierro'],
            text: "¬°Hasta pronto! üëã‚ú®\n\n**Recuerda:**\n- Practica un poco cada d√≠a\n- El progreso es acumulativo\n- Cada l√≠nea cuenta\n\n**¬°Sigue dibujando!** üé®",
            actions: []
        },

        ayuda: {
            keywords: ['ayuda', 'help', 'que puedes hacer', 'que sabes', 'como funciona', 'comandos', 'opciones'],
            text: "**Puedo ayudarte con:**\n\nüíô **EMOCIONAL:**\nFrustraci√≥n, bloqueo, ansiedad, comparaci√≥n, miedo\n\nüé® **T√âCNICO:**\n‚Ä¢ M√≥dulo 1: L√≠nea de acci√≥n, proporciones, croquis\n‚Ä¢ M√≥dulo 2: 3 masas, anatom√≠a, manos/pies\n‚Ä¢ M√≥dulo 3: Valores tonales, proyecto final\n\nüìö **SISTEMA:**\nSubir ejercicios, progreso, materiales\n\n**Escribe tu duda en lenguaje natural** üí¨",
            actions: ['Ver todo emocional', 'Ver todo t√©cnico', 'Ver sistema']
        }
    };

    // ============================================
    // 2. BASE DE CONOCIMIENTO EMOCIONAL (10)
    // ============================================
    const emotionalKnowledge = {
        frustracion: {
            keywords: ['frustrado', 'frustrada', 'frustrante', 'no puedo', 'no me sale', 'horrible', 'mal', 'no me gusta', 'feo'],
            responses: {
                leve: {
                    text: "Hey, respira üíô. La frustraci√≥n es se√±al de que est√°s aprendiendo algo nuevo.\n\n**T√©cnica r√°pida:** Respira 4 segundos (inhala) - 4 segundos (sost√©n) - 6 segundos (exhala). Hazlo 3 veces.\n\nLuego vuelve con curiosidad, no con juicio.",
                    actions: ['Estoy mejor', 'Necesito m√°s ayuda']
                },
                media: {
                    text: "Entiendo tu frustraci√≥n üíô. El 78% del curso pasa por esto. **Eres normal**.\n\n**Lo que pasa:** Tu ojo ve M√ÅS r√°pido de lo que tu mano hace. Esa brecha genera frustraci√≥n.\n\n**Soluci√≥n:** Pr√°ctica constante. La brecha se cierra con tiempo.",
                    actions: ['¬øCu√°nto tiempo?', 'Dame un ejercicio']
                },
                alta: {
                    text: "**PARA**. No dibujes ahora. En serio.\n\n**Haz esto:**\n1. Cierra tu cuaderno\n2. Camina 10 minutos\n3. Toma agua\n4. Vuelve tranquilo/a\n\nDibujar muy frustrado = malos h√°bitos.",
                    actions: ['S√≠, hablemos', 'Solo necesitaba o√≠r eso']
                }
            }
        },
        
        comparacion: {
            keywords: ['mejor que yo', 'peor que', 'otros dibujan', 'talento', 'nunca voy a', 'no tengo'],
            responses: {
                text: "üõë **Alto ah√≠**. Compararse mata el progreso creativo.\n\n**Verdad dura:** Siempre habr√° alguien \"mejor\". Siempre.\n\n**Pregunta real:** ¬øDibujas mejor que AYER? Esa es la √∫nica comparaci√≥n v√°lida.\n\nComp√°rate con tu yo de hace 1 semana.",
                actions: ['Tienes raz√≥n', '¬øY si no veo progreso?']
            }
        },
        
        impostor: {
            keywords: ['no merezco', 'soy un fraude', 'suerte', 'enga√±o', 'no soy artista'],
            responses: {
                text: "S√≠ndrome del impostor detectado üé≠. El 70% de artistas lo experimenta.\n\n**Realidad:** Si HACES arte, ERES artista. Punto.\n\n**Tip:** Reemplaza \"no soy artista\" por: \"Soy un artista en desarrollo\".\n\nTu pr√°ctica te hace artista.",
                actions: ['Me ayuda o√≠r eso', 'Pero mis dibujos son malos']
            }
        },
        
        bloqueo: {
            keywords: ['bloqueado', 'bloqueada', 'no se que dibujar', 'blanco', 'sin ideas', 'vac√≠o', 'vacio'],
            responses: {
                text: "Bloqueo = falta de INPUT, no falta de talento.\n\n**Ejercicio (15 min):**\n1. Ve 20 fotos de poses en Pinterest/Line of Action\n2. Elige la que M√ÅS te llame\n3. Dib√∫jala EN 5 MINUTOS (s√≠, mal hecho)\n4. Repite\n\nEl bloqueo se rompe con VOLUMEN.",
                actions: ['Voy a intentarlo', '¬øD√≥nde busco referencias?']
            }
        },
        
        ansiedad: {
            keywords: ['ansioso', 'ansiosa', 'nervios', 'estresado', 'estresada', 'presi√≥n', 'presion'],
            responses: {
                text: "La ansiedad es energ√≠a mal dirigida. Vamos a redirigirla.\n\n**T√©cnica 5-4-3-2-1:**\n- 5 cosas que VES\n- 4 que TOCAS\n- 3 que ESCUCHAS\n- 2 que HUELES\n- 1 que SABOREAS\n\nEsto te ancla al presente. La ansiedad vive en el futuro.",
                actions: ['Lo har√©', 'Mi ansiedad es por evaluaci√≥n']
            }
        },
        
        perfeccionismo: {
            keywords: ['perfecto', 'perfecta', 'tiene que quedar bien', 'no est√° bien', 'borrar todo'],
            responses: {
                text: "Perfeccionismo NO es excelencia. Es miedo disfrazado.\n\n**Regla 80/20:** Un dibujo al 80% te ense√±a M√ÅS que uno al 100%.\n\n¬øPor qu√©? Porque TERMINAS m√°s.\n\n**Ejercicio:** Pr√≥ximo dibujo en la MITAD del tiempo. Prohibido borrar.\n\nAbraza lo \"feo\".",
                actions: ['Me cuesta no borrar', 'Voy a intentar']
            }
        },
        
        cansancio: {
            keywords: ['cansado', 'cansada', 'agotado', 'agotada', 'no tengo energ√≠a', 'energ√≠a', 'sue√±o', 'sueno'],
            responses: {
                text: "Dibujar cansado/a = entrenar enfermo. Contraproducente.\n\n**Prioriza:**\n1. Dormir 7-8 horas\n2. Comer bien\n3. Moverte\n4. DESPU√âS dibujar\n\nTu creatividad necesita energ√≠a f√≠sica.\n\nDescansa hoy, dibuja ma√±ana.",
                actions: ['Necesitaba o√≠r esto', 'Pero tengo deadline']
            }
        },
        
        miedo: {
            keywords: ['miedo', 'temor', 'asusta', 'da p√°nico', 'panico', 'terror'],
            responses: {
                text: "El miedo al error es enemigo #1 del aprendizaje.\n\n**Verdad:** Los dibujos \"malos\" ense√±an M√ÅS que los \"buenos\".\n\nCada error es data. Data = aprendizaje.\n\n**Mantra:** \"Este dibujo no define mi valor como artista\".\n\nEl miedo se disuelve con repetici√≥n.",
                actions: ['¬øY si sigo teniendo miedo?', 'Voy a intentarlo']
            }
        },
        
        desmotivacion: {
            keywords: ['desmotivado', 'desmotivada', 'sin ganas', 'para qu√©', 'para que', 'no vale la pena'],
            responses: {
                text: "Desmotivaci√≥n = expectativas vs. realidad desalineadas.\n\n**Pregunta:** ¬øPor qu√© empezaste este curso?\n\nReconecta con ESO.\n\n**Micro-motivaci√≥n:** Dibuja solo 5 minutos hoy. SOLO 5.\n\nLa motivaci√≥n sigue a la acci√≥n, no al rev√©s.",
                actions: ['Voy a intentar 5 min', 'Ya no recuerdo por qu√© empec√©']
            }
        },
        
        llanto: {
            keywords: ['llorar', 'lloro', 'l√°grimas', 'lagrimas', 'ganas de llorar', 'llor√©', 'llore'],
            responses: {
                text: "Llorar est√° bien. En serio. No es debilidad.\n\nEst√°s procesando frustraci√≥n, expectativa, esfuerzo. Eso es HUMANO.\n\n**Permiso oficial:** Llora si necesitas. Luego l√°vate la cara, toma agua.\n\nTu bienestar > cualquier dibujo. Siempre. üíô",
                actions: ['Gracias, necesitaba esto', 'Estoy mejor ahora']
            }
        }
    };

    // ============================================
    // 3. BASE DE CONOCIMIENTO T√âCNICO (25)
    // ============================================
    const technicalKnowledge = {
        // M√ìDULO 1 (8)
        lineaAccion: {
            keywords: ['linea de accion', 'linea accion', 'l√≠nea de acci√≥n', 'l√≠nea acci√≥n', 'gesto', 'movimiento', 'dinamica', 'din√°mica'],
            responses: {
                text: "**L√≠nea de acci√≥n** = Curva imaginaria que atraviesa el cuerpo mostrando su movimiento.\n\n**C√≥mo encontrarla:**\n1. Ignora detalles\n2. Busca la curva desde cabeza a pies\n3. Dib√∫jala en 1 segundo\n\n**Formas base:** 'S', 'C' o l√≠nea recta.\n\nCroquis empieza SIEMPRE con esto.",
                actions: ['Dame ejemplo', 'Entendido']
            }
        },
        
        medirProporcion: {
            keywords: ['medir', 'proporcion', 'proporciones', 'proporci√≥n', 'lapiz', 'l√°piz', 'medicion', 'medici√≥n'],
            responses: {
                text: "**Medir con l√°piz:**\n1. Estira brazo COMPLETO\n2. Cierra un ojo\n3. Usa l√°piz como regla\n4. Cabeza = unidad base\n\n**Proporci√≥n:** Cuerpo = 7-8 cabezas.\n\n**Error:** Doblar codo.\n\nPractica con objetos simples.",
                actions: ['¬øC√≥mo practico?', 'Claro']
            }
        },
        
        contrapposto: {
            keywords: ['contrapposto', 'contraposto', 'peso', 'cadera', 'hombros', 'balance'],
            responses: {
                text: "**Contrapposto** = Peso en una pierna, √°ngulos opuestos en cadera y hombros.\n\n**Regla:**\n- Cadera sube donde HAY peso\n- Hombro BAJA mismo lado\n\n**Ejercicio:** P√°rate frente espejo, pon peso en una pierna. Observa.",
                actions: ['Ya veo', '¬øC√≥mo lo dibujo?']
            }
        },
        
        croquis2min: {
            keywords: ['croquis rapido', 'croquis r√°pido', 'croquis 2', '2 minutos', 'rapido', 'r√°pido', 'tiempo'],
            responses: {
                text: "**Croquis 2 minutos:**\n1. 10 seg: L√≠nea acci√≥n\n2. 30 seg: Masas (cabeza, torso, pelvis)\n3. 60 seg: Brazos/piernas (cilindros)\n4. 20 seg: Manos/pies simples\n\n**Prohibido:** Borrar, detalles, dudar.\n**Permitido:** L√≠neas sucias, \"fealdad\".\n\nObjetivo: CAPTURAR.",
                actions: ['¬øD√≥nde practico?', 'Entendido']
            }
        },
        
        puntoApoyo: {
            keywords: ['punto de apoyo', 'apoyo', 'equilibrio', 'estabilidad'],
            responses: {
                text: "**Punto de apoyo** = Donde cuerpo toca suelo.\n\n**Regla:** L√≠nea vertical desde ombligo debe caer dentro √°rea de apoyo.\n\n**Si no:** Figura se ve inestable.\n\nPractica dibujando l√≠nea de gravedad primero.",
                actions: ['Claro', 'Dame ejemplo']
            }
        },
        
        balanceVisual: {
            keywords: ['balance', 'balanceado', 'estable', 'inestable'],
            responses: {
                text: "**Balance visual:**\nCuerpo organizado alrededor eje central.\n\n**Checkeo:**\n1. L√≠nea vertical desde cuello\n2. ¬øCae entre pies? ‚úì Estable\n3. ¬øCae fuera? ‚úó Inestable\n\n**En movimiento:** Balance se rompe intencionalmente.",
                actions: ['Entiendo', '¬øY en acci√≥n?']
            }
        },
        
        proporcionesBasicas: {
            keywords: ['proporciones basicas', 'proporciones b√°sicas', 'canon', 'medidas', 'altura'],
            responses: {
                text: "**Proporciones:**\n- Adulto: 7.5-8 cabezas\n- Ombligo: mitad del cuerpo\n- Brazos extendidos = altura\n- Manos: ment√≥n a cejas\n- Pies: 1 cabeza\n\n**No memorices.** Observa personas reales.\n\nTu ojo > cualquier regla.",
                actions: ['OK, observar√© m√°s', 'Gracias']
            }
        },
        
        observacion: {
            keywords: ['observar', 'observacion', 'observaci√≥n', 'ver', 'mirar', 'como observar', 'c√≥mo observar'],
            responses: {
                text: "**Observaci√≥n efectiva:**\n\n1. **Visi√≥n global primero:** Forma general ‚Üí Masas ‚Üí Detalles\n2. **Dibuja lo que VES, no lo que SABES**\n3. **Medici√≥n constante:** Compara todo\n\n**Ejercicio:** Mira objeto 30 seg sin dibujar. LUEGO dibuja.",
                actions: ['Voy a practicar', 'Interesante']
            }
        },

        // M√ìDULO 2 (9)
        tresMasas: {
            keywords: ['3 masas', 'tres masas', 'masas', 'bloques', 'torso'],
            responses: {
                text: "**3 masas corporales:**\n\n1. **Cabeza** = Esfera/huevo\n2. **Torso** = Caja costillas\n3. **Pelvis** = Cubo/cuenco\n\n**Por qu√©:** Son bloques que NO se deforman. Todo se conecta a ellos.\n\n**Error:** Dibujar torso como l√≠nea.\n\nPr√°ctica: Solo estas 3 masas en poses.",
                actions: ['Entendido', 'Dame ejercicio']
            }
        },
        
        gruposMusculares: {
            keywords: ['musculos', 'm√∫sculos', 'musculares', '6 grupos', 'grupos musculares', 'anatom√≠a', 'anatomia'],
            responses: {
                text: "**6 grupos musculares:**\n\n1. Trapecio (cuello-hombros)\n2. Pectorales (pecho)\n3. Deltoides (hombros)\n4. Abdominales (core)\n5. Gl√∫teos (cadera)\n6. Cu√°driceps (muslos)\n\n**No necesitas** anatom√≠a m√©dica. Solo formas b√°sicas.\n\nPiensa: \"bultos\" que cambian silueta.",
                actions: ['OK', '¬øC√≥mo memorizo?']
            }
        },
        
        manosPies: {
            keywords: ['manos', 'pies', 'dedos', 'mano', 'pie'],
            responses: {
                text: "**Manos y pies:**\n\n**MANOS:**\n- Palma = rect√°ngulo con grosor\n- Dedos = 3 cilindros c/u\n- Pulgar = LATERAL\n\n**PIES:**\n- Pie = cu√±a 3D\n- Dedos = cilindros peque√±os\n- Tal√≥n = m√°s ancho\n\n**Error #1:** Contorno sin estructura 3D.\n\nPractica dibujando TUS manos.",
                actions: ['Voy a practicar', 'Claro']
            }
        },
        
        estructuraMano: {
            keywords: ['mano plana', 'mano se ve mal', 'mano estructura', 'palma'],
            responses: {
                text: "**Por qu√© plana:** Dibujas CONTORNO sin VOLUMEN.\n\n**Soluci√≥n 3D:**\n1. Palma = bloque rectangular con GROSOR\n2. Nudillos = 4 esferas\n3. Dedos = cilindros\n4. Pulgar lateral\n\n**Ejercicio (10 min):**\n1. Solo palma como bloque (3 min)\n2. Un dedo (3 min)\n3. Completa dem√°s (4 min)\n\nNo perfecci√≥n, ESTRUCTURA.",
                actions: ['Lo har√©', 'Gracias']
            }
        },
        
        rostroProporcion: {
            keywords: ['rostro', 'cara', 'proporciones cara', 'ojos', 'nariz', 'faciales'],
            responses: {
                text: "**Proporciones faciales:**\n\n- Ojos: mitad cabeza\n- Nariz: mitad ojos-ment√≥n\n- Boca: mitad nariz-ment√≥n\n- Ancho ojo = espacio entre ojos\n- Orejas: cejas a nariz\n\n**Regla tercios:** Frente, nariz, ment√≥n.\n\n**Importante:** Son GU√çAS. Caras var√≠an.\n\nObserva rostros reales.",
                actions: ['Entiendo', 'OK']
            }
        },
        
        anatomiaFuncional: {
            keywords: ['anatomia funcional', 'anatom√≠a funcional', 'como funciona', 'c√≥mo funciona', 'movimiento anatomia', 'movimiento anatom√≠a'],
            responses: {
                text: "**Anatom√≠a funcional** = Entender c√≥mo cuerpo se MUEVE, no solo c√≥mo se ve.\n\n**Ejemplo:** Hombro se mueve adelante, atr√°s, arriba, abajo. Dib√∫jalo seg√∫n ACCI√ìN.\n\n**Enfoque:**\n1. ¬øQu√© hace el cuerpo?\n2. ¬øQu√© m√∫sculos activan?\n3. ¬øC√≥mo cambia forma?\n\nDibuja acciones, no solo poses est√°ticas.",
                actions: ['Interesante', 'Dame ejemplo']
            }
        },
        
        estructura3D: {
            keywords: ['3d', 'tridimensional', 'volumen', 'profundidad', 'plano'],
            responses: {
                text: "**Pensar 3D:** Todo es VOLUMEN, no forma plana.\n\n**Mental:**\n- Brazo = CILINDRO\n- Torso = CAJA\n- Cabeza = ESFERA\n\n**T√©cnica:**\n1. Forma 3D simple\n2. Eje central\n3. Construye detalles\n\n**Tip:** Practica solo cilindros y cajas en √°ngulos.\n\nDomina volumen, resto fluye.",
                actions: ['Voy a practicar', 'Entendido']
            }
        },
        
        articulaciones: {
            keywords: ['articulaciones', 'articulacion', 'articulaci√≥n', 'codos', 'rodillas', 'union', 'uni√≥n'],
            responses: {
                text: "**Articulaciones:**\n\n- Hombro = esfera (amplio)\n- Codo = bisagra (solo dobla)\n- Mu√±eca = esfera peque√±a\n- Cadera = esfera (amplio)\n- Rodilla = bisagra\n- Tobillo = bisagra + rotaci√≥n\n\n**Regla:** Donde 2 cilindros juntan = ESFERA.\n\nDibuja esqueleto simple primero.",
                actions: ['Claro', 'OK']
            }
        },
        
        escorzo: {
            keywords: ['escorzo', 'perspectiva', 'angulo', '√°ngulo', 'acortamiento'],
            responses: {
                text: "**Escorzo** = Parte apunta hacia ti o se aleja. Se ve M√ÅS CORTA.\n\n**Ejemplo:** Brazo hacia ti\n- Real: largo\n- Dibujo: c√≠rculo + mano grande\n\n**T√©cnica:**\n1. Cilindro en perspectiva\n2. Elipses muestran profundidad\n3. Cerca = grande, lejos = peque√±o\n\n**Pr√°ctica:** Foto tu brazo hacia c√°mara.",
                actions: ['Voy a intentar', 'Entiendo']
            }
        },

        // M√ìDULO 3 (5)
        procesoCapas: {
            keywords: ['proceso capas', 'capas', 'proceso dibujo', 'pasos', 'workflow'],
            responses: {
                text: "**Proceso capas:**\n\n1. **Gesto (30 seg):** L√≠nea acci√≥n + masas\n2. **Estructura (2 min):** Cilindros/cubos\n3. **Anatom√≠a (3 min):** Formas musculares\n4. **Refinamiento (4+ min):** Contorno, detalles\n5. **Valores (opcional):** Luz/sombra\n\n**Regla:** NUNCA saltes capas.",
                actions: ['Entendido', '¬øCu√°nto tarda?']
            }
        },
        
        valoresTonales: {
            keywords: ['valores', 'tonales', 'luz', 'sombra', 'sombreado', 'sombrear'],
            responses: {
                text: "**Valores tonales:**\n\n**3 b√°sicos:**\n1. **Luz** (blanco papel)\n2. **Medio tono** (gris)\n3. **Sombra** (oscuro)\n\n**Regla bola:** Imagina cuerpo como esferas/cilindros.\n- Luz: donde golpea\n- Medio: transici√≥n\n- Sombra: opuesto luz\n\n**Error:** Sombrear sin estructura.\n\nEstructura PRIMERO, sombra DESPU√âS.",
                actions: ['Claro', 'Gracias']
            }
        },
        
        proyectoFinal: {
            keywords: ['proyecto final', 'final', 'proyecto', '1/4 mercurio', 'mercurio'],
            responses: {
                text: "**Proyecto final:**\n\n- **Formato:** 1/4 mercurio\n- **Tema:** Figura completa\n- **Incluir:** Gesto, anatom√≠a, proporciones, valores\n\n**Proceso:**\n1. Sketch preliminar\n2. Elige mejor\n3. Pasa a formato final\n4. Refina\n\n**Tiempo:** 4-6 horas\n\nNo perfecci√≥n, aplica TODO aprendido.",
                actions: ['¬øQu√© pose elijo?', 'Entendido']
            }
        },
        
        integracion: {
            keywords: ['integrar', 'integracion', 'integraci√≥n', 'todo junto', 'aplicar todo'],
            responses: {
                text: "**Integrar gesto + anatom√≠a:**\n\nPiensa CAPAS, no \"todo a la vez\".\n\n1. **Gesto (30 seg):** Captura energ√≠a\n2. **Estructura (2 min):** Mant√©n gesto\n3. **Anatom√≠a (3+ min):** Bultos sobre estructura\n\n**Secreto:** Gesto = ALMA. Anatom√≠a = TRAJE.\n\nNunca sacrifiques gesto por anatom√≠a perfecta.",
                actions: ['Tiene sentido', 'OK']
            }
        },
        
        figura15min: {
            keywords: ['figura larga', '15 minutos', 'figura completa', 'tiempo largo'],
            responses: {
                text: "**Figura 15 min:**\n\n- 1 min: L√≠nea acci√≥n + composici√≥n\n- 3 min: Estructura\n- 4 min: Anatom√≠a b√°sica\n- 4 min: Refinamiento\n- 3 min: Valores/sombras\n\n**Tip:** Usa temporizador.\n\n**Error:** 10 min en cabeza, correr resto.\n\nCronometra CADA fase.",
                actions: ['Voy a cronometrar', 'Entendido']
            }
        },

        // SISTEMA LMS (3)
        subirEjercicios: {
            keywords: ['subir ejercicio', 'como subir', 'c√≥mo subir', 'entregar', 'enviar trabajo', 'cargar ejercicio'],
            responses: {
                text: "**Subir ejercicios:**\n\n1. Ve a lecci√≥n\n2. Bot√≥n \"Subir ejercicio\"\n3. Foto CLARA:\n   - Buena luz\n   - Sin sombras\n   - Enfocado\n4. Sube imagen\n5. ‚úì Confirmaci√≥n\n\n**Tip:** Puedes subir varias veces. Cuenta √∫ltima.\n\nProblemas: contacta profesor.",
                actions: ['Entendido', 'Gracias']
            }
        },
        
        verProgreso: {
            keywords: ['progreso', 'avance', 'donde veo', 'd√≥nde veo', 'estadisticas', 'estad√≠sticas', 'mi progreso'],
            responses: {
                text: "**Ver progreso:**\n\n1. Dashboard principal: Barra general\n2. Cada m√≥dulo: % completado\n3. Dentro lecciones: Checkmarks ‚úì\n\n**Calcula:**\n- Lecciones completadas\n- Ejercicios subidos\n- Evaluaciones aprobadas\n\n**Actualiza** autom√°ticamente.\n\nNo obsesiones con %, obsesi√≥nate con PRACTICAR.",
                actions: ['OK', 'Claro']
            }
        },
        
        materiales: {
            keywords: ['materiales', 'que necesito', 'qu√© necesito', 'lapices', 'l√°pices', 'papel', 'herramientas'],
            responses: {
                text: "**Materiales:**\n\n**Esenciales:**\n- L√°piz grafito (HB y 2B)\n- Borrador\n- Papel (block croquis)\n- Sacapuntas\n\n**Opcionales:**\n- Carboncillo\n- L√°pices color\n- Papel mercurio (proyecto final)\n\n**No necesitas:**\n- Materiales caros\n- 20 tipos de l√°pices\n- Papel fancy para practicar\n\n**Regla:** Mejor papel barato y MUCHA pr√°ctica, que papel caro y miedo a usarlo.",
                actions: ['Perfecto', 'Gracias']
            }
        }
    };

    // ============================================
    // 4. SISTEMA DE DETECCI√ìN INTELIGENTE
    // ============================================
    function detectEmotion(text) {
        const lowerText = text.toLowerCase();
        
        // Primero: detectar conversaci√≥n b√°sica
        for (const [type, data] of Object.entries(basicConversation)) {
            for (const keyword of data.keywords) {
                if (lowerText.includes(keyword)) {
                    return { type: 'basic', subtype: type, data: data };
                }
            }
        }
        
        // Detectar emocional
        for (const [emotion, data] of Object.entries(emotionalKnowledge)) {
            for (const keyword of data.keywords) {
                if (lowerText.includes(keyword)) {
                    // Detectar intensidad si es frustraci√≥n
                    if (emotion === 'frustracion') {
                        const highIntensity = ['horrible', 'nunca', 'imposible', 'no puedo mas'].some(w => lowerText.includes(w));
                        const mediumIntensity = ['muy', 'mucho', 'demasiado'].some(w => lowerText.includes(w));
                        
                        if (highIntensity) return { type: 'emotional', emotion, intensity: 'alta', data };
                        if (mediumIntensity) return { type: 'emotional', emotion, intensity: 'media', data };
                        return { type: 'emotional', emotion, intensity: 'leve', data };
                    }
                    return { type: 'emotional', emotion, intensity: null, data };
                }
            }
        }
        
        // Detectar t√©cnico
        for (const [topic, data] of Object.entries(technicalKnowledge)) {
            for (const keyword of data.keywords) {
                if (lowerText.includes(keyword)) {
                    return { type: 'technical', topic, data };
                }
            }
        }
        
        return null;
    }

    // ============================================
    // 5. GENERADOR DE RESPUESTAS
    // ============================================
    function generateResponse(userMessage) {
        const detected = detectEmotion(userMessage);
        
        // Respuesta b√°sica (hola, gracias, etc.)
        if (detected && detected.type === 'basic') {
            return {
                type: 'basic',
                subtype: detected.subtype,
                text: detected.data.text,
                actions: detected.data.actions || []
            };
        }
        
        // Respuesta emocional
        if (detected && detected.type === 'emotional') {
            const emotionData = detected.data;
            
            if (detected.emotion === 'frustracion') {
                return emotionData.responses[detected.intensity];
            }
            
            return emotionData.responses;
        }
        
        // Respuesta t√©cnica
        if (detected && detected.type === 'technical') {
            return detected.data.responses;
        }
        
        // Respuesta por defecto (no encontrado)
        return {
            text: "Interesante pregunta ü§î. ¬øPodr√≠as darme m√°s detalles?\n\nPuedo ayudarte con:\n- üíô **Emociones** (frustraci√≥n, bloqueo, ansiedad)\n- üé® **T√©cnica** (gesto, anatom√≠a, proporciones)\n- üìö **Sistema** (c√≥mo usar el curso)\n\n¬øQu√© te gustar√≠a explorar?",
            actions: ['Tengo una duda t√©cnica', 'Me siento frustrado/a', 'Pregunta sobre el curso']
        };
    }

    // ============================================
    // 6. MEMORIA CONVERSACIONAL
    // ============================================
    class ConversationMemory {
        constructor() {
            this.history = [];
            this.emotionalState = [];
        }
        
        add(userMsg, botResponse, emotion, intensity) {
            this.history.push({
                user: userMsg,
                bot: botResponse,
                timestamp: new Date(),
                emotion,
                intensity
            });
            
            if (emotion) {
                this.emotionalState.push({ emotion, intensity, timestamp: new Date() });
            }
        }
        
        shouldOfferBreak() {
            // Si las √∫ltimas 3 interacciones tienen emociones negativas
            const recent = this.emotionalState.slice(-3);
            const negative = ['frustracion', 'ansiedad', 'bloqueo', 'llanto'];
            
            return recent.length >= 3 && recent.every(e => negative.includes(e.emotion));
        }
        
        getContextualGreeting() {
            if (this.history.length === 0) return null;
            
            const lastEmotion = this.emotionalState[this.emotionalState.length - 1];
            if (!lastEmotion) return null;
            
            const timeSince = Date.now() - lastEmotion.timestamp.getTime();
            const hoursSince = timeSince / (1000 * 60 * 60);
            
            if (hoursSince < 24) {
                return `Hey, te veo de vuelta üëã. ¬øC√≥mo te fue con lo que hablamos?\n\n¬øMejoraron las cosas o sigues con dudas?`;
            }
            
            return null;
        }
    }

    // ============================================
    // 7. EXPORTAR AL SCOPE GLOBAL
    // ============================================
    window.mentorKnowledge = {
        generateResponse,
        ConversationMemory,
        
        // Utilidades para testing
        _emotional: emotionalKnowledge,
        _technical: technicalKnowledge,
        _basic: basicConversation,
        
        // Estad√≠sticas
        getStats: function() {
            return {
                emotional: Object.keys(emotionalKnowledge).length,
                technical: Object.keys(technicalKnowledge).length,
                basic: Object.keys(basicConversation).length,
                total: Object.keys(emotionalKnowledge).length + 
                       Object.keys(technicalKnowledge).length + 
                       Object.keys(basicConversation).length
            };
        },
        
        // Test de respuestas
        testResponse: function(message) {
            console.log('üß™ Testing:', message);
            const response = generateResponse(message);
            console.log('üì§ Response:', response);
            return response;
        },
        
        // Ejemplos de consultas
        getExamples: function() {
            return {
                basic: ['hola', 'gracias', 'ayuda', 'adi√≥s'],
                emocional: [
                    'me siento frustrado',
                    'estoy bloqueado',
                    'tengo miedo',
                    'otros dibujan mejor que yo'
                ],
                tecnico: [
                    '¬øc√≥mo dibujar l√≠nea de acci√≥n?',
                    'no me salen las manos',
                    '¬øqu√© son los valores tonales?',
                    'proporciones del cuerpo'
                ],
                sistema: [
                    '¬øc√≥mo subo ejercicios?',
                    '¬øqu√© materiales necesito?',
                    '¬ød√≥nde veo mi progreso?'
                ]
            };
        }
    };

    // ============================================
    // 8. INICIALIZACI√ìN Y LOGS
    // ============================================
    console.log('‚úÖ mentor-knowledge.js v2.1 COMPLETO: Cargado exitosamente');
    console.log('‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê');
    console.log('‚îÇ  üìä ESTAD√çSTICAS DEL MENTOR ANAT√ìMICO      ‚îÇ');
    console.log('‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§');
    console.log('‚îÇ  üíô Respuestas emocionales: ' + Object.keys(emotionalKnowledge).length + '           ‚îÇ');
    console.log('‚îÇ  üé® Respuestas t√©cnicas: ' + Object.keys(technicalKnowledge).length + '              ‚îÇ');
    console.log('‚îÇ  üí¨ Conversaci√≥n b√°sica: ' + Object.keys(basicConversation).length + '               ‚îÇ');
    console.log('‚îÇ  üìù Total respuestas: ' + (Object.keys(emotionalKnowledge).length + Object.keys(technicalKnowledge).length + Object.keys(basicConversation).length) + '                  ‚îÇ');
    console.log('‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò');
    console.log('');
    console.log('üíô FUNCIONALIDADES v2.1:');
    console.log('  ‚úÖ Saludos y conversaci√≥n b√°sica');
    console.log('  ‚úÖ Detecci√≥n emocional con intensidad');
    console.log('  ‚úÖ 25 respuestas t√©cnicas completas');
    console.log('  ‚úÖ Sistema de memoria conversacional');
    console.log('  ‚úÖ Compatible con integraci√≥n index.html');
    console.log('');
    console.log('üß™ TESTING:');
    console.log('  window.mentorKnowledge.testResponse("hola")');
    console.log('  window.mentorKnowledge.getExamples()');
    console.log('  window.mentorKnowledge.getStats()');
    console.log('');
    console.log('üöÄ Sistema listo para usar!');

})();
