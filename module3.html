<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√≥dulo 3: Figura Completa - LMS UAH</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        /* ============================================
           SISTEMA DE DISE√ëO MEJORADO - VARIABLES
           ============================================ */
        :root {
            /* Colores principales */
            --primary-dark: #2c5f66;
            --primary-light: #e8a2b8;
            --primary-hover: #234b51;
            --dark: #1a1a1a;
            --gray-light: #f8f9fa;
            --gray-medium: #495057;
            --gray-border: #dee2e6;
            
            /* Colores de estado */
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            
            /* Sistema de espaciado consistente */
            --space-xs: 0.5rem;
            --space-sm: 1rem;
            --space-md: 1.5rem;
            --space-lg: 2rem;
            --space-xl: 3rem;
            --space-2xl: 4rem;
            
            /* Radios de borde */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            
            /* Sombras mejoradas */
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.06);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.12);
            --shadow-xl: 0 20px 40px rgba(0,0,0,0.16);
            
            /* Transiciones suaves */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ============================================
           ESTILOS BASE MEJORADOS
           ============================================ */
        * { 
            box-sizing: border-box; 
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: var(--gray-light);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        /* ============================================
           HEADER MEJORADO
           ============================================ */
        .header-uah {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--dark) 100%);
            color: white;
            padding: var(--space-sm) 0;
            position: sticky;
            top: 0;
            z-index: 1030;
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(10px);
        }

        /* ============================================
           BREADCRUMB MEJORADO
           ============================================ */
        .breadcrumb-custom {
            background: white;
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-md);
            box-shadow: var(--shadow-sm);
        }

        /* ============================================
           SIDEBAR MEJORADO CON M√ÅS ESPACIO
           ============================================ */
        .sidebar-lesson {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
            border: 2px solid var(--gray-border);
        }

        @media (min-width: 992px) {
            .sidebar-lesson {
                position: sticky;
                top: 90px;
                max-height: calc(100vh - 110px);
                overflow-y: auto;
            }
        }

        .sidebar-lesson:hover {
            border-color: var(--primary-light);
        }

        .lesson-link {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm);
            border-radius: var(--radius-sm);
            text-decoration: none;
            color: var(--dark);
            transition: var(--transition);
            cursor: pointer;
            margin-bottom: var(--space-xs);
            border: 2px solid transparent;
            font-weight: 500;
        }

        .lesson-link:hover {
            background: #f8f9fa;
            transform: translateX(4px);
            border-color: var(--primary-light);
        }

        .lesson-link.active {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            color: white;
            font-weight: 600;
        }

        .lesson-number {
            width: 36px;
            height: 36px;
            background: #e9ecef;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .lesson-link.active .lesson-number {
            background: white;
            color: var(--primary-dark);
        }

        .lesson-link.completed .lesson-number {
            background: var(--success);
            color: white;
        }

        .lesson-link.completed::after {
            content: '\F26B';
            font-family: 'bootstrap-icons';
            color: var(--success);
            font-size: 1.3rem;
            margin-left: auto;
        }

        .progress-module {
            height: 10px;
            background: #e9ecef;
            border-radius: 10px;
            margin-top: var(--space-md);
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .progress-bar-module {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-dark), var(--primary-light));
            border-radius: 10px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ============================================
           √ÅREA DE CONTENIDO MEJORADA
           ============================================ */
        .content-area {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-xl);
            min-height: 70vh;
            box-shadow: var(--shadow-md);
            border: 2px solid var(--gray-border);
        }

        @media (max-width: 768px) {
            .content-area { 
                padding: var(--space-md); 
            }
        }

        /* ============================================
           ENCABEZADOS DE LECCI√ìN MEJORADOS
           ============================================ */
        .lesson-header {
            border-bottom: 3px solid var(--primary-light);
            padding-bottom: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .lesson-title {
            color: var(--primary-dark);
            font-weight: 800;
            font-size: clamp(1.75rem, 4vw, 2.25rem);
            margin-bottom: var(--space-sm);
            letter-spacing: -0.02em;
        }

        .lesson-subtitle {
            color: var(--gray-medium);
            font-size: clamp(1.05rem, 2.5vw, 1.2rem);
            margin-bottom: var(--space-md);
            font-weight: 500;
        }

        /* ============================================
           OBJETIVOS Y BLOQUES DESTACADOS
           ============================================ */
        .objectives-list {
            background: linear-gradient(135deg, rgba(44,95,102,0.06), rgba(232,162,184,0.06));
            border-left: 4px solid var(--primary-dark);
            padding: var(--space-lg);
            margin: var(--space-lg) 0;
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            box-shadow: var(--shadow-sm);
        }

        .objectives-list h4,
        .objectives-list h5,
        .objectives-list h6 {
            color: var(--primary-dark);
            font-weight: 700;
            margin-bottom: var(--space-sm);
        }

        .objectives-list li {
            margin-bottom: var(--space-xs);
            color: var(--dark);
            font-weight: 500;
        }

        /* ============================================
           ACORDEONES MEJORADOS
           ============================================ */
        .accordion-button {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            color: white;
            font-weight: 600;
            font-size: clamp(0.95rem, 2vw, 1.05rem);
            padding: var(--space-md) var(--space-lg);
        }

        .accordion-button:not(.collapsed) {
            background: var(--primary-hover);
            color: white;
        }

        .accordion-button:focus {
            box-shadow: 0 0 0 0.25rem rgba(44, 95, 102, 0.25);
            border-color: var(--primary-dark);
        }

        .accordion-button::after {
            filter: brightness(0) invert(1);
        }

        .accordion-body {
            padding: var(--space-lg);
        }

        /* ============================================
           CONTENEDORES DE VIDEO MEJORADOS
           ============================================ */
        .video-container {
            background: #000;
            border-radius: var(--radius-md);
            overflow: hidden;
            margin: var(--space-lg) 0;
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            box-shadow: var(--shadow-lg);
        }

        .video-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(44,95,102,0.95), rgba(26,26,26,0.95));
            color: white;
        }

        .video-placeholder i {
            font-size: clamp(2.5rem, 8vw, 4.5rem);
            margin-bottom: var(--space-md);
        }

        /* ============================================
           TARJETAS DE EJERCICIO MEJORADAS
           ============================================ */
        .exercise-card {
            background: linear-gradient(135deg, rgba(44,95,102,0.05), rgba(232,162,184,0.05));
            border-left: 5px solid var(--primary-light);
            padding: var(--space-lg);
            border-radius: var(--radius-sm);
            margin: var(--space-lg) 0;
            box-shadow: var(--shadow-md);
            border: 2px solid var(--gray-border);
            border-left: 5px solid var(--primary-light);
        }

        .exercise-card h4,
        .exercise-card h5,
        .exercise-card h6 {
            color: var(--primary-dark);
            font-weight: 700;
            margin-bottom: var(--space-md);
        }

        /* ============================================
           IM√ÅGENES DE REFERENCIA MEJORADAS
           ============================================ */
        .reference-image {
            width: 100%;
            min-height: 120px;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-md);
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-medium);
            font-style: italic;
            text-align: center;
            padding: var(--space-sm);
            font-size: 0.9rem;
            overflow: hidden;
            position: relative;
            border: 2px solid var(--gray-border);
        }

        .reference-image img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            border-radius: var(--radius-sm);
            position: relative;
            cursor: pointer;
            transition: var(--transition);
        }

        .reference-image img:hover {
            transform: scale(1.03);
        }

        .reference-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-lg);
            margin: var(--space-lg) 0;
        }

        @media (max-width: 576px) {
            .reference-grid {
                grid-template-columns: 1fr;
                gap: var(--space-md);
            }
        }

        .reference-card {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-md);
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: var(--transition);
            border: 3px solid var(--gray-border);
            position: relative;
        }

        .reference-card:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }

        .reference-card.selected {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.05);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .selection-badge {
            position: absolute;
            top: var(--space-sm);
            right: var(--space-sm);
            z-index: 10;
        }

        /* ============================================
           CHECKLISTS MEJORADAS
           ============================================ */
        .checklist {
            background: white;
            padding: var(--space-md);
            border-radius: var(--radius-sm);
            margin: var(--space-md) 0;
            border: 2px solid var(--gray-border);
            box-shadow: var(--shadow-sm);
        }

        .checklist-item {
            padding: var(--space-sm);
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            transition: var(--transition);
            cursor: pointer;
            user-select: none;
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-xs);
        }

        .checklist-item:hover { 
            background: #f8f9fa; 
        }
        
        .checklist-item:last-child { 
            border-bottom: none; 
        }
        
        .checklist-item.checked { 
            background: rgba(16, 185, 129, 0.1);
        }
        
        .checklist-item.checked i { 
            color: var(--success); 
        }

        /* ============================================
           EVALUACIONES MEJORADAS
           ============================================ */
        .evaluation-container {
            background: var(--gray-light);
            padding: var(--space-xl);
            border-radius: var(--radius-md);
            margin: var(--space-xl) 0;
            box-shadow: var(--shadow-md);
            border: 2px solid var(--gray-border);
        }

        @media (max-width: 768px) {
            .evaluation-container { 
                padding: var(--space-md); 
            }
        }

        .eval-progress {
            background: white;
            padding: var(--space-md);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-md);
            border-left: 4px solid var(--info);
            box-shadow: var(--shadow-sm);
        }

        .eval-question {
            background: white;
            padding: var(--space-lg);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-lg);
            box-shadow: var(--shadow-md);
            border: 2px solid var(--gray-border);
        }

        .eval-question h5 {
            color: var(--primary-dark);
            font-weight: 700;
            margin-bottom: var(--space-md);
        }

        .eval-option {
            padding: var(--space-md);
            border: 2px solid var(--gray-border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-sm);
            background: white;
        }

        .eval-option:hover:not(.correct):not(.incorrect) {
            border-color: var(--primary-dark);
            background: rgba(44, 95, 102, 0.05);
            transform: translateX(4px);
        }

        .eval-option.selected {
            border-color: var(--primary-dark);
            background: rgba(44, 95, 102, 0.1);
            font-weight: 600;
        }

        .eval-option.correct {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
            font-weight: 600;
        }

        .eval-option.incorrect {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
            font-weight: 600;
        }

        .eval-radio {
            width: 24px;
            height: 24px;
            border: 2px solid var(--gray-border);
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .eval-option.selected .eval-radio {
            border-color: var(--primary-dark);
            background: var(--primary-dark);
        }

        .eval-option.selected .eval-radio::after {
            content: '';
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
        }

        .eval-option.correct .eval-radio {
            border-color: var(--success);
            background: var(--success);
        }

        .eval-option.incorrect .eval-radio {
            border-color: var(--danger);
            background: var(--danger);
        }

        /* ============================================
           BOTONES DE NAVEGACI√ìN MEJORADOS
           ============================================ */
        .btn-nav {
            padding: var(--space-sm) var(--space-xl);
            border-radius: var(--radius-sm);
            font-weight: 600;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .btn-nav:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        @media (max-width: 576px) {
            .btn-nav {
                padding: var(--space-sm) var(--space-md);
                font-size: 0.9rem;
                width: 100%;
            }
        }

        .btn-primary-custom {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            border: none;
            color: white;
        }

        .btn-primary-custom:hover {
            background: linear-gradient(135deg, var(--primary-hover), var(--primary-dark));
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary-custom {
            background: white;
            border: 2px solid var(--primary-light);
            color: var(--primary-dark);
        }

        .btn-secondary-custom:hover {
            background: var(--primary-light);
            color: white;
            border-color: var(--primary-light);
        }

        /* ============================================
           ALERTAS MEJORADAS
           ============================================ */
        .alert-custom {
            border-left: 4px solid;
            border-radius: var(--radius-sm);
            padding: var(--space-md);
            margin: var(--space-md) 0;
            box-shadow: var(--shadow-sm);
        }

        .reference-text {
            font-size: 0.875rem;
            color: var(--gray-medium);
            border-left: 3px solid var(--primary-light);
            padding-left: var(--space-md);
            margin-top: var(--space-md);
            font-style: italic;
        }

        /* ============================================
           LOADING OVERLAY
           ============================================ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-overlay.show { 
            display: flex; 
        }

        /* ============================================
           ANIMACIONES MEJORADAS
           ============================================ */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* ============================================
           MENTOR FLOTANTE - MANTENER DISE√ëO ORIGINAL
           ============================================ */
        .mentor-float-button {
            position: fixed;
            bottom: 8rem;
            right: 2rem;
            width: 68px;
            height: 68px;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            border-radius: 50%;
            box-shadow: 0 8px 24px rgba(44, 95, 102, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 9998;
            transition: var(--transition);
            border: 3px solid white;
        }

        .mentor-float-button:hover {
            transform: scale(1.12);
            box-shadow: 0 12px 32px rgba(44, 95, 102, 0.6);
        }

        .mentor-float-button i {
            color: white;
            font-size: 2rem;
        }

        .mentor-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
            border: 2px solid white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        .mentor-chat-container {
            position: fixed;
            bottom: 8rem;
            right: 2rem;
            width: 420px;
            max-width: calc(100vw - 2rem);
            height: 620px;
            max-height: calc(100vh - 6rem);
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 9999;
            animation: slideUp 0.3s ease-out;
        }

        .mentor-chat-container.show {
            display: flex;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .mentor-chat-header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            color: white;
            padding: var(--space-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        }

        .mentor-chat-header-info {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .mentor-avatar {
            width: 48px;
            height: 48px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
        }

        .mentor-status {
            display: flex;
            flex-direction: column;
        }

        .mentor-name {
            font-weight: 700;
            font-size: 1.05rem;
        }

        .mentor-online {
            font-size: 0.8rem;
            opacity: 0.95;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .mentor-close-btn {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .mentor-close-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: rotate(90deg);
        }

        .mentor-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-md);
            background: #f0f2f5;
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .mentor-chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .mentor-chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .mentor-chat-messages::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 3px;
        }

        .message {
            display: flex;
            gap: var(--space-xs);
            animation: fadeInMessage 0.3s ease-out;
        }

        @keyframes fadeInMessage {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-bubble {
            max-width: 75%;
            padding: var(--space-sm) var(--space-md);
            border-radius: 18px;
            font-size: 0.9rem;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .message.mentor .message-bubble {
            background: white;
            color: var(--dark);
            border-bottom-left-radius: 4px;
            box-shadow: var(--shadow-sm);
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.6;
            margin-top: 0.25rem;
        }

        .message-actions {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-xs);
            margin-top: var(--space-sm);
        }

        .action-button {
            background: white;
            border: 2px solid var(--primary-light);
            color: var(--primary-dark);
            padding: var(--space-xs) var(--space-sm);
            border-radius: 50px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .action-button:hover {
            background: var(--primary-light);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .mentor-chat-input-container {
            padding: var(--space-md);
            background: white;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: var(--space-sm);
            align-items: flex-end;
        }

        .mentor-chat-input {
            flex: 1;
            border: 2px solid var(--gray-border);
            border-radius: 25px;
            padding: var(--space-sm) var(--space-md);
            font-size: 0.9rem;
            resize: none;
            max-height: 100px;
            font-family: inherit;
            transition: var(--transition);
        }

        .mentor-chat-input:focus {
            outline: none;
            border-color: var(--primary-light);
        }

        .mentor-send-btn {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            border: none;
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .mentor-send-btn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: var(--shadow-md);
        }

        .mentor-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            gap: 0.4rem;
            padding: var(--space-sm) var(--space-md);
            background: white;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            width: fit-content;
            box-shadow: var(--shadow-sm);
        }

        .typing-indicator.show {
            display: flex;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--gray-medium);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        /* ============================================
           RESPONSIVE MEJORADO
           ============================================ */
        @media (max-width: 768px) {
            .mentor-chat-container {
                width: calc(100vw - 2rem);
                height: calc(100vh - 6rem);
                bottom: 6rem;
                right: 1rem;
            }

            .mentor-float-button {
                bottom: 8rem;
                right: 1.5rem;
                width: 60px;
                height: 60px;
            }

            .sidebar-lesson {
                margin-bottom: var(--space-md);
            }

            .reference-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 576px) {
            :root {
                --space-lg: 1.5rem;
                --space-xl: 2rem;
                --space-2xl: 2.5rem;
            }
        }

        /* ===== IM√ÅGENES AMPLIABLES ===== */
        .reference-image img {
            cursor: zoom-in;
            transition: transform 0.2s ease;
        }

        .reference-image img:hover {
            transform: scale(1.05);
        }

        .zoom-badge {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .reference-image:hover .zoom-badge {
            opacity: 1;
        }

        @media (max-width: 768px) {
            #imageLightbox .modal-dialog {
                max-width: 95vw;
                margin: 0.5rem;
            }
            
            #imageLightbox img {
                max-height: 85vh;
            }
        }
        /* ===== ESTILOS PARA R√öBRICA ===== */
.rubric-table {
    font-size: 0.85rem;
}

.rubric-table th {
    background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
    color: white;
    font-weight: 600;
    text-align: center;
    vertical-align: middle;
    padding: 0.75rem 0.5rem;
}

.rubric-table td {
    vertical-align: top;
    padding: 0.75rem 0.5rem;
}

.rubric-table td.small {
    line-height: 1.5;
}

.rubric-table tbody tr:hover {
    background-color: rgba(44, 95, 102, 0.05);
}

.rubric-table .table-primary td {
    background: linear-gradient(135deg, rgba(44,95,102,0.1), rgba(232,162,184,0.1));
    font-weight: 700;
    font-size: 0.95rem;
}

@media (max-width: 768px) {
    .rubric-table {
        font-size: 0.75rem;
    }
    
    .rubric-table th,
    .rubric-table td {
        padding: 0.5rem 0.25rem;
    }
}
</style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="text-center">
            <div class="spinner-border text-light" style="width: 3rem; height: 3rem;"></div>
            <p class="text-white mt-3">Cargando contenido...</p>
        </div>
    </div>

    <header class="header-uah">
        <div class="container-fluid">
            <div class="row align-items-center g-2">
                <div class="col-auto">
                    <a href="index.html" class="text-white text-decoration-none">
                        <i class="bi bi-arrow-left me-2"></i>
                        <span class="d-none d-md-inline">Volver</span>
                    </a>
                </div>
                <div class="col text-center">
                    <h1 class="h5 mb-0">M√≥dulo 3: Figura Completa</h1>
                </div>
                <div class="col-auto">
                    <span class="badge bg-light text-dark" id="progressText">0%</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container-fluid py-3 py-md-4">
        <div class="breadcrumb-custom d-none d-md-block">
            <nav>
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a href="index.html">Inicio</a></li>
                    <li class="breadcrumb-item">M√≥dulo 3</li>
                    <li class="breadcrumb-item active" id="breadcrumbLesson">Lecci√≥n 1</li>
                </ol>
            </nav>
        </div>

        <div class="row">
            <aside class="col-lg-3">
                <div class="sidebar-lesson">
                    <h5 class="mb-3"><i class="bi bi-book me-2"></i>Lecciones</h5>
                    
                    <a class="lesson-link active" data-lesson="1" onclick="loadLesson(1)">
                        <span class="lesson-number">1</span>
                        <span class="flex-grow-1">S√≠ntesis por Capas</span>
                    </a>
                    
                    <a class="lesson-link" data-lesson="2" onclick="loadLesson(2)">
                        <span class="lesson-number">2</span>
                        <span class="flex-grow-1">Luz, Sombra y Volumen</span>
                    </a>
                    
                    <a class="lesson-link" data-lesson="3" onclick="loadLesson(3)">
                        <span class="lesson-number">3</span>
                        <span class="flex-grow-1">Proyecto Final</span>
                    </a>
                    
                    <div class="mt-4">
                        <h6 class="mb-2">Progreso del M√≥dulo</h6>
                        <div class="progress-module">
                            <div class="progress-bar-module" id="progressBar" style="width: 0%"></div>
                        </div>
                        <small class="text-muted d-block mt-2" id="progressDetail">0 de 3 lecciones completadas</small>
                    </div>

                    <div class="card border-primary mt-3">
                        <div class="card-header bg-primary text-white">
                            <i class="bi bi-info-circle me-2"></i>Informaci√≥n
                        </div>
                        <div class="card-body">
                            <p class="small mb-2"><strong>Duraci√≥n:</strong> 5 d√≠as</p>
                            <p class="small mb-2"><strong>Carga:</strong> 200 min</p>
                            <p class="small mb-0"><strong>Entregables:</strong></p>
                            <ul class="small mb-0 mt-2">
                                <li>2 figuras completas</li>
                                <li>1 figura con valores</li>
                                <li>1 proyecto final</li>
                                <li>3 evaluaciones</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card border-success mt-3">
                        <div class="card-header bg-success text-white">
                            <i class="bi bi-cloud-upload me-2"></i>Entrega
                        </div>
                        <div class="card-body text-center">
                            <a href="https://forms.gle/oa3g1cUkgrZqUBZ77" class="btn btn-success btn-sm w-100" target="_blank">
                                <i class="bi bi-box-arrow-up-right me-2"></i>Subir Trabajos
                            </a>
                        </div>
                    </div>
                </div>
            </aside>

            <main class="col-lg-9">
                <div class="content-area" id="lessonContent"></div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="auth.js"></script>
    
    <script>
        // ===== CONFIGURACI√ìN Y VARIABLES GLOBALES =====
        let currentLesson = 1;
        let evaluationAnswers = {};
        let completedLessons = [];
        let selectedReference = null;
        let moduleStartTime = Date.now();
        let lessonStartTime = Date.now();

        const MODULE_NUMBER = 3;
        const TOTAL_LESSONS = 3;
        const DEBUG_MODE = true;

        function debugLog(message, data = null) {
            if (DEBUG_MODE) {
                console.log(`üîç [M${MODULE_NUMBER}] ${message}`);
                if (data) console.log(data);
            }
        }

        // ===== FUNCIONES DE PERSISTENCIA =====
        async function loadProgress() {
            debugLog('loadProgress() INICIADO');
            
            const currentUser = getCurrentUser();
            if (!currentUser) {
                debugLog('‚ùå No hay usuario');
                return;
            }

            if (window.isSyncInProgress) {
                debugLog('‚è≥ Esperando sync...');
                let waitTime = 0;
                while (window.isSyncInProgress && waitTime < 10000) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    waitTime += 500;
                }
            }

            const storageKey = `progress_${currentUser.username}`;
            const saved = localStorage.getItem(storageKey);
            
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    
                    if (data.modules && data.modules[MODULE_NUMBER]) {
                        const moduleData = data.modules[MODULE_NUMBER];
                        
                        completedLessons = Array.isArray(moduleData.completedLessons) ? moduleData.completedLessons : [];
                        evaluationAnswers = moduleData.evaluations || {};
                        selectedReference = moduleData.selectedReference || null;
                        currentLesson = moduleData.currentLesson || 1;
                        
                        debugLog(`‚úÖ Progreso cargado: ${completedLessons.length} lecciones`);
                    } else {
                        completedLessons = [];
                        evaluationAnswers = {};
                        selectedReference = null;
                        currentLesson = 1;
                    }
                } catch (error) {
                    console.error('‚ùå Error parseando:', error);
                    completedLessons = [];
                    evaluationAnswers = {};
                }
            }
            
            updateProgressBar();
        }

        async function saveProgress() {
            if (window.isSyncInProgress) {
                await new Promise(resolve => setTimeout(resolve, 1000));
                if (window.isSyncInProgress) {
                    return saveProgressLocalOnly();
                }
            }
            
            const currentUser = getCurrentUser();
            if (!currentUser) return;

            if (!Array.isArray(completedLessons)) completedLessons = [];

            const timeSpent = Math.round((Date.now() - moduleStartTime) / 60000);
            const progress = Math.round((completedLessons.length / TOTAL_LESSONS) * 100);
            const isCompleted = completedLessons.length === TOTAL_LESSONS;

            const progressData = {
                completed: isCompleted,
                progress,
                timeSpent,
                completedLessons,
                evaluations: evaluationAnswers,
                selectedReference,
                currentLesson,
                lastUpdate: new Date().toISOString()
            };

            const storageKey = `progress_${currentUser.username}`;

            try {
                const allProgress = JSON.parse(localStorage.getItem(storageKey) || '{}');
                if (!allProgress.modules) allProgress.modules = {};
                allProgress.modules[MODULE_NUMBER] = progressData;
                allProgress.lastActivity = new Date().toISOString();
                
                localStorage.setItem(storageKey, JSON.stringify(allProgress));
                debugLog('‚úÖ localStorage guardado');
            } catch (error) {
                console.error('‚ùå Error localStorage:', error);
            }

            try {
                if (typeof updateModuleProgress === 'function') {
                    await updateModuleProgress(MODULE_NUMBER, progressData);
                    debugLog('‚úÖ Sheets guardado');
                }
            } catch (error) {
                console.error('‚ùå Error Sheets:', error);
            }

            updateProgressBar();
        }

        function saveProgressLocalOnly() {
            const currentUser = getCurrentUser();
            if (!currentUser) return;

            if (!Array.isArray(completedLessons)) completedLessons = [];

            const storageKey = `progress_${currentUser.username}`;
            try {
                const allProgress = JSON.parse(localStorage.getItem(storageKey) || '{}');
                if (!allProgress.modules) allProgress.modules = {};
                
                allProgress.modules[MODULE_NUMBER] = {
                    completedLessons,
                    evaluations: evaluationAnswers,
                    selectedReference,
                    currentLesson,
                    lastUpdate: new Date().toISOString()
                };
                
                localStorage.setItem(storageKey, JSON.stringify(allProgress));
                debugLog('‚úÖ Local guardado');
            } catch (error) {
                console.error('‚ùå Error:', error);
            }
        }

        function updateProgressBar() {
            if (!Array.isArray(completedLessons)) completedLessons = [];
            
            const completed = completedLessons.length;
            const percentage = Math.round((completed / TOTAL_LESSONS) * 100);
            
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const progressDetail = document.getElementById('progressDetail');
            
            if (progressBar) progressBar.style.width = percentage + '%';
            if (progressText) progressText.textContent = percentage + '%';
            if (progressDetail) progressDetail.textContent = `${completed} de ${TOTAL_LESSONS} lecciones completadas`;
            
            completedLessons.forEach(num => {
                const link = document.querySelector(`[data-lesson="${num}"]`);
                if (link) link.classList.add('completed');
            });
        }

        // ===== INICIALIZACI√ìN =====
        async function initializeModule() {
            console.log('üöÄ M√ìDULO 3 - INICIALIZACI√ìN v4.2');
            
            const funcs = ['getCurrentUser', 'updateModuleProgress', 'logUserActivity', 'syncProgressFromSheets'];
            const missing = funcs.filter(f => typeof window[f] !== 'function');
            
            if (missing.length > 0) {
                console.error('‚ùå Funciones faltantes:', missing);
                alert('Error: auth.js no cargado');
                return;
            }
            
            const currentUser = getCurrentUser();
            if (!currentUser) {
                console.warn('‚ùå No autenticado');
                window.location.href = 'login.html';
                return;
            }
            
            console.log('‚úÖ Usuario:', currentUser.username);
            
            // ===== VERIFICACI√ìN DE ACCESO: M√ìDULO 2 DEBE ESTAR COMPLETADO =====
            const storageKey = `progress_${currentUser.username}`;
            const savedProgress = localStorage.getItem(storageKey);
            let canAccess = false;
            
            if (savedProgress) {
                try {
                    const progressData = JSON.parse(savedProgress);
                    const module2Progress = progressData.modules?.[2];
                    canAccess = module2Progress?.completed || false;
                    
                    if (!canAccess) {
                        console.warn('‚ùå ACCESO DENEGADO: M√≥dulo 2 no completado');
                        alert('‚ö†Ô∏è Debes completar el M√≥dulo 2 antes de acceder al M√≥dulo 3.\n\nSer√°s redirigido al inicio.');
                        window.location.href = 'index.html';
                        return;
                    }
                    console.log('‚úÖ Verificaci√≥n de acceso: APROBADA - M√≥dulo 2 completado');
                } catch (error) {
                    console.error('Error verificando acceso:', error);
                    alert('‚ö†Ô∏è Error verificando progreso. Ser√°s redirigido al inicio.');
                    window.location.href = 'index.html';
                    return;
                }
            } else {
                console.warn('‚ùå No hay progreso guardado, redirigiendo al inicio');
                alert('‚ö†Ô∏è Debes completar el M√≥dulo 2 primero.\n\nSer√°s redirigido al inicio.');
                window.location.href = 'index.html';
                return;
            }
            
            await syncProgressFromSheets(currentUser.username, true);
            await loadProgress();
            
            if (!Array.isArray(completedLessons)) completedLessons = [];
            
            console.log('‚úÖ Estado:', { completedLessons, evaluations: Object.keys(evaluationAnswers).length });
            
            try {
                await logUserActivity('module_access', MODULE_NUMBER.toString(), '', {});
            } catch (error) {}
            
            loadLesson(currentLesson);
            moduleStartTime = Date.now();
            
            setInterval(() => saveProgress(), 120000);
            
            console.log('‚úÖ M√ìDULO INICIALIZADO');
        }

        // ===== FUNCIONES DE NAVEGACI√ìN =====
        // ===== CONCEPTOS CLAVE POR M√ìDULO Y LECCI√ìN =====
        const MODULE_CONCEPTS = {
            3: {
                1: ['S√≠ntesis por capas', 'Proceso de construcci√≥n', '4 capas sucesivas'],
                2: ['5 valores tonales', 'Luz y sombra', 'Volumen tridimensional'],
                3: ['Composici√≥n integral', 'Proyecto final', 'Aplicaci√≥n completa del curso']
            }
        };

        async function completeLesson(lessonNum) {
            if (!Array.isArray(completedLessons)) completedLessons = [];
            if (completedLessons.includes(lessonNum)) return;

            const currentUser = getCurrentUser();
            if (!currentUser) return;

            const lessonTime = Math.round((Date.now() - lessonStartTime) / 60000);
            completedLessons.push(lessonNum);
            
            await saveProgress();
            
            try {
                await logUserActivity('lesson_completed', MODULE_NUMBER.toString(), lessonNum.toString(), {
                    timeSpent: lessonTime
                });
            } catch (error) {}
            
            showToast('¬°Lecci√≥n completada!', 'success');
            
            // ===== AVANCE AUTOM√ÅTICO A LA SIGUIENTE LECCI√ìN =====
            setTimeout(() => {
                if (lessonNum < TOTAL_LESSONS) {
                    console.log('‚è≠Ô∏è Avanzando autom√°ticamente a la siguiente lecci√≥n...');
                    showToast('Avanzando a la siguiente lecci√≥n...', 'info');
                    setTimeout(() => {
                        goToNextLesson();
                    }, 1000);
                } else {
                    console.log('üéâ ¬°M√≥dulo completado!');
                    showToast(`¬°Completaste el M√≥dulo ${MODULE_NUMBER} y el curso completo!`, 'success');
                    setTimeout(() => {
                        returnToDashboardWithSummary();
                    }, 2000);
                }
            }, 2000);
        }

        // ===== FUNCI√ìN PARA REGRESAR AL DASHBOARD CON RESUMEN =====
        function returnToDashboardWithSummary() {
            const sessionSummary = {
                moduleCompleted: MODULE_NUMBER,
                lessonsCompleted: completedLessons.length,
                timeSpent: Math.round((Date.now() - moduleStartTime) / 60000),
                newConcepts: MODULE_CONCEPTS[MODULE_NUMBER][currentLesson] || [],
                nextLesson: getNextLessonInfo()
            };
            
            localStorage.setItem('lastSessionSummary', JSON.stringify(sessionSummary));
            window.location.href = 'index.html?showSummary=true';
        }

        // ===== FUNCI√ìN AUXILIAR PARA OBTENER INFO DE SIGUIENTE LECCI√ìN =====
        function getNextLessonInfo() {
            if (currentLesson < TOTAL_LESSONS) {
                return `M√≥dulo ${MODULE_NUMBER}, Lecci√≥n ${currentLesson + 1}`;
            } else if (MODULE_NUMBER < 3) {
                return `M√≥dulo ${MODULE_NUMBER + 1}, Lecci√≥n 1`;
            } else {
                return '¬°Has completado el curso completo! üéâ';
            }
        }

        async function loadLesson(lessonNum) {
            showLoading(true);
            lessonStartTime = Date.now();
            currentLesson = lessonNum;
            
            document.getElementById('breadcrumbLesson').textContent = `Lecci√≥n ${lessonNum}`;
            document.querySelectorAll('.lesson-link').forEach(l => l.classList.remove('active'));
            document.querySelector(`[data-lesson="${lessonNum}"]`).classList.add('active');
            
            const currentUser = getCurrentUser();
            if (currentUser) {
                try {
                    await logUserActivity('lesson_view', MODULE_NUMBER.toString(), lessonNum.toString(), {});
                } catch (error) {}
            }
            
            setTimeout(() => {
                document.getElementById('lessonContent').innerHTML = lessons[`lesson${lessonNum}`];
                document.getElementById('lessonContent').classList.add('fade-in');
                restoreEvaluationState(lessonNum);
                loadChecklistState();
                showLoading(false);
                window.scrollTo({ top: 0, behavior: 'smooth' });
                saveProgress();
            }, 400);
        }

        function showLoading(show = true) {
            document.getElementById('loadingOverlay').classList.toggle('show', show);
        }

        function goToNextLesson() {
            if (currentLesson < TOTAL_LESSONS) {
                loadLesson(currentLesson + 1);
            } else {
                showToast('¬°Completaste el M√≥dulo 3!', 'success');
                setTimeout(() => window.location.href = 'index.html', 2000);
            }
        }

        // ===== FUNCIONES DE CHECKLIST =====
        function toggleChecklistItem(element) {
            element.classList.toggle('checked');
            const icon = element.querySelector('i');
            icon.className = element.classList.contains('checked') ? 'bi bi-check-circle-fill' : 'bi bi-circle';
            saveChecklistState();
        }

        function saveChecklistState() {
            const currentUser = getCurrentUser();
            if (!currentUser) return;

            const storageKey = `progress_${currentUser.username}`;
            const checklists = document.querySelectorAll('.checklist-item');
            const state = {};
            
            checklists.forEach((item, index) => {
                state[`checklist_${currentLesson}_${index}`] = item.classList.contains('checked');
            });
            
            localStorage.setItem(`${storageKey}_checklists`, JSON.stringify(state));
        }

        function loadChecklistState() {
            const currentUser = getCurrentUser();
            if (!currentUser) return;

            const storageKey = `progress_${currentUser.username}`;
            const saved = localStorage.getItem(`${storageKey}_checklists`);
            
            if (!saved) return;
            
            try {
                const state = JSON.parse(saved);
                document.querySelectorAll('.checklist-item').forEach((item, index) => {
                    const key = `checklist_${currentLesson}_${index}`;
                    if (state[key]) {
                        item.classList.add('checked');
                        const icon = item.querySelector('i');
                        if (icon) icon.className = 'bi bi-check-circle-fill';
                    }
                });
            } catch (error) {}
        }

        // ===== FUNCIONES DE EVALUACI√ìN =====
        function updateEvalProgress(lessonNum) {
            const count = Object.keys(evaluationAnswers[lessonNum] || {}).length;
            const el = document.getElementById('answeredCount');
            if (el) el.textContent = Math.min(count, 3);
        }

        function selectEvalOption(element, optionNumber, lessonNum) {
            const container = element.closest('[data-question]');
            if (!container) return;
            
            const question = container.getAttribute('data-question');
            container.querySelectorAll('.eval-option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            
            if (!evaluationAnswers[lessonNum]) evaluationAnswers[lessonNum] = {};
            evaluationAnswers[lessonNum][question] = optionNumber;
            
            updateEvalProgress(lessonNum);
            saveProgress();
        }

        async function submitEvaluation(lessonNum) {
            const userAnswers = evaluationAnswers[lessonNum] || {};
            
            if (Object.keys(userAnswers).length < 3) {
                showToast('Responde todas las preguntas', 'warning');
                return;
            }
            
            const correctAnswers = {
                1: { q1: 2, q2: 3, q3: 1 },
                2: { q1: 2, q2: 3, q3: 2 },
                3: { q1: 2, q2: 3, q3: 2 }
            };
            
            await processEvaluation(lessonNum, userAnswers, correctAnswers[lessonNum]);
        }

        // ===== TIPOS DE LECCIONES Y UMBRALES DE APROBACI√ìN =====
        const LESSON_TYPES = {
            1: 'foundational', // Primera lecci√≥n siempre es fundacional
            2: 'practice',
            3: 'practice'
        };

        const MASTERY_THRESHOLDS = {
            foundational: 3, // 100% obligatorio para fundacionales
            practice: 2      // 66% aceptable para pr√°ctica
        };

        async function processEvaluation(lessonNum, userAnswers, correctAnswers) {
            showLoading(true);
            
            setTimeout(async () => {
                let score = 0;
                
                Object.keys(correctAnswers).forEach(q => {
    const container = document.querySelector(`[data-question="${q}"]`);
    if (container) {
        const options = container.querySelectorAll('.eval-option');
        options.forEach((opt, idx) => {
            const optNum = idx + 1;
            opt.style.pointerEvents = 'none';
            
            if (optNum === correctAnswers[q]) {
                opt.classList.add('correct');
                if (userAnswers[q] === correctAnswers[q]) score++;
            } else if (optNum === userAnswers[q]) {
                opt.classList.add('incorrect');
            }
        });
    }
});
                
                document.getElementById('submitEvalBtn').style.display = 'none';
                
                // Determinar tipo de lecci√≥n y umbral requerido
                const lessonType = LESSON_TYPES[lessonNum];
                const requiredScore = MASTERY_THRESHOLDS[lessonType];
                const percentage = Math.round((score / 3) * 100);
                const passed = score >= requiredScore;
                
                try {
                    await logUserActivity('evaluation_submitted', MODULE_NUMBER.toString(), lessonNum.toString(), {
                        score: percentage,
                        passed
                    });
                } catch (error) {}
                
                const resultHTML = passed ? 
                    `<div class="alert alert-success alert-custom">
                        <h5><i class="bi bi-check-circle-fill me-2"></i>¬°Excelente!</h5>
                        <p>Aprobaste con ${score}/3 (${percentage}%).</p>
                    </div>` :
                    (() => {
                        const isFoundational = lessonType === 'foundational';
                        return `<div class="alert alert-warning alert-custom">
                            <h5><i class="bi bi-exclamation-triangle-fill me-2"></i>
                                ${isFoundational ? '¬°Ups! Necesitas dominar estos conceptos' : 'Casi ah√≠, intenta de nuevo'}
                            </h5>
                            <p>Obtuviste ${score}/3 correctas.</p>
                            ${isFoundational ? 
                                '<p class="mb-2"><strong>Esta lecci√≥n es fundamental para las siguientes.</strong> Te recomendamos:</p>' : 
                                '<p>Necesitas al menos 2/3 para aprobar.</p>'}
                            <div class="mt-3 d-flex gap-2 flex-wrap">
                                <button class="btn btn-outline-primary" onclick="reviewContent()">
                                    <i class="bi bi-book me-1"></i>Repasar contenido
                                </button>
                                <button class="btn btn-primary" onclick="retryEvaluation(${lessonNum})">
                                    <i class="bi bi-arrow-clockwise me-1"></i>Reintentar ahora
                                </button>
                                <button class="btn btn-outline-secondary" onclick="document.getElementById('mentorFloatBtn').click()">
                                    <i class="bi bi-robot me-1"></i>Consultar al Mentor
                                </button>
                            </div>
                        </div>`;
                    })();
                
                document.getElementById('evalResult').innerHTML = resultHTML;
                
                if (passed) {
                    await completeLesson(lessonNum);
                    document.getElementById('nextLessonBtn').style.display = 'inline-block';
                } else {
                    document.getElementById('retryEvalBtn').style.display = 'inline-block';
                }
                
                showLoading(false);
                await saveProgress();
            }, 600);
        }

        // ===== FUNCI√ìN PARA REPASAR CONTENIDO =====
        function reviewContent() {
            const lessonHeader = document.querySelector('.lesson-header');
            if (lessonHeader) {
                lessonHeader.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
                showToast('üí° Repasa el contenido y reint√©ntalo cuando est√©s listo/a', 'info');
            }
        }

        function retryEvaluation(lessonNum) {
    // 1. Borrar respuestas guardadas
    delete evaluationAnswers[lessonNum];
    
    // 2. RECARGAR COMPLETAMENTE el HTML de la lecci√≥n (esto borra TODO estado visual)
    const lessonContent = document.getElementById('lessonContent');
    if (lessonContent && lessons[`lesson${lessonNum}`]) {
        lessonContent.innerHTML = lessons[`lesson${lessonNum}`];
    }
    
    // 3. Restaurar el contador de respuestas
    document.getElementById('answeredCount').textContent = '0';
    
    // 4. Restaurar botones de navegaci√≥n
    document.getElementById('submitEvalBtn').style.display = 'inline-block';
    document.getElementById('retryEvalBtn').style.display = 'none';
    document.getElementById('nextLessonBtn').style.display = 'none';
    
    // 5. Limpiar el √°rea de resultados
    document.getElementById('evalResult').innerHTML = '';
    
    // 6. Guardar progreso
    saveProgress();
    
    // 7. Mensaje educativo
    showToast('üí° Repasa el contenido de la lecci√≥n antes de intentar nuevamente', 'info');
    
    // 8. Scroll suave al inicio del contenido
    setTimeout(() => {
        const lessonHeader = document.querySelector('.lesson-header');
        if (lessonHeader) {
            lessonHeader.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }
    }, 300);
}

        function restoreEvaluationState(lessonNum) {
            const answers = evaluationAnswers[lessonNum];
            if (!answers) return;
            
            Object.keys(answers).forEach(question => {
                const container = document.querySelector(`[data-question="${question}"]`);
                if (container) {
                    container.querySelectorAll('.eval-option').forEach((opt, idx) => {
                        if (idx + 1 === answers[question]) opt.classList.add('selected');
                    });
                }
            });
            
            updateEvalProgress(lessonNum);
        }

        // ===== FUNCIONES DEL PROYECTO FINAL =====
        function selectReference(refNum) {
            selectedReference = refNum;
            
            document.querySelectorAll('.reference-card').forEach(card => {
                card.classList.remove('selected');
                const badge = card.querySelector('.selection-badge');
                if (badge) badge.remove();
            });
            
            const selectedCard = document.querySelector(`[data-ref="${refNum}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
                
                const badge = document.createElement('div');
                badge.className = 'selection-badge';
                badge.innerHTML = '<span class="badge bg-success"><i class="bi bi-check-lg"></i> Seleccionada</span>';
                selectedCard.appendChild(badge);
            }
            
            saveProgress();
            showToast(`Referencia ${refNum} seleccionada`, 'success');
        }

        function showReferences() {
            const modalHTML = `
                <div class="modal fade" id="referencesModal" tabindex="-1">
                    <div class="modal-dialog modal-xl modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="bi bi-images me-2"></i>Referencias para Proyecto Final
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <p class="text-muted mb-3">Selecciona una referencia:</p>
                                <div class="reference-grid">
                                    <div class="reference-card ${selectedReference === 24 ? 'selected' : ''}" data-ref="24" onclick="selectReference(24)">
                                        ${selectedReference === 24 ? '<div class="selection-badge"><span class="badge bg-success"><i class="bi bi-check-lg"></i> Seleccionada</span></div>' : ''}
                                        <div class="reference-image" style="height: 450px;">
                                            <img src="images/ref24_pose_heroica.jpg" alt="Pose heroica" onclick="openImageLightbox('images/ref24_pose_heroica.jpg', 'Pose heroica')">
                                        </div>
                                        <h6 class="mt-3 mb-1">Referencia 24</h6>
                                    </div>
                                    <div class="reference-card ${selectedReference === 25 ? 'selected' : ''}" data-ref="25" onclick="selectReference(25)">
                                        ${selectedReference === 25 ? '<div class="selection-badge"><span class="badge bg-success"><i class="bi bi-check-lg"></i> Seleccionada</span></div>' : ''}
                                        <div class="reference-image" style="height: 450px;">
                                            <img src="images/ref25_pose_cotidiana.jpg" alt="Pose cotidiana" onclick="openImageLightbox('images/ref25_pose_cotidiana.jpg', 'Pose cotidiana')">
                                        </div>
                                        <h6 class="mt-3 mb-1">Referencia 25</h6>
                                    </div>
                                    <div class="reference-card ${selectedReference === 26 ? 'selected' : ''}" data-ref="26" onclick="selectReference(26)">
                                        ${selectedReference === 26 ? '<div class="selection-badge"><span class="badge bg-success"><i class="bi bi-check-lg"></i> Seleccionada</span></div>' : ''}
                                        <div class="reference-image" style="height: 450px;">
                                            <img src="images/ref26_pose_artistica.jpg" alt="Pose art√≠stica" onclick="openImageLightbox('images/ref26_pose_artistica.jpg', 'Pose art√≠stica')">
                                        </div>
                                        <h6 class="mt-3 mb-1">Referencia 26</h6>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            const existingModal = document.getElementById('referencesModal');
            if (existingModal) existingModal.remove();
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            const modal = new bootstrap.Modal(document.getElementById('referencesModal'));
            modal.show();
            
            document.getElementById('referencesModal').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        // ===== FUNCI√ìN PARA AMPLIAR REFERENCIAS DE LECCIONES 1 Y 2 =====
        function showReferencesModal(lessonId) {
            const references = {
                'lesson1': [
                    { file: 'ref21.jpg', title: 'Referencia 21', desc: 'Figura completa 1' },
                    { file: 'ref22.jpg', title: 'Referencia 22', desc: 'Figura completa 2' }
                ],
                'lesson2': [
                    { file: 'ref23_iluminacion_lateral.jpg', title: 'Referencia 23', desc: 'Iluminaci√≥n lateral' }
                ]
            };

            const refs = references[lessonId] || [];
            let refsHTML = '';
            
            refs.forEach(ref => {
                refsHTML += `
                    <div class="reference-card">
                        <div class="reference-image" style="height: 450px;">
                            <img src="images/${ref.file}" alt="${ref.title}" onclick="openImageLightbox('images/${ref.file}', '${ref.title}')">
                        </div>
                        <h6 class="mt-3 mb-1">${ref.title}</h6>
                    </div>
                `;
            });

            const modalHTML = `
                <div class="modal fade" id="referencesModal" tabindex="-1">
                    <div class="modal-dialog modal-xl modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="bi bi-images me-2"></i>Referencias - M√≥dulo 3
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <p class="text-muted mb-3">Im√°genes de referencia para tu ejercicio:</p>
                                <div class="reference-grid">
                                    ${refsHTML}
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            const existingModal = document.getElementById('referencesModal');
            if (existingModal) existingModal.remove();
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            const modal = new bootstrap.Modal(document.getElementById('referencesModal'));
            modal.show();
            
            document.getElementById('referencesModal').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        // ===== FUNCI√ìN PARA ABRIR IMAGEN INDIVIDUAL EN LIGHTBOX =====
        function openImageLightbox(imageSrc, imageDesc) {
            const lightboxHTML = `
                <div class="modal fade" id="imageLightbox" tabindex="-1" style="z-index: 1060;">
                    <div class="modal-dialog modal-dialog-centered" style="max-width: 90vw;">
                        <div class="modal-content bg-transparent border-0">
                            <div class="modal-body text-center p-0 position-relative">
                                <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3" 
                                        data-bs-dismiss="modal" style="z-index: 1061;"></button>
                                <img src="${imageSrc}" alt="${imageDesc}" 
                                     style="max-width: 100%; max-height: 90vh; border-radius: 8px; box-shadow: 0 8px 32px rgba(0,0,0,0.5);">
                                <p class="text-white mt-3 mb-0">${imageDesc}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            const existingLightbox = document.getElementById('imageLightbox');
            if (existingLightbox) existingLightbox.remove();
            
            document.body.insertAdjacentHTML('beforeend', lightboxHTML);
            const lightbox = new bootstrap.Modal(document.getElementById('imageLightbox'));
            lightbox.show();
            
            document.getElementById('imageLightbox').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        function submitFinalProject() {
            if (!selectedReference) {
                showToast('Primero selecciona una referencia', 'warning');
                return;
            }
            
            window.open('https://forms.gle/oa3g1cUkgrZqUBZ77', '_blank');
            showToast('Abriendo formulario...', 'info');
        }

        // ===== UTILIDADES UI =====
        function showToast(message, type = 'info') {
            const colors = { success: '#4CAF50', warning: '#FFC107', info: '#2196F3', danger: '#f44336' };
            const icons = { success: 'check-circle-fill', warning: 'exclamation-triangle-fill', info: 'info-circle-fill', danger: 'x-circle-fill' };
            
            const toast = document.createElement('div');
            toast.style.cssText = `position: fixed; top: 80px; right: 20px; background: ${colors[type]}; color: white; padding: 1rem 1.5rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 9999; animation: slideIn 0.3s; display: flex; align-items: center; gap: 0.75rem;`;
            toast.innerHTML = `<i class="bi bi-${icons[type]}" style="font-size: 1.25rem;"></i><span>${message}</span>`;
            
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ===== CONTENIDO DE LECCIONES =====
        const lessons = {
            lesson1: `
                <div class="lesson-header">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start mb-3">
                        <div class="flex-grow-1 mb-2 mb-md-0">
                            <h2 class="lesson-title">Lecci√≥n 3.1: S√≠ntesis por Capas</h2>
                            <p class="lesson-subtitle">Proceso de construcci√≥n en capas</p>
                        </div>
                        <span class="badge bg-warning text-dark lesson-duration">60 minutos</span>
                    </div>
                    
                    <div class="objectives-list">
                        <h6 class="mb-2"><i class="bi bi-bullseye me-2"></i>Objetivos</h6>
                        <ul class="mb-0">
                            <li>Integrar gesto + anatom√≠a en 1 figura completa</li>
                            <li>Aplicar proceso de refinamiento por capas</li>
                        </ul>
                    </div>
                </div>

                <div class="video-container">
    <iframe 
        src="https://www.youtube.com/embed/1ldiiFoEiek" 
        title="Proceso de s√≠ntesis por capas" 
        frameborder="0" 
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
        allowfullscreen
        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
    </iframe>
</div>

                <div class="accordion mb-4" id="accordionLesson1">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseL1_1" aria-expanded="true">
                                <i class="bi bi-layers me-2"></i>Capas 1 y 2: Estructura y Anatom√≠a
                            </button>
                        </h2>
                        <div id="collapseL1_1" class="accordion-collapse collapse show" data-bs-parent="#accordionLesson1">
                            <div class="accordion-body">
                                <h6 class="text-primary">CAPA 1 - GESTO (0-10 min):</h6>
                                <ol>
                                    <li>L√≠nea de acci√≥n visible</li>
                                    <li>Punto de apoyo marcado</li>
                                    <li>3 masas b√°sicas</li>
                                    <li>Ejes de hombros y caderas</li>
                                    <li>Extremidades direccionales</li>
                                </ol>
                                
                                <div class="alert alert-warning">
                                    <strong>NO incluir:</strong> Detalles musculares, rasgos faciales, dedos
                                </div>

                                <h6 class="text-primary mt-4">CAPA 2 - ANATOM√çA (10-30 min):</h6>
                                <ol>
                                    <li>Refinar las 3 masas tridimensionales</li>
                                    <li>Articulaciones principales</li>
                                    <li>6 grupos musculares esenciales</li>
                                    <li>Verificar proporciones</li>
                                    <li>Manos y pies simplificados</li>
                                </ol>

                                <div class="alert alert-info mt-3">
                                    <strong>Verificaci√≥n:</strong> Mide proporciones, verifica l√≠nea de acci√≥n, confirma peso
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseL1_2">
                                <i class="bi bi-pencil me-2"></i>Capas 3 y 4: Refinamiento
                            </button>
                        </h2>
                        <div id="collapseL1_2" class="accordion-collapse collapse" data-bs-parent="#accordionLesson1">
                            <div class="accordion-body">
                                <h6 class="text-primary">CAPA 3 - CONTORNO (30-60 min):</h6>
                                <ol>
                                    <li>Contorno continuo</li>
                                    <li>Detalles anat√≥micos</li>
                                    <li>Rasgos faciales</li>
                                    <li>Manos y pies completos</li>
                                    <li>Borrar construcci√≥n</li>
                                </ol>

                                <h6 class="text-primary mt-4">CAPA 4 - VOLUMEN (60-90 min):</h6>
                                <ol>
                                    <li>Fuente de luz</li>
                                    <li>Zonas luz/sombra</li>
                                    <li>Valores tonales</li>
                                    <li>Sombras proyectadas</li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseL1_3">
                                <i class="bi bi-exclamation-triangle me-2"></i>Errores Frecuentes
                            </button>
                        </h2>
                        <div id="collapseL1_3" class="accordion-collapse collapse" data-bs-parent="#accordionLesson1">
                            <div class="accordion-body">
                                <div class="mb-4">
                                    <h6 class="text-danger">ERROR 1: Comenzar con detalles</h6>
                                    <p class="text-success mb-0"><strong>Soluci√≥n:</strong> Fuerza el orden 1‚Üí2‚Üí3‚Üí4</p>
                                </div>

                                <div class="mb-4">
                                    <h6 class="text-danger">ERROR 2: Perder l√≠nea de acci√≥n</h6>
                                    <p class="text-success mb-0"><strong>Soluci√≥n:</strong> Revisa constantemente</p>
                                </div>

                                <div class="mb-0">
                                    <h6 class="text-danger">ERROR 3: Sobre-trabajar √°reas</h6>
                                    <p class="text-success mb-0"><strong>Soluci√≥n:</strong> Retrocede cada 10 min</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card">
                    <h5 class="mb-3">
                        <i class="bi bi-palette me-2"></i>EJERCICIO: 2 Figuras Completas
                    </h5>
                    <p><strong>Objetivo:</strong> 4 capas con documentaci√≥n fotogr√°fica</p>
                    
                    <div class="row mt-4">
                        <div class="col-md-6 mb-3">
                            <h6>Materiales:</h6>
                            <ul>
                                <li>2 hojas papel</li>
                                <li>L√°pices: HB, 2B, 4B</li>
                                <li>Goma de borrar</li>
                                <li>Smartphone</li>
                            </ul>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6>Referencias:</h6>
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="reference-image" style="height: 300px; position: relative;">
                                        <img src="images/ref21.jpg" 
                                             alt="Referencia 21" 
                                             onclick="openImageLightbox('images/ref21.jpg', 'Referencia 21')"
                                             title="Clic para ampliar"
                                             style="cursor: zoom-in; transition: transform 0.2s;">
                                        <span class="zoom-badge" style="position: absolute; bottom: 8px; right: 8px; 
                                                                         background: rgba(0,0,0,0.7); color: white; 
                                                                         padding: 4px 8px; border-radius: 4px; 
                                                                         font-size: 0.75rem;">
                                            <i class="bi bi-zoom-in me-1"></i>Ampliar
                                        </span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="reference-image" style="height: 300px; position: relative;">
                                        <img src="images/ref22.jpg" 
                                             alt="Referencia 22" 
                                             onclick="openImageLightbox('images/ref22.jpg', 'Referencia 22')"
                                             title="Clic para ampliar"
                                             style="cursor: zoom-in; transition: transform 0.2s;">
                                        <span class="zoom-badge" style="position: absolute; bottom: 8px; right: 8px; 
                                                                         background: rgba(0,0,0,0.7); color: white; 
                                                                         padding: 4px 8px; border-radius: 4px; 
                                                                         font-size: 0.75rem;">
                                            <i class="bi bi-zoom-in me-1"></i>Ampliar
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center mt-2">
                                <button class="btn btn-sm btn-outline-primary" onclick="showReferencesModal('lesson1')">
                                    <i class="bi bi-eye me-1"></i>Ver en Grande
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <h6>Primera figura (60 min):</h6>
                        <div class="checklist">
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>0-10 min: Capa 1 ‚Üí FOTOGRAFIAR</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>10-30 min: Capa 2 ‚Üí FOTOGRAFIAR</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>30-60 min: Capa 3 ‚Üí FOTOGRAFIAR</span>
                            </div>
                        </div>

                        <h6 class="mt-4">Segunda figura (90 min):</h6>
                        <div class="checklist">
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>0-10 min: Capa 1 ‚Üí FOTOGRAFIAR</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>10-30 min: Capa 2 ‚Üí FOTOGRAFIAR</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>30-60 min: Capa 3 ‚Üí FOTOGRAFIAR</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>60-90 min: Capa 4 ‚Üí FOTOGRAFIAR</span>
                            </div>
                        </div>

                        <p class="mt-3 mb-0"><strong>Total:</strong> 7 fotos + 2 dibujos</p>
                    </div>
                </div>

                <div class="evaluation-container">
                    <h4 class="mb-4"><i class="bi bi-clipboard-check me-2"></i>Evaluaci√≥n 3.1</h4>
                    
                    <div class="eval-progress">
                        <small class="text-muted">Respondidas: <strong><span id="answeredCount">0</span>/3</strong></small>
                    </div>
                    
                    <div class="eval-question" data-question="q1">
                        <h6>Pregunta 1:</h6>
                        <p>¬øQu√© incluir en Capa 1?</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 1)">
                                <div class="eval-radio"></div>
                                <span>A) Detalles musculares</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 1)">
                                <div class="eval-radio"></div>
                                <span>B) L√≠nea de acci√≥n, 3 masas, apoyo</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 1)">
                                <div class="eval-radio"></div>
                                <span>C) Sombreado</span>
                            </div>
                        </div>
                    </div>

                    <div class="eval-question" data-question="q2">
                        <h6>Pregunta 2:</h6>
                        <p>¬øEn qu√© capa se refinan contornos?</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 1)">
                                <div class="eval-radio"></div>
                                <span>A) Capa 1</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 1)">
                                <div class="eval-radio"></div>
                                <span>B) Capa 2</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 1)">
                                <div class="eval-radio"></div>
                                <span>C) Capa 3</span>
                            </div>
                        </div>
                    </div>

                    <div class="eval-question" data-question="q3">
                        <h6>Pregunta 3:</h6>
                        <p>¬øError m√°s frecuente?</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 1)">
                                <div class="eval-radio"></div>
                                <span>A) Comenzar con detalles</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 1)">
                                <div class="eval-radio"></div>
                                <span>B) Usar muchas capas</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 1)">
                                <div class="eval-radio"></div>
                                <span>C) Fotografiar proceso</span>
                            </div>
                        </div>
                    </div>

                    <div id="evalResult" class="mt-3"></div>

                    <div class="d-flex flex-column flex-md-row justify-content-center gap-3 mt-4">
                        <button class="btn btn-primary btn-nav" id="submitEvalBtn" onclick="submitEvaluation(1)">
                            <i class="bi bi-check-circle me-2"></i>Enviar
                        </button>
                        <button class="btn btn-warning btn-nav" id="retryEvalBtn" style="display: none;" onclick="retryEvaluation(1)">
                            <i class="bi bi-arrow-clockwise me-2"></i>Reintentar
                        </button>
                        <button class="btn btn-primary-custom btn-nav" id="nextLessonBtn" style="display: none;" onclick="goToNextLesson()">
                            Siguiente <i class="bi bi-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>
            `,

            lesson2: `
                <div class="lesson-header">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start mb-3">
                        <div class="flex-grow-1 mb-2 mb-md-0">
                            <h2 class="lesson-title">Lecci√≥n 3.2: Luz, Sombra y Volumen</h2>
                            <p class="lesson-subtitle">Crear profundidad con valores tonales</p>
                        </div>
                        <span class="badge bg-warning text-dark lesson-duration">60 minutos</span>
                    </div>
                    
                    <div class="objectives-list">
                        <h6 class="mb-2"><i class="bi bi-bullseye me-2"></i>Objetivos</h6>
                        <ul class="mb-0">
                            <li>Aplicar principios luz/sombra para volumen 3D</li>
                            <li>Crear 1 figura con valores tonales completos</li>
                        </ul>
                    </div>
                </div>

                <div class="accordion mb-4" id="accordionLesson2">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseL2_1" aria-expanded="true">
                                <i class="bi bi-brightness-high me-2"></i>Los 5 Valores Tonales
                            </button>
                        </h2>
                        <div id="collapseL2_1" class="accordion-collapse collapse show" data-bs-parent="#accordionLesson2">
                            <div class="accordion-body">
                                <p class="lead">5 valores b√°sicos:</p>
                                
                                <div class="mb-3">
                                    <h6 class="text-primary">1. LUZ DIRECTA:</h6>
                                    <ul>
                                        <li>Recibe luz directamente</li>
                                        <li>Punto m√°s brillante</li>
                                        <li>Blanco del papel</li>
                                    </ul>
                                </div>

                                <div class="mb-3">
                                    <h6 class="text-primary">2. LUZ REFLEJADA:</h6>
                                    <ul>
                                        <li>Rebota de superficies</li>
                                        <li>En zonas de sombra</li>
                                        <li>M√°s clara que sombra</li>
                                    </ul>
                                </div>

                                <div class="mb-3">
                                    <h6 class="text-primary">3. TONO MEDIO:</h6>
                                    <ul>
                                        <li>Sin luz directa ni sombra</li>
                                        <li>Mayor parte del cuerpo</li>
                                        <li>Gris medio</li>
                                    </ul>
                                </div>

                                <div class="mb-3">
                                    <h6 class="text-primary">4. SOMBRA PROPIA:</h6>
                                    <ul>
                                        <li>NO recibe luz</li>
                                        <li>Opuesta a fuente</li>
                                        <li>M√°s oscura que medio</li>
                                    </ul>
                                </div>

                                <div class="mb-3">
                                    <h6 class="text-primary">5. SOMBRA PROYECTADA:</h6>
                                    <ul>
                                        <li>Proyecta sobre otras superficies</li>
                                        <li>Zona m√°s oscura</li>
                                        <li>Define contacto con suelo</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2_2">
                                <i class="bi bi-lightbulb me-2"></i>Tipos de Iluminaci√≥n
                            </button>
                        </h2>
                        <div id="collapse2_2" class="accordion-collapse collapse" data-bs-parent="#accordionLesson2">
                            <div class="accordion-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <div class="card h-100">
                                            <div class="card-body">
                                                <h6 class="text-primary">LUZ FRONTAL:</h6>
                                                <ul class="text-sm mb-0">
                                                    <li>Frente al modelo</li>
                                                    <li>Menos sombras</li>
                                                    <li>Menos volumen</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <div class="card h-100">
                                            <div class="card-body">
                                                <h6 class="text-primary">LUZ LATERAL:</h6>
                                                <ul class="text-sm mb-0">
                                                    <li>A un lado</li>
                                                    <li>M√°ximo contraste</li>
                                                    <li>Mejor volumen</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <div class="card h-100">
                                            <div class="card-body">
                                                <h6 class="text-primary">LUZ POSTERIOR:</h6>
                                                <ul class="text-sm mb-0">
                                                    <li>Detr√°s del modelo</li>
                                                    <li>Silueta definida</li>
                                                    <li>Detalles en sombra</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <div class="card h-100">
                                            <div class="card-body">
                                                <h6 class="text-primary">LUZ CENITAL:</h6>
                                                <ul class="text-sm mb-0">
                                                    <li>Arriba del modelo</li>
                                                    <li>Sombras en rostro</li>
                                                    <li>Com√∫n en natural</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="alert alert-success mt-3 mb-0">
                                    <i class="bi bi-star me-2"></i>
                                    <strong>Regla:</strong> Una sola fuente dominante = sombras consistentes
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2_3">
                                <i class="bi bi-person me-2"></i>Aplicaci√≥n en Cuerpo
                            </button>
                        </h2>
                        <div id="collapse2_3" class="accordion-collapse collapse" data-bs-parent="#accordionLesson2">
                            <div class="accordion-body">
                                <h6 class="text-primary">PROCESO:</h6>
                                
                                <div class="mb-3">
                                    <strong>1. Identificar fuente luz</strong>
                                </div>

                                <div class="mb-3">
                                    <strong>2. Dividir zonas luz/sombra</strong>
                                </div>

                                <div class="mb-3">
                                    <strong>3. Aplicar valores progresivamente</strong>
                                </div>

                                <div class="mb-0">
                                    <strong>4. Unificar y suavizar</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card">
                    <h5 class="mb-3">
                        <i class="bi bi-palette me-2"></i>EJERCICIO: 1 Figura con Valores
                    </h5>
                    <p><strong>Objetivo:</strong> Aplicar 5 valores tonales</p>
                    
                    <div class="row mt-4">
                        <div class="col-md-6 mb-3">
                            <h6>Materiales:</h6>
                            <ul>
                                <li>1 hoja</li>
                                <li>L√°pices: HB, 2B, 4B, 6B</li>
                                <li>Goma</li>
                                <li>Difumino (opcional)</li>
                            </ul>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6>Referencia:</h6>
                            <div class="reference-image" style="height: 400px; position: relative;">
                                <img src="images/ref23_iluminacion_lateral.jpg" 
                                     alt="Referencia 23" 
                                     onclick="openImageLightbox('images/ref23_iluminacion_lateral.jpg', 'Referencia 23 - Iluminaci√≥n lateral')"
                                     title="Clic para ampliar"
                                     style="cursor: zoom-in; transition: transform 0.2s;">
                                <span class="zoom-badge" style="position: absolute; bottom: 8px; right: 8px; 
                                                                 background: rgba(0,0,0,0.7); color: white; 
                                                                 padding: 4px 8px; border-radius: 4px; 
                                                                 font-size: 0.75rem;">
                                    <i class="bi bi-zoom-in me-1"></i>Ampliar
                                </span>
                            </div>
                            <div class="text-center mt-2">
                                <button class="btn btn-sm btn-outline-primary" onclick="showReferencesModal('lesson2')">
                                    <i class="bi bi-eye me-1"></i>Ver en Grande
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <h6>Proceso (90 min):</h6>
                        <div class="checklist">
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>0-30 min: Capas 1 y 2</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>30-40 min: Zonas luz/sombra</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>40-90 min: Aplicar valores</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="evaluation-container">
                    <h4 class="mb-4"><i class="bi bi-clipboard-check me-2"></i>Evaluaci√≥n 3.2</h4>
                    
                    <div class="eval-progress">
                        <small class="text-muted">Respondidas: <strong><span id="answeredCount">0</span>/3</strong></small>
                    </div>
                    
                    <div class="eval-question" data-question="q1">
                        <h6>Pregunta 1:</h6>
                        <p>¬øCu√°ntos valores tonales b√°sicos?</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 2)">
                                <div class="eval-radio"></div>
                                <span>A) 3 valores</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 2)">
                                <div class="eval-radio"></div>
                                <span>B) 5 valores</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 2)">
                                <div class="eval-radio"></div>
                                <span>C) 7 valores</span>
                            </div>
                        </div>
                    </div>

                    <div class="eval-question" data-question="q2">
                        <h6>Pregunta 2:</h6>
                        <p>¬øZona m√°s oscura?</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 2)">
                                <div class="eval-radio"></div>
                                <span>A) Sombra propia</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 2)">
                                <div class="eval-radio"></div>
                                <span>B) Tono medio</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 2)">
                                <div class="eval-radio"></div>
                                <span>C) Sombra proyectada</span>
                            </div>
                        </div>
                    </div>

                    <div class="eval-question" data-question="q3">
                        <h6>Pregunta 3:</h6>
                        <p>¬øMayor contraste?</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 2)">
                                <div class="eval-radio"></div>
                                <span>A) Luz frontal</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 2)">
                                <div class="eval-radio"></div>
                                <span>B) Luz lateral</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 2)">
                                <div class="eval-radio"></div>
                                <span>C) Luz difusa</span>
                            </div>
                        </div>
                    </div>

                    <div id="evalResult" class="mt-3"></div>

                    <div class="d-flex flex-column flex-md-row justify-content-center gap-3 mt-4">
                        <button class="btn btn-primary btn-nav" id="submitEvalBtn" onclick="submitEvaluation(2)">
                            <i class="bi bi-check-circle me-2"></i>Enviar
                        </button>
                        <button class="btn btn-warning btn-nav" id="retryEvalBtn" style="display: none;" onclick="retryEvaluation(2)">
                            <i class="bi bi-arrow-clockwise me-2"></i>Reintentar
                        </button>
                        <button class="btn btn-primary-custom btn-nav" id="nextLessonBtn" style="display: none;" onclick="goToNextLesson()">
                            Siguiente <i class="bi bi-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>
            `,

            lesson3: `
                <div class="lesson-header">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start mb-3">
                        <div class="flex-grow-1 mb-2 mb-md-0">
                            <h2 class="lesson-title">Lecci√≥n 3.3: Proyecto Final</h2>
                            <p class="lesson-subtitle">Dibujo Completo - Integraci√≥n Total</p>
                        </div>
                        <span class="badge bg-danger text-white lesson-duration">2-3 horas</span>
                    </div>
                    
                    <div class="objectives-list">
                        <h6 class="mb-2"><i class="bi bi-bullseye me-2"></i>Objetivos</h6>
                        <ul class="mb-0">
                            <li>Crear representaci√≥n integrando todo el curso</li>
                            <li>Demostrar dominio t√©cnico 1/4 mercurio</li>
                        </ul>
                    </div>
                </div>

                <div class="final-message">
                    <h3 class="mb-3"><i class="bi bi-trophy me-2"></i>¬°Tu obra maestra!</h3>
                    <p class="lead mb-4">M√°s de 20 dibujos completados</p>
                    <div class="row text-start">
                        <div class="col-md-4 mb-3">
                            <h5><i class="bi bi-check-circle-fill me-2"></i>M√≥dulo 1</h5>
                            <p class="mb-0 text-sm">8 croquis gesto</p>
                        </div>
                        <div class="col-md-4 mb-3">
                            <h5><i class="bi bi-check-circle-fill me-2"></i>M√≥dulo 2</h5>
                            <p class="mb-0 text-sm">12 estudios anat√≥micos</p>
                        </div>
                        <div class="col-md-4 mb-3">
                            <h5><i class="bi bi-check-circle-fill me-2"></i>M√≥dulo 3</h5>
                            <p class="mb-0 text-sm">3 figuras integradas</p>
                        </div>
                    </div>
                </div>

                <div class="alert alert-info alert-custom">
                    <i class="bi bi-info-circle-fill me-2"></i>
                    <strong>Importante:</strong> Conf√≠a en el proceso por capas
                </div>

                <div class="card mb-4">
                    <div class="card-header" style="background: var(--primary-dark); color: white;">
                        <h5 class="mb-0"><i class="bi bi-clipboard-data me-2"></i>Requisitos</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary">Especificaciones:</h6>
                                <ul class="text-sm">
                                    <li>1/4 mercurio (27.5 x 37.5 cm)</li>
                                    <li>L√°piz grafito</li>
                                    <li>2-3 horas</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-primary">Debe demostrar:</h6>
                                <ul class="text-sm">
                                    <li>L√≠nea de acci√≥n clara</li>
                                    <li>Proporciones correctas</li>
                                    <li>Estructura anat√≥mica</li>
                                    <li>Grupos musculares</li>
                                    <li>Manos y pies estructurados</li>
                                    <li>Valores tonales (m√≠n 3)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header" style="background: var(--primary-light); color: white;">
                        <h5 class="mb-0"><i class="bi bi-images me-2"></i>Selecci√≥n Referencia</h5>
                    </div>
                    <div class="card-body">
                        <p class="mb-3">Elige <strong>UNA</strong> referencia:</p>
                        
                        <div class="reference-grid">
                            <div class="reference-card ${selectedReference === 24 ? 'selected' : ''}" data-ref="24" onclick="selectReference(24)">
                                ${selectedReference === 24 ? '<div class="selection-badge"><span class="badge bg-success"><i class="bi bi-check-lg"></i> Seleccionada</span></div>' : ''}
                                <div class="reference-image" style="height: 375px;">
                                    <img src="images/ref24_pose_heroica.jpg" alt="Pose heroica">
                                </div>
                                <h6 class="mt-3 mb-1">Referencia 24</h6>
                            </div>

                            <div class="reference-card ${selectedReference === 25 ? 'selected' : ''}" data-ref="25" onclick="selectReference(25)">
                                ${selectedReference === 25 ? '<div class="selection-badge"><span class="badge bg-success"><i class="bi bi-check-lg"></i> Seleccionada</span></div>' : ''}
                                <div class="reference-image" style="height: 375px;">
                                    <img src="images/ref25_pose_cotidiana.jpg" alt="Pose cotidiana">
                                </div>
                                <h6 class="mt-3 mb-1">Referencia 25</h6>
                            </div>

                            <div class="reference-card ${selectedReference === 26 ? 'selected' : ''}" data-ref="26" onclick="selectReference(26)">
                                ${selectedReference === 26 ? '<div class="selection-badge"><span class="badge bg-success"><i class="bi bi-check-lg"></i> Seleccionada</span></div>' : ''}
                                <div class="reference-image" style="height: 375px;">
                                    <img src="images/ref26_pose_artistica.jpg" alt="Pose art√≠stica">
                                </div>
                                <h6 class="mt-3 mb-1">Referencia 26</h6>
                            </div>
                        </div>

                        <div class="text-center mt-3">
                            <button class="btn btn-outline-primary" onclick="showReferences()">
                                <i class="bi bi-eye me-2"></i>Ver en Grande
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
    <div class="card-header" style="background: var(--primary-dark); color: white;">
        <h5 class="mb-0"><i class="bi bi-star me-2"></i>R√∫brica Anal√≠tica - Proyecto Final</h5>
    </div>
    <div class="card-body">
        <div class="alert alert-info">
            <strong><i class="bi bi-info-circle me-2"></i>Informaci√≥n de Evaluaci√≥n</strong>
            <ul class="mb-0 mt-2 small">
                <li><strong>Formato:</strong> 1/4 mercurio (27.5 √ó 37.5 cm)</li>
                <li><strong>T√©cnica:</strong> L√°piz grafito</li>
                <li><strong>Tiempo:</strong> 2-3 horas presenciales</li>
                <li><strong>Modalidad:</strong> Presencial con supervisi√≥n docente</li>
                <li><strong>Puntaje total:</strong> 28 puntos</li>
                <li><strong>Puntaje m√≠nimo aprobatorio:</strong> 17 puntos (60%)</li>
            </ul>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered rubric-table mb-0">
                <thead class="table-light">
                    <tr>
                        <th style="width: 150px;">Criterio</th>
                        <th>Excelente (4)</th>
                        <th>Bueno (3)</th>
                        <th>Satisfactorio (2)</th>
                        <th>Insuficiente (1)</th>
                        <th style="width: 100px;">Puntaje</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>1. Gesto y L√≠nea de Acci√≥n</strong><br><small class="text-muted">Captura de movimiento y energ√≠a</small></td>
                        <td class="small"><strong>Captura excepcional del gesto:</strong> La l√≠nea de acci√≥n es claramente visible atravesando la figura y transmite con contundencia la direcci√≥n y energ√≠a del movimiento. El punto de apoyo est√° inequ√≠vocamente identificado, generando sensaci√≥n de estabilidad o dinamismo seg√∫n la pose. La figura tiene presencia visual fuerte y comunica intenci√≥n corporal clara. El dibujo "respira" y tiene vida.</td>
                        <td class="small"><strong>Captura competente del gesto:</strong> La l√≠nea de acci√≥n es visible y comunica efectivamente la direcci√≥n del movimiento. El punto de apoyo es reconocible y la figura mantiene balance corporal apropiado. La pose transmite intenci√≥n aunque puede carecer de algunos matices expresivos. La energ√≠a del movimiento es evidente.</td>
                        <td class="small"><strong>Captura b√°sica del gesto:</strong> La l√≠nea de acci√≥n es reconocible pero d√©bil o fragmentada. La direcci√≥n del movimiento se intuye pero carece de fuerza visual. El punto de apoyo es identificable con incertidumbre. La figura cumple funci√≥n representativa b√°sica pero carece de presencia o dinamismo convincente.</td>
                        <td class="small"><strong>Captura deficiente del gesto:</strong> La l√≠nea de acci√≥n es imperceptible, ausente o contradictoria con el movimiento representado. No hay claridad sobre el punto de apoyo. La figura aparece r√≠gida, inestable o sin intenci√≥n corporal clara. No comunica energ√≠a ni direcci√≥n del movimiento.</td>
                        <td class="text-center"><strong>4</strong></td>
                    </tr>
                    <tr>
                        <td><strong>2. Proporciones y Relaciones Visuales</strong><br><small class="text-muted">Observaci√≥n y consistencia interna</small></td>
                        <td class="small"><strong>Observaci√≥n excepcional:</strong> Demuestra capacidad sobresaliente de observaci√≥n visual. Las relaciones proporcionales entre todas las partes del cuerpo son coherentes y cre√≠bles. La cabeza, torso, extremidades y articulaciones mantienen relaciones visuales arm√≥nicas entre s√≠. El cuerpo representado es anat√≥micamente convincente y fiel a la observaci√≥n del modelo. No hay distorsiones que comprometan la lectura natural de la figura humana.</td>
                        <td class="small"><strong>Observaci√≥n competente:</strong> Demuestra buena capacidad de observaci√≥n. Las relaciones proporcionales son en general correctas y cre√≠bles. Las partes del cuerpo se relacionan apropiadamente entre s√≠ con m√≠nimas imprecisiones que no afectan la lectura anat√≥mica general. La figura es reconocible y convincente como representaci√≥n del cuerpo humano observado.</td>
                        <td class="small"><strong>Observaci√≥n b√°sica:</strong> Demuestra capacidad elemental de observaci√≥n. Las relaciones proporcionales presentan errores evidentes pero la figura es reconocible como cuerpo humano. Algunas partes est√°n desproporcionadas respecto a otras, afectando parcialmente la coherencia visual, pero sin comprometer gravemente la representaci√≥n general.</td>
                        <td class="small"><strong>Observaci√≥n deficiente:</strong> Errores significativos en las relaciones proporcionales que distorsionan gravemente la figura. Las partes del cuerpo no se relacionan coherentemente entre s√≠. La cabeza, torso o extremidades presentan desproporciones que comprometen la credibilidad anat√≥mica. Pobre capacidad de observaci√≥n visual del modelo.</td>
                        <td class="text-center"><strong>4</strong></td>
                    </tr>
                    <tr>
                        <td><strong>3. Estructura Anat√≥mica</strong><br><small class="text-muted">Comprensi√≥n de masas y articulaciones</small></td>
                        <td class="small"><strong>Comprensi√≥n estructural excepcional:</strong> Las tres masas corporales principales (cabeza, tronco, pelvis) est√°n claramente diferenciadas como vol√∫menes tridimensionales s√≥lidos. Las articulaciones principales est√°n correctamente ubicadas y funcionan como bisagras cre√≠bles del cuerpo. Se evidencia comprensi√≥n profunda de c√≥mo la estructura √≥sea subyacente determina la forma externa. Los grupos musculares superficiales modifican convincentemente el contorno corporal.</td>
                        <td class="small"><strong>Comprensi√≥n estructural competente:</strong> Las masas corporales son reconocibles como vol√∫menes diferenciados. Las articulaciones est√°n correctamente ubicadas en su mayor√≠a. Se evidencia buena comprensi√≥n de la relaci√≥n entre estructura interna y forma externa. Los grupos musculares principales son identificables y contribuyen apropiadamente a la volumetr√≠a.</td>
                        <td class="small"><strong>Comprensi√≥n estructural b√°sica:</strong> Las masas corporales son reconocibles aunque poco diferenciadas volum√©tricamente. Las articulaciones b√°sicas est√°n presentes con algunos errores de ubicaci√≥n. Se evidencia comprensi√≥n elemental de estructura anat√≥mica que cumple con requisitos m√≠nimos. Algunos grupos musculares son identificables.</td>
                        <td class="small"><strong>Comprensi√≥n estructural deficiente:</strong> Las masas corporales est√°n confundidas o no diferenciadas. Las articulaciones est√°n incorrectamente ubicadas o ausentes. No se evidencia comprensi√≥n de la estructura anat√≥mica subyacente. El cuerpo aparece plano o sin l√≥gica volum√©trica interna.</td>
                        <td class="text-center"><strong>4</strong></td>
                    </tr>
                    <tr>
                        <td><strong>4. Extremidades</strong><br><small class="text-muted">Manos y pies estructurados</small></td>
                        <td class="small"><strong>Extremidades excepcionales:</strong> Las manos presentan estructura volum√©trica clara con palma diferenciada y dedos articulados. Los pies muestran estructura tridimensional con tal√≥n, arco y dedos reconocibles. Las extremidades tienen presencia volum√©trica convincente y no aparecen simplificadas como formas gen√©ricas. Las proporciones de manos y pies son apropiadas respecto al cuerpo. Los gestos son naturales y cre√≠bles.</td>
                        <td class="small"><strong>Extremidades competentes:</strong> Las manos presentan estructura reconocible con volumen b√°sico y dedos diferenciados. Los pies muestran estructura elemental con componentes principales identificables. Las extremidades tienen volumen suficiente para evitar apariencia plana. Las proporciones son aceptables. Los gestos son apropiados aunque pueden carecer de refinamiento.</td>
                        <td class="small"><strong>Extremidades b√°sicas:</strong> Las manos presentan estructura simplificada pero evitan ser "mitones" sin dedos. Los pies presentan estructura elemental que evita ser "bloques" sin articulaci√≥n. Las extremidades cumplen con estructura m√≠nima reconocible aunque con limitaciones evidentes. Las proporciones son funcionales con imprecisiones tolerables.</td>
                        <td class="small"><strong>Extremidades deficientes:</strong> Las manos est√°n excesivamente simplificadas como "mitones" sin estructura de dedos. Los pies est√°n simplificados como "bloques" sin componentes diferenciados. Las extremidades carecen de estructura volum√©trica convincente. Las proporciones son muy incorrectas respecto al cuerpo representado.</td>
                        <td class="text-center"><strong>4</strong></td>
                    </tr>
                    <tr>
                        <td><strong>5. Valores Tonales y Volumetr√≠a</strong><br><small class="text-muted">Luz, sombra y volumen</small></td>
                        <td class="small"><strong>Volumetr√≠a excepcional:</strong> Representa convincentemente al menos tres valores tonales claramente diferenciados que crean sensaci√≥n de volumen tridimensional s√≥lido. La fuente de luz es identificable y consistente en toda la figura. Las zonas de luz, medias luces y sombras est√°n apropiadamente distribuidas seg√∫n la iluminaci√≥n. Incluye sombra proyectada que define contacto con el suelo. Las transiciones tonales son suaves y naturales. El cuerpo "sale del papel".</td>
                        <td class="small"><strong>Volumetr√≠a competente:</strong> Representa tres valores tonales diferenciados que generan volumen efectivo. La fuente de luz es clara y mayormente consistente. Las zonas lum√≠nicas est√°n apropiadamente ubicadas. La sombra proyectada est√° presente. Las transiciones son apropiadas. El volumen tridimensional es evidente en la mayor√≠a de las √°reas del cuerpo.</td>
                        <td class="small"><strong>Volumetr√≠a b√°sica:</strong> Representa al menos tres valores diferenciados que cumplen funci√≥n volum√©trica b√°sica. La fuente de luz es identificable con algunas inconsistencias. La sombra proyectada est√° presente aunque d√©bil. Las transiciones son funcionales aunque pueden ser abruptas. El volumen es reconocible pero puede resultar limitado en algunas √°reas.</td>
                        <td class="small"><strong>Volumetr√≠a deficiente:</strong> Menos de tres valores diferenciados o valores planos sin gradaci√≥n. La fuente de luz es incoherente o no identificable. La sombra proyectada est√° ausente o muy incorrecta. Las transiciones son bruscas o inexistentes. El dibujo carece de volumetr√≠a convincente y aparece plano.</td>
                        <td class="text-center"><strong>4</strong></td>
                    </tr>
                    <tr>
                        <td><strong>6. Composici√≥n y Limpieza T√©cnica</strong><br><small class="text-muted">Ubicaci√≥n y calidad de ejecuci√≥n</small></td>
                        <td class="small"><strong>Presentaci√≥n excepcional:</strong> La figura est√° ubicada con excelente criterio compositivo dentro del formato, aprovechando apropiadamente el espacio y generando balance visual arm√≥nico. No est√° cortada ni flotando sin contacto con el suelo. Las l√≠neas son decididas, controladas y limpias. Se permiten l√≠neas de construcci√≥n sutiles que evidencian proceso, pero sin exceso de borrado o suciedad. La presentaci√≥n demuestra planificaci√≥n, control t√©cnico y cuidado.</td>
                        <td class="small"><strong>Presentaci√≥n competente:</strong> La figura est√° bien ubicada dentro del formato con apropiado uso del espacio y balance visual. El contacto con el suelo es claro. Las l√≠neas son mayormente limpias y controladas con algunas correcciones visibles. Las l√≠neas de construcci√≥n est√°n presentes sin ser excesivas. La presentaci√≥n es clara y demuestra cuidado apropiado.</td>
                        <td class="small"><strong>Presentaci√≥n b√°sica:</strong> La figura est√° ubicada aceptablemente aunque puede estar ligeramente descentrada o con uso desigual del espacio. El contacto con suelo es reconocible. Las l√≠neas presentan correcciones evidentes pero controladas. Hay exceso moderado de borrado. La presentaci√≥n cumple con est√°ndar m√≠nimo funcional.</td>
                        <td class="small"><strong>Presentaci√≥n deficiente:</strong> La figura est√° mal ubicada (cortada significativamente, flotando, muy descentrada, uso muy pobre del espacio). Las l√≠neas son temblorosas, sucias o con borrado excesivo. Presenta manchas, arrugas o descuido evidente. La presentaci√≥n no cumple con est√°ndar profesional b√°sico.</td>
                        <td class="text-center"><strong>4</strong></td>
                    </tr>
                    <tr>
                        <td><strong>7. S√≠ntesis y Coherencia del Proceso</strong><br><small class="text-muted">Integraci√≥n de aprendizajes</small></td>
                        <td class="small"><strong>S√≠ntesis excepcional:</strong> El dibujo demuestra integraci√≥n sobresaliente de todos los aprendizajes del curso: observaci√≥n gestual (M√≥dulo 1), comprensi√≥n anat√≥mica (M√≥dulo 2) y capacidad de s√≠ntesis volum√©trica (M√≥dulo 3). Se evidencia claramente el proceso constructivo por capas sin perder la estructura inicial. La l√≠nea de acci√≥n permanece respetada hasta el refinamiento final. Demuestra madurez en la capacidad de sintetizar conocimientos y aplicarlos coherentemente.</td>
                        <td class="small"><strong>S√≠ntesis competente:</strong> El dibujo integra efectivamente los aprendizajes del curso. Se reconoce el proceso constructivo por capas en la mayor√≠a de las √°reas. La estructura inicial se mantiene en el refinamiento final. Demuestra buena capacidad de s√≠ntesis con aplicaci√≥n coherente de conocimientos, aunque puede carecer de algunos refinamientos.</td>
                        <td class="small"><strong>S√≠ntesis b√°sica:</strong> El dibujo integra parcialmente los aprendizajes del curso. Se reconoce parcialmente el proceso por capas aunque puede haberse perdido en algunas √°reas. La estructura inicial es identificable pero puede haberse comprometido en el refinamiento. Demuestra comprensi√≥n elemental con capacidad de s√≠ntesis limitada.</td>
                        <td class="small"><strong>S√≠ntesis deficiente:</strong> El dibujo no demuestra integraci√≥n de aprendizajes del curso. No hay evidencia del proceso constructivo por capas. La estructura inicial (si existi√≥) se perdi√≥ completamente. No demuestra capacidad de s√≠ntesis ni aplicaci√≥n coherente de conocimientos del curso.</td>
                        <td class="text-center"><strong>4</strong></td>
                    </tr>
                    <tr class="table-primary">
                        <td colspan="5" class="text-end"><strong>TOTAL:</strong></td>
                        <td class="text-center"><strong>28</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="alert alert-success mt-4 mb-3">
            <h6 class="mb-2"><strong><i class="bi bi-award me-2"></i>Sistema de Calificaci√≥n:</strong></h6>
            <ul class="mb-0 small">
                <li><strong>25-28 puntos: EXCELENTE</strong> - Dominio sobresaliente con calidad profesional</li>
                <li><strong>21-24 puntos: BUENO</strong> - Dominio competente con resultados convincentes</li>
                <li><strong>17-20 puntos: SUFICIENTE (M√≠nimo Aprobatorio)</strong> - Dominio b√°sico, requiere plan de mejora</li>
                <li><strong>Menos de 17 puntos: INSUFICIENTE</strong> - Requiere rehacer proyecto (10 d√≠as con plan de recuperaci√≥n)</li>
            </ul>
        </div>

        <div class="alert alert-warning">
            <h6 class="mb-2"><strong><i class="bi bi-exclamation-triangle me-2"></i>Prohibiciones Estrictas:</strong></h6>
            <ul class="mb-0 small">
                <li>‚ùå NO usar filtros digitales o tracing</li>
                <li>‚ùå NO copiar proyectos de otros estudiantes</li>
                <li>‚ùå NO usar cuadr√≠cula de transferencia mec√°nica</li>
                <li>‚ùå NO agregar color (solo grafito permitido)</li>
            </ul>
        </div>

        <div class="alert alert-info mb-0">
            <h6 class="mb-2"><strong><i class="bi bi-clipboard-check me-2"></i>Observaciones Generales:</strong></h6>
            <ul class="mb-0 small">
                <li>Se valorar√° la evidencia del proceso constructivo por capas (trazos iniciales visibles)</li>
                <li>Se considerar√° la progresi√≥n t√©cnica demostrada respecto a ejercicios previos del curso</li>
                <li>El dibujo debe estar firmado y fechado</li>
                <li><strong>Modalidad presencial:</strong> El proyecto se ejecuta en clase bajo supervisi√≥n docente con tiempo cronometrado</li>
            </ul>
        </div>
    </div>
</div>

                <div class="final-message">
                    <h4 class="mb-3">¬°Momento de Crear!</h4>
                    <p class="mb-4">Respira profundo y comienza</p>
                    
                    <div class="d-flex flex-column flex-md-row justify-content-center gap-3">
                        <button class="btn btn-light btn-lg" onclick="showReferences()">
                            <i class="bi bi-images me-2"></i>Ver Referencias
                        </button>
                        <button class="btn btn-success btn-lg" onclick="submitFinalProject()">
                            <i class="bi bi-cloud-upload me-2"></i>Subir Proyecto
                        </button>
                    </div>
                </div>

                <div class="evaluation-container mt-5">
                    <h4 class="mb-4"><i class="bi bi-clipboard-check me-2"></i>Evaluaci√≥n Final</h4>
                    
                    <div class="eval-progress">
                        <small class="text-muted">Respondidas: <strong><span id="answeredCount">0</span>/3</strong></small>
                    </div>
                    
                    <div class="eval-question" data-question="q1">
                        <h6>Pregunta 1:</h6>
                        <p>¬øCu√°l es el puntaje m√≠nimo aprobatorio del Proyecto Final?</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 3)">
                                <div class="eval-radio"></div>
                                <span>A) 14 puntos (50%)</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 3)">
                                <div class="eval-radio"></div>
                                <span>B) 17 puntos (60%)</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 3)">
                                <div class="eval-radio"></div>
                                <span>C) 21 puntos (75%)</span>
                            </div>
                        </div>
                    </div>

                    <div class="eval-question" data-question="q2">
                        <h6>Pregunta 2:</h6>
                        <p>¬øCu√°ntos criterios diferentes eval√∫a la r√∫brica del Proyecto Final?</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 3)">
                                <div class="eval-radio"></div>
                                <span>A) 4 criterios</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 3)">
                                <div class="eval-radio"></div>
                                <span>B) 5 criterios</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 3)">
                                <div class="eval-radio"></div>
                                <span>C) 7 criterios</span>
                            </div>
                        </div>
                    </div>

                    <div class="eval-question" data-question="q3">
                        <h6>Pregunta 3:</h6>
                        <p>¬øQu√© NO est√° permitido?</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 3)">
                                <div class="eval-radio"></div>
                                <span>A) Revisar m√≥dulos</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 3)">
                                <div class="eval-radio"></div>
                                <span>B) Usar filtros digitales o tracing</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 3)">
                                <div class="eval-radio"></div>
                                <span>C) Ver ejercicios anteriores</span>
                            </div>
                        </div>
                    </div>

                    <div id="evalResult" class="mt-3"></div>

                    <div class="d-flex flex-column flex-md-row justify-content-center gap-3 mt-4">
                        <button class="btn btn-primary btn-nav" id="submitEvalBtn" onclick="submitEvaluation(3)">
                            <i class="bi bi-check-circle me-2"></i>Enviar
                        </button>
                        <button class="btn btn-warning btn-nav" id="retryEvalBtn" style="display: none;" onclick="retryEvaluation(3)">
                            <i class="bi bi-arrow-clockwise me-2"></i>Reintentar
                        </button>
                        <button class="btn btn-success btn-nav" id="nextLessonBtn" style="display: none;" onclick="window.location.href='index.html'">
                            <i class="bi bi-house-door me-2"></i>Completar M√≥dulo
                        </button>
                    </div>
                </div>

                <div class="alert alert-success alert-custom mt-4">
                    <h5><i class="bi bi-trophy-fill me-2"></i>¬°Felicitaciones!</h5>
                    <p class="mb-0">Has llegado al final del curso. Una vez completes tu proyecto final, habr√°s demostrado tu dominio en representaci√≥n del cuerpo humano.</p>
                </div>
            `
        };

        // ===== EVENT LISTENERS =====
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeModule);
        } else {
            initializeModule();
        }

        window.addEventListener('beforeunload', function() {
            saveProgress();
        });

        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden') {
                saveProgress();
            }
        });

        console.log('%cüé® M√ìDULO 3 CARGADO', 'color: #2c5f66; font-size: 16px; font-weight: bold;');
        console.log('%cM√≥dulo 3 v4.2 - Sistema completo', 'color: #e8a2b8;');

        // ===== HACER CLICABLES LAS IM√ÅGENES PEQUE√ëAS =====
        document.addEventListener('click', function(e) {
            if (e.target.matches('.reference-image img')) {
                const imgSrc = e.target.getAttribute('src');
                const imgAlt = e.target.getAttribute('alt') || 'Referencia';
                openImageLightbox(imgSrc, imgAlt);
            }
        });
    </script>

    <!-- ============================================
         MENTOR ANAT√ìMICO - BOT√ìN FLOTANTE Y CHAT
         ============================================ -->
    <button class="mentor-float-button" id="mentorFloatBtn" aria-label="Abrir Mentor Virtual">
        <i class="bi bi-chat-dots-fill"></i>
        <span class="mentor-badge">!</span>
    </button>

    <div class="mentor-chat-container" id="mentorChatContainer">
        <div class="mentor-chat-header">
            <div class="mentor-chat-header-info">
                <div class="mentor-avatar">
                    üé®
                </div>
                <div class="mentor-status">
                    <div class="mentor-name">Mentor Anat√≥mico</div>
                    <div class="mentor-online">
                        <span class="status-dot"></span>
                        En l√≠nea
                    </div>
                </div>
            </div>
            <button class="mentor-close-btn" id="mentorCloseBtn" aria-label="Cerrar chat">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>

        <div class="mentor-chat-messages" id="mentorMessages">
            <!-- Los mensajes se agregan din√°micamente aqu√≠ -->
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <span class="typing-dot"></span>
            <span class="typing-dot"></span>
            <span class="typing-dot"></span>
        </div>

        <div class="mentor-chat-input-container">
            <textarea 
                class="mentor-chat-input" 
                id="mentorInput" 
                placeholder="Escribe tu pregunta o duda..."
                rows="1"
            ></textarea>
            <button class="mentor-send-btn" id="mentorSendBtn" aria-label="Enviar mensaje">
                <i class="bi bi-send-fill"></i>
            </button>
        </div>
    </div>

    <!-- IMPORTAR BASE DE CONOCIMIENTO DEL MENTOR -->
    <script src="mentor-knowledge.js"></script>

    <script>
        // ============================================
        // SISTEMA DE MENTOR INTEGRADO
        // ============================================
        
        // Inicializar memoria conversacional
        const conversationMemory = new window.mentorKnowledge.ConversationMemory();
        
        // Elementos del DOM
        const mentorFloatBtn = document.getElementById('mentorFloatBtn');
        const mentorCloseBtn = document.getElementById('mentorCloseBtn');
        const mentorChatContainer = document.getElementById('mentorChatContainer');
        const mentorMessages = document.getElementById('mentorMessages');
        const mentorInput = document.getElementById('mentorInput');
        const mentorSendBtn = document.getElementById('mentorSendBtn');
        const typingIndicator = document.getElementById('typingIndicator');

        // ===== DEBUG: Verificar elementos =====
        console.log('üîç DEBUG M√ìDULO:');
        console.log('1. ¬øExiste mentorFloatBtn?', mentorFloatBtn !== null);
        console.log('2. ¬øExiste mentorChatContainer?', mentorChatContainer !== null);
        console.log('3. ¬øExiste window.mentorKnowledge?', typeof window.mentorKnowledge !== 'undefined');
        
        if (!mentorFloatBtn) {
            console.error('‚ùå ERROR: No se encontr√≥ el bot√≥n flotante #mentorFloatBtn');
        }
        if (!mentorChatContainer) {
            console.error('‚ùå ERROR: No se encontr√≥ el contenedor #mentorChatContainer');
        }
        if (typeof window.mentorKnowledge === 'undefined') {
            console.error('‚ùå ERROR: window.mentorKnowledge no est√° definido');
            console.error('   Verifica que mentor-knowledge.js est√© en la misma carpeta');
        } else {
            console.log('‚úÖ Mentor cargado correctamente');
        }
        console.log('================================');



        // Toggle chat
        mentorFloatBtn.addEventListener('click', function() {
            mentorChatContainer.classList.add('show');
            mentorFloatBtn.style.display = 'none';
            
            // Mensaje de bienvenida contextual
            if (mentorMessages.children.length === 0) {
                const greeting = conversationMemory.getContextualGreeting();
                if (greeting) {
                    addMentorMessage(greeting);
                } else {
                    addMentorMessage(
                        "¬°Hola! üëã Soy tu Mentor Anat√≥mico.\n\n**¬øEn qu√© puedo ayudarte?**\n\nüíô **Emocional:** Frustraci√≥n, bloqueo, ansiedad\nüé® **T√©cnico:** L√≠nea de acci√≥n, proporciones, manos\nüìö **Sistema:** Subir ejercicios, ver progreso",
                        ['Duda t√©cnica', 'Apoyo emocional', 'Info del curso']
                    );
                }
            }
            
            mentorInput.focus();
        });

        mentorCloseBtn.addEventListener('click', function() {
            mentorChatContainer.classList.remove('show');
            mentorFloatBtn.style.display = 'flex';
        });

        // Enviar mensaje
        mentorSendBtn.addEventListener('click', sendMessage);
        mentorInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Auto-resize del textarea
        mentorInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 100) + 'px';
        });

        function sendMessage() {
            const message = mentorInput.value.trim();
            if (!message) return;

            // Agregar mensaje del usuario
            addUserMessage(message);
            mentorInput.value = '';
            mentorInput.style.height = 'auto';

            // Mostrar indicador de escritura
            showTypingIndicator();

            // Simular delay de respuesta
            setTimeout(() => {
                hideTypingIndicator();
                
                // USAR EL SISTEMA DE MENTOR-KNOWLEDGE.JS
                const response = window.mentorKnowledge.generateResponse(message);
                
                // Guardar en memoria
                conversationMemory.add(message, response.text, response.emotion, response.intensity);
                
                // Mostrar respuesta
                addMentorMessage(response.text, response.actions || []);
                
                // Verificar si deber√≠a ofrecer un break
                if (conversationMemory.shouldOfferBreak()) {
                    setTimeout(() => {
                        addMentorMessage(
                            "üíô Noto que est√°s pasando por un momento dif√≠cil.\n\n**¬øQuieres tomar un descanso?**\n\nA veces lo mejor es alejarse un rato, tomar aire fresco y volver con energ√≠a renovada.",
                            ['S√≠, tomar√© un break', 'No, estoy bien']
                        );
                    }, 1500);
                }
            }, 800 + Math.random() * 700);
        }

        function addUserMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.textContent = text;
            
            messageDiv.appendChild(bubble);
            mentorMessages.appendChild(messageDiv);
            scrollToBottom();
        }

        function addMentorMessage(text, actions = []) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message mentor';
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.innerHTML = text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            messageDiv.appendChild(bubble);
            
            // Agregar botones de acci√≥n si existen
            if (actions && actions.length > 0) {
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'message-actions';
                
                actions.forEach(actionText => {
                    const btn = document.createElement('button');
                    btn.className = 'action-button';
                    btn.textContent = actionText;
                    btn.onclick = () => {
                        // Agregar mensaje del usuario visualmente
                        addUserMessage(actionText);
                        
                        // Deshabilitar el bot√≥n para evitar doble clic
                        btn.disabled = true;
                        btn.style.opacity = '0.5';
                        
                        // Mostrar indicador de escritura
                        showTypingIndicator();
                        
                        // Generar respuesta contextual
                        setTimeout(() => {
                            hideTypingIndicator();
                            const response = window.mentorKnowledge.generateResponse(actionText);
                            conversationMemory.add(actionText, response.text, response.emotion, response.intensity);
                            addMentorMessage(response.text, response.actions || []);
                        }, 800 + Math.random() * 700);
                    };
                    actionsDiv.appendChild(btn);
                });
                
                bubble.appendChild(actionsDiv);
            }
            
            mentorMessages.appendChild(messageDiv);
            scrollToBottom();
        }

        function showTypingIndicator() {
            typingIndicator.classList.add('show');
            scrollToBottom();
        }

        function hideTypingIndicator() {
            typingIndicator.classList.remove('show');
        }

        function scrollToBottom() {
            setTimeout(() => {
                mentorMessages.scrollTop = mentorMessages.scrollHeight;
            }, 100);
        }
    

        // ============================================
        // CELEBRACI√ìN ESPECIAL AL COMPLETAR TODO EL CURSO
        // ============================================
        function showCompletionCelebration() {
            const celebrationHTML = `
                <div id="completionCelebration" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(135deg, rgba(44,95,102,0.98), rgba(232,162,184,0.98));
                    z-index: 10000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    animation: fadeIn 0.5s ease-out;
                ">
                    <div style="
                        background: white;
                        border-radius: 24px;
                        padding: 3rem;
                        max-width: 600px;
                        width: 90%;
                        text-align: center;
                        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                        animation: scaleIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
                    ">
                        <div style="font-size: 6rem; margin-bottom: 1rem; animation: bounce 1s infinite;">
                            üéâ
                        </div>
                        <h1 style="
                            color: var(--primary-dark);
                            font-size: clamp(1.75rem, 5vw, 2.5rem);
                            font-weight: 800;
                            margin-bottom: 1rem;
                        ">
                            ¬°FELICITACIONES!
                        </h1>
                        <p style="
                            font-size: clamp(1rem, 3vw, 1.3rem);
                            color: #495057;
                            margin-bottom: 2rem;
                            font-weight: 500;
                        ">
                            Has completado exitosamente todo el curso de<br>
                            <strong>Dibujo y Representaci√≥n del Cuerpo Humano</strong>
                        </p>
                        <div style="
                            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
                            padding: 1.5rem;
                            border-radius: 12px;
                            margin-bottom: 2rem;
                        ">
                            <div style="font-size: clamp(2rem, 6vw, 3rem); font-weight: 800; color: var(--primary-dark);">
                                3/3 M√ìDULOS ‚ú®
                            </div>
                            <div style="font-size: clamp(0.9rem, 2.5vw, 1.1rem); color: #495057; margin-top: 0.5rem;">
                                26 lecciones ‚Ä¢ 23 ejercicios ‚Ä¢ 10 evaluaciones
                            </div>
                        </div>
                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                            <button onclick="document.getElementById('completionCelebration').remove(); window.location.href='index.html';" style="
                                background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
                                color: white;
                                border: none;
                                padding: 1rem 2rem;
                                border-radius: 12px;
                                font-size: 1.1rem;
                                font-weight: 600;
                                cursor: pointer;
                                transition: transform 0.3s ease;
                            " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
                                üè† Ver Dashboard
                            </button>
                            <button onclick="document.getElementById('completionCelebration').remove();" style="
                                background: white;
                                color: var(--primary-dark);
                                border: 2px solid var(--primary-light);
                                padding: 1rem 2rem;
                                border-radius: 12px;
                                font-size: 1.1rem;
                                font-weight: 600;
                                cursor: pointer;
                                transition: transform 0.3s ease;
                            " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
                                Continuar
                            </button>
                        </div>
                    </div>
                </div>
                <style>
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes scaleIn {
                        from { transform: scale(0.8); opacity: 0; }
                        to { transform: scale(1); opacity: 1; }
                    }
                    @keyframes bounce {
                        0%, 100% { transform: translateY(0); }
                        50% { transform: translateY(-20px); }
                    }
                </style>
            `;
            
            document.body.insertAdjacentHTML('beforeend', celebrationHTML);
            createConfetti();
        }
        
        function createConfetti() {
            const canvas = document.createElement('canvas');
            canvas.style.position = 'fixed';
            canvas.style.top = '0';
            canvas.style.left = '0';
            canvas.style.width = '100%';
            canvas.style.height = '100%';
            canvas.style.pointerEvents = 'none';
            canvas.style.zIndex = '9999';
            document.body.appendChild(canvas);
            
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const confetti = [];
            const colors = ['#2c5f66', '#e8a2b8', '#10b981', '#f59e0b', '#ef4444', '#3b82f6'];
            
            for (let i = 0; i < 150; i++) {
                confetti.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    size: Math.random() * 6 + 4,
                    speedY: Math.random() * 3 + 2,
                    speedX: Math.random() * 2 - 1,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    rotation: Math.random() * 360
                });
            }
            
            function animateConfetti() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                confetti.forEach((piece, index) => {
                    piece.y += piece.speedY;
                    piece.x += piece.speedX;
                    piece.rotation += 2;
                    
                    ctx.save();
                    ctx.translate(piece.x, piece.y);
                    ctx.rotate(piece.rotation * Math.PI / 180);
                    ctx.fillStyle = piece.color;
                    ctx.fillRect(-piece.size / 2, -piece.size / 2, piece.size, piece.size);
                    ctx.restore();
                    
                    if (piece.y > canvas.height) {
                        confetti[index] = {
                            x: Math.random() * canvas.width,
                            y: -20,
                            size: Math.random() * 6 + 4,
                            speedY: Math.random() * 3 + 2,
                            speedX: Math.random() * 2 - 1,
                            color: colors[Math.floor(Math.random() * colors.length)],
                            rotation: Math.random() * 360
                        };
                    }
                });
                
                requestAnimationFrame(animateConfetti);
            }
            
            animateConfetti();
            
            setTimeout(() => canvas.remove(), 10000);
        }

    </script>
</body>
</html>
