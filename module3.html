<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulo 3: Figura Completa - LMS UAH</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        :root {
            --primary-dark: #2c5f66;
            --primary-light: #e8a2b8;
            --dark: #1a1a1a;
            --success: #4CAF50;
            --warning: #FFC107;
            --danger: #f44336;
            --info: #2196F3;
        }

        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
        }

        .header-uah {
            background: linear-gradient(135deg, var(--primary-dark), var(--dark));
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1030;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .breadcrumb-custom {
            background: white;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .sidebar-lesson {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        @media (min-width: 992px) {
            .sidebar-lesson {
                position: sticky;
                top: 90px;
                max-height: calc(100vh - 110px);
                overflow-y: auto;
            }
        }

        .lesson-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            border-radius: 8px;
            text-decoration: none;
            color: var(--dark);
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 0.5rem;
            border: 2px solid transparent;
        }

        .lesson-link:hover {
            background: #f8f9fa;
            transform: translateX(3px);
            border-color: var(--primary-light);
        }

        .lesson-link.active {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            color: white;
        }

        .lesson-number {
            width: 35px;
            height: 35px;
            background: var(--primary-dark);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }

        .lesson-link.active .lesson-number {
            background: white;
            color: var(--primary-dark);
        }

        .main-content-area {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        /* Prerequisitos Screen */
        .prereq-screen {
            text-align: center;
            padding: 3rem 2rem;
        }

        .prereq-icon {
            font-size: 5rem;
            color: var(--warning);
            margin-bottom: 1.5rem;
        }

        .prereq-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 1rem;
        }

        .prereq-subtitle {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 2rem;
        }

        .prereq-list {
            background: #f8f9fa;
            border-left: 4px solid var(--primary-dark);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem auto;
            max-width: 600px;
            text-align: left;
        }

        .prereq-list h5 {
            color: var(--primary-dark);
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .prereq-list ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .prereq-list li {
            padding: 0.75rem 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .prereq-list li:last-child {
            border-bottom: none;
        }

        .prereq-list li i {
            color: var(--success);
            font-size: 1.2rem;
        }

        .prereq-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 500px;
            margin: 2rem auto;
        }

        /* Test Diagnóstico */
        .test-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .test-header {
            background: linear-gradient(135deg, var(--primary-dark), var(--dark));
            color: white;
            padding: 2.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .test-header h3 {
            margin-bottom: 0.5rem;
        }

        .test-instructions {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .test-counter {
            background: rgba(255,255,255,0.2);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            display: inline-block;
            margin-top: 1rem;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .test-question {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .test-question:hover {
            border-color: var(--primary-light);
            box-shadow: 0 4px 12px rgba(44,95,102,0.1);
        }

        .question-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .question-number {
            background: var(--primary-dark);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
            font-size: 1.1rem;
        }

        .question-text {
            flex: 1;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
            line-height: 1.5;
        }

        .test-option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin: 0.75rem 0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .test-option:hover {
            background: #e9ecef;
            border-color: var(--primary-light);
            transform: translateX(5px);
        }

        .test-option.selected {
            background: #d1ecf1;
            border-color: var(--primary-dark);
        }

        .test-option.correct {
            background: #d4edda;
            border-color: var(--success);
        }

        .test-option.incorrect {
            background: #f8d7da;
            border-color: var(--danger);
        }

        .test-radio {
            width: 22px;
            height: 22px;
            border: 3px solid #999;
            border-radius: 50%;
            flex-shrink: 0;
            position: relative;
        }

        .test-option.selected .test-radio {
            border-color: var(--primary-dark);
        }

        .test-option.selected .test-radio::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: var(--primary-dark);
            border-radius: 50%;
        }

        .test-result {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
        }

        .test-result.success {
            background: #d4edda;
            border: 2px solid var(--success);
            color: #155724;
        }

        .test-result.failure {
            background: #f8d7da;
            border: 2px solid var(--danger);
            color: #721c24;
        }

        /* Lesson Content */
        .lesson-header {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #e0e0e0;
        }

        .lesson-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
        }

        .lesson-subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 1rem;
        }

        .lesson-duration {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
        }

        .objectives-list {
            background: linear-gradient(135deg, rgba(44,95,102,0.05), rgba(232,162,184,0.05));
            border-left: 4px solid var(--primary-dark);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .objectives-list h6 {
            color: var(--primary-dark);
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .objectives-list ul {
            margin-bottom: 0;
        }

        .objectives-list li {
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }

        /* Progress Bar */
        .progress-module {
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-module {
            height: 100%;
            background: linear-gradient(90deg, var(--success), #20c997);
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Accordion */
        .accordion-button {
            background: #f8f9fa;
            color: var(--dark);
            font-weight: 600;
        }

        .accordion-button:not(.collapsed) {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            color: white;
        }

        .accordion-button:focus {
            box-shadow: none;
            border-color: var(--primary-light);
        }

        /* Exercise Card */
        .exercise-card {
            background: linear-gradient(135deg, rgba(44,95,102,0.05), rgba(232,162,184,0.05));
            border: 2px solid var(--primary-light);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .exercise-card h5 {
            color: var(--primary-dark);
            font-weight: 700;
        }

        /* Evaluación */
        .eval-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .eval-question {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 2px solid #e0e0e0;
        }

        .eval-option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin: 0.75rem 0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .eval-option:hover {
            background: #e9ecef;
            border-color: var(--primary-light);
        }

        .eval-option.selected {
            background: #d1ecf1;
            border-color: var(--primary-dark);
        }

        .eval-radio {
            width: 20px;
            height: 20px;
            border: 2px solid #666;
            border-radius: 50%;
            flex-shrink: 0;
            position: relative;
        }

        .eval-option.selected .eval-radio::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: var(--primary-dark);
            border-radius: 50%;
        }

        /* Floating Buttons */
        .floating-btn {
            position: fixed;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            border: none;
        }

        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        #mentorBtn {
            bottom: 30px;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
        }

        #rubricBtn {
            bottom: 110px;
            background: linear-gradient(135deg, var(--info), var(--primary-light));
            display: none;
        }

        /* Chat Container */
        .chat-container {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 400px;
            height: 600px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 999;
        }

        .chat-container.show {
            display: flex;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-header {
            background: linear-gradient(135deg, var(--primary-dark), var(--dark));
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header-info h5 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .chat-header-info small {
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .chat-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .chat-close:hover {
            background: rgba(255,255,255,0.3);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            background: #f8f9fa;
        }

        .chat-message {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-message strong {
            color: var(--primary-dark);
        }

        .chat-input-container {
            padding: 1rem;
            background: white;
            border-top: 1px solid #e0e0e0;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 0.5rem;
        }

        .chat-input {
            flex: 1;
            border: 2px solid #e0e0e0;
            border-radius: 24px;
            padding: 0.75rem 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            border-color: var(--primary-dark);
        }

        .chat-send-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .chat-send-btn:hover {
            transform: scale(1.05);
        }

        /* Modal */
        .modal-custom {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-custom.show {
            display: flex;
        }

        .modal-content-custom {
            background: white;
            border-radius: 16px;
            max-width: 1000px;
            max-height: 90vh;
            width: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header-custom {
            background: linear-gradient(135deg, var(--primary-dark), var(--dark));
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header-custom h4 {
            margin: 0;
            font-weight: 700;
        }

        .modal-body-custom {
            padding: 2rem;
            overflow-y: auto;
            flex: 1;
        }

        .modal-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Glosario */
        .glossary-section {
            margin-bottom: 2.5rem;
        }

        .glossary-section h4 {
            color: var(--primary-dark);
            border-bottom: 3px solid var(--primary-light);
            padding-bottom: 0.75rem;
            margin-bottom: 1.5rem;
            font-weight: 700;
        }

        .glossary-term {
            background: linear-gradient(135deg, rgba(44,95,102,0.03), rgba(232,162,184,0.03));
            border-left: 4px solid var(--primary-light);
            padding: 1.25rem;
            margin-bottom: 1rem;
            border-radius: 0 8px 8px 0;
            transition: all 0.3s ease;
        }

        .glossary-term:hover {
            border-left-width: 6px;
            box-shadow: 0 2px 8px rgba(44,95,102,0.1);
        }

        .glossary-term h6 {
            color: var(--primary-dark);
            font-weight: 700;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }

        .glossary-term p {
            margin-bottom: 0.75rem;
            line-height: 1.6;
            color: var(--dark);
        }

        .glossary-term small {
            color: #666;
            font-style: italic;
            display: block;
            padding-top: 0.5rem;
            border-top: 1px solid #e0e0e0;
        }

        .glossary-references {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .glossary-references h5 {
            color: var(--primary-dark);
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .glossary-references ol {
            padding-left: 1.5rem;
        }

        .glossary-references li {
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }

        /* Rúbrica Table */
        .rubric-intro {
            background: linear-gradient(135deg, rgba(44,95,102,0.05), rgba(232,162,184,0.05));
            border-left: 4px solid var(--primary-dark);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .rubric-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            font-size: 0.9rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .rubric-table th,
        .rubric-table td {
            border: 1px solid #ddd;
            padding: 1rem;
            text-align: left;
            vertical-align: top;
        }

        .rubric-table th {
            background: linear-gradient(135deg, var(--primary-dark), var(--dark));
            color: white;
            font-weight: 700;
            text-align: center;
        }

        .rubric-table th:first-child {
            text-align: left;
        }

        .rubric-table .level-excellent {
            background: #d4edda;
        }

        .rubric-table .level-good {
            background: #d1ecf1;
        }

        .rubric-table .level-sufficient {
            background: #fff3cd;
        }

        .rubric-table .level-insufficient {
            background: #f8d7da;
        }

        .rubric-table .criterion-name {
            font-weight: 700;
            color: var(--primary-dark);
        }

        .remedial-section {
            margin-top: 2rem;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .chat-container {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
            }

            .floating-btn {
                right: 20px;
            }

            #rubricBtn {
                bottom: 100px;
            }

            .modal-content-custom {
                max-width: 100%;
            }

            .rubric-table {
                font-size: 0.75rem;
            }

            .rubric-table th,
            .rubric-table td {
                padding: 0.5rem;
            }

            .main-content-area {
                padding: 1.5rem;
            }
        }

        @media (max-width: 576px) {
            .header-uah {
                padding: 0.75rem 0;
            }

            .lesson-title {
                font-size: 1.5rem;
            }

            .floating-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            #rubricBtn {
                bottom: 90px;
            }

            .chat-container {
                height: calc(100vh - 120px);
                bottom: 70px;
            }

            .prereq-title {
                font-size: 1.5rem;
            }

            .test-header {
                padding: 1.5rem;
            }
        }

        /* Utility */
        .text-sm {
            font-size: 0.9rem;
        }

        .btn-nav {
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            min-width: 150px;
            transition: all 0.3s ease;
        }

        .btn-nav:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header-uah">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="mb-0">DIADIFO - Dibujo Figura Humana</h5>
                    <small class="text-white-50">Universidad Alberto Hurtado</small>
                </div>
                <a href="index.html" class="btn btn-outline-light btn-sm">
                    <i class="bi bi-house-door me-1"></i>Inicio
                </a>
            </div>
        </div>
    </header>

    <div class="container my-4">
        <!-- Breadcrumb -->
        <nav class="breadcrumb-custom" aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="index.html">Inicio</a></li>
                <li class="breadcrumb-item active">Módulo 3</li>
            </ol>
        </nav>

        <!-- Main Layout -->
        <div class="row g-4">
            <!-- Sidebar -->
            <aside class="col-lg-3">
                <div class="sidebar-lesson">
                    <h5 class="mb-3" style="color: var(--primary-dark); font-weight: 700;">
                        <i class="bi bi-list-ul me-2"></i>Lecciones
                    </h5>
                    
                    <a class="lesson-link" data-lesson="1" onclick="loadLesson(1)">
                        <span class="lesson-number">1</span>
                        <span class="flex-grow-1">Síntesis por Capas</span>
                    </a>
                    
                    <a class="lesson-link" data-lesson="2" onclick="loadLesson(2)">
                        <span class="lesson-number">2</span>
                        <span class="flex-grow-1">Luz, Sombra y Volumen</span>
                    </a>
                    
                    <a class="lesson-link" data-lesson="3" onclick="loadLesson(3)">
                        <span class="lesson-number">3</span>
                        <span class="flex-grow-1">Proyecto Final</span>
                    </a>
                    
                    <div class="mt-4">
                        <h6 class="mb-2">Progreso del Módulo</h6>
                        <div class="progress-module">
                            <div class="progress-bar-module" id="progressBar" style="width: 0%">0%</div>
                        </div>
                        <small class="text-muted d-block mt-2" id="progressDetail">0 de 3 lecciones completadas</small>
                    </div>

                    <div class="card border-primary mt-3">
                        <div class="card-header bg-primary text-white">
                            <i class="bi bi-info-circle me-2"></i>Información
                        </div>
                        <div class="card-body">
                            <p class="small mb-2"><strong>Duración:</strong> 5 días</p>
                            <p class="small mb-2"><strong>Carga:</strong> 200 min</p>
                            <p class="small mb-0"><strong>Entregables:</strong></p>
                            <ul class="small mb-0 mt-2">
                                <li>2 figuras completas</li>
                                <li>1 figura con valores</li>
                                <li>1 proyecto final</li>
                                <li>3 evaluaciones</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card border-success mt-3">
                        <div class="card-header bg-success text-white">
                            <i class="bi bi-cloud-upload me-2"></i>Entrega Final
                        </div>
                        <div class="card-body text-center">
                            <p class="mb-3 small">Fotografía tus trabajos y súbelos:</p>
                            <a href="https://forms.gle/TU_URL_AQUI" 
                               class="btn btn-primary btn-sm" 
                               target="_blank">
                                <i class="bi bi-box-arrow-up-right me-2"></i>Subir Trabajos
                            </a>
                            <p class="small text-muted mt-3 mb-0">
                                Plazo: Al completar el módulo
                            </p>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="col-lg-9">
                <div class="main-content-area" id="mainContent">
                    <!-- Content loaded dynamically -->
                </div>
            </main>
        </div>
    </div>

    <!-- Floating Mentor Button -->
    <button id="mentorBtn" class="floating-btn" onclick="toggleChat()" title="Mentor Anatómico">
        <i class="bi bi-chat-dots"></i>
    </button>

    <!-- Floating Rubric Button -->
    <button id="rubricBtn" class="floating-btn" onclick="showRubric()" title="Ver Rúbrica">
        <i class="bi bi-clipboard-check"></i>
    </button>

    <!-- Chat Container -->
    <div id="chatContainer" class="chat-container">
        <div class="chat-header">
            <div class="chat-header-info">
                <h5><i class="bi bi-robot me-2"></i>Mentor Anatómico</h5>
                <small>
                    <i class="bi bi-circle-fill text-success" style="font-size: 0.5rem;"></i>
                    En línea
                </small>
            </div>
            <button class="chat-close" onclick="toggleChat()">×</button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="chat-message">
                <p><strong>🎨 Mentor:</strong> ¡Hola! Soy tu asistente para el Módulo 3. Pregúntame sobre técnicas, conceptos o revisa el glosario completo.</p>
                <button class="btn btn-primary btn-sm mt-2" onclick="showGlossary()">
                    <i class="bi bi-book me-1"></i>Ver Glosario Completo
                </button>
            </div>
        </div>
        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <input type="text" class="chat-input" id="chatInput" placeholder="Escribe tu pregunta..." onkeypress="handleChatEnter(event)">
                <button class="chat-send-btn" onclick="sendMessage()">
                    <i class="bi bi-send-fill"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Glossary Modal -->
    <div id="glossaryModal" class="modal-custom" onclick="closeGlossaryOnOutside(event)">
        <div class="modal-content-custom" onclick="event.stopPropagation()">
            <div class="modal-header-custom">
                <h4><i class="bi bi-book me-2"></i>Glosario Completo del Curso</h4>
                <button class="modal-close" onclick="closeGlossary()">×</button>
            </div>
            <div class="modal-body-custom">
                <!-- Módulo 1 -->
                <div class="glossary-section">
                    <h4>📐 Módulo 1: Observación y Gesto</h4>
                    
                    <div class="glossary-term">
                        <h6>Línea de acción</h6>
                        <p>Eje imaginario que atraviesa la figura capturando la dirección y energía del movimiento.</p>
                        <small>Fuente: Loomis, A. (1943). Figure drawing for all it's worth. Viking Press; Nicolaïdes, K. (1941). The natural way to draw. Houghton Mifflin.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Gesto</h6>
                        <p>Esencia del movimiento y actitud corporal capturada en trazos rápidos y fluidos.</p>
                        <small>Fuente: Nicolaïdes, K. (1941). The natural way to draw. Houghton Mifflin.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Contrapposto</h6>
                        <p>Distribución de peso en una pierna, creando ejes opuestos entre hombros y caderas.</p>
                        <small>Fuente: Loomis, A. (1943). Figure drawing for all it's worth. Viking Press.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Proporciones</h6>
                        <p>Relaciones de tamaño entre las diferentes partes del cuerpo humano.</p>
                        <small>Fuente: Loomis, A. (1943). Figure drawing for all it's worth. Viking Press.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Croquis</h6>
                        <p>Dibujo rápido de 2 a 5 minutos que captura la esencia del movimiento.</p>
                        <small>Fuente: Nicolaïdes, K. (1941). The natural way to draw. Houghton Mifflin.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Punto de apoyo</h6>
                        <p>Punto de contacto entre el cuerpo y el suelo que soporta el peso de la figura.</p>
                        <small>Fuente: Bridgman, G. B. (1920). Constructive anatomy. Dover Publications.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Balance visual</h6>
                        <p>Organización del peso y las formas alrededor de un eje central vertical.</p>
                        <small>Fuente: Loomis, A. (1943). Figure drawing for all it's worth. Viking Press.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Medición visual</h6>
                        <p>Técnica de usar el lápiz como regla para comparar proporciones y ángulos.</p>
                        <small>Fuente: Nicolaïdes, K. (1941). The natural way to draw. Houghton Mifflin.</small>
                    </div>
                </div>

                <!-- Módulo 2 -->
                <div class="glossary-section">
                    <h4>🦴 Módulo 2: Anatomía Funcional</h4>
                    
                    <div class="glossary-term">
                        <h6>3 masas corporales</h6>
                        <p>División fundamental del cuerpo en cabeza, torso y pelvis como formas tridimensionales.</p>
                        <small>Fuente: Loomis, A. (1943). Figure drawing for all it's worth. Viking Press; Bridgman, G. B. (1920). Constructive anatomy. Dover Publications.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Anatomía funcional</h6>
                        <p>Relación entre la estructura anatómica y el movimiento del cuerpo humano.</p>
                        <small>Fuente: Richer, P. (1971). Artistic anatomy (R. B. Hale, Ed.). Watson-Guptill. (Original 1890)</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Grupos musculares</h6>
                        <p>Los 6 grupos musculares superficiales esenciales para el dibujo: deltoides, pectorales, abdominales, dorsales, glúteos y cuádriceps.</p>
                        <small>Fuente: Bridgman, G. B. (1920). Constructive anatomy. Dover Publications.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Estructura ósea</h6>
                        <p>Esqueleto simplificado que define la forma fundamental del cuerpo.</p>
                        <small>Fuente: Richer, P. (1971). Artistic anatomy (R. B. Hale, Ed.). Watson-Guptill. (Original 1890)</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Articulaciones</h6>
                        <p>Puntos de conexión y movimiento entre huesos que permiten la flexibilidad del cuerpo.</p>
                        <small>Fuente: Bridgman, G. B. (1920). Constructive anatomy. Dover Publications.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Escorzo</h6>
                        <p>Acortamiento visual de formas debido a la perspectiva cuando se alejan del observador.</p>
                        <small>Fuente: Hogarth, B. (1958). Dynamic anatomy. Watson-Guptill Publications.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Simplificación geométrica</h6>
                        <p>Representación del cuerpo mediante formas básicas: cubos, cilindros y esferas.</p>
                        <small>Fuente: Loomis, A. (1943). Figure drawing for all it's worth. Viking Press.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Palma</h6>
                        <p>Masa sólida rectangular de la mano que sirve como base para los dedos.</p>
                        <small>Fuente: Loomis, A. (1956). Drawing the head and hands. Viking Press.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Falanges</h6>
                        <p>Los 3 segmentos articulados que componen cada dedo de la mano.</p>
                        <small>Fuente: Goldfinger, E. (1991). Human anatomy for artists. Oxford University Press.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Regla de tercios</h6>
                        <p>División horizontal del rostro en tres partes iguales: frente, nariz y boca-mentón.</p>
                        <small>Fuente: Loomis, A. (1956). Drawing the head and hands. Viking Press.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Canon de proporciones</h6>
                        <p>Sistema de medida donde el cuerpo humano adulto equivale a 7.5-8 cabezas de altura.</p>
                        <small>Fuente: Loomis, A. (1943). Figure drawing for all it's worth. Viking Press.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Columna vertebral</h6>
                        <p>Eje flexible y curvo que conecta las tres masas corporales y permite el movimiento.</p>
                        <small>Fuente: Bridgman, G. B. (1920). Constructive anatomy. Dover Publications.</small>
                    </div>
                </div>

                <!-- Módulo 3 -->
                <div class="glossary-section">
                    <h4>🎨 Módulo 3: Figura Completa</h4>
                    
                    <div class="glossary-term">
                        <h6>Valores tonales</h6>
                        <p>5 niveles de luz a oscuridad: luz máxima, luz, medio tono, sombra y sombra profunda.</p>
                        <small>Fuente: Loomis, A. (1943). Figure drawing for all it's worth. Viking Press.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Síntesis</h6>
                        <p>Integración del gesto (Módulo 1) y la anatomía (Módulo 2) en una representación completa.</p>
                        <small>Fuente: Gagné, R. M. (1985). The conditions of learning. Holt, Rinehart.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Proceso por capas</h6>
                        <p>Método de construcción progresiva: gesto → estructura → anatomía → refinamiento.</p>
                        <small>Fuente: Nicolaïdes, K. (1941). The natural way to draw. Houghton Mifflin.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Fuente de luz</h6>
                        <p>Dirección de la iluminación que determina dónde aparecen las luces y sombras.</p>
                        <small>Fuente: Hogarth, B. (1958). Dynamic anatomy. Watson-Guptill Publications.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Sombra proyectada</h6>
                        <p>Área oscura que aparece sobre una superficie cuando un objeto bloquea la luz.</p>
                        <small>Fuente: Loomis, A. (1943). Figure drawing for all it's worth. Viking Press.</small>
                    </div>

                    <div class="glossary-term">
                        <h6>Medio tono</h6>
                        <p>Valor intermedio entre luz y sombra que crea la transición gradual entre ambos.</p>
                        <small>Fuente: Loomis, A. (1943). Figure drawing for all it's worth. Viking Press.</small>
                    </div>
                </div>

                <!-- Referencias -->
                <div class="glossary-references">
                    <h5><i class="bi bi-journal-text me-2"></i>Referencias Bibliográficas</h5>
                    <ol>
                        <li>Loomis, A. (1943). <em>Figure drawing for all it's worth</em>. Viking Press.</li>
                        <li>Loomis, A. (1956). <em>Drawing the head and hands</em>. Viking Press.</li>
                        <li>Nicolaïdes, K. (1941). <em>The natural way to draw</em>. Houghton Mifflin.</li>
                        <li>Bridgman, G. B. (1920). <em>Constructive anatomy</em>. Dover Publications.</li>
                        <li>Richer, P. (1971). <em>Artistic anatomy</em> (R. B. Hale, Ed.). Watson-Guptill. (Original work published 1890)</li>
                        <li>Goldfinger, E. (1991). <em>Human anatomy for artists</em>. Oxford University Press.</li>
                        <li>Hogarth, B. (1958). <em>Dynamic anatomy</em>. Watson-Guptill Publications.</li>
                        <li>Vanderpoel, J. H. (1907). <em>The human figure</em>. Dover Publications.</li>
                        <li>Krause, K. (2015-2025). <em>Line of action</em>. https://line-of-action.com/</li>
                        <li>Gagné, R. M. (1985). <em>The conditions of learning</em>. Holt, Rinehart and Winston.</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Rubric Modal -->
    <div id="rubricModal" class="modal-custom" onclick="closeRubricOnOutside(event)">
        <div class="modal-content-custom" onclick="event.stopPropagation()">
            <div class="modal-header-custom">
                <h4><i class="bi bi-clipboard-check me-2"></i>Rúbrica de Evaluación - Proyecto Final</h4>
                <button class="modal-close" onclick="closeRubric()">×</button>
            </div>
            <div class="modal-body-custom">
                <div class="rubric-intro">
                    <h5 style="color: var(--primary-dark);"><i class="bi bi-info-circle me-2"></i>Instrucciones</h5>
                    <p class="mb-2">Utiliza esta rúbrica para autoevaluar tu proyecto final <strong>ANTES</strong> de subirlo. El puntaje mínimo para aprobar es <strong>60/100 puntos</strong>.</p>
                    <p class="mb-0"><strong>Formato requerido:</strong> 1/4 mercurio (27.5 × 37.5 cm)</p>
                </div>

                <table class="rubric-table">
                    <thead>
                        <tr>
                            <th style="width: 15%;">Criterio</th>
                            <th style="width: 21.25%;">Excelente<br>(90-100%)</th>
                            <th style="width: 21.25%;">Bueno<br>(75-89%)</th>
                            <th style="width: 21.25%;">Suficiente<br>(60-74%)</th>
                            <th style="width: 21.25%;">Insuficiente<br>(&lt;60%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="criterion-name">1. Gesto y Línea de Acción<br><small>(20 pts)</small></td>
                            <td class="level-excellent">Línea de acción claramente visible, energía del movimiento capturada magistralmente, punto de apoyo identificable</td>
                            <td class="level-good">Línea de acción visible, buena captura de energía, punto de apoyo claro</td>
                            <td class="level-sufficient">Línea de acción presente pero débil, captura parcial de energía</td>
                            <td class="level-insufficient">Línea de acción ausente o imperceptible, sin energía</td>
                        </tr>
                        <tr>
                            <td class="criterion-name">2. Proporciones<br><small>(20 pts)</small></td>
                            <td class="level-excellent">Proporciones 95-100% precisas, consistencia interna perfecta entre todas las partes</td>
                            <td class="level-good">Proporciones 85-94% precisas, consistencia interna buena con errores menores</td>
                            <td class="level-sufficient">Proporciones 70-84% precisas, algunos errores evidentes pero figura reconocible</td>
                            <td class="level-insufficient">Proporciones &lt;70% precisas, errores mayores que distorsionan figura</td>
                        </tr>
                        <tr>
                            <td class="criterion-name">3. Anatomía Funcional<br><small>(20 pts)</small></td>
                            <td class="level-excellent">3 masas claramente diferenciadas, articulaciones correctas, 6 grupos musculares identificables</td>
                            <td class="level-good">3 masas visibles, articulaciones mayormente correctas, 4-5 grupos musculares identificables</td>
                            <td class="level-sufficient">3 masas presentes pero poco claras, articulaciones básicas, 2-3 grupos musculares</td>
                            <td class="level-insufficient">Masas corporales confundidas, articulaciones incorrectas, anatomía ausente</td>
                        </tr>
                        <tr>
                            <td class="criterion-name">4. Extremidades<br><small>(15 pts)</small></td>
                            <td class="level-excellent">Manos y pies estructurados con articulaciones claras, proporciones correctas, gestos naturales</td>
                            <td class="level-good">Manos y pies con estructura reconocible, proporciones aceptables, alguna rigidez</td>
                            <td class="level-sufficient">Manos y pies intentados pero con errores evidentes de estructura</td>
                            <td class="level-insufficient">Manos y pies omitidos, extremadamente simplificados o incorrectos</td>
                        </tr>
                        <tr>
                            <td class="criterion-name">5. Valores Tonales<br><small>(15 pts)</small></td>
                            <td class="level-excellent">5 valores claramente diferenciados, fuente de luz consistente, sombra proyectada coherente</td>
                            <td class="level-good">4 valores diferenciados, fuente de luz clara, sombra proyectada presente</td>
                            <td class="level-sufficient">3 valores diferenciados, fuente de luz identificable, sombra básica</td>
                            <td class="level-insufficient">Menos de 3 valores, iluminación confusa o ausente</td>
                        </tr>
                        <tr>
                            <td class="criterion-name">6. Composición y Limpieza<br><small>(10 pts)</small></td>
                            <td class="level-excellent">Figura bien ubicada en formato, balance visual excelente, líneas limpias y decisivas</td>
                            <td class="level-good">Figura bien ubicada, buen balance, líneas mayormente limpias</td>
                            <td class="level-sufficient">Figura ubicada aceptablemente, balance básico, algunas líneas sucias</td>
                            <td class="level-insufficient">Figura mal ubicada, sin balance, líneas muy sucias o borradas excesivamente</td>
                        </tr>
                        <tr style="font-weight: 700; background: #f8f9fa;">
                            <td colspan="4" style="text-align: right;">TOTAL:</td>
                            <td style="text-align: center;">/100 pts</td>
                        </tr>
                    </tbody>
                </table>

                <div class="remedial-section">
                    <div class="alert alert-warning">
                        <h5><i class="bi bi-exclamation-triangle me-2"></i>Sistema de Recuperación</h5>
                        <p class="mb-2">Si obtienes menos de 60 puntos en tu proyecto final:</p>
                        <ul class="mb-0">
                            <li>Se identificarán los 3 criterios más débiles</li>
                            <li>Recibirás un plan de recuperación de 10 días</li>
                            <li>Deberás crear un NUEVO proyecto final completo</li>
                            <li>No hay límite de intentos hasta aprobar</li>
                        </ul>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <button class="btn btn-primary btn-nav me-2" onclick="alert('Función de descarga PDF en desarrollo')">
                        <i class="bi bi-file-pdf me-2"></i>Descargar PDF
                    </button>
                    <button class="btn btn-secondary btn-nav" onclick="alert('Función de descarga PNG en desarrollo')">
                        <i class="bi bi-image me-2"></i>Descargar PNG
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="auth.js"></script>
    <script>
        // ===== VARIABLES GLOBALES =====
        let currentLesson = 0;
        let moduleProgress = {
            completedLessons: [],
            evaluations: {},
            testDiagnostico: null
        };
        let testAttempts = 0;
        let testAnswers = {};

        // ===== INICIALIZACIÓN =====
        async function initializeModule() {
            console.log('🎨 Inicializando Módulo 3...');
            
            // Verificar usuario autenticado
            const currentUser = getCurrentUser();
            if (!currentUser) {
                window.location.href = 'login.html';
                return;
            }

            // Sincronizar progreso desde Sheets
            await syncProgressFromSheets(currentUser, true);
            const progress = getStoredProgress();
            
            if (progress && progress.modules && progress.modules[3]) {
                moduleProgress = progress.modules[3];
            }

            // Verificar si ya aprobó el test diagnóstico
            if (moduleProgress.testDiagnostico && moduleProgress.testDiagnostico.aprobado) {
                console.log('✅ Test diagnóstico ya aprobado');
                iniciarModulo();
            } else {
                showPrerequisitos();
            }

            updateProgressBar();
        }

        // ===== PANTALLA DE PREREQUISITOS =====
        function showPrerequisitos() {
            const content = `
                <div class="prereq-screen">
                    <div class="prereq-icon">
                        <i class="bi bi-exclamation-triangle-fill"></i>
                    </div>
                    <h2 class="prereq-title">⚠️ Módulo Avanzado</h2>
                    <p class="prereq-subtitle">Este módulo requiere conocimientos de los Módulos 1 y 2</p>

                    <div class="prereq-list">
                        <h5><i class="bi bi-check2-square me-2"></i>Prerequisitos</h5>
                        <ul>
                            <li>
                                <i class="bi bi-check-circle-fill"></i>
                                <span><strong>Línea de acción</strong> (Módulo 1)</span>
                            </li>
                            <li>
                                <i class="bi bi-check-circle-fill"></i>
                                <span><strong>3 masas corporales</strong> (Módulo 2)</span>
                            </li>
                            <li>
                                <i class="bi bi-check-circle-fill"></i>
                                <span><strong>Proporciones básicas</strong> (Módulos 1 y 2)</span>
                            </li>
                        </ul>
                    </div>

                    <div class="prereq-buttons">
                        <button class="btn btn-success btn-nav btn-lg w-100" onclick="iniciarModulo()">
                            <i class="bi bi-check-circle me-2"></i>Completé Módulos 1 y 2
                        </button>
                        <button class="btn btn-primary btn-nav btn-lg w-100" onclick="mostrarTestDiagnostico()">
                            <i class="bi bi-clipboard-check me-2"></i>Test Diagnóstico
                        </button>
                        <a href="index.html" class="btn btn-outline-secondary btn-nav btn-lg w-100">
                            <i class="bi bi-arrow-left me-2"></i>Volver a Módulos 1 y 2
                        </a>
                    </div>
                </div>
            `;
            document.getElementById('mainContent').innerHTML = content;
        }

        // ===== TEST DIAGNÓSTICO =====
        function mostrarTestDiagnostico() {
            // Verificar intentos
            if (moduleProgress.testDiagnostico && moduleProgress.testDiagnostico.intentos >= 3) {
                alert('Has alcanzado el límite de 3 intentos. Por favor, completa los Módulos 1 y 2 antes de continuar.');
                return;
            }

            testAnswers = {};
            testAttempts = moduleProgress.testDiagnostico ? moduleProgress.testDiagnostico.intentos : 0;

            const content = `
                <div class="test-container">
                    <div class="test-header">
                        <h3>📋 Test Diagnóstico</h3>
                        <p class="mb-0">Verifica tus conocimientos de los Módulos 1 y 2</p>
                        <div class="test-instructions">
                            <p class="mb-1"><strong>Instrucciones:</strong></p>
                            <ul class="mb-1 text-start" style="list-style-position: inside;">
                                <li>5 preguntas de opción múltiple</li>
                                <li>Mínimo aprobatorio: 4/5 correctas (80%)</li>
                                <li>Máximo 3 intentos</li>
                            </ul>
                        </div>
                        <div class="test-counter" id="testCounter">Respondidas: 0/5</div>
                    </div>

                    <div class="test-question">
                        <div class="question-header">
                            <span class="question-number">1</span>
                            <span class="question-text">¿Cuál es la línea de acción correcta en una figura?</span>
                        </div>
                        <div class="test-option" onclick="selectTestOption(1, 'A')">
                            <div class="test-radio"></div>
                            <span>A) Una línea recta vertical en el centro</span>
                        </div>
                        <div class="test-option" onclick="selectTestOption(1, 'B')">
                            <div class="test-radio"></div>
                            <span>B) Una curva en "C" que atraviesa el cuerpo capturando el movimiento</span>
                        </div>
                        <div class="test-option" onclick="selectTestOption(1, 'C')">
                            <div class="test-radio"></div>
                            <span>C) El contorno exterior de la figura</span>
                        </div>
                    </div>

                    <div class="test-question">
                        <div class="question-header">
                            <span class="question-number">2</span>
                            <span class="question-text">¿Cuáles son las 3 masas corporales fundamentales?</span>
                        </div>
                        <div class="test-option" onclick="selectTestOption(2, 'A')">
                            <div class="test-radio"></div>
                            <span>A) Brazos, piernas y tronco</span>
                        </div>
                        <div class="test-option" onclick="selectTestOption(2, 'B')">
                            <div class="test-radio"></div>
                            <span>B) Cabeza, torso y pelvis</span>
                        </div>
                        <div class="test-option" onclick="selectTestOption(2, 'C')">
                            <div class="test-radio"></div>
                            <span>C) Hombros, abdomen y caderas</span>
                        </div>
                    </div>

                    <div class="test-question">
                        <div class="question-header">
                            <span class="question-number">3</span>
                            <span class="question-text">En contrapposto con peso en la pierna derecha, ¿qué sucede?</span>
                        </div>
                        <div class="test-option" onclick="selectTestOption(3, 'A')">
                            <div class="test-radio"></div>
                            <span>A) La cadera derecha sube y el hombro derecho baja</span>
                        </div>
                        <div class="test-option" onclick="selectTestOption(3, 'B')">
                            <div class="test-radio"></div>
                            <span>B) La cadera derecha baja y el hombro derecho sube</span>
                        </div>
                        <div class="test-option" onclick="selectTestOption(3, 'C')">
                            <div class="test-radio"></div>
                            <span>C) Ambas caderas y hombros quedan al mismo nivel</span>
                        </div>
                    </div>

                    <div class="test-question">
                        <div class="question-header">
                            <span class="question-number">4</span>
                            <span class="question-text">¿Cómo se estructura correctamente una mano?</span>
                        </div>
                        <div class="test-option" onclick="selectTestOption(4, 'A')">
                            <div class="test-radio"></div>
                            <span>A) Como 5 líneas que salen de un punto</span>
                        </div>
                        <div class="test-option" onclick="selectTestOption(4, 'B')">
                            <div class="test-radio"></div>
                            <span>B) Un bloque rectangular (palma) más 5 cilindros articulados (dedos)</span>
                        </div>
                        <div class="test-option" onclick="selectTestOption(4, 'C')">
                            <div class="test-radio"></div>
                            <span>C) Una esfera con extensiones</span>
                        </div>
                    </div>

                    <div class="test-question">
                        <div class="question-header">
                            <span class="question-number">5</span>
                            <span class="question-text">¿Cuáles son los valores tonales básicos de luz a oscuridad?</span>
                        </div>
                        <div class="test-option" onclick="selectTestOption(5, 'A')">
                            <div class="test-radio"></div>
                            <span>A) Luz máxima, luz, medio tono, sombra, sombra profunda</span>
                        </div>
                        <div class="test-option" onclick="selectTestOption(5, 'B')">
                            <div class="test-radio"></div>
                            <span>B) Blanco, gris claro, gris oscuro, negro</span>
                        </div>
                        <div class="test-option" onclick="selectTestOption(5, 'C')">
                            <div class="test-radio"></div>
                            <span>C) Luz, sombra y medio tono solamente</span>
                        </div>
                    </div>

                    <div id="testResult"></div>

                    <div class="text-center mt-4">
                        <button class="btn btn-primary btn-nav" id="evaluateTestBtn" onclick="evaluateTest()" disabled>
                            <i class="bi bi-check-circle me-2"></i>Evaluar Test
                        </button>
                    </div>

                    <div class="mt-3 text-center text-muted">
                        <small>Intento ${testAttempts + 1} de 3</small>
                    </div>
                </div>
            `;
            document.getElementById('mainContent').innerHTML = content;
        }

        function selectTestOption(questionNum, option) {
            // Remover selección anterior de esta pregunta
            const questionDiv = document.querySelectorAll('.test-question')[questionNum - 1];
            questionDiv.querySelectorAll('.test-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Marcar nueva selección
            event.currentTarget.classList.add('selected');
            testAnswers[questionNum] = option;

            // Actualizar contador
            const count = Object.keys(testAnswers).length;
            document.getElementById('testCounter').textContent = `Respondidas: ${count}/5`;

            // Habilitar botón si completó las 5
            document.getElementById('evaluateTestBtn').disabled = count < 5;
        }

        async function evaluateTest() {
            const correctAnswers = {
                1: 'B',
                2: 'B',
                3: 'A',
                4: 'B',
                5: 'A'
            };

            let score = 0;
            for (let q = 1; q <= 5; q++) {
                if (testAnswers[q] === correctAnswers[q]) {
                    score++;
                }
            }

            const passed = score >= 4;
            testAttempts++;

            // Guardar en Google Sheets
            const currentUser = getCurrentUser();
            if (currentUser) {
                moduleProgress.testDiagnostico = {
                    aprobado: passed,
                    puntaje: `${score}/5`,
                    intentos: testAttempts,
                    fecha: new Date().toISOString()
                };

                await updateModuleProgress(3, moduleProgress);
                await logUserActivity('test_diagnostico', 3, 0, {
                    aprobado: passed,
                    puntaje: score,
                    intento: testAttempts
                });
            }

            // Mostrar resultado
            let resultHTML = '';
            if (passed) {
                resultHTML = `
                    <div class="test-result success">
                        <h4><i class="bi bi-check-circle-fill me-2"></i>¡Aprobado!</h4>
                        <p class="mb-2">Obtuviste ${score}/5 respuestas correctas</p>
                        <button class="btn btn-success btn-nav mt-2" onclick="iniciarModulo()">
                            <i class="bi bi-arrow-right-circle me-2"></i>Iniciar Módulo 3
                        </button>
                    </div>
                `;
            } else {
                if (testAttempts >= 3) {
                    resultHTML = `
                        <div class="test-result failure">
                            <h4><i class="bi bi-x-circle-fill me-2"></i>No Aprobado</h4>
                            <p class="mb-2">Obtuviste ${score}/5 - Mínimo requerido: 4/5</p>
                            <p class="mb-0"><strong>Has alcanzado el límite de 3 intentos.</strong><br>
                            Por favor, revisa los Módulos 1 y 2 antes de continuar.</p>
                            <a href="index.html" class="btn btn-warning btn-nav mt-3">
                                <i class="bi bi-arrow-left-circle me-2"></i>Volver a Módulos
                            </a>
                        </div>
                    `;
                } else {
                    resultHTML = `
                        <div class="test-result failure">
                            <h4><i class="bi bi-x-circle-fill me-2"></i>No Aprobado</h4>
                            <p class="mb-2">Obtuviste ${score}/5 - Mínimo requerido: 4/5</p>
                            <p class="mb-2"><strong>Respuestas correctas:</strong></p>
                            <ul class="text-start mb-0" style="list-style-position: inside;">
                                <li>Q1: B - Curva en "C" atravesando el cuerpo</li>
                                <li>Q2: B - Cabeza, torso y pelvis</li>
                                <li>Q3: A - Cadera derecha sube, hombro baja</li>
                                <li>Q4: B - Bloque rectangular + 5 cilindros</li>
                                <li>Q5: A - 5 valores tonales</li>
                            </ul>
                            <button class="btn btn-warning btn-nav mt-3" onclick="mostrarTestDiagnostico()">
                                <i class="bi bi-arrow-clockwise me-2"></i>Reintentar (${testAttempts}/3)
                            </button>
                        </div>
                    `;
                }
            }

            document.getElementById('testResult').innerHTML = resultHTML;
            document.getElementById('evaluateTestBtn').style.display = 'none';
        }

        // ===== INICIAR MÓDULO =====
        function iniciarModulo() {
            console.log('✅ Iniciando Módulo 3');
            loadLesson(1);
        }

        // ===== CARGAR LECCIONES =====
        function loadLesson(lessonNum) {
            currentLesson = lessonNum;

            // Actualizar sidebar
            document.querySelectorAll('.lesson-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-lesson') == lessonNum) {
                    link.classList.add('active');
                }
            });

            // Mostrar/ocultar botón rúbrica
            const rubricBtn = document.getElementById('rubricBtn');
            rubricBtn.style.display = lessonNum === 3 ? 'flex' : 'none';

            // Cargar contenido
            const content = getLessonContent(lessonNum);
            document.getElementById('mainContent').innerHTML = content;

            // Scroll al inicio
            window.scrollTo(0, 0);

            // Log actividad
            logUserActivity('lesson_view', 3, lessonNum);
        }

        function getLessonContent(lessonNum) {
            const lessons = {
                1: getLesson1Content(),
                2: getLesson2Content(),
                3: getLesson3Content()
            };
            return lessons[lessonNum] || '';
        }

        // ===== LECCIÓN 3.1: SÍNTESIS POR CAPAS =====
        function getLesson1Content() {
            return `
                <div class="lesson-header">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start mb-3">
                        <div class="flex-grow-1 mb-2 mb-md-0">
                            <h2 class="lesson-title">Lección 3.1: Síntesis por Capas</h2>
                            <p class="lesson-subtitle">Integración de Gesto y Anatomía</p>
                        </div>
                        <span class="badge bg-primary lesson-duration">60 minutos</span>
                    </div>
                    
                    <div class="objectives-list">
                        <h6><i class="bi bi-bullseye me-2"></i>Objetivos de Aprendizaje</h6>
                        <ul>
                            <li><strong>OA 3.1 (COMPRENDER):</strong> Explicar el proceso de construcción por capas + aprobar evaluación (2/3)</li>
                            <li><strong>OA 3.2 (APLICAR):</strong> Usar proceso en 2 figuras de 60-90 min + documentar 4 fotos cada una</li>
                        </ul>
                    </div>
                </div>

                <div class="alert alert-info alert-custom">
                    <h5><i class="bi bi-lightbulb me-2"></i>Concepto Central</h5>
                    <p class="mb-0">Integrarás <strong>gesto (Módulo 1)</strong> y <strong>anatomía (Módulo 2)</strong> en una figura completa. El proceso por capas garantiza que nunca pierdas la energía inicial del movimiento.</p>
                </div>

                <div class="accordion mt-4" id="accordionLesson1">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseL1_1">
                                <i class="bi bi-layers me-2"></i>Las 4 Capas del Proceso
                            </button>
                        </h2>
                        <div id="collapseL1_1" class="accordion-collapse collapse show" data-bs-parent="#accordionLesson1">
                            <div class="accordion-body">
                                <h6 class="text-primary">CAPA 1 - GESTO (0-10 min):</h6>
                                <ol>
                                    <li>Línea de acción visible y clara</li>
                                    <li>Punto de apoyo marcado</li>
                                    <li>Las 3 masas básicas (cabeza, torso, pelvis)</li>
                                    <li>Ejes de hombros y caderas</li>
                                    <li>Extremidades direccionales (líneas simples)</li>
                                </ol>
                                
                                <div class="alert alert-warning">
                                    <strong>NO incluir:</strong> Detalles musculares, rasgos faciales, dedos individuales
                                </div>

                                <h6 class="text-primary mt-4">CAPA 2 - ESTRUCTURA (10-30 min):</h6>
                                <ol>
                                    <li>Refinar las 3 masas como formas tridimensionales</li>
                                    <li>Marcar articulaciones principales (hombros, codos, muñecas, caderas, rodillas, tobillos)</li>
                                    <li>Identificar 6 grupos musculares esenciales</li>
                                    <li>Verificar proporciones con medición visual</li>
                                    <li>Manos y pies simplificados (bloques básicos)</li>
                                </ol>

                                <h6 class="text-primary mt-4">CAPA 3 - ANATOMÍA (30-60 min):</h6>
                                <ol>
                                    <li>Contorno continuo y limpio</li>
                                    <li>Detalles anatómicos (músculos visibles)</li>
                                    <li>Rasgos faciales básicos</li>
                                    <li>Manos y pies con estructura completa</li>
                                    <li>Refinar proporciones finales</li>
                                </ol>

                                <h6 class="text-primary mt-4">CAPA 4 - REFINAMIENTO (60-90 min):</h6>
                                <ol>
                                    <li>Línea de peso variable (gruesa/fina)</li>
                                    <li>Borrar líneas constructivas</li>
                                    <li>Detalles finales</li>
                                    <li>Verificación final de proporciones</li>
                                </ol>

                                <div class="alert alert-danger mt-3">
                                    <strong>⚠️ NUNCA saltes capas.</strong> El gesto es el alma de la figura, la anatomía es solo el traje. Sin alma, el traje está vacío.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card mt-4">
                    <h5 class="mb-3">
                        <i class="bi bi-pencil me-2"></i>EJERCICIO: 2 Figuras Completas por Capas
                    </h5>
                    <p><strong>Objetivo:</strong> Aplicar el proceso de 4 capas en dos figuras diferentes</p>
                    
                    <div class="row mt-4">
                        <div class="col-md-6 mb-3">
                            <h6>Materiales:</h6>
                            <ul>
                                <li>2 hojas tamaño carta</li>
                                <li>Lápices: HB, 2B, 4B</li>
                                <li>Goma de borrar</li>
                                <li>Cámara/celular para documentar</li>
                            </ul>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6>Referencias sugeridas:</h6>
                            <ul>
                                <li>line-of-action.com (poses de 30 min)</li>
                                <li>Fotografías de atletas</li>
                                <li>Bailarines en movimiento</li>
                            </ul>
                        </div>
                    </div>

                    <div class="mt-3">
                        <h6>Proceso por figura (60-90 min cada una):</h6>
                        <div class="alert alert-info">
                            <p class="mb-2"><strong>📸 DOCUMENTACIÓN REQUERIDA:</strong></p>
                            <p class="mb-0">Toma 1 foto después de completar cada capa (4 fotos por figura = 8 fotos totales)</p>
                        </div>
                    </div>
                </div>

                ${getEvaluation1()}
            `;
        }

        // ===== LECCIÓN 3.2: LUZ, SOMBRA Y VOLUMEN =====
        function getLesson2Content() {
            return `
                <div class="lesson-header">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start mb-3">
                        <div class="flex-grow-1 mb-2 mb-md-0">
                            <h2 class="lesson-title">Lección 3.2: Luz, Sombra y Volumen</h2>
                            <p class="lesson-subtitle">Aplicación de Valores Tonales</p>
                        </div>
                        <span class="badge bg-warning text-dark lesson-duration">90 minutos</span>
                    </div>
                    
                    <div class="objectives-list">
                        <h6><i class="bi bi-bullseye me-2"></i>Objetivos de Aprendizaje</h6>
                        <ul>
                            <li><strong>OA 3.3 (COMPRENDER):</strong> Explicar los 5 valores tonales y su función + aprobar evaluación (2/3)</li>
                            <li><strong>OA 3.4 (APLICAR):</strong> Desarrollar 1 figura de 90 min con 5 valores + fuente de luz coherente</li>
                        </ul>
                    </div>
                </div>

                <div class="alert alert-info alert-custom">
                    <h5><i class="bi bi-sun me-2"></i>Concepto Central</h5>
                    <p class="mb-0">Los valores tonales transforman un dibujo plano en una forma tridimensional. La fuente de luz determina dónde aplicar cada uno de los 5 valores.</p>
                </div>

                <div class="accordion mt-4" id="accordionLesson2">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseL2_1">
                                <i class="bi bi-palette me-2"></i>Los 5 Valores Tonales
                            </button>
                        </h2>
                        <div id="collapseL2_1" class="accordion-collapse collapse show" data-bs-parent="#accordionLesson2">
                            <div class="accordion-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="text-primary">1. LUZ MÁXIMA</h6>
                                                <ul class="text-sm mb-0">
                                                    <li>Blanco del papel</li>
                                                    <li>Recibe luz directa</li>
                                                    <li>Punto más brillante</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="text-primary">2. LUZ</h6>
                                                <ul class="text-sm mb-0">
                                                    <li>Gris muy claro</li>
                                                    <li>Iluminado pero no directo</li>
                                                    <li>Transición suave</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="text-primary">3. MEDIO TONO</h6>
                                                <ul class="text-sm mb-0">
                                                    <li>Gris medio</li>
                                                    <li>Transición luz-sombra</li>
                                                    <li>Mayor área del cuerpo</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="text-primary">4. SOMBRA</h6>
                                                <ul class="text-sm mb-0">
                                                    <li>Gris oscuro</li>
                                                    <li>No recibe luz directa</li>
                                                    <li>Opuesta a fuente</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12 mb-3">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="text-primary">5. SOMBRA PROFUNDA</h6>
                                                <ul class="text-sm mb-0">
                                                    <li>Negro intenso</li>
                                                    <li>Pliegues y cavidades</li>
                                                    <li>Sombra proyectada</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="alert alert-success mt-3">
                                    <strong>Regla clave:</strong> Imagina el cuerpo como esferas y cilindros. La luz los envuelve gradualmente.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseL2_2">
                                <i class="bi bi-lightbulb me-2"></i>Fuente de Luz
                            </button>
                        </h2>
                        <div id="collapseL2_2" class="accordion-collapse collapse" data-bs-parent="#accordionLesson2">
                            <div class="accordion-body">
                                <p>La dirección de la luz determina dónde aplicar cada valor:</p>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="text-primary">LUZ FRONTAL:</h6>
                                                <ul class="text-sm mb-0">
                                                    <li>Desde el observador</li>
                                                    <li>Poco contraste</li>
                                                    <li>Menos volumen aparente</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="text-primary">LUZ LATERAL:</h6>
                                                <ul class="text-sm mb-0">
                                                    <li>Desde un lado</li>
                                                    <li>Máximo contraste</li>
                                                    <li>Mejor para volumen</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="alert alert-warning">
                                    <strong>Importante:</strong> Elige UNA fuente de luz y mantén consistencia en toda la figura.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card mt-4">
                    <h5 class="mb-3">
                        <i class="bi bi-palette me-2"></i>EJERCICIO: 1 Figura con Valores Tonales
                    </h5>
                    <p><strong>Objetivo:</strong> Aplicar los 5 valores tonales con fuente de luz coherente</p>
                    
                    <div class="row mt-4">
                        <div class="col-md-6 mb-3">
                            <h6>Materiales:</h6>
                            <ul>
                                <li>1 hoja tamaño carta</li>
                                <li>Lápices: HB, 2B, 4B, 6B</li>
                                <li>Goma y difumino</li>
                            </ul>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6>Proceso (90 min):</h6>
                            <ol>
                                <li>0-30 min: Capas 1 y 2 (gesto + estructura)</li>
                                <li>30-40 min: Dividir zonas luz/sombra</li>
                                <li>40-90 min: Aplicar 5 valores progresivamente</li>
                            </ol>
                        </div>
                    </div>

                    <div class="alert alert-danger mt-3">
                        <strong>⚠️ SIEMPRE estructura PRIMERO, valores DESPUÉS.</strong> Nunca comiences con sombras sin tener la forma correcta.
                    </div>
                </div>

                ${getEvaluation2()}
            `;
        }

        // ===== LECCIÓN 3.3: PROYECTO FINAL =====
        function getLesson3Content() {
            return `
                <div class="lesson-header">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start mb-3">
                        <div class="flex-grow-1 mb-2 mb-md-0">
                            <h2 class="lesson-title">Lección 3.3: Proyecto Final</h2>
                            <p class="lesson-subtitle">Dibujo Completo - Integración Total</p>
                        </div>
                        <span class="badge bg-danger text-white lesson-duration">2-3 horas</span>
                    </div>
                    
                    <div class="objectives-list">
                        <h6><i class="bi bi-bullseye me-2"></i>Objetivos de Aprendizaje</h6>
                        <ul>
                            <li><strong>OA 3.5 (EVALUAR):</strong> Autoevaluar con rúbrica identificando puntaje en 6 criterios</li>
                            <li><strong>OA 3.6 (CREAR):</strong> Producir proyecto final 1/4 mercurio ≥60/100 pts según rúbrica</li>
                        </ul>
                    </div>
                </div>

                <div class="alert alert-info alert-custom">
                    <h5><i class="bi bi-trophy me-2"></i>Tu Proyecto Final</h5>
                    <p class="mb-0">Este es tu proyecto final. Aplica todo lo aprendido en los 3 módulos: gesto, anatomía y valores tonales. Demuestra tu dominio técnico en una sola pieza.</p>
                </div>

                <div class="card border-primary mt-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-clipboard-check me-2"></i>Requisitos del Proyecto</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <h6 class="text-primary">Formato y Materiales:</h6>
                                <ul>
                                    <li><strong>Formato:</strong> 1/4 mercurio (27.5 × 37.5 cm)</li>
                                    <li><strong>Lápices:</strong> HB, 2B, 4B, 6B</li>
                                    <li><strong>Papel:</strong> Blanco, lisa o texturada</li>
                                    <li><strong>Herramientas:</strong> Goma, difumino opcional</li>
                                </ul>
                            </div>
                            <div class="col-md-6 mb-3">
                                <h6 class="text-primary">Requisitos Técnicos:</h6>
                                <ul>
                                    <li>✓ Línea de acción visible</li>
                                    <li>✓ Proporciones ≥70% precisas</li>
                                    <li>✓ 3 masas diferenciadas + grupos musculares</li>
                                    <li>✓ Manos y pies estructurados</li>
                                    <li>✓ Mínimo 3 valores tonales</li>
                                    <li>✓ Composición balanceada</li>
                                </ul>
                            </div>
                        </div>

                        <div class="alert alert-warning mt-3 mb-0">
                            <strong>Puntaje mínimo:</strong> 60/100 puntos para aprobar. Usa el botón flotante para ver la rúbrica completa.
                        </div>
                    </div>
                </div>

                <div class="accordion mt-4" id="accordionLesson3">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseL3_1">
                                <i class="bi bi-list-check me-2"></i>Proceso Sugerido
                            </button>
                        </h2>
                        <div id="collapseL3_1" class="accordion-collapse collapse show" data-bs-parent="#accordionLesson3">
                            <div class="accordion-body">
                                <h6 class="text-primary">FASE 1: PLANIFICACIÓN (30 min)</h6>
                                <ol>
                                    <li>Buscar referencias de calidad (3-5 opciones)</li>
                                    <li>Hacer sketches preliminares rápidos (5 min cada uno)</li>
                                    <li>Elegir el mejor sketch para desarrollar</li>
                                    <li>Verificar composición en el formato</li>
                                </ol>

                                <h6 class="text-primary mt-4">FASE 2: CONSTRUCCIÓN (90-120 min)</h6>
                                <ol>
                                    <li><strong>Capa 1 - Gesto:</strong> Línea de acción + masas básicas</li>
                                    <li><strong>Capa 2 - Estructura:</strong> Articulaciones + proporciones</li>
                                    <li><strong>Capa 3 - Anatomía:</strong> Grupos musculares + extremidades</li>
                                    <li><strong>Capa 4 - Refinamiento:</strong> Contorno limpio + detalles</li>
                                </ol>

                                <h6 class="text-primary mt-4">FASE 3: VALORES (30-60 min)</h6>
                                <ol>
                                    <li>Identificar fuente de luz</li>
                                    <li>Dividir zonas luz/sombra</li>
                                    <li>Aplicar 5 valores progresivamente</li>
                                    <li>Unificar y suavizar transiciones</li>
                                </ol>

                                <h6 class="text-primary mt-4">FASE 4: AUTOEVALUACIÓN</h6>
                                <ol>
                                    <li>Usar rúbrica para evaluar cada criterio</li>
                                    <li>Identificar áreas de mejora</li>
                                    <li>Hacer ajustes finales si es necesario</li>
                                    <li>Fotografiar resultado final</li>
                                </ol>

                                <div class="alert alert-success mt-3">
                                    <i class="bi bi-lightbulb me-2"></i>
                                    <strong>Tip:</strong> No tengas miedo de hacer múltiples intentos. La práctica es la única forma de mejorar.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseL3_2">
                                <i class="bi bi-exclamation-triangle me-2"></i>Errores Comunes a Evitar
                            </button>
                        </h2>
                        <div id="collapseL3_2" class="accordion-collapse collapse" data-bs-parent="#accordionLesson3">
                            <div class="accordion-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <div class="card border-danger">
                                            <div class="card-header bg-danger text-white">
                                                <strong>❌ NO HACER</strong>
                                            </div>
                                            <div class="card-body">
                                                <ul class="mb-0">
                                                    <li>Saltar la línea de acción</li>
                                                    <li>Comenzar con detalles</li>
                                                    <li>Ignorar proporciones</li>
                                                    <li>Aplicar valores antes de estructura</li>
                                                    <li>Usar múltiples fuentes de luz</li>
                                                    <li>Borrar excesivamente</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="card border-success">
                                            <div class="card-header bg-success text-white">
                                                <strong>✓ SÍ HACER</strong>
                                            </div>
                                            <div class="card-body">
                                                <ul class="mb-0">
                                                    <li>Seguir proceso por capas</li>
                                                    <li>Verificar proporciones constantemente</li>
                                                    <li>Mantener línea de acción visible</li>
                                                    <li>Construir de general a específico</li>
                                                    <li>Usar una sola fuente de luz</li>
                                                    <li>Planificar antes de ejecutar</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card border-primary mt-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-cloud-upload me-2"></i>Entrega del Proyecto</h5>
                    </div>
                    <div class="card-body text-center">
                        <p class="mb-3">Una vez completado tu proyecto final, fotografíalo y súbelo junto con tus otros trabajos del módulo:</p>
                        <a href="https://forms.gle/TU_URL_AQUI" class="btn btn-success btn-nav" target="_blank">
                            <i class="bi bi-box-arrow-up-right me-2"></i>Subir Proyecto Final
                        </a>
                        <p class="text-muted mt-3 mb-0 small">Recuerda autoevaluarte con la rúbrica antes de enviar</p>
                    </div>
                </div>

                ${getEvaluation3()}

                <div id="congratsMessage" style="display: none;">
                    <div class="alert alert-success alert-custom mt-4">
                        <h4><i class="bi bi-trophy-fill me-2"></i>¡Felicitaciones!</h4>
                        <p class="mb-2">Has completado exitosamente el curso DIADIFO.</p>
                        <p class="mb-0">Has creado 24 dibujos y dominado la representación del cuerpo humano. Estás listo para enseñar esto a tus futuros estudiantes.</p>
                    </div>
                </div>
            `;
        }

        // ===== EVALUACIONES =====
        function getEvaluation1() {
            return `
                <div class="eval-container mt-4">
                    <h5 class="mb-3">
                        <i class="bi bi-clipboard-check me-2"></i>Evaluación Formativa 3.1
                    </h5>
                    <p class="mb-4">Responde las siguientes preguntas. Necesitas 2/3 correctas para aprobar.</p>

                    <div class="eval-question">
                        <h6 class="mb-3">1. ¿Cuál es el orden correcto del proceso por capas?</h6>
                        <div class="eval-option" onclick="selectEvalOption(this, 1, 'A', 1)">
                            <div class="eval-radio"></div>
                            <span>A) Anatomía → Gesto → Estructura → Refinamiento</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 1, 'B', 1)">
                            <div class="eval-radio"></div>
                            <span>B) Gesto → Estructura → Anatomía → Refinamiento</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 1, 'C', 1)">
                            <div class="eval-radio"></div>
                            <span>C) Estructura → Anatomía → Gesto → Refinamiento</span>
                        </div>
                    </div>

                    <div class="eval-question">
                        <h6 class="mb-3">2. ¿Por qué NO debes saltar capas en el proceso?</h6>
                        <div class="eval-option" onclick="selectEvalOption(this, 2, 'A', 1)">
                            <div class="eval-radio"></div>
                            <span>A) Porque pierdes tiempo</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 2, 'B', 1)">
                            <div class="eval-radio"></div>
                            <span>B) Porque el gesto es el alma y debe ir primero</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 2, 'C', 1)">
                            <div class="eval-radio"></div>
                            <span>C) Porque es una regla arbitraria</span>
                        </div>
                    </div>

                    <div class="eval-question">
                        <h6 class="mb-3">3. ¿Cuántas fotografías debes documentar por figura?</h6>
                        <div class="eval-option" onclick="selectEvalOption(this, 3, 'A', 1)">
                            <div class="eval-radio"></div>
                            <span>A) 2 fotos (inicio y fin)</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 3, 'B', 1)">
                            <div class="eval-radio"></div>
                            <span>B) 4 fotos (una por cada capa)</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 3, 'C', 1)">
                            <div class="eval-radio"></div>
                            <span>C) Solo la versión final</span>
                        </div>
                    </div>

                    <div id="evalResult1" class="mt-3"></div>

                    <div class="text-center mt-4">
                        <button class="btn btn-primary btn-nav" id="submitEval1" onclick="submitEvaluation(1)">
                            <i class="bi bi-check-circle me-2"></i>Enviar Evaluación
                        </button>
                    </div>
                </div>
            `;
        }

        function getEvaluation2() {
            return `
                <div class="eval-container mt-4">
                    <h5 class="mb-3">
                        <i class="bi bi-clipboard-check me-2"></i>Evaluación Formativa 3.2
                    </h5>
                    <p class="mb-4">Responde las siguientes preguntas. Necesitas 2/3 correctas para aprobar.</p>

                    <div class="eval-question">
                        <h6 class="mb-3">1. ¿Cuántos valores tonales básicos existen?</h6>
                        <div class="eval-option" onclick="selectEvalOption(this, 1, 'A', 2)">
                            <div class="eval-radio"></div>
                            <span>A) 3 (luz, medio, sombra)</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 1, 'B', 2)">
                            <div class="eval-radio"></div>
                            <span>B) 5 (luz máxima, luz, medio, sombra, profunda)</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 1, 'C', 2)">
                            <div class="eval-radio"></div>
                            <span>C) 7 (escala completa)</span>
                        </div>
                    </div>

                    <div class="eval-question">
                        <h6 class="mb-3">2. La fuente de luz determina:</h6>
                        <div class="eval-option" onclick="selectEvalOption(this, 2, 'A', 2)">
                            <div class="eval-radio"></div>
                            <span>A) Solo dónde va la sombra</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 2, 'B', 2)">
                            <div class="eval-radio"></div>
                            <span>B) Dónde aplicar cada uno de los 5 valores</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 2, 'C', 2)">
                            <div class="eval-radio"></div>
                            <span>C) El color del dibujo</span>
                        </div>
                    </div>

                    <div class="eval-question">
                        <h6 class="mb-3">3. El medio tono es:</h6>
                        <div class="eval-option" onclick="selectEvalOption(this, 3, 'A', 2)">
                            <div class="eval-radio"></div>
                            <span>A) El valor más oscuro</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 3, 'B', 2)">
                            <div class="eval-radio"></div>
                            <span>B) La transición entre luz y sombra</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 3, 'C', 2)">
                            <div class="eval-radio"></div>
                            <span>C) El blanco del papel</span>
                        </div>
                    </div>

                    <div id="evalResult2" class="mt-3"></div>

                    <div class="text-center mt-4">
                        <button class="btn btn-primary btn-nav" id="submitEval2" onclick="submitEvaluation(2)">
                            <i class="bi bi-check-circle me-2"></i>Enviar Evaluación
                        </button>
                    </div>
                </div>
            `;
        }

        function getEvaluation3() {
            return `
                <div class="eval-container mt-4">
                    <h5 class="mb-3">
                        <i class="bi bi-clipboard-check me-2"></i>Evaluación Formativa 3.3
                    </h5>
                    <p class="mb-4">Responde las siguientes preguntas. Necesitas 2/3 correctas para aprobar.</p>

                    <div class="eval-question">
                        <h6 class="mb-3">1. El formato del proyecto final es:</h6>
                        <div class="eval-option" onclick="selectEvalOption(this, 1, 'A', 3)">
                            <div class="eval-radio"></div>
                            <span>A) Hoja carta</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 1, 'B', 3)">
                            <div class="eval-radio"></div>
                            <span>B) 1/4 mercurio (27.5 × 37.5 cm)</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 1, 'C', 3)">
                            <div class="eval-radio"></div>
                            <span>C) Tamaño libre</span>
                        </div>
                    </div>

                    <div class="eval-question">
                        <h6 class="mb-3">2. ¿Cuál es el puntaje mínimo para aprobar?</h6>
                        <div class="eval-option" onclick="selectEvalOption(this, 2, 'A', 3)">
                            <div class="eval-radio"></div>
                            <span>A) 50/100 puntos</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 2, 'B', 3)">
                            <div class="eval-radio"></div>
                            <span>B) 60/100 puntos</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 2, 'C', 3)">
                            <div class="eval-radio"></div>
                            <span>C) 70/100 puntos</span>
                        </div>
                    </div>

                    <div class="eval-question">
                        <h6 class="mb-3">3. Si repruebas el proyecto (&lt;60pts), debes:</h6>
                        <div class="eval-option" onclick="selectEvalOption(this, 3, 'A', 3)">
                            <div class="eval-radio"></div>
                            <span>A) Abandonar el curso</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 3, 'B', 3)">
                            <div class="eval-radio"></div>
                            <span>B) Crear un NUEVO proyecto completo</span>
                        </div>
                        <div class="eval-option" onclick="selectEvalOption(this, 3, 'C', 3)">
                            <div class="eval-radio"></div>
                            <span>C) Solo corregir detalles</span>
                        </div>
                    </div>

                    <div id="evalResult3" class="mt-3"></div>

                    <div class="text-center mt-4">
                        <button class="btn btn-primary btn-nav" id="submitEval3" onclick="submitEvaluation(3)">
                            <i class="bi bi-check-circle me-2"></i>Enviar Evaluación
                        </button>
                    </div>
                </div>
            `;
        }

        // ===== EVALUACIÓN LOGIC =====
        const evalAnswers = {
            1: { 1: 'B', 2: 'B', 3: 'B' },
            2: { 1: 'B', 2: 'B', 3: 'B' },
            3: { 1: 'B', 2: 'B', 3: 'B' }
        };

        let currentEvalAnswers = {};

        function selectEvalOption(element, questionNum, option, lessonNum) {
            // Remover selección previa
            const parent = element.closest('.eval-question');
            parent.querySelectorAll('.eval-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Seleccionar nueva opción
            element.classList.add('selected');
            
            if (!currentEvalAnswers[lessonNum]) {
                currentEvalAnswers[lessonNum] = {};
            }
            currentEvalAnswers[lessonNum][questionNum] = option;
        }

        async function submitEvaluation(lessonNum) {
            const answers = currentEvalAnswers[lessonNum] || {};
            const correctAnswers = evalAnswers[lessonNum];

            if (Object.keys(answers).length < 3) {
                alert('Por favor responde todas las preguntas antes de enviar.');
                return;
            }

            let score = 0;
            for (let q = 1; q <= 3; q++) {
                if (answers[q] === correctAnswers[q]) {
                    score++;
                }
            }

            const passed = score >= 2;
            const resultDiv = document.getElementById(`evalResult${lessonNum}`);

            if (passed) {
                resultDiv.innerHTML = `
                    <div class="alert alert-success">
                        <h5><i class="bi bi-check-circle-fill me-2"></i>¡Aprobaste!</h5>
                        <p class="mb-0">${score}/3 respuestas correctas</p>
                    </div>
                `;

                // Marcar lección como completada
                if (!moduleProgress.completedLessons.includes(lessonNum)) {
                    moduleProgress.completedLessons.push(lessonNum);
                }

                // Guardar evaluación
                moduleProgress.evaluations[`lesson${lessonNum}`] = {
                    score: score,
                    passed: true,
                    date: new Date().toISOString()
                };

                // Guardar progreso
                await updateModuleProgress(3, moduleProgress);
                await logUserActivity('evaluation_submitted', 3, lessonNum, { score, passed });
                
                updateProgressBar();

                // Auto-avance después de 3 segundos
                setTimeout(() => {
                    if (lessonNum < 3) {
                        loadLesson(lessonNum + 1);
                    } else {
                        // Mostrar mensaje de felicitaciones
                        document.getElementById('congratsMessage').style.display = 'block';
                        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                    }
                }, 3000);

            } else {
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h5><i class="bi bi-x-circle-fill me-2"></i>No Aprobado</h5>
                        <p class="mb-2">${score}/3 correctas - Mínimo requerido: 2/3</p>
                        <p class="mb-0"><strong>Respuestas correctas:</strong> Todas las opciones B son correctas en esta evaluación.</p>
                    </div>
                `;
            }

            document.getElementById(`submitEval${lessonNum}`).style.display = 'none';
        }

        // ===== PROGRESS BAR =====
        function updateProgressBar() {
            const completed = moduleProgress.completedLessons.length;
            const percentage = (completed / 3) * 100;
            
            const progressBar = document.getElementById('progressBar');
            const progressDetail = document.getElementById('progressDetail');
            
            if (progressBar) {
                progressBar.style.width = percentage + '%';
                progressBar.textContent = Math.round(percentage) + '%';
            }
            
            if (progressDetail) {
                progressDetail.textContent = `${completed} de 3 lecciones completadas`;
            }
        }

        // ===== CHAT FUNCTIONS =====
        function toggleChat() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.classList.toggle('show');
        }

        function handleChatEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message === '') return;

            const messagesDiv = document.getElementById('chatMessages');
            
            // Mensaje del usuario
            const userMsg = document.createElement('div');
            userMsg.className = 'chat-message';
            userMsg.innerHTML = `<p><strong>Tú:</strong> ${message}</p>`;
            messagesDiv.appendChild(userMsg);

            // Respuesta del mentor
            setTimeout(() => {
                const mentorMsg = document.createElement('div');
                mentorMsg.className = 'chat-message';
                mentorMsg.innerHTML = `<p><strong>🎨 Mentor:</strong> ${getMentorResponse(message)}</p>`;
                messagesDiv.appendChild(mentorMsg);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, 500);

            input.value = '';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function getMentorResponse(message) {
            const msg = message.toLowerCase();
            
            if (msg.includes('gesto') || msg.includes('linea de accion') || msg.includes('línea')) {
                return 'La línea de acción es el alma de tu dibujo. Debe capturar la energía y dirección del movimiento. ¡Nunca la pierdas en el proceso!';
            }
            if (msg.includes('masa') || msg.includes('anatomia') || msg.includes('anatomía')) {
                return 'Las 3 masas corporales (cabeza, torso, pelvis) son la base de cualquier figura. Piensa en ellas como formas tridimensionales que se conectan.';
            }
            if (msg.includes('valor') || msg.includes('sombra') || msg.includes('luz')) {
                return 'Los 5 valores tonales transforman tu dibujo plano en volumen. Recuerda: estructura PRIMERO, valores DESPUÉS.';
            }
            if (msg.includes('proporc') || msg.includes('medic')) {
                return 'Las proporciones correctas son esenciales. Usa tu lápiz como regla y verifica constantemente durante todo el proceso.';
            }
            if (msg.includes('capa')) {
                return 'El proceso por capas garantiza que construyas correctamente: Gesto → Estructura → Anatomía → Refinamiento. ¡Nunca saltes pasos!';
            }
            if (msg.includes('glosario')) {
                showGlossary();
                return 'He abierto el glosario completo con todos los términos del curso. ¡Revísalo cuando lo necesites!';
            }
            
            return 'Interesante pregunta. Te recomiendo revisar el glosario completo para más detalles sobre los conceptos del curso.';
        }

        // ===== MODAL FUNCTIONS =====
        function showGlossary() {
            document.getElementById('glossaryModal').classList.add('show');
        }

        function closeGlossary() {
            document.getElementById('glossaryModal').classList.remove('show');
        }

        function closeGlossaryOnOutside(event) {
            if (event.target.id === 'glossaryModal') {
                closeGlossary();
            }
        }

        function showRubric() {
            document.getElementById('rubricModal').classList.add('show');
        }

        function closeRubric() {
            document.getElementById('rubricModal').classList.remove('show');
        }

        function closeRubricOnOutside(event) {
            if (event.target.id === 'rubricModal') {
                closeRubric();
            }
        }

        // ===== INICIALIZAR AL CARGAR =====
        window.addEventListener('DOMContentLoaded', initializeModule);
    </script>
</body>
</html>
