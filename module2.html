<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulo 2: Anatomía Funcional - LMS UAH</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        :root {
            --primary-dark: #2c5f66;
            --primary-light: #e8a2b8;
            --dark: #1a1a1a;
            --success: #4CAF50;
            --warning: #FFC107;
            --danger: #f44336;
            --info: #2196F3;
        }

        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
        }

        .header-uah {
            background: linear-gradient(135deg, var(--primary-dark), var(--dark));
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1030;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .breadcrumb-custom {
            background: white;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .sidebar-lesson {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        @media (min-width: 992px) {
            .sidebar-lesson {
                position: sticky;
                top: 90px;
                max-height: calc(100vh - 110px);
                overflow-y: auto;
            }
        }

        .lesson-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            border-radius: 8px;
            text-decoration: none;
            color: var(--dark);
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 0.5rem;
            border: 2px solid transparent;
        }

        .lesson-link:hover {
            background: #f8f9fa;
            transform: translateX(3px);
            border-color: var(--primary-light);
        }

        .lesson-link.active {
            background: linear-gradient(135deg, var(--primary-dark), var(--dark));
            color: white;
            border-color: var(--primary-dark);
        }

        .lesson-link.completed {
            background: #e8f5e9;
            border-color: var(--success);
        }

        .lesson-link.completed .lesson-number {
            background: var(--success);
            color: white;
        }

        .lesson-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: #e0e0e0;
            color: var(--dark);
            border-radius: 50%;
            font-weight: 600;
            flex-shrink: 0;
        }

        .lesson-link.active .lesson-number {
            background: white;
            color: var(--primary-dark);
        }

        .progress-module {
            background: #e0e0e0;
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
        }

        .progress-bar-module {
            background: linear-gradient(90deg, var(--success), #66BB6A);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .content-area {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .lesson-header {
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
        }

        .lesson-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
        }

        .lesson-subtitle {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 0;
        }

        .lesson-duration {
            font-size: 0.85rem;
            padding: 0.5rem 1rem;
        }

        .objectives-list {
            background: #f0f7ff;
            border-left: 4px solid var(--info);
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
        }

        .objectives-list ul {
            margin: 0.5rem 0 0 0;
            padding-left: 1.25rem;
        }

        .video-container {
            margin: 1.5rem 0;
        }

        .video-placeholder {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            aspect-ratio: 16/9;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
        }

        .reference-image {
            background: #f5f5f5;
            border: 2px dashed #ccc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 1rem;
            color: #999;
        }

        .exercise-card {
            background: #fff9e6;
            border-left: 4px solid var(--warning);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .checklist {
            background: white;
            border-radius: 8px;
            padding: 1rem;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .checklist-item:hover {
            background: #f5f5f5;
        }

        .checklist-item i {
            font-size: 1.25rem;
            transition: all 0.3s;
        }

        .checklist-item.completed i {
            color: var(--success);
        }

        .evaluation-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .eval-progress {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .eval-question {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .eval-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .eval-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .eval-option:hover {
            border-color: var(--primary-light);
            background: #f8f9fa;
        }

        .eval-option.selected {
            border-color: var(--primary-dark);
            background: #e8f5e9;
        }

        .eval-option.correct {
            border-color: var(--success);
            background: #e8f5e9;
        }

        .eval-option.incorrect {
            border-color: var(--danger);
            background: #ffebee;
        }

        .eval-radio {
            width: 20px;
            height: 20px;
            border: 2px solid #ccc;
            border-radius: 50%;
            flex-shrink: 0;
            transition: all 0.3s;
        }

        .eval-option.selected .eval-radio {
            border-color: var(--primary-dark);
            background: var(--primary-dark);
            box-shadow: inset 0 0 0 3px white;
        }

        .btn-nav {
            padding: 0.75rem 2rem;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .btn-primary-custom {
            background: linear-gradient(135deg, var(--primary-dark), var(--dark));
            border: none;
            color: white;
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn-secondary-custom {
            background: #6c757d;
            border: none;
            color: white;
        }

        .alert-custom {
            border-radius: 12px;
            border: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        @keyframes slideOut {
            from { transform: translateX(0); }
            to { transform: translateX(100%); }
        }

        .fade-in { animation: fadeIn 0.5s ease-out; }

        .sidebar-lesson::-webkit-scrollbar { width: 6px; }
        .sidebar-lesson::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .sidebar-lesson::-webkit-scrollbar-thumb { background: var(--primary-dark); border-radius: 10px; }

        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="text-center">
            <div class="spinner-border text-light" style="width: 3rem; height: 3rem;"></div>
            <p class="text-white mt-3">Cargando contenido...</p>
        </div>
    </div>

    <header class="header-uah">
        <div class="container-fluid">
            <div class="row align-items-center g-2">
                <div class="col-auto">
                    <a href="index.html" class="text-white text-decoration-none">
                        <i class="bi bi-arrow-left me-2"></i>
                        <span class="d-none d-md-inline">Volver</span>
                    </a>
                </div>
                <div class="col text-center">
                    <h1 class="h5 mb-0">Módulo 2: Anatomía Funcional</h1>
                </div>
                <div class="col-auto">
                    <span class="badge bg-light text-dark" id="progressText">0%</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container-fluid py-3 py-md-4">
        <div class="breadcrumb-custom d-none d-md-block">
            <nav>
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a href="index.html">Inicio</a></li>
                    <li class="breadcrumb-item">Módulo 2</li>
                    <li class="breadcrumb-item active" id="breadcrumbLesson">Lección 1</li>
                </ol>
            </nav>
        </div>

        <div class="row">
            <aside class="col-lg-3">
                <div class="sidebar-lesson">
                    <h5 class="mb-3"><i class="bi bi-book me-2"></i>Lecciones</h5>
                    
                    <a class="lesson-link active" data-lesson="1" onclick="loadLesson(1)">
                        <span class="lesson-number">1</span>
                        <span class="flex-grow-1">Estructura Ósea</span>
                    </a>
                    
                    <a class="lesson-link" data-lesson="2" onclick="loadLesson(2)">
                        <span class="lesson-number">2</span>
                        <span class="flex-grow-1">Músculos Superficiales</span>
                    </a>
                    
                    <a class="lesson-link" data-lesson="3" onclick="loadLesson(3)">
                        <span class="lesson-number">3</span>
                        <span class="flex-grow-1">Extremidades</span>
                    </a>
                    
                    <a class="lesson-link" data-lesson="4" onclick="loadLesson(4)">
                        <span class="lesson-number">4</span>
                        <span class="flex-grow-1">Rostro</span>
                    </a>
                    
                    <div class="mt-4">
                        <h6 class="mb-2">Progreso del Módulo</h6>
                        <div class="progress-module">
                            <div class="progress-bar-module" id="progressBar" style="width: 0%"></div>
                        </div>
                        <small class="text-muted d-block mt-2" id="progressDetail">0 de 4 lecciones completadas</small>
                    </div>

                    <div class="card border-primary mt-3">
                        <div class="card-header bg-primary text-white">
                            <i class="bi bi-info-circle me-2"></i>Información del Módulo
                        </div>
                        <div class="card-body">
                            <p class="small mb-2"><strong>Duración:</strong> 4 días</p>
                            <p class="small mb-2"><strong>Carga:</strong> 200 min</p>
                            <p class="small mb-0"><strong>Entregables:</strong></p>
                            <ul class="small mb-0 mt-2">
                                <li>3 figuras esqueléticas</li>
                                <li>2 figuras musculares</li>
                                <li>3 manos + 2 pies</li>
                                <li>2 rostros</li>
                                <li>4 evaluaciones aprobadas</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card border-success mt-3">
                        <div class="card-header bg-success text-white">
                            <i class="bi bi-cloud-upload me-2"></i>Entrega
                        </div>
                        <div class="card-body text-center">
                            <a href="https://forms.gle/URL_FORMULARIO_M2" class="btn btn-success btn-sm w-100" target="_blank">
                                <i class="bi bi-box-arrow-up-right me-2"></i>Subir Trabajos
                            </a>
                        </div>
                    </div>
                </div>
            </aside>

            <main class="col-lg-9">
                <div class="content-area" id="lessonContent"></div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="auth.js"></script>
    
    <script>
        // ===== VARIABLES GLOBALES =====
        let currentLesson = 1;
        let evaluationAnswers = {};
        let completedLessons = [];
        let moduleStartTime = Date.now();
        let lessonStartTime = Date.now();

        const MODULE_NUMBER = 2;
        const TOTAL_LESSONS = 4;
        const DEBUG_MODE = true;

        function debugLog(message, data = null) {
            if (DEBUG_MODE) {
                console.log(`🔍 [M${MODULE_NUMBER}] ${message}`);
                if (data) console.log(data);
            }
        }

        // ===== FUNCIÓN DE PERSISTENCIA =====
        async function loadProgress() {
            debugLog('loadProgress() INICIADO - ESPERANDO SYNC...');
            
            const currentUser = getCurrentUser();
            if (!currentUser) {
                debugLog('❌ No hay usuario, cancelando loadProgress');
                return;
            }

            if (window.isSyncInProgress) {
                debugLog('⏳ Sync en progreso, esperando...');
                let waitTime = 0;
                while (window.isSyncInProgress && waitTime < 10000) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    waitTime += 500;
                }
                debugLog('✅ Sync completado, continuando loadProgress');
            }

            const storageKey = `progress_${currentUser.username}`;
            const saved = localStorage.getItem(storageKey);
            
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    
                    if (data.modules && data.modules[MODULE_NUMBER]) {
                        const moduleData = data.modules[MODULE_NUMBER];
                        
                        completedLessons = Array.isArray(moduleData.completedLessons) ? 
                            moduleData.completedLessons : [];
                        
                        evaluationAnswers = moduleData.evaluations || {};
                        currentLesson = moduleData.currentLesson || 1;
                        
                        debugLog('✅ Progreso cargado:', { completedLessons, evaluations: Object.keys(evaluationAnswers).length });
                    } else {
                        debugLog('⚠️ No hay datos del módulo 2, inicializando...');
                        completedLessons = [];
                        evaluationAnswers = {};
                        currentLesson = 1;
                    }
                } catch (error) {
                    console.error('❌ Error parseando progreso:', error);
                    completedLessons = [];
                    evaluationAnswers = {};
                    currentLesson = 1;
                }
            } else {
                debugLog('ℹ️ No hay progreso guardado');
                completedLessons = [];
                evaluationAnswers = {};
                currentLesson = 1;
            }
            
            updateProgressBar();
            debugLog('✅ loadProgress() COMPLETADO');
        }

        async function saveProgress() {
            debugLog('saveProgress() INICIADO');
            
            if (window.isSyncInProgress) {
                debugLog('⏳ Sync en progreso, posponiendo guardado...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                if (window.isSyncInProgress) {
                    debugLog('⚠️ Sync sigue en progreso, guardando solo en localStorage');
                    return saveProgressLocalOnly();
                }
            }
            
            const currentUser = getCurrentUser();
            if (!currentUser) {
                console.warn('❌ No hay usuario');
                return;
            }

            if (!Array.isArray(completedLessons)) {
                console.warn('⚠️ completedLessons no es array, corrigiendo...');
                completedLessons = [];
            }

            const timeSpent = Math.round((Date.now() - moduleStartTime) / 60000);
            const progress = Math.round((completedLessons.length / TOTAL_LESSONS) * 100);
            const isCompleted = completedLessons.length === TOTAL_LESSONS;

            const progressData = {
                completed: isCompleted,
                progress,
                timeSpent,
                completedLessons,
                evaluations: evaluationAnswers,
                lastUpdate: new Date().toISOString()
            };

            const storageKey = `progress_${currentUser.username}`;

            try {
                const allProgress = JSON.parse(localStorage.getItem(storageKey) || '{}');
                if (!allProgress.modules) allProgress.modules = {};
                allProgress.modules[MODULE_NUMBER] = progressData;
                allProgress.lastActivity = new Date().toISOString();
                
                localStorage.setItem(storageKey, JSON.stringify(allProgress));
                debugLog('✅ localStorage guardado');
            } catch (error) {
                console.error('❌ Error localStorage:', error);
            }

            try {
                if (typeof updateModuleProgress !== 'function') {
                    console.error('❌ updateModuleProgress no existe');
                    return;
                }

                const success = await updateModuleProgress(MODULE_NUMBER, progressData);
                debugLog(success ? '✅ Sheets guardado' : '⚠️ Sheets falló');
            } catch (error) {
                console.error('❌ Error Sheets:', error);
            }

            updateProgressBar();
        }

        function saveProgressLocalOnly() {
            const currentUser = getCurrentUser();
            if (!currentUser) return;

            if (!Array.isArray(completedLessons)) {
                completedLessons = [];
            }

            const storageKey = `progress_${currentUser.username}`;
            try {
                const allProgress = JSON.parse(localStorage.getItem(storageKey) || '{}');
                if (!allProgress.modules) allProgress.modules = {};
                
                allProgress.modules[MODULE_NUMBER] = {
                    completedLessons,
                    evaluations: evaluationAnswers,
                    currentLesson,
                    lastUpdate: new Date().toISOString()
                };
                
                localStorage.setItem(storageKey, JSON.stringify(allProgress));
                debugLog('✅ localStorage guardado (solo local)');
            } catch (error) {
                console.error('❌ Error:', error);
            }
        }

        function updateProgressBar() {
            if (!Array.isArray(completedLessons)) {
                console.warn('⚠️ updateProgressBar: completedLessons no es array, corrigiendo...');
                completedLessons = [];
            }
            
            const completed = completedLessons.length;
            const percentage = Math.round((completed / TOTAL_LESSONS) * 100);
            
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const progressDetail = document.getElementById('progressDetail');
            
            if (progressBar) progressBar.style.width = percentage + '%';
            if (progressText) progressText.textContent = percentage + '%';
            if (progressDetail) progressDetail.textContent = `${completed} de ${TOTAL_LESSONS} lecciones completadas`;
            
            completedLessons.forEach(num => {
                const link = document.querySelector(`[data-lesson="${num}"]`);
                if (link) link.classList.add('completed');
            });
        }

        // ===== FUNCIÓN DE INICIALIZACIÓN CON VERIFICACIÓN DE ACCESO =====
        async function initializeModule() {
            // ===== 🔒 VERIFICACIÓN DE ACCESO AL MÓDULO 2 =====
            const progress = getStudentProgress();
            if (progress && progress.modules) {
                const m1Data = progress.modules[1];
                const m1Completed = (m1Data?.completedLessons || []).length;
                
                if (m1Completed < 3) {
                    document.body.innerHTML = `
                        <div style="display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px;">
                            <div style="background: white; padding: 50px 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 500px; text-align: center;">
                                <i class="bi bi-lock-fill" style="font-size: 80px; color: #667eea; display: block; margin-bottom: 20px;"></i>
                                <h2 style="color: #333; margin-bottom: 15px; font-size: 28px; font-weight: 700;">Módulo 2 Bloqueado</h2>
                                <p style="color: #666; font-size: 16px; line-height: 1.6; margin-bottom: 25px;">
                                    Primero debes completar las <strong>3 lecciones del Módulo 1: Observación y Gesto</strong> antes de acceder al Módulo 2.
                                </p>
                                <div style="background: #f0f2f5; padding: 15px; border-radius: 10px; margin-bottom: 30px;">
                                    <p style="color: #333; font-size: 18px; font-weight: 600; margin: 0;">
                                        📊 Progreso actual: <span style="color: #667eea;">${m1Completed}/3 lecciones</span>
                                    </p>
                                </div>
                                <a href="index.html" class="btn btn-primary" style="display: inline-block; background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 15px 35px; border-radius: 10px; text-decoration: none; font-weight: 600; transition: all 0.3s; border: none;">
                                    <i class="bi bi-arrow-left me-2"></i>Volver al Inicio
                                </a>
                                <p style="color: #999; font-size: 13px; margin-top: 20px;">
                                    💡 Tip: El aprendizaje es progresivo. Completa las bases antes de avanzar.
                                </p>
                            </div>
                        </div>
                    `;
                    return;
                }
            }
            // ===== FIN VERIFICACIÓN DE ACCESO =====

            console.log('='.repeat(60));
            console.log('🚀 MÓDULO 2 - INICIALIZACIÓN v4.2');
            console.log('='.repeat(60));
            
            const funcs = ['getCurrentUser', 'updateModuleProgress', 'logUserActivity', 'syncProgressFromSheets'];
            const missing = funcs.filter(f => typeof window[f] !== 'function');
            
            if (missing.length > 0) {
                console.error('❌ Funciones faltantes:', missing);
                alert('Error: auth.js no cargado correctamente');
                return;
            }
            
            const currentUser = getCurrentUser();
            if (!currentUser) {
                console.warn('❌ Usuario no autenticado, redirigiendo...');
                window.location.href = 'login.html';
                return;
            }
            
            console.log('✅ Usuario:', currentUser.username);
            
            console.log('🔄 Iniciando sincronización ANTES de cargar progreso...');
            await syncProgressFromSheets(currentUser.username, true);
            
            await loadProgress();
            
            if (!Array.isArray(completedLessons)) {
                console.warn('⚠️ Después de loadProgress, completedLessons no es array. Corrigiendo...');
                completedLessons = [];
            }
            
            console.log('✅ Estado cargado:');
            console.log('  - Lecciones completadas:', completedLessons);
            console.log('  - Evaluaciones:', Object.keys(evaluationAnswers).length);
            console.log('  - Lección actual:', currentLesson);
            
            try {
                await logUserActivity('module_access', MODULE_NUMBER.toString(), '', {});
            } catch (error) {
                console.warn('⚠️ No se pudo registrar actividad:', error);
            }
            
            loadLesson(currentLesson);
            moduleStartTime = Date.now();
            
            setInterval(() => {
                debugLog('⏰ Auto-guardado periódico');
                saveProgress();
            }, 120000);
            
            console.log('✅ MÓDULO 2 INICIALIZADO CORRECTAMENTE');
            console.log('='.repeat(60));
        }

        // ===== FUNCIONES DE NAVEGACIÓN =====
        async function completeLesson(lessonNum) {
            if (!Array.isArray(completedLessons)) {
                console.warn('⚠️ completedLessons no es array, inicializando...');
                completedLessons = [];
            }

            if (completedLessons.includes(lessonNum)) return;

            const currentUser = getCurrentUser();
            if (!currentUser) return;

            const lessonTime = Math.round((Date.now() - lessonStartTime) / 60000);
            completedLessons.push(lessonNum);
            
            await saveProgress();
            
            try {
                await logUserActivity('lesson_completed', MODULE_NUMBER.toString(), lessonNum.toString(), {
                    timeSpent: lessonTime
                });
                console.log(`✅ Lección ${lessonNum} completada`);
            } catch (error) {
                console.error('Error:', error);
            }
            
            showToast('¡Lección completada!', 'success');
            updateProgressBar();
        }

        function loadLesson(lessonNum) {
            currentLesson = lessonNum;
            lessonStartTime = Date.now();
            
            document.querySelectorAll('.lesson-link').forEach(link => {
                link.classList.remove('active');
            });
            
            const activeLink = document.querySelector(`[data-lesson="${lessonNum}"]`);
            if (activeLink) activeLink.classList.add('active');
            
            const breadcrumb = document.getElementById('breadcrumbLesson');
            if (breadcrumb) breadcrumb.textContent = `Lección ${lessonNum}`;
            
            const content = document.getElementById('lessonContent');
            if (content) {
                content.innerHTML = lessons[`lesson${lessonNum}`];
                content.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            if (evaluationAnswers[lessonNum]) {
                restoreEvaluation(lessonNum);
            }
            
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) overlay.style.display = 'none';
        }

        function goToNextLesson() {
            if (currentLesson < TOTAL_LESSONS) {
                loadLesson(currentLesson + 1);
            } else {
                window.location.href = 'index.html';
            }
        }

        // ===== FUNCIONES DE EVALUACIÓN =====
        function selectEvalOption(element, answer, lessonNum) {
            const question = element.closest('.eval-question');
            const questionId = question.dataset.question;
            
            question.querySelectorAll('.eval-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            element.classList.add('selected');
            
            if (!evaluationAnswers[lessonNum]) {
                evaluationAnswers[lessonNum] = {};
            }
            evaluationAnswers[lessonNum][questionId] = answer;
            
            updateEvalProgress(lessonNum);
        }

        function updateEvalProgress(lessonNum) {
            const totalQuestions = 3;
            const answeredCount = evaluationAnswers[lessonNum] ? 
                Object.keys(evaluationAnswers[lessonNum]).length : 0;
            
            const counter = document.getElementById('answeredCount');
            if (counter) counter.textContent = answeredCount;
        }

        async function submitEvaluation(lessonNum) {
            const correctAnswers = {
                1: { q1: 2, q2: 1, q3: 1 },
                2: { q1: 1, q2: 3, q3: 2 },
                3: { q1: 2, q2: 1, q3: 2 },
                4: { q1: 2, q2: 3, q3: 1 }
            };

            const userAnswers = evaluationAnswers[lessonNum] || {};
            
            if (Object.keys(userAnswers).length < 3) {
                showToast('Por favor responde todas las preguntas', 'warning');
                return;
            }

            let correct = 0;
            Object.keys(correctAnswers[lessonNum]).forEach(q => {
                const question = document.querySelector(`[data-question="${q}"]`);
                const options = question.querySelectorAll('.eval-option');
                
                options.forEach((opt, idx) => {
                    opt.classList.remove('selected', 'correct', 'incorrect');
                    if (idx + 1 === correctAnswers[lessonNum][q]) {
                        opt.classList.add('correct');
                    }
                    if (idx + 1 === userAnswers[q] && userAnswers[q] !== correctAnswers[lessonNum][q]) {
                        opt.classList.add('incorrect');
                    }
                });
                
                if (userAnswers[q] === correctAnswers[lessonNum][q]) {
                    correct++;
                }
            });

            const resultDiv = document.getElementById('evalResult');
            const passed = correct >= 2;

            if (passed) {
                resultDiv.innerHTML = `
                    <div class="alert alert-success">
                        <h5><i class="bi bi-check-circle-fill me-2"></i>¡Aprobado!</h5>
                        <p>Obtuviste ${correct}/3 respuestas correctas.</p>
                    </div>
                `;
                
                await completeLesson(lessonNum);
                
                document.getElementById('submitEvalBtn').style.display = 'none';
                document.getElementById('retryEvalBtn').style.display = 'none';
                
                if (lessonNum < TOTAL_LESSONS) {
                    document.getElementById('nextLessonBtn').style.display = 'inline-block';
                } else {
                    document.getElementById('nextLessonBtn').style.display = 'inline-block';
                    document.getElementById('nextLessonBtn').innerHTML = '<i class="bi bi-house-door me-2"></i>Completar Módulo';
                }
                
                showToast('¡Evaluación aprobada!', 'success');
            } else {
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h5><i class="bi bi-x-circle-fill me-2"></i>No Aprobado</h5>
                        <p>Obtuviste ${correct}/3 respuestas correctas. Necesitas 2/3 para aprobar.</p>
                    </div>
                `;
                
                document.getElementById('submitEvalBtn').style.display = 'none';
                document.getElementById('retryEvalBtn').style.display = 'inline-block';
                
                showToast('Revisa el contenido e inténtalo nuevamente', 'warning');
            }

            await saveProgress();
        }

        function retryEvaluation(lessonNum) {
            evaluationAnswers[lessonNum] = {};
            
            document.querySelectorAll('.eval-option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });
            
            const resultDiv = document.getElementById('evalResult');
            if (resultDiv) resultDiv.innerHTML = '';
            
            document.getElementById('submitEvalBtn').style.display = 'inline-block';
            document.getElementById('retryEvalBtn').style.display = 'none';
            document.getElementById('nextLessonBtn').style.display = 'none';
            
            updateEvalProgress(lessonNum);
            showToast('Evaluación reiniciada', 'info');
        }

        function restoreEvaluation(lessonNum) {
            const answers = evaluationAnswers[lessonNum];
            if (!answers) return;
            
            Object.keys(answers).forEach(question => {
                const container = document.querySelector(`[data-question="${question}"]`);
                if (container) {
                    container.querySelectorAll('.eval-option').forEach((opt, idx) => {
                        if (idx + 1 === answers[question]) opt.classList.add('selected');
                    });
                }
            });
            
            updateEvalProgress(lessonNum);
        }

        function toggleChecklistItem(element) {
            element.classList.toggle('completed');
            const icon = element.querySelector('i');
            if (element.classList.contains('completed')) {
                icon.className = 'bi bi-check-circle-fill text-success';
            } else {
                icon.className = 'bi bi-circle text-muted';
            }
        }

        function showToast(message, type = 'info') {
            const colors = { success: '#4CAF50', warning: '#FFC107', info: '#2196F3', danger: '#f44336' };
            const icons = { success: 'check-circle-fill', warning: 'exclamation-triangle-fill', info: 'info-circle-fill', danger: 'x-circle-fill' };
            
            const toast = document.createElement('div');
            toast.style.cssText = `position: fixed; top: 80px; right: 20px; background: ${colors[type]}; color: white; padding: 1rem 1.5rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 9999; animation: slideIn 0.3s;`;
            toast.innerHTML = `<i class="bi bi-${icons[type]}" style="font-size: 1.25rem; margin-right: 0.75rem;"></i><span>${message}</span>`;
            
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function getStudentProgress() {
            const currentUser = getCurrentUser();
            if (!currentUser) return null;
            
            const progressKey = `progress_${currentUser.username}`;
            try {
                const progress = JSON.parse(localStorage.getItem(progressKey) || 'null');
                return progress;
            } catch (error) {
                console.error('Error parsing progress data:', error);
                return null;
            }
        }

        // ===== CONTENIDO DE LECCIONES =====
        const lessons = {
            lesson1: `
                <div class="lesson-header">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start mb-3">
                        <div class="flex-grow-1 mb-2 mb-md-0">
                            <h2 class="lesson-title">Lección 2.1: Estructura Ósea Simplificada</h2>
                            <p class="lesson-subtitle">Las 3 masas corporales y su geometría</p>
                        </div>
                        <span class="badge bg-primary text-white lesson-duration">40 minutos</span>
                    </div>
                    
                    <div class="objectives-list">
                        <h6 class="mb-2"><i class="bi bi-bullseye me-2"></i>Objetivos de Aprendizaje</h6>
                        <ul class="mb-0">
                            <li>Identificar las 3 masas principales del cuerpo (cabeza, caja torácica, pelvis)</li>
                            <li>Simplificar el esqueleto en formas geométricas básicas</li>
                            <li>Dibujar 3 figuras esqueléticas desde diferentes ángulos</li>
                        </ul>
                    </div>
                </div>

                <div class="video-container">
                    <div class="video-placeholder">
                        <i class="bi bi-play-circle"></i>
                        <p class="mt-3 mb-0 text-sm">Video: Estructura ósea simplificada (3:20 min)</p>
                    </div>
                </div>

                <div class="accordion mb-4" id="accordionLesson1">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseL1_1" aria-expanded="true">
                                <i class="bi bi-1-circle me-2"></i>Las 3 Masas Corporales
                            </button>
                        </h2>
                        <div id="collapseL1_1" class="accordion-collapse collapse show" data-bs-parent="#accordionLesson1">
                            <div class="accordion-body">
                                <p>El cuerpo humano se puede simplificar en <strong>3 masas sólidas principales:</strong></p>
                                <ul>
                                    <li><strong>Cabeza:</strong> Óvalo o esfera</li>
                                    <li><strong>Caja torácica:</strong> Cilindro o prisma (más ancho arriba)</li>
                                    <li><strong>Pelvis:</strong> Trapecio o caja (más ancha abajo)</li>
                                </ul>
                                <p class="small text-muted">Estas masas están conectadas por la columna vertebral, que actúa como eje flexible.</p>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseL1_2">
                                <i class="bi bi-2-circle me-2"></i>La Columna como Eje
                            </button>
                        </h2>
                        <div id="collapseL1_2" class="accordion-collapse collapse" data-bs-parent="#accordionLesson1">
                            <div class="accordion-body">
                                <p>La columna vertebral NO es recta - tiene curvas naturales:</p>
                                <ul>
                                    <li>Cuello: curva hacia adelante</li>
                                    <li>Torso: curva hacia atrás</li>
                                    <li>Lumbar: curva hacia adelante</li>
                                </ul>
                                <p class="alert alert-info small mb-0">
                                    <i class="bi bi-lightbulb me-2"></i>
                                    En el dibujo, representa la columna como una línea curva en forma de "S" suave.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseL1_3">
                                <i class="bi bi-3-circle me-2"></i>Extremidades Simplificadas
                            </button>
                        </h2>
                        <div id="collapseL1_3" class="accordion-collapse collapse" data-bs-parent="#accordionLesson1">
                            <div class="accordion-body">
                                <h6>Brazos y piernas = Cilindros conectados</h6>
                                <ul>
                                    <li><strong>Brazo:</strong> Cilindro del hombro al codo + cilindro del codo a muñeca</li>
                                    <li><strong>Pierna:</strong> Cilindro de cadera a rodilla + cilindro de rodilla a tobillo</li>
                                </ul>
                                <p class="small text-muted mb-0">Las articulaciones (hombro, codo, cadera, rodilla) son puntos de rotación - márcalas con círculos pequeños.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card">
                    <h5 class="mb-3">
                        <i class="bi bi-palette me-2"></i>EJERCICIO: 3 Figuras Esqueléticas
                    </h5>
                    <p><strong>Objetivo:</strong> Dibujar estructura ósea simplificada desde 3 ángulos diferentes (10 min cada una)</p>
                    
                    <div class="row mt-4">
                        <div class="col-md-6 mb-3">
                            <h6>Materiales:</h6>
                            <ul class="small">
                                <li>3 hojas de papel</li>
                                <li>Lápiz HB</li>
                                <li>Goma de borrar</li>
                            </ul>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6>Referencias fotográficas:</h6>
                            <div class="row g-2">
                                <div class="col-4">
                                    <div class="reference-image" style="height: 100px;">
                                        <span class="text-xs">ref10_frontal.jpg</span>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="reference-image" style="height: 100px;">
                                        <span class="text-xs">ref11_lateral.jpg</span>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="reference-image" style="height: 100px;">
                                        <span class="text-xs">ref12_espalda.jpg</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <h6>Proceso (10 min por figura):</h6>
                        <div class="checklist">
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Marca las 3 masas (cabeza, torso, pelvis) como formas simples</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Dibuja la columna vertebral como línea curva</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Agrega extremidades como cilindros (marca articulaciones)</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Verifica proporciones (altura = 7.5 cabezas)</span>
                            </div>
                        </div>

                        <p class="mb-0 small mt-3"><strong>Documentación:</strong> Fotografía tus 3 dibujos. Los subirás al finalizar el módulo.</p>
                    </div>
                </div>

                <div class="evaluation-container">
                    <h4 class="mb-4"><i class="bi bi-clipboard-check me-2"></i>Evaluación Lección 2.1</h4>
                    
                    <div class="eval-progress">
                        <small class="text-muted">Preguntas respondidas: <strong><span id="answeredCount">0</span>/3</strong></small>
                    </div>
                    
                    <div class="eval-question" data-question="q1">
                        <h6>Pregunta 1:</h6>
                        <p>¿Cuáles son las 3 masas principales del cuerpo humano?</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 1)">
                                <div class="eval-radio"></div>
                                <span>A) Cabeza, brazos y piernas</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 1)">
                                <div class="eval-radio"></div>
                                <span>B) Cabeza, caja torácica y pelvis</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 1)">
                                <div class="eval-radio"></div>
                                <span>C) Cráneo, columna y extremidades</span>
                            </div>
                        </div>
                    </div>

                    <div class="eval-question" data-question="q2">
                        <h6>Pregunta 2:</h6>
                        <p>La columna vertebral en el dibujo anatómico se representa mejor como:</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 1)">
                                <div class="eval-radio"></div>
                                <span>A) Línea curva en forma de "S"</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 1)">
                                <div class="eval-radio"></div>
                                <span>B) Línea completamente recta</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 1)">
                                <div class="eval-radio"></div>
                                <span>C) Cilindro perfectamente recto</span>
                            </div>
                        </div>
                    </div>

                    <div class="eval-question" data-question="q3">
                        <h6>Pregunta 3:</h6>
                        <p>¿Qué forma geométrica se usa para simplificar la caja torácica?</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 1)">
                                <div class="eval-radio"></div>
                                <span>A) Cilindro o prisma (más ancho arriba)</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 1)">
                                <div class="eval-radio"></div>
                                <span>B) Esfera perfecta</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 1)">
                                <div class="eval-radio"></div>
                                <span>C) Cubo regular</span>
                            </div>
                        </div>
                    </div>

                    <div id="evalResult" class="mt-3"></div>

                    <div class="d-flex flex-column flex-md-row justify-content-center gap-3 mt-4">
                        <button class="btn btn-primary btn-nav" id="submitEvalBtn" onclick="submitEvaluation(1)">
                            <i class="bi bi-check-circle me-2"></i>Enviar Evaluación
                        </button>
                        <button class="btn btn-warning btn-nav" id="retryEvalBtn" style="display: none;" onclick="retryEvaluation(1)">
                            <i class="bi bi-arrow-clockwise me-2"></i>Reintentar
                        </button>
                        <button class="btn btn-primary-custom btn-nav" id="nextLessonBtn" style="display: none;" onclick="goToNextLesson()">
                            Siguiente Lección <i class="bi bi-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>
            `,

            lesson2: `
                <div class="lesson-header">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start mb-3">
                        <div class="flex-grow-1 mb-2 mb-md-0">
                            <h2 class="lesson-title">Lección 2.2: Músculos Superficiales</h2>
                            <p class="lesson-subtitle">Los 6 grupos musculares esenciales</p>
                        </div>
                        <span class="badge bg-warning text-dark lesson-duration">50 minutos</span>
                    </div>
                    
                    <div class="objectives-list">
                        <h6 class="mb-2"><i class="bi bi-bullseye me-2"></i>Objetivos de Aprendizaje</h6>
                        <ul class="mb-0">
                            <li>Identificar los 6 grupos musculares visibles más importantes</li>
                            <li>Comprender cómo los músculos afectan la forma externa del cuerpo</li>
                            <li>Dibujar 2 figuras aplicando formas musculares sobre estructura ósea</li>
                        </ul>
                    </div>
                </div>

                <div class="alert alert-info alert-custom">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>Concepto clave:</strong> No necesitas memorizar todos los músculos del cuerpo. 
                    En dibujo anatómico, nos enfocamos en los <strong>6 grupos musculares</strong> que más influyen en la forma visible.
                </div>

                <div class="row mb-4">
                    <div class="col-md-6 mb-3">
                        <div class="card h-100" style="border-color: #FF5722;">
                            <div class="card-header text-white" style="background-color: #FF5722;">1. PECTORALES (Pecho)</div>
                            <div class="card-body">
                                <p class="small mb-2"><strong>Ubicación:</strong> Parte frontal del torso superior</p>
                                <p class="small mb-2"><strong>Forma:</strong> Dos abanicos que se unen al centro</p>
                                <p class="small mb-2"><strong>Función:</strong> Acercan los brazos al cuerpo</p>
                                <p class="small mb-0"><strong>En dibujo:</strong> Crean volumen en el pecho masculino y la base del busto femenino</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card h-100" style="border-color: #4CAF50;">
                            <div class="card-header text-white" style="background-color: #4CAF50;">2. DORSALES (Espalda)</div>
                            <div class="card-body">
                                <p class="small mb-2"><strong>Ubicación:</strong> Espalda media y baja</p>
                                <p class="small mb-2"><strong>Forma:</strong> Forma de "V" invertida</p>
                                <p class="small mb-2"><strong>Función:</strong> Jalan los brazos hacia atrás y abajo</p>
                                <p class="small mb-0"><strong>En dibujo:</strong> Definen la silueta de la espalda en vista posterior</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card h-100" style="border-color: #2196F3;">
                            <div class="card-header text-white" style="background-color: #2196F3;">3. TRAPECIOS (Cuello-Hombros)</div>
                            <div class="card-body">
                                <p class="small mb-2"><strong>Ubicación:</strong> Desde la nuca hasta los hombros</p>
                                <p class="small mb-2"><strong>Forma:</strong> Trapecio o rombo aplanado</p>
                                <p class="small mb-2"><strong>Función:</strong> Elevan y bajan los hombros</p>
                                <p class="small mb-0"><strong>En dibujo:</strong> Conectan visualmente cabeza con torso</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card h-100" style="border-color: #9C27B0;">
                            <div class="card-header text-white" style="background-color: #9C27B0;">4. ABDOMINALES (Centro)</div>
                            <div class="card-body">
                                <p class="small mb-2"><strong>Ubicación:</strong> Parte frontal del torso bajo</p>
                                <p class="small mb-2"><strong>Forma:</strong> Bloques rectangulares apilados (6-pack)</p>
                                <p class="small mb-2"><strong>Función:</strong> Flexionan el tronco</p>
                                <p class="small mb-0"><strong>En dibujo:</strong> Más visibles en poses de tensión o cuerpos atléticos</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card h-100" style="border-color: #FF9800;">
                            <div class="card-header text-white" style="background-color: #FF9800;">5. GLÚTEOS (Cadera)</div>
                            <div class="card-body">
                                <p class="small mb-2"><strong>Ubicación:</strong> Parte posterior de la cadera</p>
                                <p class="small mb-2"><strong>Forma:</strong> Dos masas redondeadas</p>
                                <p class="small mb-2"><strong>Función:</strong> Extienden la cadera</p>
                                <p class="small mb-0"><strong>En dibujo:</strong> Definen la curva de la cadera posterior</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card h-100" style="border-color: #F44336;">
                            <div class="card-header text-white" style="background-color: #F44336;">6. DELTOIDES (Hombros)</div>
                            <div class="card-body">
                                <p class="small mb-2"><strong>Ubicación:</strong> Parte superior del brazo</p>
                                <p class="small mb-2"><strong>Forma:</strong> Triángulo invertido que cubre la articulación</p>
                                <p class="small mb-2"><strong>Función:</strong> Elevar y rotar el brazo</p>
                                <p class="small mb-0"><strong>En dibujo:</strong> Crean la transición entre torso y brazo</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-warning alert-custom">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <strong>Importante:</strong> Los músculos NO flotan en el aire - siempre están anclados al esqueleto. 
                    Siempre construye de adentro hacia afuera: <strong>esqueleto → músculos → contorno final</strong>
                </div>

                <div class="exercise-card">
                    <h5 class="mb-3">
                        <i class="bi bi-palette me-2"></i>EJERCICIO: 2 Figuras Musculares
                    </h5>
                    <p><strong>Objetivo:</strong> Aplicar conocimiento muscular sobre estructura ósea (20 min cada una)</p>
                    
                    <div class="row mt-4">
                        <div class="col-md-6 mb-3">
                            <h6>Materiales:</h6>
                            <ul class="small">
                                <li>2 hojas de papel</li>
                                <li>Lápiz HB y 2B</li>
                                <li>Goma de borrar</li>
                            </ul>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6>Referencias fotográficas:</h6>
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="reference-image" style="height: 120px;">
                                        <span class="text-xs">ref12_figura_muscular_frontal.jpg</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="reference-image" style="height: 120px;">
                                        <span class="text-xs">ref13_figura_muscular_espalda.jpg</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <h6>Proceso (20 min por figura):</h6>
                        <div class="checklist">
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Dibuja estructura ósea simplificada (5 min)</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Identifica músculos visibles en la pose (2 min)</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Agrega formas musculares (10 min)</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Refina contornos (3 min)</span>
                            </div>
                        </div>

                        <p class="mb-0 small mt-3"><strong>Documentación:</strong> Fotografía ambos dibujos para entregar al final del módulo.</p>
                    </div>
                </div>

                <div class="evaluation-container">
                    <h4 class="mb-4"><i class="bi bi-clipboard-check me-2"></i>Evaluación Lección 2.2</h4>
                    
                    <div class="eval-progress">
                        <small class="text-muted">Preguntas respondidas: <strong><span id="answeredCount">0</span>/3</strong></small>
                    </div>
                    
                    <div class="eval-question" data-question="q1">
                        <h6>Pregunta 1:</h6>
                        <p>¿Qué músculo crea la forma en "V" de la espalda?</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 2)">
                                <div class="eval-radio"></div>
                                <span>A) Trapecios</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 2)">
                                <div class="eval-radio"></div>
                                <span>B) Abdominales</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 2)">
                                <div class="eval-radio"></div>
                                <span>C) Dorsales</span>
                            </div>
                        </div>
                    </div>

                    <div class="eval-question" data-question="q2">
                        <h6>Pregunta 2:</h6>
                        <p>¿Cuántos grupos musculares esenciales estudiamos en esta lección?</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 2)">
                                <div class="eval-radio"></div>
                                <span>A) 3 grupos</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 2)">
                                <div class="eval-radio"></div>
                                <span>B) 10 grupos</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 2)">
                                <div class="eval-radio"></div>
                                <span>C) 6 grupos esenciales</span>
                            </div>
                        </div>
                    </div>

                    <div class="eval-question" data-question="q3">
                        <h6>Pregunta 3:</h6>
                        <p>El orden correcto para dibujar la figura humana es:</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 2)">
                                <div class="eval-radio"></div>
                                <span>A) Músculos → esqueleto → contorno</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 2)">
                                <div class="eval-radio"></div>
                                <span>B) Esqueleto → músculos → contorno</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 2)">
                                <div class="eval-radio"></div>
                                <span>C) Contorno → músculos → esqueleto</span>
                            </div>
                        </div>
                    </div>

                    <div id="evalResult" class="mt-3"></div>

                    <div class="d-flex flex-column flex-md-row justify-content-center gap-3 mt-4">
                        <button class="btn btn-primary btn-nav" id="submitEvalBtn" onclick="submitEvaluation(2)">
                            <i class="bi bi-check-circle me-2"></i>Enviar Evaluación
                        </button>
                        <button class="btn btn-warning btn-nav" id="retryEvalBtn" style="display: none;" onclick="retryEvaluation(2)">
                            <i class="bi bi-arrow-clockwise me-2"></i>Reintentar
                        </button>
                        <button class="btn btn-primary-custom btn-nav" id="nextLessonBtn" style="display: none;" onclick="goToNextLesson()">
                            Siguiente Lección <i class="bi bi-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>
            `,

            lesson3: `
                <div class="lesson-header">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start mb-3">
                        <div class="flex-grow-1 mb-2 mb-md-0">
                            <h2 class="lesson-title">Lección 2.3: Extremidades</h2>
                            <p class="lesson-subtitle">Estructura de manos y pies</p>
                        </div>
                        <span class="badge bg-success text-white lesson-duration">60 minutos</span>
                    </div>
                    
                    <div class="objectives-list">
                        <h6 class="mb-2"><i class="bi bi-bullseye me-2"></i>Objetivos de Aprendizaje</h6>
                        <ul class="mb-0">
                            <li>Comprender la estructura básica de manos y pies</li>
                            <li>Aplicar proporciones para dibujar manos realistas</li>
                            <li>Dibujar 3 estudios de manos + 2 estudios de pies</li>
                        </ul>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <i class="bi bi-hand-index me-2"></i>MANOS
                            </div>
                            <div class="card-body">
                                <h6>Estructura simplificada:</h6>
                                <ul class="small">
                                    <li><strong>Palma:</strong> Rectángulo o trapecio</li>
                                    <li><strong>Dedos:</strong> 3 cilindros conectados cada uno</li>
                                    <li><strong>Pulgar:</strong> 2 cilindros (más corto)</li>
                                </ul>
                                <div class="alert alert-info small mb-0">
                                    <strong>Proporción clave:</strong> La mano completa mide aproximadamente lo mismo que el rostro (desde mentón hasta línea del cabello).
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <i class="bi bi-cone-striped me-2"></i>PIES
                            </div>
                            <div class="card-body">
                                <h6>Estructura simplificada:</h6>
                                <ul class="small">
                                    <li><strong>Base:</strong> Cuña o prisma triangular</li>
                                    <li><strong>Dedos:</strong> Cilindros pequeños decrecientes</li>
                                    <li><strong>Talón:</strong> Forma redondeada posterior</li>
                                </ul>
                                <div class="alert alert-success small mb-0">
                                    <strong>Proporción clave:</strong> El pie mide aproximadamente la misma longitud que el antebrazo (de codo a muñeca).
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-warning alert-custom">
                    <i class="bi bi-lightbulb me-2"></i>
                    <strong>Consejo pro:</strong> Las manos y pies son las partes más complejas de dibujar. 
                    No te frustres - incluso artistas experimentados practican constantemente. Piensa en <strong>formas simples</strong> primero.
                </div>

                <div class="exercise-card">
                    <h5 class="mb-3">
                        <i class="bi bi-palette me-2"></i>EJERCICIO: 3 Manos + 2 Pies
                    </h5>
                    <p><strong>Objetivo:</strong> Estudiar diferentes poses de manos y pies (15 min cada estudio)</p>
                    
                    <div class="row mt-4">
                        <div class="col-md-12 mb-3">
                            <h6>Referencias sugeridas:</h6>
                            <div class="row g-2">
                                <div class="col-6 col-md-4">
                                    <div class="reference-image" style="height: 100px;">
                                        <span class="text-xs">mano_abierta.jpg</span>
                                    </div>
                                    <small class="d-block text-center mt-1">Mano abierta</small>
                                </div>
                                <div class="col-6 col-md-4">
                                    <div class="reference-image" style="height: 100px;">
                                        <span class="text-xs">mano_puño.jpg</span>
                                    </div>
                                    <small class="d-block text-center mt-1">Puño cerrado</small>
                                </div>
                                <div class="col-6 col-md-4">
                                    <div class="reference-image" style="height: 100px;">
                                        <span class="text-xs">mano_señalando.jpg</span>
                                    </div>
                                    <small class="d-block text-center mt-1">Dedo señalando</small>
                                </div>
                                <div class="col-6 col-md-6">
                                    <div class="reference-image" style="height: 100px;">
                                        <span class="text-xs">pie_lateral.jpg</span>
                                    </div>
                                    <small class="d-block text-center mt-1">Pie vista lateral</small>
                                </div>
                                <div class="col-6 col-md-6">
                                    <div class="reference-image" style="height: 100px;">
                                        <span class="text-xs">pie_frontal.jpg</span>
                                    </div>
                                    <small class="d-block text-center mt-1">Pie vista frontal</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <h6>Proceso por cada estudio (15 min):</h6>
                        <div class="checklist">
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Identifica la forma básica (rectángulo/cuña)</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Marca articulaciones principales</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Agrega cilindros para dedos/dedos del pie</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Refina contornos y detalles</span>
                            </div>
                        </div>

                        <p class="mb-0 small mt-3"><strong>Documentación:</strong> Fotografía los 5 estudios completos.</p>
                    </div>
                </div>

                <div class="evaluation-container">
                    <h4 class="mb-4"><i class="bi bi-clipboard-check me-2"></i>Evaluación Lección 2.3</h4>
                    
                    <div class="eval-progress">
                        <small class="text-muted">Preguntas respondidas: <strong><span id="answeredCount">0</span>/3</strong></small>
                    </div>
                    
                    <div class="eval-question" data-question="q1">
                        <h6>Pregunta 1:</h6>
                        <p>¿Cuántos cilindros forman cada dedo de la mano (excepto el pulgar)?</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 3)">
                                <div class="eval-radio"></div>
                                <span>A) 2 cilindros</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 3)">
                                <div class="eval-radio"></div>
                                <span>B) 3 cilindros</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 3)">
                                <div class="eval-radio"></div>
                                <span>C) 4 cilindros</span>
                            </div>
                        </div>
                    </div>

                    <div class="eval-question" data-question="q2">
                        <h6>Pregunta 2:</h6>
                        <p>La proporción de la mano completa es similar a:</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 3)">
                                <div class="eval-radio"></div>
                                <span>A) El tamaño del rostro</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 3)">
                                <div class="eval-radio"></div>
                                <span>B) La mitad del brazo</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 3)">
                                <div class="eval-radio"></div>
                                <span>C) El tamaño de la cabeza completa</span>
                            </div>
                        </div>
                    </div>

                    <div class="eval-question" data-question="q3">
                        <h6>Pregunta 3:</h6>
                        <p>La estructura básica del pie se simplifica mejor como:</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 3)">
                                <div class="eval-radio"></div>
                                <span>A) Un rectángulo plano</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 3)">
                                <div class="eval-radio"></div>
                                <span>B) Una cuña o prisma triangular</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 3)">
                                <div class="eval-radio"></div>
                                <span>C) Un cilindro</span>
                            </div>
                        </div>
                    </div>

                    <div id="evalResult" class="mt-3"></div>

                    <div class="d-flex flex-column flex-md-row justify-content-center gap-3 mt-4">
                        <button class="btn btn-primary btn-nav" id="submitEvalBtn" onclick="submitEvaluation(3)">
                            <i class="bi bi-check-circle me-2"></i>Enviar Evaluación
                        </button>
                        <button class="btn btn-warning btn-nav" id="retryEvalBtn" style="display: none;" onclick="retryEvaluation(3)">
                            <i class="bi bi-arrow-clockwise me-2"></i>Reintentar
                        </button>
                        <button class="btn btn-primary-custom btn-nav" id="nextLessonBtn" style="display: none;" onclick="goToNextLesson()">
                            Siguiente Lección <i class="bi bi-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>
            `,

            lesson4: `
                <div class="lesson-header">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start mb-3">
                        <div class="flex-grow-1 mb-2 mb-md-0">
                            <h2 class="lesson-title">Lección 2.4: Rostro - Proporciones Básicas</h2>
                            <p class="lesson-subtitle">Regla de tercios y ubicación de rasgos</p>
                        </div>
                        <span class="badge bg-warning text-dark lesson-duration">50 minutos</span>
                    </div>
                    
                    <div class="objectives-list">
                        <h6 class="mb-2"><i class="bi bi-bullseye me-2"></i>Objetivos de Aprendizaje</h6>
                        <ul class="mb-0">
                            <li>Aplicar la regla de tercios en el rostro humano</li>
                            <li>Comprender la división horizontal y vertical del rostro</li>
                            <li>Dibujar 2 rostros desde observación con proporciones correctas</li>
                        </ul>
                    </div>
                </div>

                <div class="accordion mb-4" id="accordionLesson4">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseL4_1" aria-expanded="true">
                                <i class="bi bi-1-circle me-2"></i>División Horizontal: Regla de Tercios
                            </button>
                        </h2>
                        <div id="collapseL4_1" class="accordion-collapse collapse show" data-bs-parent="#accordionLesson4">
                            <div class="accordion-body">
                                <p>El rostro se divide en <strong>3 tercios iguales horizontalmente:</strong></p>
                                <ul>
                                    <li><strong>Tercio 1 (superior):</strong> Desde la línea del cabello hasta las cejas</li>
                                    <li><strong>Tercio 2 (medio):</strong> Desde las cejas hasta la base de la nariz</li>
                                    <li><strong>Tercio 3 (inferior):</strong> Desde la base de la nariz hasta el mentón</li>
                                </ul>
                                <div class="alert alert-primary small mb-0">
                                    <i class="bi bi-info-circle me-2"></i>
                                    Esta regla funciona en la mayoría de los rostros adultos. Los niños tienen proporciones diferentes.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseL4_2">
                                <i class="bi bi-2-circle me-2"></i>División Vertical: Anchos
                            </button>
                        </h2>
                        <div id="collapseL4_2" class="accordion-collapse collapse" data-bs-parent="#accordionLesson4">
                            <div class="accordion-body">
                                <p>El rostro también se divide <strong>verticalmente en 5 partes iguales:</strong></p>
                                <ul>
                                    <li>1 ancho de ojo</li>
                                    <li>1 ancho de ojo</li>
                                    <li>1 ancho de separación entre ojos (aprox. 1 ojo)</li>
                                    <li>1 ancho de ojo</li>
                                    <li>1 ancho de ojo</li>
                                </ul>
                                <p class="small text-muted mb-0">Total: el rostro tiene aproximadamente 5 "anchos de ojo" de ancho.</p>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseL4_3">
                                <i class="bi bi-3-circle me-2"></i>Ubicación de Rasgos Principales
                            </button>
                        </h2>
                        <div id="collapseL4_3" class="accordion-collapse collapse" data-bs-parent="#accordionLesson4">
                            <div class="accordion-body">
                                <ul>
                                    <li><strong>Ojos:</strong> A la mitad de la altura total de la cabeza</li>
                                    <li><strong>Orejas:</strong> Entre línea de cejas y base de nariz</li>
                                    <li><strong>Boca:</strong> Entre nariz y mentón, ligeramente más cerca de la nariz</li>
                                    <li><strong>Ancho nariz:</strong> Distancia entre esquinas internas de los ojos</li>
                                    <li><strong>Ancho boca:</strong> Alineada con centro de las pupilas</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-warning alert-custom">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <strong>Importante:</strong> Estas son <strong>guías generales</strong>, no reglas absolutas. 
                    Cada persona tiene variaciones únicas. Usa estas proporciones como punto de partida.
                </div>

                <div class="exercise-card">
                    <h5 class="mb-3">
                        <i class="bi bi-palette me-2"></i>EJERCICIO: 2 Rostros con Proporciones
                    </h5>
                    <p><strong>Objetivo:</strong> Dibujar rostros aplicando la regla de tercios (20 min cada uno)</p>
                    
                    <div class="row mt-4">
                        <div class="col-md-6 mb-3">
                            <h6>Materiales:</h6>
                            <ul class="small">
                                <li>2 hojas de papel</li>
                                <li>Lápiz HB</li>
                                <li>Regla (opcional)</li>
                                <li>Goma de borrar</li>
                            </ul>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6>Referencias:</h6>
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="reference-image" style="height: 120px;">
                                        <span class="text-xs">rostro_frontal.jpg</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="reference-image" style="height: 120px;">
                                        <span class="text-xs">rostro_3cuartos.jpg</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <h6>Proceso (20 min por rostro):</h6>
                        <div class="checklist">
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Dibuja óvalo de la cabeza y línea vertical central</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Marca las 3 divisiones horizontales (tercios)</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Ubica ojos a la mitad de la altura</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Agrega nariz (tercio medio) y boca (tercio inferior)</span>
                            </div>
                            <div class="checklist-item" onclick="toggleChecklistItem(this)">
                                <i class="bi bi-circle text-muted"></i>
                                <span>Refina rasgos y agrega detalles</span>
                            </div>
                        </div>

                        <p class="mb-0 small mt-3"><strong>Documentación:</strong> Fotografía ambos dibujos terminados.</p>
                    </div>
                </div>

                <div class="evaluation-container">
                    <h4 class="mb-4"><i class="bi bi-clipboard-check me-2"></i>Evaluación Final Módulo 2</h4>
                    
                    <div class="eval-progress">
                        <small class="text-muted">Preguntas respondidas: <strong><span id="answeredCount">0</span>/3</strong></small>
                    </div>
                    
                    <div class="eval-question" data-question="q1">
                        <h6>Pregunta 1:</h6>
                        <p>Los ojos están ubicados aproximadamente:</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 4)">
                                <div class="eval-radio"></div>
                                <span>A) En el tercio superior del rostro</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 4)">
                                <div class="eval-radio"></div>
                                <span>B) A la mitad de la altura total de la cabeza</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 4)">
                                <div class="eval-radio"></div>
                                <span>C) En el tercio inferior del rostro</span>
                            </div>
                        </div>
                    </div>

                    <div class="eval-question" data-question="q2">
                        <h6>Pregunta 2:</h6>
                        <p>¿En cuántas partes iguales se divide el rostro verticalmente?</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 4)">
                                <div class="eval-radio"></div>
                                <span>A) 3 partes</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 4)">
                                <div class="eval-radio"></div>
                                <span>B) 4 partes</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 4)">
                                <div class="eval-radio"></div>
                                <span>C) 5 divisiones verticales (anchos de ojo)</span>
                            </div>
                        </div>
                    </div>

                    <div class="eval-question" data-question="q3">
                        <h6>Pregunta 3:</h6>
                        <p>El rostro se divide horizontalmente en:</p>
                        <div class="eval-options">
                            <div class="eval-option" onclick="selectEvalOption(this, 1, 4)">
                                <div class="eval-radio"></div>
                                <span>A) 3 tercios iguales (cejas, nariz, mentón)</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 2, 4)">
                                <div class="eval-radio"></div>
                                <span>B) 2 mitades (superior e inferior)</span>
                            </div>
                            <div class="eval-option" onclick="selectEvalOption(this, 3, 4)">
                                <div class="eval-radio"></div>
                                <span>C) 5 divisiones verticales</span>
                            </div>
                        </div>
                    </div>

                    <div id="evalResult" class="mt-3"></div>

                    <div class="d-flex flex-column flex-md-row justify-content-center gap-3 mt-4">
                        <button class="btn btn-primary btn-nav" id="submitEvalBtn" onclick="submitEvaluation(4)">
                            <i class="bi bi-check-circle me-2"></i>Enviar Evaluación
                        </button>
                        <button class="btn btn-warning btn-nav" id="retryEvalBtn" style="display: none;" onclick="retryEvaluation(4)">
                            <i class="bi bi-arrow-clockwise me-2"></i>Reintentar
                        </button>
                        <button class="btn btn-success btn-nav" id="nextLessonBtn" style="display: none;" onclick="window.location.href='index.html'">
                            <i class="bi bi-house-door me-2"></i>Completar Módulo
                        </button>
                    </div>
                </div>

                <div class="alert alert-success alert-custom mt-4">
                    <h5><i class="bi bi-trophy-fill me-2"></i>¡Felicitaciones!</h5>
                    <p class="mb-2">Has completado el <strong>Módulo 2: Anatomía Funcional</strong></p>
                    <p class="small mb-2"><strong>Portfolio completado:</strong></p>
                    <ul class="small mb-0">
                        <li>3 figuras esquelé ticas (Lección 1)</li>
                        <li>2 figuras musculares (Lección 2)</li>
                        <li>3 estudios de manos + 2 estudios de pies (Lección 3)</li>
                        <li>2 rostros con proporciones (Lección 4)</li>
                        <li>4 evaluaciones aprobadas (mínimo 2/3 en cada una)</li>
                    </ul>
                </div>

                <div class="card border-primary mt-3">
                    <div class="card-header bg-primary text-white">
                        <i class="bi bi-cloud-upload me-2"></i>Entrega Final Módulo 2
                    </div>
                    <div class="card-body text-center">
                        <p class="mb-3">Fotografía todos tus trabajos con buena iluminación y súbelos al formulario:</p>
                        <a href="https://forms.gle/URL_FORMULARIO_M2" class="btn btn-primary" target="_blank">
                            <i class="bi bi-box-arrow-up-right me-2"></i>Subir Trabajos Módulo 2
                        </a>
                        <p class="small text-muted mt-3 mb-0">Plazo: Antes de iniciar Módulo 3</p>
                    </div>
                </div>
            `
        };

        // ===== INICIALIZACIÓN =====
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeModule);
        } else {
            initializeModule();
        }

        window.addEventListener('beforeunload', function() {
            saveProgress();
        });

        console.log('%c🔍 DEBUG MODE', 'color: #4CAF50; font-size: 16px; font-weight: bold;');
        console.log('%cMódulo 2 v4.2 - Sincronización habilitada', 'color: #FFC107;');
    </script>
</body>
</html>
