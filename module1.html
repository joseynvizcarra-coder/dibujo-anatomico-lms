                    </div>
                `
            },
            3: {
                title: 'Volumen y Masa',
                meta: '<span><i class="bi bi-clock me-1"></i>15 minutos</span><span><i class="bi bi-book me-1"></i>Tridimensionalidad</span>',
                content: `
                    <div class="leonardo-quote">
                        <i class="bi bi-quote text-success fs-3"></i>
                        <p class="mb-0 mt-2">"La luz y la sombra hacen que el cuerpo parezca tener relieve."</p>
                        <small class="text-muted d-block mt-2">‚Äî Leonardo da Vinci, Tratado de la Pintura</small>
                    </div>

                    <!-- VIDEO PLACEHOLDER 3: Luz y Volumen -->
                    <div class="media-container video">
                        <i class="bi bi-play-circle display-1 text-primary mb-3"></i>
                        <div class="media-placeholder">üìπ VIDEO: "Construyendo Volumen con Luz"</div>
                        <div class="media-description">
                            <strong>Duraci√≥n:</strong> 4-5 minutos<br>
                            <strong>Contenido sugerido:</strong>
                            <ul class="text-start mt-2">
                                <li><strong>0:00-1:00:</strong> Demostraci√≥n con objeto simple (manzana, pelota) bajo luz direccional</li>
                                <li><strong>1:00-2:30:</strong> T√ö dibujando tu brazo con l√°mpara lateral (time-lapse)</li>
                                <li><strong>2:30-4:00:</strong> An√°lisis: identificar zona de luz, medios tonos, sombra propia</li>
                                <li><strong>4:00-5:00:</strong> Comparaci√≥n con estudio anat√≥mico de Leonardo (dominio p√∫blico)</li>
                            </ul>
                            <small class="text-muted"><em>Setup simple: l√°mpara de escritorio + c√°mara fija mostrando proceso</em></small>
                        </div>
                    </div>

                    <h3>De la L√≠nea a la Masa</h3>
                    <p class="lead">El volumen no se logra con m√°s l√≠neas, sino <strong>observando c√≥mo la luz revela la forma</strong>.</p>

                    <!-- IMAGEN PLACEHOLDER 3: Diagrama de Luz -->
                    <div class="media-container image">
                        <i class="bi bi-image display-1 text-warning mb-3"></i>
                        <div class="media-placeholder">üñºÔ∏è DIAGRAMA: Las Tres Zonas de Luz</div>
                        <div class="media-description">
                            <strong>Recurso sugerido:</strong> Infograf√≠a educativa
                            <ul class="text-start mt-2">
                                <li>Esfera o cilindro simple con fuente de luz direccional</li>
                                <li><strong>Zona 1 (amarillo):</strong> Luz directa - plano que mira hacia la luz</li>
                                <li><strong>Zona 2 (gris):</strong> Medios tonos - transici√≥n gradual</li>
                                <li><strong>Zona 3 (negro):</strong> Sombra propia - plano alejado de la luz</li>
                                <li>Flechas indicando direcci√≥n de luz y gradaci√≥n</li>
                            </ul>
                            <small class="text-muted"><em>Estilo: Diagrama t√©cnico limpio, colores codificados</em></small>
                        </div>
                    </div>

                    <h4>Formas Geom√©tricas como Herramientas</h4>
                    <p>Leonardo reduc√≠a formas complejas a geometr√≠a simple no porque el cuerpo sea geom√©trico, sino para comprender c√≥mo la luz las afecta.</p>

                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <div class="card h-100 border-info text-center">
                                <div class="card-body">
                                    <i class="bi bi-circle text-info" style="font-size: 2.5rem;"></i>
                                    <h6 class="mt-2">Esfera</h6>
                                    <p class="small mb-0">Cabeza, articulaciones, m√∫sculos redondeados</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card h-100 border-warning text-center">
                                <div class="card-body">
                                    <i class="bi bi-egg text-warning" style="font-size: 2.5rem;"></i>
                                    <h6 class="mt-2">Cilindro</h6>
                                    <p class="small mb-0">Cuello, brazos, piernas, torso</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card h-100 border-danger text-center">
                                <div class="card-body">
                                    <i class="bi bi-box text-danger" style="font-size: 2.5rem;"></i>
                                    <h6 class="mt-2">Planos</h6>
                                    <p class="small mb-0">Rostro, manos, pies, huesos visibles</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- GALER√çA PLACEHOLDER 3: Estudios de Leonardo -->
                    <div class="media-container gallery">
                        <i class="bi bi-grid-3x3 display-1 text-info mb-3"></i>
                        <div class="media-placeholder">üé® GALER√çA: Estudios Anat√≥micos de Leonardo da Vinci</div>
                        <div class="media-description">
                            <strong>Recurso sugerido:</strong> 4-6 im√°genes de dominio p√∫blico
                            <ul class="text-start mt-2">
                                <li><strong>Imagen 1:</strong> Estudio de brazo mostrando estructura √≥sea (Royal Collection Trust)</li>
                                <li><strong>Imagen 2:</strong> Estudio de mano con sombreado (Windsor Collection)</li>
                                <li><strong>Imagen 3:</strong> Estudio de pierna con musculatura visible</li>
                                <li><strong>Imagen 4:</strong> Estudio de hombro y cuello</li>
                                <li>Cada imagen con breve descripci√≥n: "Observa c√≥mo usa l√≠neas paralelas para sombreado"</li>
                            </ul>
                            <small class="text-muted"><em>Fuente: Wikimedia Commons / Royal Collection Trust (dominio p√∫blico)</em></small>
                        </div>
                    </div>

                    <div class="alert alert-primary border-0">
                        <h5 class="alert-heading"><i class="bi bi-lightbulb-fill me-2"></i>Principio del Volumen</h5>
                        <p class="mb-0">No dibujes l√≠neas que separan luz de sombra. Usa <strong>gradaci√≥n de valor</strong> (tono) para crear la transici√≥n.</p>
                    </div>

                    <div class="exercise-box">
                        <div class="exercise-title">
                            <i class="bi bi-pencil-square me-2"></i>Ejercicio 3: Estudio de Volumen + Copia de Leonardo
                        </div>
                        
                        <p><strong>Parte A: Tu Brazo con Luz Dirigida (30 minutos)</strong></p>
                        
                        <p><strong>Setup:</strong></p>
                        <ul>
                            <li>Coloca l√°mpara a 45¬∞ de tu brazo</li>
                            <li>Ambiente relativamente oscuro</li>
                            <li>Observa gradaci√≥n de brillante a oscuro</li>
                        </ul>

                        <p><strong>Proceso:</strong></p>
                        <ol>
                            <li><strong>0-5 min:</strong> Observa sin dibujar (identifica luz, sombra, transici√≥n)</li>
                            <li><strong>5-10 min:</strong> Contorno b√°sico con l√≠nea ligera</li>
                            <li><strong>10-25 min:</strong> Construye volumen mediante gradaci√≥n</li>
                            <li><strong>25-30 min:</strong> Refina transiciones</li>
                        </ol>

                        <div class="alert alert-warning border-0 mt-3">
                            <p class="mb-0"><strong>Regla:</strong> No uses l√≠neas para separar luz y sombra. Solo gradaci√≥n de tono.</p>
                        </div>

                        <p class="mt-3"><strong>Parte B: Copiar Estudio de Leonardo (20 minutos)</strong></p>
                        <ul>
                            <li>Elige uno de los estudios de la galer√≠a arriba</li>
                            <li>Copia observando: uso de l√≠neas, sombreado, √©nfasis estructural</li>
                            <li>No busques perfecci√≥n, busca comprender su m√©todo</li>
                        </ul>

                        <p class="mt-3"><strong>Entregable:</strong></p>
                        <ul>
                            <li>Fotograf√≠a de tu estudio de brazo (30 min)</li>
                            <li>Fotograf√≠a de tu copia de Leonardo (20 min)</li>
                            <li>Reflexi√≥n (150 palabras): "¬øC√≥mo cambia mi percepci√≥n cuando pienso en t√©rminos de luz y planos en lugar de l√≠neas?"</li>
                        </ul>
                    </div>

                    <h3>Integraci√≥n: Gesto + Volumen</h3>
                    <div class="alert alert-success border-0">
                        <h6 class="alert-heading"><i class="bi bi-trophy me-2"></i>Proceso Completo Leonardo</h6>
                        <ol class="mb-0">
                            <li><strong>Gesto (30 seg - 1 min):</strong> Captura l√≠nea de acci√≥n y direcci√≥n</li>
                            <li><strong>Formas volum√©tricas (2-3 min):</strong> Agrega cilindros y esferas sobre estructura</li>
                            <li><strong>Observar luz (1 min):</strong> Identifica zonas brillantes y oscuras</li>
                            <li><strong>Construir volumen (5-10 min):</strong> Grad√∫a de luz a sombra</li>
                        </ol>
                    </div>

                    <!-- VIDEO/IMAGEN PLACEHOLDER 4: Integraci√≥n Final -->
                    <div class="media-container video">
                        <i class="bi bi-play-circle display-1 text-primary mb-3"></i>
                        <div class="media-placeholder">üìπ VIDEO BONUS: "Del Gesto al Volumen - Proceso Completo"</div>
                        <div class="media-description">
                            <strong>Duraci√≥n:</strong> 3 minutos (opcional)<br>
                            <strong>Contenido sugerido:</strong>
                            <ul class="text-start mt-2">
                                <li>Time-lapse de T√ö dibujando una figura completa</li>
                                <li>Paso 1: Gesto r√°pido (30 seg en tiempo real)</li>
                                <li>Paso 2: Formas volum√©tricas (acelerado)</li>
                                <li>Paso 3: Aplicaci√≥n de luz y sombra (acelerado)</li>
                                <li>Resultado final con comentario tuyo: "Esto es lo que logramos en el M√≥dulo 1"</li>
                            </ul>
                            <small class="text-muted"><em>Este video sirve como cierre motivacional del m√≥dulo</em></small>
                        </div>
                    </div>

                    <!-- EVALUACI√ìN INTERACTIVA DE LA LECCI√ìN 3 -->
                    <div class="card border-primary mt-4 mb-4" id="quiz3Container">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="bi bi-question-circle me-2"></i>Evaluaci√≥n: Volumen y Luz</h5>
                        </div>
                        <div class="card-body">
                            <p class="mb-3">Responde estas preguntas para verificar tu comprensi√≥n de los conceptos clave:</p>
                            
                            <!-- Pregunta 1 -->
                            <div class="quiz-question mb-4">
                                <p class="fw-bold">1. ¬øCu√°l es el principio fundamental para crear volumen en el dibujo seg√∫n Leonardo?</p>
                                <div class="quiz-options" data-question="3-1" data-correct="b">
                                    <div class="quiz-option" data-answer="a" onclick="selectQuizAnswer(this)">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="q3-1" id="q3-1a">
                                            <label class="form-check-label" for="q3-1a">
                                                Agregar m√°s l√≠neas de contorno para definir los bordes
                                            </label>
                                        </div>
                                    </div>
                                    <div class="quiz-option" data-answer="b" onclick="selectQuizAnswer(this)">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="q3-1" id="q3-1b">
                                            <label class="form-check-label" for="q3-1b">
                                                Observar c√≥mo la luz revela la forma mediante gradaci√≥n de valores
                                            </label>
                                        </div>
                                    </div>
                                    <div class="quiz-option" data-answer="c" onclick="selectQuizAnswer(this)">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="q3-1" id="q3-1c">
                                            <label class="form-check-label" for="q3-1c">
                                                Memorizar f√≥rmulas geom√©tricas de las formas del cuerpo
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="quiz-feedback mt-2" style="display: none;"></div>
                            </div>

                            <!-- Pregunta 2 -->
                            <div class="quiz-question mb-4">
                                <p class="fw-bold">2. ¬øPara qu√© sirven las formas geom√©tricas simples (esfera, cilindro, caja) en el m√©todo Leonardo?</p>
                                <div class="quiz-options" data-question="3-2" data-correct="c">
                                    <div class="quiz-option" data-answer="a" onclick="selectQuizAnswer(this)">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="q3-2" id="q3-2a">
                                            <label class="form-check-label" for="q3-2a">
                                                Son la forma final del dibujo anat√≥mico
                                            </label>
                                        </div>
                                    </div>
                                    <div class="quiz-option" data-answer="b" onclick="selectQuizAnswer(this)">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="q3-2" id="q3-2b">
                                            <label class="form-check-label" for="q3-2b">
                                                Reemplazan la necesidad de observar la anatom√≠a real
                                            </label>
                                        </div>
                                    </div>
                                    <div class="quiz-option" data-answer="c" onclick="selectQuizAnswer(this)">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="q3-2" id="q3-2c">
                                            <label class="form-check-label" for="q3-2c">
                                                Son herramientas para comprender c√≥mo la luz afecta las formas complejas
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="quiz-feedback mt-2" style="display: none;"></div>
                            </div>

                            <!-- Pregunta 3 -->
                            <div class="quiz-question mb-4">
                                <p class="fw-bold">3. ¬øCu√°les son las tres zonas de luz fundamentales en un objeto iluminado?</p>
                                <div class="quiz-options" data-question="3-3" data-correct="a">
                                    <div class="quiz-option" data-answer="a" onclick="selectQuizAnswer(this)">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="q3-3" id="q3-3a">
                                            <label class="form-check-label" for="q3-3a">
                                                Luz directa, medios tonos y sombra propia
                                            </label>
                                        </div>
                                    </div>
                                    <div class="quiz-option" data-answer="b" onclick="selectQuizAnswer(this)">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="q3-3" id="q3-3b">
                                            <label class="form-check-label" for="q3-3b">
                                                Contorno, relleno y fondo
                                            </label>
                                        </div>
                                    </div>
                                    <div class="quiz-option" data-answer="c" onclick="selectQuizAnswer(this)">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="q3-3" id="q3-3c">
                                            <label class="form-check-label" for="q3-3c">
                                                L√≠nea, masa y volumen
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="quiz-feedback mt-2" style="display: none;"></div>
                            </div>

                            <button class="btn btn-primary w-100" onclick="submitQuiz(3)" id="submitQuiz3">
                                <i class="bi bi-check-circle me-2"></i>Verificar Respuestas
                            </button>
                            
                            <div class="alert mt-3" id="quizResult3" style="display: none;"></div>
                        </div>
                    </div>

                    <h3>Logros del M√≥dulo 1</h3>
                    <div class="card border-success">
                        <div class="card-header bg-success text-white">
                            <i class="bi bi-check-circle-fill me-2"></i><strong>Has completado los fundamentos del m√©todo Leonardo</strong>
                        </div>
                        <div class="card-body">
                            <ul class="mb-0">
                                <li>‚úÖ <strong>Observaci√≥n contemplativa:</strong> Ver m√°s all√° del reconocimiento</li>
                                <li>‚úÖ <strong>Gesto y movimiento:</strong> Capturar energ√≠a antes que detalle</li>
                                <li>‚úÖ <strong>Volumen y luz:</strong> Comprender tridimensionalidad mediante observaci√≥n</li>
                            </ul>
                            <p class="mt-3 mb-0 fw-bold text-primary">Siguiente: M√≥dulo 2 - Anatom√≠a como Comprensi√≥n Org√°nica</p>
                        </div>
                    </div>

                    <div class="alert alert-info border-0 mt-4">
                        <h6 class="alert-heading">üì¶ Entregable Final del M√≥dulo 1</h6>
                        <p><strong>Re√∫ne todos tus ejercicios en un solo documento PDF o carpeta de im√°genes:</strong></p>
                        <ol class="mb-0">
                            <li>Ejercicio 1: Mano observada + reflexi√≥n 100 palabras</li>
                            <li>Ejercicio 2: 15 croquis gestuales + reflexi√≥n 150 palabras</li>
                            <li>Ejercicio 3: Brazo con luz + copia Leonardo + reflexi√≥n 150 palabras</li>
                        </ol>
                    </div>
                `
            }
        };

        // Sistema de evaluaciones interactivas
        let quizAnswers = {};
        let quizScores = {};

        function selectQuizAnswer(element) {
            const optionsContainer = element.parentElement;
            const questionId = optionsContainer.getAttribute('data-question');
            const selectedAnswer = element.getAttribute('data-answer');
            
            // Deseleccionar todas las opciones de esta pregunta
            optionsContainer.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
                opt.querySelector('input').checked = false;
            });
            
            // Seleccionar la opci√≥n clickeada
            element.classList.add('selected');
            element.querySelector('input').checked = true;
            
            // Guardar respuesta
            quizAnswers[questionId] = selectedAnswer;
            
            // Log para tracking
            console.log('Respuesta seleccionada:', questionId, selectedAnswer);
            
            // Registrar interacci√≥n
            if (typeof logUserActivity === 'function' && currentUser) {
                logUserActivity('quiz_answer', currentUser, {
                    moduleId: 1,
                    lessonId: currentLesson,
                    questionId: questionId,
                    answer: selectedAnswer
                });
            }
        }

        function submitQuiz(lessonNumber) {
            const correctAnswers = {};
            let totalQuestions = 0;
            let correctCount = 0;
            
            // Obtener todas las preguntas de esta lecci√≥n
            document.querySelectorAll(`[data-question^="${lessonNumber}-"]`).forEach(optionsContainer => {
                const questionId = optionsContainer.getAttribute('data-question');
                const correctAnswer = optionsContainer.getAttribute('data-correct');
                correctAnswers[questionId] = correctAnswer;
                totalQuestions++;
                
                const userAnswer = quizAnswers[questionId];
                const feedbackDiv = optionsContainer.parentElement.querySelector('.quiz-feedback');
                
                if (userAnswer) {
                    const isCorrect = userAnswer === correctAnswer;
                    if (isCorrect) correctCount++;
                    
                    // Marcar opciones
                    optionsContainer.querySelectorAll('.quiz-option').forEach(opt => {
                        const answer = opt.getAttribute('data-answer');
                        opt.classList.remove('selected');
                        
                        if (answer === correctAnswer) {
                            opt.classList.add('correct');
                        } else if (answer === userAnswer && !isCorrect) {
                            opt.classList.add('incorrect');
                        }
                    });
                    
                    // Mostrar feedback
                    feedbackDiv.style.display = 'block';
                    if (isCorrect) {
                        feedbackDiv.className = 'quiz-feedback alert alert-success mt-2';
                        feedbackDiv.innerHTML = '<i class="bi bi-check-circle me-2"></i>¬°Correcto!';
                    } else {
                        feedbackDiv.className = 'quiz-feedback alert alert-danger mt-2';
                        feedbackDiv.innerHTML = '<i class="bi bi-x-circle me-2"></i>Incorrecto. Revisa el contenido de la lecci√≥n.';
                    }
                }
            });
            
            // Calcular score
            const scorePercentage = Math.round((correctCount / totalQuestions) * 100);
            quizScores[lessonNumber] = scorePercentage;
            
            // Mostrar resultado general
            const resultDiv = document.getElementById(`quizResult${lessonNumber}`);
            resultDiv.style.display = 'block';
            
            if (scorePercentage >= 70) {
                resultDiv.className = 'alert alert-success mt-3';
                resultDiv.innerHTML = `
                    <h6 class="alert-heading"><i class="bi bi-trophy-fill me-2"></i>¬°Excelente!</h6>
                    <p class="mb-0">Has obtenido ${correctCount}/${totalQuestions} respuestas correctas (${scorePercentage}%). Dominas los conceptos de esta lecci√≥n.</p>
                `;
            } else {
                resultDiv.className = 'alert alert-warning mt-3';
                resultDiv.innerHTML = `
                    <h6 class="alert-heading"><i class="bi bi-exclamation-triangle-fill me-2"></i>Puedes mejorar</h6>
                    <p class="mb-0">Has obtenido ${correctCount}/${totalQuestions} respuestas correctas (${scorePercentage}%). Te recomendamos revisar el contenido de la lecci√≥n antes de continuar.</p>
                `;
            }
            
            // Deshabilitar bot√≥n de submit
            document.getElementById(`submitQuiz${lessonNumber}`).disabled = true;
            document.getElementById(`submitQuiz${lessonNumber}`).innerHTML = '<i class="bi bi-check-circle-fill me-2"></i>Evaluaci√≥n Completada';
            
            // Registrar resultado
            if (typeof logUserActivity === 'function' && currentUser) {
                logUserActivity('quiz_completed', currentUser, {
                    moduleId: 1,
                    lessonId: lessonNumber,
                    score: scorePercentage,
                    correct: correctCount,
                    total: totalQuestions
                });
            }
            
            console.log('Quiz completado:', {
                lesson: lessonNumber,
                score: scorePercentage,
                correct: correctCount,
                total: totalQuestions
            });
        }

        // Agregar evaluaciones a las lecciones 1 y 2
        const quizLesson1 = `
            <div class="card border-primary mt-4 mb-4" id="quiz1Container">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-question-circle me-2"></i>Evaluaci√≥n: El Acto de Observar</h5>
                </div>
                <div class="card-body">
                    <p class="mb-3">Responde estas preguntas para verificar tu comprensi√≥n:</p>
                    
                    <div class="quiz-question mb-4">
                        <p class="fw-bold">1. ¬øQu√© significa "saper vedere" seg√∫n Leonardo da Vinci?</p>
                        <div class="quiz-options" data-question="1-1" data-correct="b">
                            <div class="quiz-option" data-answer="a" onclick="selectQuizAnswer(this)">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1-1" id="q1-1a">
                                    <label class="form-check-label" for="q1-1a">Saber dibujar r√°pido y con precisi√≥n</label>
                                </div>
                            </div>
                            <div class="quiz-option" data-answer="b" onclick="selectQuizAnswer(this)">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1-1" id="q1-1b">
                                    <label class="form-check-label" for="q1-1b">Aprender a ver con intenci√≥n cient√≠fica y curiosidad art√≠stica</label>
                                </div>
                            </div>
                            <div class="quiz-option" data-answer="c" onclick="selectQuizAnswer(this)">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1-1" id="q1-1c">
                                    <label class="form-check-label" for="q1-1c">Memorizar las proporciones del cuerpo humano</label>
                                </div>
                            </div>
                        </div>
                        <div class="quiz-feedback mt-2" style="display: none;"></div>
                    </div>

                    <div class="quiz-question mb-4">
                        <p class="fw-bold">2. ¬øCu√°l es la diferencia clave entre "reconocimiento" y "observaci√≥n"?</p>
                        <div class="quiz-options" data-question="1-2" data-correct="a">
                            <div class="quiz-option" data-answer="a" onclick="selectQuizAnswer(this)">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1-2" id="q1-2a">
                                    <label class="form-check-label" for="q1-2a">Reconocimiento identifica r√°pidamente, observaci√≥n estudia c√≥mo se estructura</label>
                                </div>
                            </div>
                            <div class="quiz-option" data-answer="b" onclick="selectQuizAnswer(this)">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1-2" id="q1-2b">
                                    <label class="form-check-label" for="q1-2b">No hay diferencia, son sin√≥nimos</label>
                                </div>
                            </div>
                            <div class="quiz-option" data-answer="c" onclick="selectQuizAnswer(this)">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q1-2" id="q1-2c">
                                    <label class="form-check-label" for="q1-2c">Reconocimiento es para expertos, observaci√≥n para principiantes</label>
                                </div>
                            </div>
                        </div>
                        <div class="quiz-feedback mt-2" style="display: none;"></div>
                    </div>

                    <button class="btn btn-primary w-100" onclick="submitQuiz(1)" id="submitQuiz1">
                        <i class="bi bi-check-circle me-2"></i>Verificar Respuestas
                    </button>
                    
                    <div class="alert mt-3" id="quizResult1" style="display: none;"></div>
                </div>
            </div>
        `;

        const quizLesson2 = `
            <div class="card border-primary mt-4 mb-4" id="quiz2Container">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-question-circle me-2"></i>Evaluaci√≥n: La L√≠nea como Movimiento</h5>
                </div>
                <div class="card-body">
                    <p class="mb-3">Responde estas preguntas para verificar tu comprensi√≥n:</p>
                    
                    <div class="quiz-question mb-4">
                        <p class="fw-bold">1. ¬øQu√© es la "l√≠nea de acci√≥n" en el croquis gestual?</p>
                        <div class="quiz-options" data-question="2-1" data-correct="c">
                            <div class="quiz-option" data-answer="a" onclick="selectQuizAnswer(this)">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2-1" id="q2-1a">
                                    <label class="form-check-label" for="q2-1a">El contorno exterior de la figura</label>
                                </div>
                            </div>
                            <div class="quiz-option" data-answer="b" onclick="selectQuizAnswer(this)">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2-1" id="q2-1b">
                                    <label class="form-check-label" for="q2-1b">La columna vertebral anat√≥mica real</label>
                                </div>
                            </div>
                            <div class="quiz-option" data-answer="c" onclick="selectQuizAnswer(this)">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2-1" id="q2-1c">
                                    <label class="form-check-label" for="q2-1c">Una curva imaginaria que captura la direcci√≥n principal del movimiento</label>
                                </div>
                            </div>
                        </div>
                        <div class="quiz-feedback mt-2" style="display: none;"></div>
                    </div>

                    <div class="quiz-question mb-4">
                        <p class="fw-bold">2. ¬øPor qu√© el croquis gestual debe ser r√°pido (30 segundos a 2 minutos)?</p>
                        <div class="quiz-options" data-question="2-2" data-correct="b">
                            <div class="quiz-option" data-answer="a" onclick="selectQuizAnswer(this)">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2-2" id="q2-2a">
                                    <label class="form-check-label" for="q2-2a">Para ahorrar tiempo y dibujar m√°s figuras</label>
                                </div>
                            </div>
                            <div class="quiz-option" data-answer="b" onclick="selectQuizAnswer(this)">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2-2" id="q2-2b">
                                    <label class="form-check-label" for="q2-2b">Para desactivar el pensamiento anal√≠tico y capturar solo lo esencial</label>
                                </div>
                            </div>
                            <div class="quiz-option" data-answer="c" onclick="selectQuizAnswer(this)">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2-2" id="q2-2c">
                                    <label class="form-check-label" for="q2-2c">Porque los detalles no son importantes en el dibujo</label>
                                </div>
                            </div>
                        </div>
                        <div class="quiz-feedback mt-2" style="display: none;"></div>
                    </div>

                    <div class="quiz-question mb-4">
                        <p class="fw-bold">3. ¬øCu√°les son los tres elementos fundamentales del gesto?</p>
                        <div class="quiz-options" data-question="2-3" data-correct="a">
                            <div class="quiz-option" data-answer="a" onclick="selectQuizAnswer(this)">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2-3" id="q2-3a">
                                    <label class="form-check-label" for="q2-3a">Direcci√≥n, peso y ritmo</label>
                                </div>
                            </div>
                            <div class="quiz-option" data-answer="b" onclick="selectQuizAnswer(this)">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2-3" id="q2-3b">
                                    <label class="form-check-label" for="q2-3b">Cabeza, torso y extremidades</label>
                                </div>
                            </div>
                            <div class="quiz-option" data-answer="c" onclick="selectQuizAnswer(this)">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q2-3" id="q2-3c">
                                    <label class="form-check-label" for="q2-3c">L√≠nea, forma y volumen</label>
                                </div>
                            </div>
                        </div>
                        <div class="quiz-feedback mt-2" style="display: none;"></div>
                    </div>

                    <button class="btn btn-primary w-100" onclick="submitQuiz(2)" id="submitQuiz2">
                        <i class="bi bi-check-circle me-2"></i>Verificar Respuestas
                    </button>
                    
                    <div class="alert mt-3" id="quizResult2" style="display: none;"></div>
                </div>
            </div>
        `;

        // Modificar el contenido de las lecciones 1 y 2 para incluir los quizzes
        lessonsContent[1].content = lessonsContent[1].content.replace(
            '<div class="alert alert-info border-0">',
            quizLesson1 + '<div class="alert alert-info border-0">'
        );

        lessonsContent[2].content = lessonsContent[2].content.replace(
            '<div class="alert alert-info border-0">',
            quizLesson2 + '<div class="alert alert-info border-0">'
        );

        window.addEventListener('online', () => {
            isOnline = true;
            console.log('‚úì Conexi√≥n restaurada');
            syncProgressWithSheets();
        });

        window.addEventListener('offline', () => {
            isOnline = false;
            console.log('‚ö† Sin conexi√≥n - modo offline');
        });

        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Inicializando M√≥dulo 1 - M√©todo Leonardo...');
            
            if (typeof getCurrentUser !== 'undefined' && typeof protectPage !== 'undefined') {
                if (!protectPage()) return;
                currentUser = getCurrentUser();
            } else {
                const storedUser = localStorage.getItem('currentUser');
                if (storedUser) {
                    currentUser = JSON.parse(storedUser);
                } else {
                    console.error('‚úñ No hay usuario autenticado');
                    window.location.href = 'login.html';
                    return;
                }
            }

            console.log('‚úì Usuario autenticado:', currentUser);
            
            loadModuleProgress();
            loadLesson(1);
            
            if (typeof logUserActivity === 'function') {
                logUserActivity('module_access', currentUser, { 
                    moduleId: 1,
                    moduleTitle: 'Observaci√≥n y Gesto - M√©todo Leonardo'
                });
            }
        });

        async function loadModuleProgress() {
            console.log('üìä Cargando progreso del M√≥dulo 1...');
            
            try {
                if (isOnline && typeof getStudentProgress === 'function') {
                    console.log('‚òÅÔ∏è Intentando cargar desde Google Sheets...');
                    const sheetsProgress = await getStudentProgress(currentUser.username);
                    
                    if (sheetsProgress && sheetsProgress.modules && sheetsProgress.modules[1]) {
                        moduleProgress = sheetsProgress.modules[1].progress || 0;
                        completedLessons = sheetsProgress.modules[1].completedLessons || [];
                        
                        console.log('‚úì Progreso cargado desde Google Sheets:', {
                            moduleProgress,
                            completedLessons
                        });
                        
                        syncToLocalStorage(sheetsProgress.modules[1]);
                        updateProgressDisplay();
                        updateSidebarProgress();
                        return;
                    }
                }
            } catch (error) {
                console.error('‚úñ Error cargando desde Google Sheets:', error);
            }
            
            console.log('üíæ Cargando desde localStorage (fallback)...');
            const progressKey = `progress_${currentUser.username || currentUser.email}`;
            const userProgress = JSON.parse(localStorage.getItem(progressKey) || 'null');
            
            if (userProgress && userProgress.modules && userProgress.modules[1]) {
                moduleProgress = userProgress.modules[1].progress || 0;
                completedLessons = userProgress.modules[1].completedLessons || [];
                
                console.log('‚úì Progreso cargado desde localStorage:', {
                    moduleProgress,
                    completedLessons
                });
            } else {
                console.log('‚ÑπÔ∏è No hay progreso previo - iniciando desde cero');
            }
            
            updateProgressDisplay();
            updateSidebarProgress();
        }

        function syncToLocalStorage(moduleData) {
            const progressKey = `progress_${currentUser.username || currentUser.email}`;
            let userProgress = JSON.parse(localStorage.getItem(progressKey) || 'null');
            
            if (!userProgress) {
                userProgress = initializeLocalProgress();
            }
            
            userProgress.modules[1] = moduleData;
            userProgress.lastActivity = new Date().toISOString();
            localStorage.setItem(progressKey, JSON.stringify(userProgress));
            
            console.log('‚úì Sincronizado con localStorage');
        }

        function initializeLocalProgress() {
            return {
                modules: {
                    1: { completed: false, progress: 0, timeSpent: 0, completedLessons: [] },
                    2: { completed: false, progress: 0, timeSpent: 0, completedLessons: [] },
                    3: { completed: false, progress: 0, timeSpent: 0, completedLessons: [] }
                },
                overallProgress: 0,
                totalTimeSpent: 0,
                lastActivity: new Date().toISOString()
            };
        }

        function updateProgressDisplay() {
            document.getElementById('progressText').textContent = moduleProgress + '% Completado';
            
            const progressBar = document.getElementById('moduleProgress');
            progressBar.style.width = moduleProgress + '%';
            const progressText = progressBar.querySelector('span');
            if (progressText) {
                progressText.textContent = moduleProgress + '%';
            }
        }

        function updateSidebarProgress() {
            document.querySelectorAll('.lesson-link').forEach((link) => {
                const lessonNum = parseInt(link.getAttribute('data-lesson'));
                link.classList.remove('completed');
                
                if (completedLessons.includes(lessonNum)) {
                    link.classList.add('completed');
                }
            });
        }

        function loadLesson(lessonNumber) {
            console.log('üìñ Cargando lecci√≥n:', lessonNumber);
            currentLesson = lessonNumber;
            
            document.querySelectorAll('.lesson-link').forEach((link) => {
                link.classList.remove('active');
                if (parseInt(link.getAttribute('data-lesson')) === lessonNumber) {
                    link.classList.add('active');
                }
            });

            const lesson = lessonsContent[lessonNumber];
            if (lesson) {
                document.getElementById('lessonTitle').textContent = lesson.title;
                document.getElementById('lessonMeta').innerHTML = lesson.meta;
                document.getElementById('lessonContent').innerHTML = lesson.content;
            } else {
                console.error('‚úñ Lecci√≥n no encontrada:', lessonNumber);
            }

            updateNavigationButtons();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateNavigationButtons() {
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');
            const completeButton = document.getElementById('completeButton');

            prevButton.disabled = (currentLesson <= 1);

            if (currentLesson >= 3) {
                nextButton.style.display = 'none';
            } else {
                nextButton.style.display = 'inline-block';
            }

            if (completedLessons.includes(currentLesson)) {
                completeButton.innerHTML = '<i class="bi bi-check-circle-fill me-2"></i>Lecci√≥n Completada';
                completeButton.classList.add('btn', 'btn-success');
                completeButton.classList.remove('btn-uah-success');
                completeButton.disabled = true;
            } else {
                completeButton.innerHTML = '<i class="bi bi-check-circle me-2"></i>Marcar como Completada';
                completeButton.classList.add('btn-uah-success');
                completeButton.classList.remove('btn', 'btn-success');
                completeButton.disabled = false;
            }
        }

        function goToPreviousLesson() {
            if (currentLesson > 1) {
                loadLesson(currentLesson - 1);
            }
        }

        function goToNextLesson() {
            if (currentLesson < 3) {
                loadLesson(currentLesson + 1);
            }
        }

        async function completeLesson() {
            if (completedLessons.includes(currentLesson)) {
                console.log('‚ÑπÔ∏è Lecci√≥n ya completada');
                return;
            }

            completedLessons.push(currentLesson);
            moduleProgress = Math.round((completedLessons.length / 3) * 100);
            
            console.log('‚úì Lecci√≥n completada:', currentLesson, '- Progreso:', moduleProgress + '%');
            
            await saveProgress();
            
            updateProgressDisplay();
            updateSidebarProgress();
            updateNavigationButtons();
            
            if (moduleProgress >= 100) {
                showNotification('¬°Felicitaciones! Has completado el M√≥dulo 1: Observaci√≥n y Gesto', 'success');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
            } else {
                showNotification('¬°Lecci√≥n ' + currentLesson + ' completada!', 'success');
                
                if (currentLesson < 3) {
                    setTimeout(() => {
                        loadLesson(currentLesson + 1);
                    }, 2000);
                }
            }
        }

        async function saveProgress() {
            console.log('üíæ Guardando progreso...');
            
            const progressData = {
                progress: moduleProgress,
                completed: moduleProgress >= 100,
                completedLessons: completedLessons,
                timeSpent: 0,
                lastUpdate: new Date().toISOString()
            };
            
            const progressKey = `progress_${currentUser.username || currentUser.email}`;
            let userProgress = JSON.parse(localStorage.getItem(progressKey) || 'null');
            
            if (!userProgress) {
                userProgress = initializeLocalProgress();
            }

            userProgress.modules[1] = progressData;
            
            let totalProgress = 0;
            for (let id in userProgress.modules) {
                totalProgress += userProgress.modules[id].progress || 0;
            }
            userProgress.overallProgress = Math.round(totalProgress / 3);
            userProgress.lastActivity = new Date().toISOString();

            localStorage.setItem(progressKey, JSON.stringify(userProgress));
            console.log('‚úì Guardado en localStorage');

            try {
                if (isOnline && typeof updateModuleProgress === 'function') {
                    console.log('‚òÅÔ∏è Sincronizando con Google Sheets...');
                    const success = await updateModuleProgress(1, progressData);
                    
                    if (success) {
                        console.log('‚úì Sincronizado con Google Sheets');
                    } else {
                        console.warn('‚ö† No se pudo sincronizar con Sheets');
                    }
                } else {
                    console.log('üî¥ Modo offline - solo localStorage');
                }
                
                if (typeof logUserActivity === 'function') {
                    logUserActivity('lesson_completed', currentUser, {
                        moduleId: 1,
                        lessonId: currentLesson,
                        progress: moduleProgress
                    });
                }
                
            } catch (error) {
                console.error('‚úñ Error sincronizando:', error);
            }
        }

        async function syncProgressWithSheets() {
            try {
                if (!isOnline || typeof updateModuleProgress !== 'function') return;
                
                const progressKey = `progress_${currentUser.username || currentUser.email}`;
                const localProgress = JSON.parse(localStorage.getItem(progressKey) || 'null');
                
                if (localProgress && localProgress.modules[1]) {
                    console.log('üîÑ Sincronizando progreso local...');
                    const success = await updateModuleProgress(1, localProgress.modules[1]);
                    
                    if (success) {
                        console.log('‚úì Sincronizaci√≥n completada');
                        showNotification('Progreso sincronizado con la nube', 'info');
                    }
                }
            } catch (error) {
                console.error('‚úñ Error en sincronizaci√≥n autom√°tica:', error);
            }
        }

        function showNotification(message, type = 'success') {
            const toastEl = document.getElementById('notificationToast');
            const toastBody = document.getElementById('toastBody');
            const toastIcon = document.getElementById('toastIcon');
            
            const icons = {
                success: 'bi-check-circle-fill text-success',
                error: 'bi-x-circle-fill text-danger',
                warning: 'bi-exclamation-triangle-fill text-warning',
                info: 'bi-info-circle-fill text-info'
            };
            
            toastIcon.className = icons[type] || icons.success;
            toastIcon.className += ' me-2';
            toastBody.textContent = message;
            
            const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
            toast.show();
        }

        window.addEventListener('error', function(e) {
            console.error('‚úñ Error global:', e);
        });

        window.addEventListener('beforeunload', function() {
            if (moduleProgress > 0 && completedLessons.length > 0) {
                saveProgress();
            }
        });
    </script>
</body>
</html><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="M√≥dulo 1: Observaci√≥n y Gesto - M√©todo Leonardo da Vinci">
    <title>M√≥dulo 1: Ver para Dibujar - LMS UAH</title>
    
    <!-- Bootstrap 5.3.2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        :root {
            --primary-dark: #2c5f66;
            --primary-light: #e8a2b8;
            --dark: #1a1a1a;
            --success: #4CAF50;
            --warning: #FFC107;
            --danger: #f44336;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
        }

        .header-uah {
            background: linear-gradient(135deg, var(--primary-dark), var(--dark));
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1030;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .back-btn {
            color: white;
            text-decoration: none;
            transition: opacity 0.3s;
        }

        .back-btn:hover {
            opacity: 0.8;
            color: white;
        }

        .sidebar-lesson {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            position: sticky;
            top: 90px;
            max-height: calc(100vh - 110px);
            overflow-y: auto;
        }

        .lesson-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 8px;
            text-decoration: none;
            color: var(--dark);
            transition: all 0.3s;
            cursor: pointer;
            margin-bottom: 0.5rem;
            border: 2px solid transparent;
        }

        .lesson-link:hover {
            background: #f8f9fa;
        }

        .lesson-link.active {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            color: white;
            border-color: var(--primary-dark);
        }

        .lesson-number {
            width: 35px;
            height: 35px;
            background: #e9ecef;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .lesson-link.active .lesson-number {
            background: rgba(255,255,255,0.3);
            color: white;
        }

        .lesson-link.completed .lesson-number {
            background: var(--success);
            color: white;
        }

        .lesson-link.completed::after {
            content: '‚úì';
            margin-left: auto;
            font-weight: bold;
        }

        .progress-uah {
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .progress-bar-uah {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-dark), var(--primary-light));
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 1rem;
            color: white;
            font-weight: bold;
            transition: width 0.5s ease;
        }

        /* Media containers */
        .media-container {
            background: #f8f9fa;
            border: 2px dashed var(--primary-dark);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .media-container.video {
            min-height: 400px;
            background: linear-gradient(135deg, #f3e5f5, #e8f5e9);
        }

        .media-container.image {
            min-height: 350px;
            background: linear-gradient(135deg, #fff3e0, #fce4ec);
        }

        .media-container.gallery {
            min-height: 450px;
            background: linear-gradient(135deg, #e1f5fe, #fff8e1);
        }

        .media-placeholder {
            color: var(--primary-dark);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .media-description {
            color: var(--dark);
            margin-top: 1rem;
            font-size: 0.95rem;
            max-width: 600px;
        }

        .exercise-box {
            background: linear-gradient(135deg, #fff8e1, #fce4ec);
            border-left: 4px solid var(--primary-dark);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }

        .exercise-title {
            font-weight: bold;
            color: var(--primary-dark);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .leonardo-quote {
            background: linear-gradient(135deg, #e8f5e9, #e1f5fe);
            border-left: 4px solid var(--success);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
            font-style: italic;
        }

        .content-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .lesson-content h3 {
            color: var(--primary-dark);
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .lesson-content h4 {
            color: var(--dark);
            margin-top: 1.5rem;
            margin-bottom: 0.8rem;
        }

        .lesson-content p {
            line-height: 1.8;
            margin-bottom: 1rem;
        }

        .btn-uah-primary {
            background: var(--primary-dark);
            border: none;
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .btn-uah-primary:hover:not(:disabled) {
            background: var(--primary-light);
            color: var(--dark);
            transform: translateY(-2px);
        }

        .btn-uah-primary:disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-uah-success {
            background: var(--success);
            border: none;
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-weight: 600;
        }

        .btn-uah-success:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .lesson-content {
            animation: fadeIn 0.5s ease;
        }

        @media (max-width: 991px) {
            .sidebar-lesson {
                position: static;
                margin-bottom: 2rem;
            }
            
            .media-container {
                min-height: 250px;
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <script src="auth.js"></script>

    <!-- Header -->
    <header class="header-uah">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-auto">
                    <a href="index.html" class="back-btn d-flex align-items-center gap-2">
                        <i class="bi bi-arrow-left"></i>
                        <span>Volver al Curso</span>
                    </a>
                </div>
                <div class="col text-center">
                    <h1 class="h4 mb-0">M√≥dulo 1: Observaci√≥n y Gesto</h1>
                    <small class="text-white-50">"Ver para Dibujar, Dibujar para Ver"</small>
                </div>
                <div class="col-auto">
                    <span class="badge bg-light text-dark" id="progressText">0% Completado</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container-fluid py-4">
        <div class="row">
            <!-- Sidebar -->
            <aside class="col-lg-3">
                <div class="sidebar-lesson">
                    <h5 class="mb-3">
                        <i class="bi bi-eye me-2"></i>Lecciones
                    </h5>
                    <div class="lesson-list">
                        <a class="lesson-link active" data-lesson="1" onclick="loadLesson(1)">
                            <span class="lesson-number">1</span>
                            <span class="flex-grow-1">El Acto de Observar</span>
                        </a>
                        <a class="lesson-link" data-lesson="2" onclick="loadLesson(2)">
                            <span class="lesson-number">2</span>
                            <span class="flex-grow-1">La L√≠nea como Movimiento</span>
                        </a>
                        <a class="lesson-link" data-lesson="3" onclick="loadLesson(3)">
                            <span class="lesson-number">3</span>
                            <span class="flex-grow-1">Volumen y Masa</span>
                        </a>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="col-lg-9">
                <div class="content-card">
                    <!-- Progress Bar -->
                    <div class="progress-uah">
                        <div class="progress-bar-uah" id="moduleProgress" style="width: 0%">
                            <span>0%</span>
                        </div>
                    </div>

                    <!-- Content Header -->
                    <div class="border-bottom pb-3 mb-4">
                        <h2 class="lesson-title h3 mb-2" id="lessonTitle">Lecci√≥n 1: El Acto de Observar</h2>
                        <div class="d-flex gap-3 text-muted small lesson-meta" id="lessonMeta">
                            <span><i class="bi bi-clock me-1"></i>15 minutos</span>
                            <span><i class="bi bi-book me-1"></i>Observaci√≥n</span>
                        </div>
                    </div>

                    <!-- Lesson Content -->
                    <div class="lesson-content" id="lessonContent">
                        <p>Cargando contenido...</p>
                    </div>

                    <!-- Navigation -->
                    <div class="d-flex justify-content-between align-items-center pt-4 mt-4 border-top flex-wrap gap-3">
                        <button class="btn btn-uah-primary" id="prevButton" onclick="goToPreviousLesson()">
                            <i class="bi bi-arrow-left me-2"></i>Lecci√≥n Anterior
                        </button>

                        <button class="btn btn-uah-success" onclick="completeLesson()" id="completeButton">
                            <i class="bi bi-check-circle me-2"></i>Marcar como Completada
                        </button>

                        <button class="btn btn-uah-primary" id="nextButton" onclick="goToNextLesson()">
                            Siguiente Lecci√≥n<i class="bi bi-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="notificationToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="bi bi-check-circle-fill text-success me-2" id="toastIcon"></i>
                <strong class="me-auto">Notificaci√≥n</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastBody">
                Mensaje aqu√≠
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let currentUser = null;
        let currentLesson = 1;
        let moduleProgress = 0;
        let completedLessons = [];
        let isOnline = navigator.onLine;
        
        window.currentModuleId = 1;

        const lessonsContent = {
            1: {
                title: 'El Acto de Observar',
                meta: '<span><i class="bi bi-clock me-1"></i>15 minutos</span><span><i class="bi bi-book me-1"></i>Observaci√≥n</span>',
                content: `
                    <div class="leonardo-quote">
                        <i class="bi bi-quote text-success fs-3"></i>
                        <p class="mb-0 mt-2">"La pintura es cosa mental. El buen pintor ha de pintar dos cosas principales: el hombre y la intenci√≥n de su alma."</p>
                        <small class="text-muted d-block mt-2">‚Äî Leonardo da Vinci, Tratado de la Pintura (c. 1490)</small>
                    </div>

                    <!-- VIDEO PLACEHOLDER 1: Introducci√≥n al Saper Vedere -->
                    <div class="media-container video">
                        <i class="bi bi-play-circle display-1 text-primary mb-3"></i>
                        <div class="media-placeholder">üìπ VIDEO: "El Saper Vedere de Leonardo"</div>
                        <div class="media-description">
                            <strong>Duraci√≥n:</strong> 3-4 minutos<br>
                            <strong>Contenido sugerido:</strong>
                            <ul class="text-start mt-2">
                                <li>Introducci√≥n personal tuya explicando el concepto</li>
                                <li>Mostrar cuadernos de Leonardo (im√°genes de dominio p√∫blico)</li>
                                <li>Demostraci√≥n en vivo: c√≥mo observas T√ö algo antes de dibujarlo</li>
                                <li>Contraste visual: reconocimiento r√°pido vs. observaci√≥n contemplativa</li>
                            </ul>
                            <small class="text-muted"><em>Recomendaci√≥n t√©cnica: Video en formato 16:9, subt√≠tulos incluidos, pausable</em></small>
                        </div>
                    </div>

                    <h3>Observaci√≥n vs. Reconocimiento</h3>
                    <p class="lead">El primer obst√°culo para dibujar bien es que nuestro cerebro <strong>reconoce</strong> en lugar de <strong>observar</strong>.</p>

                    <!-- IMAGEN PLACEHOLDER 1: Comparaci√≥n Visual -->
                    <div class="media-container image">
                        <i class="bi bi-image display-1 text-warning mb-3"></i>
                        <div class="media-placeholder">üñºÔ∏è IMAGEN COMPARATIVA: Reconocimiento vs. Observaci√≥n</div>
                        <div class="media-description">
                            <strong>Recurso sugerido:</strong> Infograf√≠a dividida en 2 columnas
                            <ul class="text-start mt-2">
                                <li><strong>Lado izquierdo (Reconocimiento):</strong> Dibujo simb√≥lico gen√©rico de una mano con etiquetas: "S√≠mbolo mental", "5 dedos", "Forma conocida"</li>
                                <li><strong>Lado derecho (Observaci√≥n):</strong> Dibujo realista espec√≠fico con anotaciones: "Esta mano", "Este √°ngulo", "Esta luz"</li>
                                <li>Usa √≠conos ‚ùå y ‚úì para reforzar el mensaje</li>
                            </ul>
                            <small class="text-muted"><em>Formato: PNG o JPG, alta resoluci√≥n, texto legible en m√≥vil</em></small>
                        </div>
                    </div>

                    <h4>Principio Fundamental</h4>
                    <div class="alert alert-primary border-0">
                        <h5 class="alert-heading"><i class="bi bi-lightbulb-fill me-2"></i>Dibuja lo que VES, no lo que SABES</h5>
                        <p class="mb-0">Tu conocimiento previo puede sabotear tu capacidad de ver lo que realmente tienes frente a ti.</p>
                    </div>

                    <h3>Los Tres Niveles de Observaci√≥n</h3>

                    <!-- GALER√çA PLACEHOLDER 1: Tres Niveles -->
                    <div class="media-container gallery">
                        <i class="bi bi-grid-3x3 display-1 text-info mb-3"></i>
                        <div class="media-placeholder">üé® GALER√çA INTERACTIVA: Tres Niveles de Observaci√≥n</div>
                        <div class="media-description">
                            <strong>Recurso sugerido:</strong> 3 im√°genes secuenciales del mismo objeto
                            <ul class="text-start mt-2">
                                <li><strong>Imagen 1 - Forma General:</strong> Figura humana con overlay de forma geom√©trica simple (cilindro, esfera)</li>
                                <li><strong>Imagen 2 - Relaciones:</strong> Misma figura con l√≠neas mostrando √°ngulos, proporciones, conexiones</li>
                                <li><strong>Imagen 3 - Car√°cter:</strong> Figura completa con detalles espec√≠ficos resaltados (tensi√≥n muscular, peso, inclinaci√≥n)</li>
                            </ul>
                            <small class="text-muted"><em>Implementaci√≥n: Carousel Bootstrap o grid simple 3 columnas</em></small>
                        </div>
                    </div>

                    <div class="exercise-box">
                        <div class="exercise-title">
                            <i class="bi bi-pencil-square me-2"></i>Ejercicio 1: "Observaci√≥n Contemplativa de tu Mano"
                        </div>
                        
                        <p><strong>Tiempo:</strong> 15 minutos (2 min observar + 10 min dibujar + 3 min reflexionar)</p>
                        
                        <p><strong>Instrucciones:</strong></p>
                        <ol>
                            <li>Coloca tu mano en posici√≥n c√≥moda con buena iluminaci√≥n</li>
                            <li><strong>Observa 2 minutos sin dibujar:</strong> forma general, sombras, conexiones</li>
                            <li><strong>Dibuja 10 minutos:</strong> mira tu mano 90% del tiempo, el papel solo 10%</li>
                            <li>No corrijas ni borres. Acepta las imperfecciones.</li>
                        </ol>

                        <div class="alert alert-warning border-0 mt-3">
                            <p class="mb-0"><strong>Regla cr√≠tica:</strong> Si tu mente dice "s√© c√≥mo es una mano", detente y pregunta: "¬øC√≥mo es <em>ESTA</em> mano?"</p>
                        </div>

                        <p class="mt-3"><strong>Entregable:</strong></p>
                        <ul>
                            <li>1 fotograf√≠a de tu dibujo (buena iluminaci√≥n, enfoque claro)</li>
                            <li>Reflexi√≥n escrita (100 palabras): "¬øQu√© vi que nunca hab√≠a notado antes?"</li>
                        </ul>
                    </div>

                    <div class="alert alert-info border-0">
                        <p class="mb-0"><strong>Evidencia Cient√≠fica:</strong> Chamberlain et al. (2014) demostraron que "aprender a ver" produce cambios medibles en el cerebro. La observaci√≥n es una habilidad entrenable, no un talento innato.</p>
                    </div>
                `
            },
            2: {
                title: 'La L√≠nea como Movimiento',
                meta: '<span><i class="bi bi-clock me-1"></i>15 minutos</span><span><i class="bi bi-book me-1"></i>Gesto</span>',
                content: `
                    <div class="leonardo-quote">
                        <i class="bi bi-quote text-success fs-3"></i>
                        <p class="mb-0 mt-2">"El movimiento es causa de toda vida."</p>
                        <small class="text-muted d-block mt-2">‚Äî Leonardo da Vinci, Cuadernos</small>
                    </div>

                    <!-- VIDEO PLACEHOLDER 2: Demostraci√≥n de Croquis Gestual -->
                    <div class="media-container video">
                        <i class="bi bi-play-circle display-1 text-primary mb-3"></i>
                        <div class="media-placeholder">üìπ VIDEO: "Croquis Gestual en Tiempo Real"</div>
                        <div class="media-description">
                            <strong>Duraci√≥n:</strong> 5-6 minutos<br>
                            <strong>Contenido sugerido:</strong>
                            <ul class="text-start mt-2">
                                <li><strong>0:00-1:00:</strong> Explicaci√≥n del concepto de l√≠nea de acci√≥n</li>
                                <li><strong>1:00-3:00:</strong> T√ö dibujando 3 croquis de 30 segundos (time-lapse)</li>
                                <li><strong>3:00-5:00:</strong> T√ö dibujando 2 croquis de 1 minuto (tiempo real)</li>
                                <li><strong>5:00-6:00:</strong> An√°lisis de los dibujos: qu√© capturaste, qu√© ignoraste intencionalmente</li>
                            </ul>
                            <small class="text-muted"><em>C√°mara cenital mostrando tu mano dibujando + resultado final</em></small>
                        </div>
                    </div>

                    <h3>¬øQu√© es la L√≠nea de Acci√≥n?</h3>
                    <p>Una curva imaginaria que atraviesa la figura, capturando su <strong>direcci√≥n principal</strong> de movimiento o peso. No es real, es una abstracci√≥n que resume la intenci√≥n de la pose.</p>

                    <!-- IMAGEN PLACEHOLDER 2: L√≠nea de Acci√≥n Ejemplos -->
                    <div class="media-container image">
                        <i class="bi bi-image display-1 text-warning mb-3"></i>
                        <div class="media-placeholder">üñºÔ∏è DIAGRAMA: Tipos de L√≠nea de Acci√≥n</div>
                        <div class="media-description">
                            <strong>Recurso sugerido:</strong> Infograf√≠a con 3 figuras humanas
                            <ul class="text-start mt-2">
                                <li><strong>Figura 1:</strong> Pose con l√≠nea ascendente (salto) - overlay en rojo mostrando la curva</li>
                                <li><strong>Figura 2:</strong> Pose con curva S (contrapposto) - overlay en azul</li>
                                <li><strong>Figura 3:</strong> Pose con l√≠nea descendente (agachado) - overlay en verde</li>
                                <li>Flechas indicando direcci√≥n del movimiento</li>
                            </ul>
                            <small class="text-muted"><em>Estilo: Ilustraci√≥n limpia, colores contrastantes para claridad</em></small>
                        </div>
                    </div>

                    <h4>Los Tres Elementos del Gesto</h4>
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <div class="card h-100 border-primary">
                                <div class="card-body text-center">
                                    <i class="bi bi-arrow-up-right text-primary" style="font-size: 2.5rem;"></i>
                                    <h6 class="mt-2">1. Direcci√≥n</h6>
                                    <p class="small mb-0">¬øHacia d√≥nde se mueve la figura?</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card h-100 border-warning">
                                <div class="card-body text-center">
                                    <i class="bi bi-circle-half text-warning" style="font-size: 2.5rem;"></i>
                                    <h6 class="mt-2">2. Peso</h6>
                                    <p class="small mb-0">¬øD√≥nde est√° el centro de gravedad?</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card h-100 border-success">
                                <div class="card-body text-center">
                                    <i class="bi bi-soundwave text-success" style="font-size: 2.5rem;"></i>
                                    <h6 class="mt-2">3. Ritmo</h6>
                                    <p class="small mb-0">¬øC√≥mo se alternan tensi√≥n y relajaci√≥n?</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- GALER√çA PLACEHOLDER 2: Proceso de Croquis -->
                    <div class="media-container gallery">
                        <i class="bi bi-grid-3x3 display-1 text-info mb-3"></i>
                        <div class="media-placeholder">üé® SECUENCIA: Del Gesto al Detalle</div>
                        <div class="media-description">
                            <strong>Recurso sugerido:</strong> Progresi√≥n de un mismo croquis
                            <ul class="text-start mt-2">
                                <li><strong>Paso 1 (30 segundos):</strong> Solo l√≠nea de acci√≥n + masa general</li>
                                <li><strong>Paso 2 (1 minuto):</strong> L√≠nea de acci√≥n + indicaci√≥n de extremidades principales</li>
                                <li><strong>Paso 3 (2 minutos):</strong> Todo lo anterior + sugerencia de volumen b√°sico</li>
                                <li>Cada imagen con timer visible y anotaciones de lo que se captur√≥</li>
                            </ul>
                            <small class="text-muted"><em>Ideal: Tus propios dibujos fotografiados o escaneados</em></small>
                        </div>
                    </div>

                    <div class="exercise-box">
                        <div class="exercise-title">
                            <i class="bi bi-pencil-square me-2"></i>Ejercicio 2: Serie de Croquis Gestuales
                        </div>
                        
                        <p><strong>Tiempo total:</strong> 20 minutos de dibujo activo</p>
                        
                        <p><strong>Materiales:</strong> Papel, carboncillo o l√°piz blando (4B-6B), cron√≥metro</p>
                        
                        <p><strong>Referencias:</strong> Usa <a href="https://line-of-action.com" target="_blank" class="text-primary">Line of Action</a> (gratuito) o videos en YouTube de "gesture drawing reference"</p>

                        <p><strong>Serie de tiempos:</strong></p>
                        <ul>
                            <li><strong>5 croquis de 30 segundos:</strong> Solo l√≠nea de acci√≥n</li>
                            <li><strong>5 croquis de 1 minuto:</strong> L√≠nea de acci√≥n + peso</li>
                            <li><strong>5 croquis de 2 minutos:</strong> Todo anterior + ritmo</li>
                        </ul>

                        <div class="alert alert-warning border-0 mt-3">
                            <p class="mb-0"><strong>Regla:</strong> No levantes el l√°piz innecesariamente. No borres nada. Prioriza direcci√≥n sobre detalle.</p>
                        </div>

                        <p class="mt-3"><strong>Entregable:</strong></p>
                        <ul>
                            <li>Fotograf√≠a de 15 croquis completos (puede ser en varias hojas)</li>
                            <li>Reflexi√≥n (150 palabras): "¬øQu√© fue m√°s dif√≠cil capturar: direcci√≥n, peso o ritmo?"</li>
                        </ul>
                    </div>

                    <div class="alert alert-info border-0">
                        <p class="mb-0"><strong>Neurociencia:</strong> El dibujo r√°pido desactiva el pensamiento anal√≠tico y activa la percepci√≥n visual directa. Tu mano responde a lo que tu ojo ve sin interferencia del conocimiento conceptual.</p>
                    </div>
                `
            },
            3: {
                title: 'Volumen y Masa',
                meta: '<span><i class="bi bi-clock me-1"></i>15 minutos</span><span><i class="bi bi-book me-1"></i>Tridimensionalidad</span>',
                content: `
                    <div class="leonardo-quote">
                        <i class="bi bi-quote text-success fs-3"></i>
                        <p class="mb-0 mt-2">"La luz y la sombra hacen que el cuerpo parezca tener relieve."</p>
                        <small class="text-muted d-block mt-2">‚Äî Leonardo da Vinci, Tratado de la Pintura</small>
                    </div>

                    <!-- VIDEO PLACEHOLDER 3: Luz y Volumen -->
                    <div class="media-container video">
                        <i class="bi bi-play-circle display-1 text-primary mb-3"></i>
                        <div class="media-placeholder">üìπ VIDEO: "Construyendo Volumen con Luz"</div>
                        <div class="media-description">
                            <strong>Duraci√≥n:</strong> 4-5 minutos<br>
                            <strong>Contenido sugerido:</strong>
                            <ul class="text-start mt-2">
                                <li><strong>0:00-1:00:</strong> Demostraci√≥n con objeto simple (manzana, pelota) bajo luz direccional</li>
                                <li><strong>1:00-2:30:</strong> T√ö dibujando tu brazo con l√°mpara lateral (time-lapse)</li>
                                <li><strong>2:30-4:00:</strong> An√°lisis: identificar zona de luz, medios tonos, sombra propia</li>
                                <li><strong>4:00-5:00:</strong> Comparaci√≥n con estudio anat√≥mico de Leonardo (dominio p√∫blico)</li>
                            </ul>
                            <small class="text-muted"><em>Setup simple: l√°mpara de escritorio + c√°mara fija mostrando proceso</em></small>
                        </div>
                    </div>

                    <h3>De la L√≠nea a la Masa</h3>
                    <p class="lead">El volumen no se logra con m√°s l√≠neas, sino <strong>observando c√≥mo la luz revela la forma</strong>.</p>

                    <!-- IMAGEN PLACEHOLDER 3: Diagrama de Luz -->
                    <div class="media-container image">
                        <i class="bi bi-image display-1 text-warning mb-3"></i>
                        <div class="media-placeholder">üñºÔ∏è DIAGRAMA: Las Tres Zonas de Luz</div>
                        <div class="media-description">
                            <strong>Recurso sugerido:</strong> Infograf√≠a educativa
                            <ul class="text-start mt-2">
                                <li>Esfera o cilindro simple con fuente de luz direccional</li>
                                <li><strong>Zona 1 (amarillo):</strong> Luz directa - plano que mira hacia la luz</li>
                                <li><strong>Zona 2 (gris):</strong> Medios tonos - transici√≥n gradual</li>
                                <li><strong>Zona 3 (negro):</strong> Sombra propia - plano alejado de la luz</li>
                                <li>Flechas indicando direcci√≥n de luz y gradaci√≥n</li>
                            </ul>
                            <small class="text-muted"><em>Estilo: Diagrama t√©cnico limpio, colores codificados</em></small>
                        </div>
                    </div>

                    <h4>Formas Geom√©tricas como Herramientas</h4>
                    <p>Leonardo reduc√≠a formas complejas a geometr√≠a simple no porque el cuerpo sea geom√©trico, sino para comprender c√≥mo la luz las afecta.</p>

                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <div class="card h-100 border-info text-center">
                                <div class="card-body">
                                    <i class="bi bi-circle text-info" style="font-size: 2.5rem;"></i>
                                    <h6 class="mt-2">Esfera</h6>
                                    <p class="small mb-0">Cabeza, articulaciones, m√∫sculos redondeados</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card h-100 border-warning text-center">
                                <div class="card-body">
                                    <i class="bi bi-egg text-warning" style="font-size: 2.5rem;"></i>
                                    <h6 class="mt-2">Cilindro</h6>
                                    <p class="small mb-0">Cuello, brazos, piernas, torso</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card h-100 border-danger text-center">
                                <div class="card-body">
                                    <i class="bi bi-box text-danger" style="font-size: 2.5rem;"></i>
                                    <h6 class="mt-2">Planos</h6>
                                    <p class="small mb-0">Rostro, manos, pies, huesos visibles</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- GALER√çA PLACEHOLDER 3: Estudios de Leonardo -->
                    <div class="media-container gallery">
                        <i class="bi bi-grid-3x3 display-1 text-info mb-3"></i>
                        <div class="media-placeholder">üé® GALER√çA: Estudios Anat√≥micos de Leonardo da Vinci</div>
                        <div class="media-description">
                            <strong>Recurso sugerido:</strong> 4-6 im√°genes de dominio p√∫blico
                            <ul class="text-start mt-2">
                                <li><strong>Imagen 1:</strong> Estudio de brazo mostrando estructura √≥sea (Royal Collection Trust)</li>
                                <li><strong>Imagen 2:</strong> Estudio de mano con sombreado (Windsor Collection)</li>
                                <li><strong>Imagen 3:</strong> Estudio de pierna con musculatura visible</li>
                                <li><strong>Imagen 4:</strong> Estudio de hombro y cuello</li>
                                <li>Cada imagen con breve descripci√≥n: "Observa c√≥mo usa l√≠neas paralelas para sombreado"</li>
                            </ul>
                            <small class="text-muted"><em>Fuente: Wikimedia Commons / Royal Collection Trust (dominio p√∫blico)</em></small>
                        </div>
                    </div>

                    <div class="alert alert-primary border-0">
                        <h5 class="alert-heading"><i class="bi bi-lightbulb-fill me-2"></i>Principio del Volumen</h5>
                        <p class="mb-0">No dibujes l√≠neas que separan luz de sombra. Usa <strong>gradaci√≥n de valor</strong> (tono) para crear la transici√≥n.</p>
                    </div>

                    <div class="exercise-box">
                        <div class="exercise-title">
                            <i class="bi bi-pencil-square me-2"></i>Ejercicio 3: Estudio de Volumen + Copia de Leonardo
                        </div>
                        
                        <p><strong>Parte A: Tu Brazo con Luz Dirigida (30 minutos)</strong></p>
                        
                        <p><strong>Setup:</strong></p>
                        <ul>
                            <li>Coloca l√°mpara a 45¬∞ de tu brazo</li>
                            <li>Ambiente relativamente oscuro</li>
                            <li>Observa gradaci√≥n de brillante a oscuro</li>
                        </ul>

                        <p><strong>Proceso:</strong></p>
                        <ol>
                            <li><strong>0-5 min:</strong> Observa sin dibujar (identifica luz, sombra, transici√≥n)</li>
                            <li><strong>5-10 min:</strong> Contorno b√°sico con l√≠nea ligera</li>
                            <li><strong>10-25 min:</strong> Construye volumen mediante gradaci√≥n</li>
                            <li><strong>25-30 min:</strong> Refina transiciones</li>
                        </ol>

                        <div class="alert alert-warning border-0 mt-3">
                            <p class="mb-0"><strong>Regla:</strong> No uses l√≠neas para separar luz y sombra. Solo gradaci√≥n de tono.</p>
                        </div>

                        <p class="mt-3"><strong>Parte B: Copiar Estudio de Leonardo (20 minutos)</strong></p>
                        <ul>
                            <li>Elige uno de los estudios de la galer√≠a arriba</li>
                            <li>Copia observando: uso de l√≠neas, sombreado, √©nfasis estructural</li>
                            <li>No busques perfecci√≥n, busca comprender su m√©todo</li>
                        </ul>

                        <p class="mt-3"><strong>Entregable:</strong></p>
                        <ul>
                            <li>Fotograf√≠a de tu estudio de brazo (30 min)</li>
                            <li>Fotograf√≠a de tu copia de Leonardo (20 min)</li>
                            <li>Reflexi√≥n (150 palabras): "¬øC√≥mo cambia mi percepci√≥n cuando pienso en t√©rminos de luz y planos en lugar de l√≠neas?"</li>
                        </ul>
                    </div>

                    <h3>Integraci√≥n: Gesto + Volumen</h3>
                    <div class="alert alert-success border-0">
                        <h6 class="alert-heading"><i class="bi bi-trophy me-2"></i>Proceso Completo Leonardo</h6>
                        <ol class="mb-0">
                            <li><strong>Gesto (30 seg - 1 min):</strong> Captura l√≠nea de acci√≥n y direcci√≥n</li>
                            <li><strong>Formas volum√©tricas (2-3 min):</strong> Agrega cilindros y esferas sobre estructura</li>
                            <li><strong>Observar luz (1 min):</strong> Identifica zonas brillantes y oscuras</li>
                            <li><strong>Construir volumen (5-10 min):</strong> Grad√∫a de luz a sombra</li>
                        </ol>
                    </div>

                    <!-- VIDEO/IMAGEN PLACEHOLDER 4: Integraci√≥n Final -->
                    <div class="media-container video">
                        <i class="bi bi-play-circle display-1 text-primary mb-3"></i>
                        <div class="media-placeholder">üìπ VIDEO BONUS: "Del Gesto al Volumen - Proceso Completo"</div>
                        <div class="media-description">
                            <strong>Duraci√≥n:</strong> 3 minutos (opcional)<br>
                            <strong>Contenido sugerido:</strong>
                            <ul class="text-start mt-2">
                                <li>Time-lapse de T√ö dibujando una figura completa</li>
                                <li>Paso 1: Gesto r√°pido (30 seg en tiempo real)</li>
                                <li>Paso 2: Formas volum√©tricas (acelerado)</li>
                                <li>Paso 3: Aplicaci√≥n de luz y sombra (acelerado)</li>
                                <li>Resultado final con comentario tuyo: "Esto es lo que logramos en el M√≥dulo 1"</li>
                            </ul>
                            <small class="text-muted"><em>Este video sirve como cierre motivacional del m√≥dulo</em></small>
                        </div>
                    </div>

                    <h3>Logros del M√≥dulo 1</h3>
                    <div class="card border-success">
                        <div class="card-header bg-success text-white">
                            <i class="bi bi-check-circle-fill me-2"></i><strong>Has completado los fundamentos del m√©todo Leonardo</strong>
                        </div>
                        <div class="card-body">
                            <ul class="mb-0">
                                <li>‚úÖ <strong>Observaci√≥n contemplativa:</strong> Ver m√°s all√° del reconocimiento</li>
                                <li>‚úÖ <strong>Gesto y movimiento:</strong> Capturar energ√≠a antes que detalle</li>
                                <li>‚úÖ <strong>Volumen y luz:</strong> Comprender tridimensionalidad mediante observaci√≥n</li>
                            </ul>
                            <p class="mt-3 mb-0 fw-bold text-primary">Siguiente: M√≥dulo 2 - Anatom√≠a como Comprensi√≥n Org√°nica</p>
                        </div>
                    </div>

                    <div class="alert alert-info border-0 mt-4">
                        <h6 class="alert-heading">üì¶ Entregable Final del M√≥dulo 1</h6>
                        <p><strong>Re√∫ne todos tus ejercicios en un solo documento PDF o carpeta de im√°genes:</strong></p>
                        <ol class="mb-0">
                            <li>Ejercicio 1: Mano observada + reflexi√≥n 100 palabras</li>
                            <li>Ejercicio 2: 15 croquis gestuales + reflexi√≥n 150 palabras</li>
                            <li>Ejercicio 3: Brazo con luz + copia Leonardo + reflexi√≥n 150 palabras</li>
                        </ol>
                    </div>
                `
            }
        };

        window.addEventListener('online', () => {
            isOnline = true;
            console.log('‚úì Conexi√≥n restaurada');
            syncProgressWithSheets();
        });

        window.addEventListener('offline', () => {
            isOnline = false;
            console.log('‚ö† Sin conexi√≥n - modo offline');
        });

        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Inicializando M√≥dulo 1 - M√©todo Leonardo...');
            
            if (typeof getCurrentUser !== 'undefined' && typeof protectPage !== 'undefined') {
                if (!protectPage()) return;
                currentUser = getCurrentUser();
            } else {
                const storedUser = localStorage.getItem('currentUser');
                if (storedUser) {
                    currentUser = JSON.parse(storedUser);
                } else {
                    console.error('‚úñ No hay usuario autenticado');
                    window.location.href = 'login.html';
                    return;
                }
            }

            console.log('‚úì Usuario autenticado:', currentUser);
            
            loadModuleProgress();
            loadLesson(1);
            
            if (typeof logUserActivity === 'function') {
                logUserActivity('module_access', currentUser, { 
                    moduleId: 1,
                    moduleTitle: 'Observaci√≥n y Gesto - M√©todo Leonardo'
                });
            }
        });

        async function loadModuleProgress() {
            console.log('üìä Cargando progreso del M√≥dulo 1...');
            
            try {
                if (isOnline && typeof getStudentProgress === 'function') {
                    console.log('‚òÅÔ∏è Intentando cargar desde Google Sheets...');
                    const sheetsProgress = await getStudentProgress(currentUser.username);
                    
                    if (sheetsProgress && sheetsProgress.modules && sheetsProgress.modules[1]) {
                        moduleProgress = sheetsProgress.modules[1].progress || 0;
                        completedLessons = sheetsProgress.modules[1].completedLessons || [];
                        
                        console.log('‚úì Progreso cargado desde Google Sheets:', {
                            moduleProgress,
                            completedLessons
                        });
                        
                        syncToLocalStorage(sheetsProgress.modules[1]);
                        updateProgressDisplay();
                        updateSidebarProgress();
                        return;
                    }
                }
            } catch (error) {
                console.error('‚úñ Error cargando desde Google Sheets:', error);
            }
            
            console.log('üíæ Cargando desde localStorage (fallback)...');
            const progressKey = `progress_${currentUser.username || currentUser.email}`;
            let userProgress = JSON.parse(localStorage.getItem(progressKey) || 'null');
            
            if (!userProgress) {
                userProgress = initializeLocalProgress();
            }

            userProgress.modules[1] = progressData;
            
            let totalProgress = 0;
            for (let id in userProgress.modules) {
                totalProgress += userProgress.modules[id].progress || 0;
            }
            userProgress.overallProgress = Math.round(totalProgress / 3);
            userProgress.lastActivity = new Date().toISOString();

            localStorage.setItem(progressKey, JSON.stringify(userProgress));
            console.log('‚úì Guardado en localStorage');

            try {
                if (isOnline && typeof updateModuleProgress === 'function') {
                    console.log('‚òÅÔ∏è Sincronizando con Google Sheets...');
                    const success = await updateModuleProgress(1, progressData);
                    
                    if (success) {
                        console.log('‚úì Sincronizado con Google Sheets');
                    } else {
                        console.warn('‚ö† No se pudo sincronizar con Sheets');
                    }
                } else {
                    console.log('üî¥ Modo offline - solo localStorage');
                }
                
                if (typeof logUserActivity === 'function') {
                    logUserActivity('lesson_completed', currentUser, {
                        moduleId: 1,
                        lessonId: currentLesson,
                        progress: moduleProgress
                    });
                }
                
            } catch (error) {
                console.error('‚úñ Error sincronizando:', error);
            }
        }

        async function syncProgressWithSheets() {
            try {
                if (!isOnline || typeof updateModuleProgress !== 'function') return;
                
                const progressKey = `progress_${currentUser.username || currentUser.email}`;
                const localProgress = JSON.parse(localStorage.getItem(progressKey) || 'null');
                
                if (localProgress && localProgress.modules[1]) {
                    console.log('üîÑ Sincronizando progreso local...');
                    const success = await updateModuleProgress(1, localProgress.modules[1]);
                    
                    if (success) {
                        console.log('‚úì Sincronizaci√≥n completada');
                        showNotification('Progreso sincronizado con la nube', 'info');
                    }
                }
            } catch (error) {
                console.error('‚úñ Error en sincronizaci√≥n autom√°tica:', error);
            }
        }

        function showNotification(message, type = 'success') {
            const toastEl = document.getElementById('notificationToast');
            const toastBody = document.getElementById('toastBody');
            const toastIcon = document.getElementById('toastIcon');
            
            const icons = {
                success: 'bi-check-circle-fill text-success',
                error: 'bi-x-circle-fill text-danger',
                warning: 'bi-exclamation-triangle-fill text-warning',
                info: 'bi-info-circle-fill text-info'
            };
            
            toastIcon.className = icons[type] || icons.success;
            toastIcon.className += ' me-2';
            toastBody.textContent = message;
            
            const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
            toast.show();
        }

        window.addEventListener('error', function(e) {
            console.error('‚úñ Error global:', e);
        });

        window.addEventListener('beforeunload', function() {
            if (moduleProgress > 0 && completedLessons.length > 0) {
                saveProgress();
            }
        });
    </script>
</body>
</html> = `progress_${currentUser.username || currentUser.email}`;
            const userProgress = JSON.parse(localStorage.getItem(progressKey) || 'null');
            
            if (userProgress && userProgress.modules && userProgress.modules[1]) {
                moduleProgress = userProgress.modules[1].progress || 0;
                completedLessons = userProgress.modules[1].completedLessons || [];
                
                console.log('‚úì Progreso cargado desde localStorage:', {
                    moduleProgress,
                    completedLessons
                });
            } else {
                console.log('‚ÑπÔ∏è No hay progreso previo - iniciando desde cero');
            }
            
            updateProgressDisplay();
            updateSidebarProgress();
        }

        function syncToLocalStorage(moduleData) {
            const progressKey = `progress_${currentUser.username || currentUser.email}`;
            let userProgress = JSON.parse(localStorage.getItem(progressKey) || 'null');
            
            if (!userProgress) {
                userProgress = initializeLocalProgress();
            }
            
            userProgress.modules[1] = moduleData;
            userProgress.lastActivity = new Date().toISOString();
            localStorage.setItem(progressKey, JSON.stringify(userProgress));
            
            console.log('‚úì Sincronizado con localStorage');
        }

        function initializeLocalProgress() {
            return {
                modules: {
                    1: { completed: false, progress: 0, timeSpent: 0, completedLessons: [] },
                    2: { completed: false, progress: 0, timeSpent: 0, completedLessons: [] },
                    3: { completed: false, progress: 0, timeSpent: 0, completedLessons: [] }
                },
                overallProgress: 0,
                totalTimeSpent: 0,
                lastActivity: new Date().toISOString()
            };
        }

        function updateProgressDisplay() {
            document.getElementById('progressText').textContent = moduleProgress + '% Completado';
            
            const progressBar = document.getElementById('moduleProgress');
            progressBar.style.width = moduleProgress + '%';
            const progressText = progressBar.querySelector('span');
            if (progressText) {
                progressText.textContent = moduleProgress + '%';
            }
        }

        function updateSidebarProgress() {
            document.querySelectorAll('.lesson-link').forEach((link) => {
                const lessonNum = parseInt(link.getAttribute('data-lesson'));
                link.classList.remove('completed');
                
                if (completedLessons.includes(lessonNum)) {
                    link.classList.add('completed');
                }
            });
        }

        function loadLesson(lessonNumber) {
            console.log('üìñ Cargando lecci√≥n:', lessonNumber);
            currentLesson = lessonNumber;
            
            document.querySelectorAll('.lesson-link').forEach((link) => {
                link.classList.remove('active');
                if (parseInt(link.getAttribute('data-lesson')) === lessonNumber) {
                    link.classList.add('active');
                }
            });

            const lesson = lessonsContent[lessonNumber];
            if (lesson) {
                document.getElementById('lessonTitle').textContent = lesson.title;
                document.getElementById('lessonMeta').innerHTML = lesson.meta;
                document.getElementById('lessonContent').innerHTML = lesson.content;
            } else {
                console.error('‚úñ Lecci√≥n no encontrada:', lessonNumber);
            }

            updateNavigationButtons();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateNavigationButtons() {
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');
            const completeButton = document.getElementById('completeButton');

            prevButton.disabled = (currentLesson <= 1);

            if (currentLesson >= 3) {
                nextButton.style.display = 'none';
            } else {
                nextButton.style.display = 'inline-block';
            }

            if (completedLessons.includes(currentLesson)) {
                completeButton.innerHTML = '<i class="bi bi-check-circle-fill me-2"></i>Lecci√≥n Completada';
                completeButton.classList.add('btn', 'btn-success');
                completeButton.classList.remove('btn-uah-success');
                completeButton.disabled = true;
            } else {
                completeButton.innerHTML = '<i class="bi bi-check-circle me-2"></i>Marcar como Completada';
                completeButton.classList.add('btn-uah-success');
                completeButton.classList.remove('btn', 'btn-success');
                completeButton.disabled = false;
            }
        }

        function goToPreviousLesson() {
            if (currentLesson > 1) {
                loadLesson(currentLesson - 1);
            }
        }

        function goToNextLesson() {
            if (currentLesson < 3) {
                loadLesson(currentLesson + 1);
            }
        }

        async function completeLesson() {
            if (completedLessons.includes(currentLesson)) {
                console.log('‚ÑπÔ∏è Lecci√≥n ya completada');
                return;
            }

            completedLessons.push(currentLesson);
            moduleProgress = Math.round((completedLessons.length / 3) * 100);
            
            console.log('‚úì Lecci√≥n completada:', currentLesson, '- Progreso:', moduleProgress + '%');
            
            await saveProgress();
            
            updateProgressDisplay();
            updateSidebarProgress();
            updateNavigationButtons();
            
            if (moduleProgress >= 100) {
                showNotification('¬°Felicitaciones! Has completado el M√≥dulo 1: Observaci√≥n y Gesto', 'success');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
            } else {
                showNotification('¬°Lecci√≥n ' + currentLesson + ' completada!', 'success');
                
                if (currentLesson < 3) {
                    setTimeout(() => {
                        loadLesson(currentLesson + 1);
                    }, 2000);
                }
            }
        }

        async function saveProgress() {
            console.log('üíæ Guardando progreso...');
            
            const progressData = {
                progress: moduleProgress,
                completed: moduleProgress >= 100,
                completedLessons: completedLessons,
                timeSpent: 0,
                lastUpdate: new Date().toISOString()
            };
            
            const progressKey